# 1999 population
print(pop1999)
# average death rates
print(rates)
# first value of age_adj_rate_1999
weighted.mean(rates, pop1999)
# 2013 population
print(pop2013)
# first value of age_adj_rate_2013
weighted.mean(rates, pop2013)
# flag for 1999 and 45-54 age range
ok <- data[,"Year"]==1999 & data[,"Age"] %in% ages_decade[[2]]
# average death rates
rates <- (data[ok&male,"Deaths"] + data[ok&!male,"Deaths"])/(data[ok&male,"Population"] + data[ok&!male,"Population"])
# 1999 population
print(pop1999)
# average death rates
print(rates)
# first value of age_adj_rate_1999
weighted.mean(rates, pop1999)
# 2013 population
print(pop2013)
# first value of age_adj_rate_2013
weighted.mean(rates, pop2013)
# flag for 1999 and 45-54 age range
ok <- data[,"Year"]==1999 & data[,"Age"] %in% ages_decade[[2]]
# average death rates
rates <- (data[ok&male,"Deaths"] + data[ok&!male,"Deaths"])/(data[ok&male,"Population"] + data[ok&!male,"Population"])
# 1999 population
print(pop1999)
# average death rates
print(rates)
# first value of age_adj_rate_1999
weighted.mean(rates, pop1999)
# flag for 1999 and 45-54 age range
ok <- data[,"Year"]==2013 & data[,"Age"] %in% ages_decade[[2]]
# average death rates
rates <- (data[ok&male,"Deaths"] + data[ok&!male,"Deaths"])/(data[ok&male,"Population"] + data[ok&!male,"Population"])
# 2013 population
print(pop2013)
# first value of age_adj_rate_2013
weighted.mean(rates, pop2013)
# flag for 1999 and 45-54 age range
ok <- data[,"Year"]==1999 & data[,"Age"] %in% ages_decade[[2]]
# average death rates
rates <- (data[ok&male,"Deaths"] + data[ok&!male,"Deaths"])/(data[ok&male,"Population"] + data[ok&!male,"Population"])
# 1999 average death rates
print(rates)
# 1999 population
print(pop1999)
# first value of age_adj_rate_1999
weighted.mean(rates, pop1999)
# flag for 1999 and 45-54 age range
ok <- data[,"Year"]==2013 & data[,"Age"] %in% ages_decade[[2]]
# average death rates
rates <- (data[ok&male,"Deaths"] + data[ok&!male,"Deaths"])/(data[ok&male,"Population"] + data[ok&!male,"Population"])
# 2013 average death rates
print(rates)
# 2013 population
print(pop2013)
# first value of age_adj_rate_2013
weighted.mean(rates, pop2013)
DT::datatable(mort_data_totals)
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# multiply each year's age population with 2013 death rate
across(starts_with("total_death_rate"), ~ .x * pop1999, .names = "adj_{.col}")
)
# %>% pivot_longer(
#   # return back to a long table
#   # in order to group by Age, Year and calculate weighted mean
#   !Age,
#   names_to = c(".value", "Year"),
#   names_pattern = "^(.*)_([0-9]{4})$"
# ) %>% group_by(
#   Year
# ) %>% summarise(
#   weighted_mean_extrap = sum(extrap_total_pop) / sum(total_pop)
# )
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# multiply each year's age population with 2013 death rate
across(starts_with("total_death_rate"), ~ sum(.x * pop1999) / sum(pop1999), .names = "adj_{.col}")
)
# %>% pivot_longer(
#   # return back to a long table
#   # in order to group by Age, Year and calculate weighted mean
#   !Age,
#   names_to = c(".value", "Year"),
#   names_pattern = "^(.*)_([0-9]{4})$"
# ) %>% group_by(
#   Year
# ) %>% summarise(
#   weighted_mean_extrap = sum(extrap_total_pop) / sum(total_pop)
# )
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# multiply each year's age population with 2013 death rate
across(starts_with("total_death_rate"), ~ sum(.x * pop1999) / sum(pop1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
# in order to group by Age, Year and calculate weighted mean
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# multiply each year's age population with 2013 death rate
across(starts_with("total_death_rate"), ~ sum(.x * pop1999) / sum(pop1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
# in order to group by Age, Year and calculate weighted mean
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
)
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# multiply each year's age population with 2013 death rate
across(starts_with("total_death_rate"), ~ sum(.x * pop1999) / sum(pop1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
# in order to group by Age, Year and calculate weighted mean
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_1999) / sum(total_pop_1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_1999) / sum(total_pop_1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_2013_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_2013) / sum(total_pop_2013), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
)
DT::datatable(pop_2013_adj_death_rate, options = list(scrollX = TRUE))
pop_2013_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_2013) / sum(total_pop_2013), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
) %>% mutate(
# normalize death rate relative to 1999 value
adj_total_death_rate = adj_total_death_rate / 0.00397199977461337
)
DT::datatable(pop_2013_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_1999) / sum(total_pop_1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
) %>% mutate(
# normalize death rate relative to 1999 value
adj_total_death_rate = adj_total_death_rate / 0.0038151430187487
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
ggplot() +
geom_line(age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate))
class(age_adj_rate_flat_data$Year)
class(pop_1999_adj_death_rate$Year)
class(pop_2013_adj_death_rate$Year)
pop_2013_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_2013) / sum(total_pop_2013), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
) %>% mutate(
# normalize death rate relative to 1999 value
adj_total_death_rate = adj_total_death_rate / 0.00397199977461337,
# make Year continuous
Year = as.numeric(Year)
)
DT::datatable(pop_2013_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_1999) / sum(total_pop_1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
) %>% mutate(
# normalize death rate relative to 1999 value
adj_total_death_rate = adj_total_death_rate / 0.0038151430187487,
# make Year continuous
Year = as.numeric(Year)
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
pop_1999_adj_death_rate <- mort_data_totals %>% pivot_wider(
names_from = Year,
values_from = c(total_death_rate, total_pop),
names_vary = "slowest",
id_cols = c(Age)
) %>% mutate(
# calculate weighted mean for death rates with 1999 population
across(starts_with("total_death_rate"), ~ sum(.x * total_pop_1999) / sum(total_pop_1999), .names = "adj_{.col}")
) %>% pivot_longer(
# return back to a long table
!Age,
names_to = c(".value", "Year"),
names_pattern = "^(.*)_([0-9]{4})$"
) %>% group_by(
Year
) %>% dplyr::select(
# pull columns needed for plot
Year,
adj_total_death_rate
) %>% distinct(
Year, adj_total_death_rate
) %>% mutate(
# normalize death rate relative to 1999 value
adj_total_death_rate = adj_total_death_rate / 0.0038151430187487,
# make Year continuous
Year = as.numeric(Year)
)
DT::datatable(pop_1999_adj_death_rate, options = list(scrollX = TRUE))
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate))
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate), linetype = "dashed") +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate)) +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate), linetype = "dashed") +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate), linetype = "dotted") +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites")
ggplot() +
geom_line(data = age_adj_rate_flat_data, aes(x = Year, y = adj_death_rate)) +
geom_line(data = pop_1999_adj_death_rate, aes(x = Year, y = adj_total_death_rate), linetype = "dashed") +
geom_line(data = pop_2013_adj_death_rate, aes(x = Year, y = adj_total_death_rate), linetype = "dotted") +
scale_y_continuous("Age-adj death rate, relative to 1999", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("It doesn't matter too much what age adjustment\nyou use for 45-54-year-old non-Hisp whites") +
annotate("text", x = 2003, y = 1.053, label = "Using 1999\nage dist") +
annotate("text", x = 2004, y = 1.032, label = "Using 2013\nage dist")
raw_death_rate
raw_death_rate[,2,1]
raw_death_rate_data <- mort_data2 %>% group_by(
Year
) %>% summarize(
death_rate = sum(Deaths) / sum(Population)
)
DT::datatable(raw_death_rate_data)
ggplot(raw_death_rate_data, aes(x = Year, y = death_rate)) +
geom_line() +
scale_y_continuous("Death rates among non-Hisp whites 45-54", expand = c(0,0)) +
scale_x_continuous("Year", breaks = c(2000, 2005, 2010), expand = c(0,0)) +
theme(
panel.background = element_rect(fill = "white"),
axis.line.x = element_line(color = "black"),
axis.line.y = element_line(color = "black"),
panel.grid.major = element_line(color = "grey", linetype = "dotted", size = 0.5),
plot.title = element_text(hjust = 0.5),
axis.text = element_text(size = 10)
) +
ggtitle("Raw death rates\nfor 45-54-year-old non-Hispanic whites")
