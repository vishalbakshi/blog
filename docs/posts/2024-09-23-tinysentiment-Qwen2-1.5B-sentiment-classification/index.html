<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-09-23">
<meta name="description" content="In this blog post I use Qwen2-1.5B-Instruct to classify sentiment in the financial_phrasebank dataset with 86.1% accuracy.">

<title>Sentiment Classification with Qwen2-1.5B-Instruct – Vishal Bakshi’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9c1ae87ad5063dce4f793ccd314a7566.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#prompt-a" id="toc-prompt-a" class="nav-link" data-scroll-target="#prompt-a">Prompt A</a></li>
  <li><a href="#prompt-b" id="toc-prompt-b" class="nav-link" data-scroll-target="#prompt-b">Prompt B</a></li>
  <li><a href="#prompt-c" id="toc-prompt-c" class="nav-link" data-scroll-target="#prompt-c">Prompt C</a></li>
  <li><a href="#prompt-d" id="toc-prompt-d" class="nav-link" data-scroll-target="#prompt-d">Prompt D</a></li>
  <li><a href="#prompt-e" id="toc-prompt-e" class="nav-link" data-scroll-target="#prompt-e">Prompt E</a></li>
  <li><a href="#prompt-f" id="toc-prompt-f" class="nav-link" data-scroll-target="#prompt-f">Prompt F</a></li>
  <li><a href="#prompt-g" id="toc-prompt-g" class="nav-link" data-scroll-target="#prompt-g">Prompt G</a></li>
  <li><a href="#prompt-h" id="toc-prompt-h" class="nav-link" data-scroll-target="#prompt-h">Prompt H</a></li>
  <li><a href="#prompt-i" id="toc-prompt-i" class="nav-link" data-scroll-target="#prompt-i">Prompt I</a></li>
  <li><a href="#prompt-j" id="toc-prompt-j" class="nav-link" data-scroll-target="#prompt-j">Prompt J</a></li>
  <li><a href="#prompt-k" id="toc-prompt-k" class="nav-link" data-scroll-target="#prompt-k">Prompt K</a></li>
  <li><a href="#prompt-l" id="toc-prompt-l" class="nav-link" data-scroll-target="#prompt-l">Prompt L</a></li>
  <li><a href="#prompt-m" id="toc-prompt-m" class="nav-link" data-scroll-target="#prompt-m">Prompt M</a></li>
  <li><a href="#prompt-n" id="toc-prompt-n" class="nav-link" data-scroll-target="#prompt-n">Prompt N</a></li>
  <li><a href="#prompt-o" id="toc-prompt-o" class="nav-link" data-scroll-target="#prompt-o">Prompt O</a></li>
  <li><a href="#prompt-p" id="toc-prompt-p" class="nav-link" data-scroll-target="#prompt-p">Prompt P</a></li>
  <li><a href="#prompt-q" id="toc-prompt-q" class="nav-link" data-scroll-target="#prompt-q">Prompt Q</a></li>
  <li><a href="#prompt-r" id="toc-prompt-r" class="nav-link" data-scroll-target="#prompt-r">Prompt R</a></li>
  <li><a href="#prompt-s" id="toc-prompt-s" class="nav-link" data-scroll-target="#prompt-s">Prompt S</a></li>
  <li><a href="#prompt-t" id="toc-prompt-t" class="nav-link" data-scroll-target="#prompt-t">Prompt T</a></li>
  <li><a href="#prompt-u" id="toc-prompt-u" class="nav-link" data-scroll-target="#prompt-u">Prompt U</a></li>
  <li><a href="#prompt-v" id="toc-prompt-v" class="nav-link" data-scroll-target="#prompt-v">Prompt V</a></li>
  <li><a href="#prompt-w" id="toc-prompt-w" class="nav-link" data-scroll-target="#prompt-w">Prompt W</a></li>
  <li><a href="#prompt-x" id="toc-prompt-x" class="nav-link" data-scroll-target="#prompt-x">Prompt X</a></li>
  <li><a href="#prompt-y" id="toc-prompt-y" class="nav-link" data-scroll-target="#prompt-y">Prompt Y</a></li>
  <li><a href="#prompt-z" id="toc-prompt-z" class="nav-link" data-scroll-target="#prompt-z">Prompt Z</a></li>
  <li><a href="#prompt-aa" id="toc-prompt-aa" class="nav-link" data-scroll-target="#prompt-aa">Prompt AA</a></li>
  <li><a href="#prompt-ab" id="toc-prompt-ab" class="nav-link" data-scroll-target="#prompt-ab">Prompt AB</a></li>
  <li><a href="#prompt-ac" id="toc-prompt-ac" class="nav-link" data-scroll-target="#prompt-ac">Prompt AC</a></li>
  <li><a href="#prompt-ad" id="toc-prompt-ad" class="nav-link" data-scroll-target="#prompt-ad">Prompt AD</a></li>
  <li><a href="#prompt-ae" id="toc-prompt-ae" class="nav-link" data-scroll-target="#prompt-ae">Prompt AE</a></li>
  <li><a href="#prompt-af" id="toc-prompt-af" class="nav-link" data-scroll-target="#prompt-af">Prompt AF</a></li>
  <li><a href="#prompt-ag" id="toc-prompt-ag" class="nav-link" data-scroll-target="#prompt-ag">Prompt AG</a></li>
  <li><a href="#prompt-ah" id="toc-prompt-ah" class="nav-link" data-scroll-target="#prompt-ah">Prompt AH</a></li>
  <li><a href="#prompt-ai" id="toc-prompt-ai" class="nav-link" data-scroll-target="#prompt-ai">Prompt AI</a></li>
  <li><a href="#running-inference-10-times-using-the-best-prompt" id="toc-running-inference-10-times-using-the-best-prompt" class="nav-link" data-scroll-target="#running-inference-10-times-using-the-best-prompt">Running Inference 10 Times Using the Best Prompt</a></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sentiment Classification with Qwen2-1.5B-Instruct</h1>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">TinySentiment</div>
  </div>
  </div>

<div>
  <div class="description">
    In this blog post I use Qwen2-1.5B-Instruct to classify sentiment in the <code>financial_phrasebank</code> dataset with 86.1% accuracy.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:29:36.899920Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:29:36.898890Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:31:45.341672Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:31:45.340913Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:29:36.899823Z&quot;}}">
<details class="code-fold">
<summary>Show pip installs</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install transformers <span class="op">-</span>Uqq</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install accelerate <span class="op">-</span>qq</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install torch<span class="op">==</span><span class="fl">2.2.2</span> <span class="op">-</span>qq</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasets<span class="op">~=</span><span class="fl">2.16.1</span> <span class="op">-</span>qq</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install scikit<span class="op">-</span>learn<span class="op">==</span><span class="fl">1.2</span> <span class="op">-</span>qq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:31:45.344334Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:31:45.344091Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:31:48.090041Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:31:48.089531Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:31:45.344311Z&quot;}}" data-execution_count="2">
<details class="code-fold">
<summary>Show imports and setup</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> transformers</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datasets</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> sklearn.__version__ <span class="op">==</span> <span class="st">'1.2.0'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> transformers.__version__ <span class="op">==</span> <span class="st">'4.44.2'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> torch.__version__ <span class="op">==</span> <span class="st">'2.2.2+cu121'</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> datasets.__version__ <span class="op">==</span> <span class="st">'2.16.1'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:31:48.092313Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:31:48.090710Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:31:48.868734Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:31:48.867959Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:31:48.092295Z&quot;}}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset, Dataset</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd, numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, ConfusionMatrixDisplay</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> CategoricalDtype</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:31:48.870818Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:31:48.870383Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:31:59.745257Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:31:59.744737Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:31:48.870797Z&quot;}}">
<details class="code-fold">
<summary>Show setup</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoModelForCausalLM, AutoTokenizer</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">"cuda"</span> <span class="co"># the device to load the model onto</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> AutoModelForCausalLM.from_pretrained(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Qwen/Qwen2-1.5B-Instruct"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span><span class="st">"auto"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"Qwen/Qwen2-1.5B-Instruct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-5" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:31:59.746123Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:31:59.745950Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.168891Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.168295Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:31:59.746107Z&quot;}}">
<details class="code-fold">
<summary>Show setup</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load dataset</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> load_dataset(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"financial_phrasebank"</span>, <span class="st">"sentences_allagree"</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    split<span class="op">=</span><span class="st">"train"</span>  <span class="co"># note that the dataset does not have a default test split</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new column with the numeric label verbalised as label_text (e.g. "positive" instead of "0")</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>label_map <span class="op">=</span> {i: label_text <span class="cf">for</span> i, label_text <span class="kw">in</span> <span class="bu">enumerate</span>(dataset.features[<span class="st">"label"</span>].names)}</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_label_text(example):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    example[<span class="st">"label_text"</span>] <span class="op">=</span> label_map[example[<span class="st">"label"</span>]]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> example</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_label_text)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:01.169818Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:01.169637Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.174116Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.173534Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:01.169816Z&quot;}}" data-execution_count="6">
<details class="code-fold">
<summary>Show <code>generate_response</code> function</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_response(prompt):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You are a helpful assistant."</span>},</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        model_inputs.input_ids,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> [</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:01.174924Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:01.174782Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.180621Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.180081Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:01.174909Z&quot;}}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_prompt(item, prompt):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        item[<span class="st">'prompt'</span>] <span class="op">=</span> prompt.<span class="bu">format</span>(text<span class="op">=</span>item[<span class="st">'sentence'</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> item</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_responses(dataset, prompt):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> [</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:01.181278Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:01.181134Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.185952Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.185412Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:01.181278Z&quot;}}" data-execution_count="8">
<details class="code-fold">
<summary>Show <code>make_cm</code> function</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cm(df):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create confusion matrix for true vs predicted sentiment classes"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>df[<span class="st">'label_text'</span>], y_pred<span class="op">=</span>df[<span class="st">'responses'</span>], labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    disp <span class="op">=</span> ConfusionMatrixDisplay(cm, display_labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I chose 8x8 so it fits on one screen but still is large</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    disp.plot(ax<span class="op">=</span>ax,text_kw<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">16</span>}, cmap<span class="op">=</span><span class="st">'Blues'</span>, colorbar<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change label font size without changing label text</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make tick labels larger</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:01.187048Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:01.186919Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.190209Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.189668Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:01.187048Z&quot;}}" data-execution_count="9">
<details class="code-fold">
<summary>Show <code>ds_subset</code> function</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ds_subset(dataset, exclude_idxs, columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(dataset)))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> idxs <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> exclude_idxs]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ddf <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    new_ds <span class="op">=</span> Dataset.from_pandas(ddf.iloc[idxs, columns])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this notebook I’ll use <a href="https://huggingface.co/Qwen/Qwen2-1.5B-Instruct">Qwen2-1.5B-Instruct</a> to classify sentiment in the <a href="https://huggingface.co/datasets/financial_phrasebank"><code>financial_phrasebank</code> dataset</a>. In previous notebooks I have performed <a href="https://vishalbakshi.github.io/blog/posts/2024-08-31-tinysentiment-phi-2-sentiment-classification/">sentiment classification with phi-2</a>, <a href="https://vishalbakshi.github.io/blog/posts/2024-09-12-tinysentiment-phi-3-sentiment-classification/">phi-3</a>, <a href="https://vishalbakshi.github.io/blog/posts/2024-09-12-tinysentiment-phi-3-5-sentiment-classification/">phi-3.5</a>, and <a href="https://vishalbakshi.github.io/blog/posts/2024-08-29-tinysentiment-claude-experiments/">the Claude series</a>.</p>
<p>This notebook is part of <a href="https://vishalbakshi.github.io/blog/#category=TinySentiment">a series of blog posts</a> for a project I’m working called TinySentiment where I’m experimenting with tiny models to improve their ability to classify sentiment in the <code>financial_phrasebank dataset</code>. I was inspired to do so after reading <a href="https://huggingface.co/blog/synthetic-data-save-costs">this blog post</a> and <a href="https://github.com/MoritzLaurer/synthetic-data-blog/blob/main/notebooks/synthetic_data_creation.ipynb">this corresponding notebook</a> by Moritz Laurer as part of a fastai study group last year.</p>
<p>Here are the results from my experiments so far (**the best-performing prompt from this notebook):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Prompting Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">claude-3-5-sonnet-20240620</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">94.78%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">94% (1302/1391)</td>
<td style="text-align: center;">95% (544/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">claude-3-opus-20240229</td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">94.13%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">96% (1333/1391)</td>
<td style="text-align: center;">88% (501/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">phi-3.5</td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">93.94%</td>
<td style="text-align: center;">96% (286/299)</td>
<td style="text-align: center;">98% (1355/1379)</td>
<td style="text-align: center;">83% (467/566)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-3</td>
<td style="text-align: center;">30-Shot w/System Prompt</td>
<td style="text-align: center;">92.79%</td>
<td style="text-align: center;">98% (290/297)</td>
<td style="text-align: center;">94% (1284/1373)</td>
<td style="text-align: center;">88% (499/564)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">claude-3-haiku-20240307</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">92.39%</td>
<td style="text-align: center;">90% (272/303)</td>
<td style="text-align: center;">91% (1267/1391)</td>
<td style="text-align: center;">96% (550/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-2</td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91.94%</td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">**Qwen2-1.5B</td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">86.10%</td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">95.5% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
</tbody>
</table>
<p>Here are the results from this notebook. The best-performing prompt was a randomly shuffled 27-Shot prompt (<a href="#prompt-ad">Prompt AD</a>), yielding an overall accuracy of 86.10%.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">prompt</th>
<th style="text-align: center;">strategy</th>
<th style="text-align: center;">accuracy</th>
<th style="text-align: center;">negative</th>
<th style="text-align: center;">neutral</th>
<th style="text-align: center;">positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-a">A</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81.76%</td>
<td style="text-align: center;">97% (293/303)</td>
<td style="text-align: center;">85% (1185/1391)</td>
<td style="text-align: center;">65% (373/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-b">B</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">51.86%</td>
<td style="text-align: center;">99% (300/303)</td>
<td style="text-align: center;">61% (846/1391)</td>
<td style="text-align: center;">5% (28/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-c">C</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81.40%</td>
<td style="text-align: center;">93% (283/303)</td>
<td style="text-align: center;">96% (1330/1391)</td>
<td style="text-align: center;">40% (230/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-d">D</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">78.53%</td>
<td style="text-align: center;">92% (279/303)</td>
<td style="text-align: center;">92% (1281/1391)</td>
<td style="text-align: center;">38% (218/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-e">E</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">66.21%</td>
<td style="text-align: center;"><u><strong>100% (302/303)</strong></u></td>
<td style="text-align: center;">82% (1145/1391)</td>
<td style="text-align: center;">9% (52/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-f">F</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">78.05%</td>
<td style="text-align: center;">88% (267/303)</td>
<td style="text-align: center;">97% (1355/1391)</td>
<td style="text-align: center;">25% (145/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-g">G</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">66.70%</td>
<td style="text-align: center;">94% (285/303)</td>
<td style="text-align: center;">80% (1107/1391)</td>
<td style="text-align: center;">21% (118/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-h">H</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">70.89%</td>
<td style="text-align: center;">85% (259/303)</td>
<td style="text-align: center;">90% (1247/1391)</td>
<td style="text-align: center;">17% (99/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-i">I</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">69.17%</td>
<td style="text-align: center;">58% (176/303)</td>
<td style="text-align: center;">86% (1201/1391)</td>
<td style="text-align: center;">33% (189/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-j">J</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">57.38%</td>
<td style="text-align: center;">47% (142/303)</td>
<td style="text-align: center;">78% (1086/1391)</td>
<td style="text-align: center;">12% (71/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-k">K</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">41.87%</td>
<td style="text-align: center;">34% (102/303)</td>
<td style="text-align: center;">52% (728/1391)</td>
<td style="text-align: center;">21% (118/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-l">L</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">42.84%</td>
<td style="text-align: center;">66% (200/303)</td>
<td style="text-align: center;">45% (629/1391)</td>
<td style="text-align: center;">25% (141/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-m">M</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">51.46%</td>
<td style="text-align: center;">26% (79/303)</td>
<td style="text-align: center;">77% (1078/1391)</td>
<td style="text-align: center;">1% (8/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-n">N</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">29.77%</td>
<td style="text-align: center;">11% (33/303)</td>
<td style="text-align: center;">44% (608/1391)</td>
<td style="text-align: center;">6% (33/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-o">O</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">61.00%</td>
<td style="text-align: center;">37% (113/303)</td>
<td style="text-align: center;">90% (1257/1391)</td>
<td style="text-align: center;">2% (11/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-p">P</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">78.20%</td>
<td style="text-align: center;">91% (275/302)</td>
<td style="text-align: center;">91% (1266/1390)</td>
<td style="text-align: center;">40% (227/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-q">Q</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">76.93%</td>
<td style="text-align: center;">96% (289/302)</td>
<td style="text-align: center;">73% (1010/1387)</td>
<td style="text-align: center;"><u><strong>77% (438/569)</strong></u></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-r">R</a></td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">81.42%</td>
<td style="text-align: center;">92% (274/299)</td>
<td style="text-align: center;">94% (1301/1379)</td>
<td style="text-align: center;">45% (252/566)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-s">S</a></td>
<td style="text-align: center;">30-Shot</td>
<td style="text-align: center;">81.51%</td>
<td style="text-align: center;">87% (255/294)</td>
<td style="text-align: center;">98% (1345/1379)</td>
<td style="text-align: center;">39% (221/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-t">T</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">83.73%</td>
<td style="text-align: center;">93% (272/294)</td>
<td style="text-align: center;">94.3% (1303/1382)</td>
<td style="text-align: center;">53% (298/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-u">U</a></td>
<td style="text-align: center;">25-Shot</td>
<td style="text-align: center;">82.94%</td>
<td style="text-align: center;">90% (266/294)</td>
<td style="text-align: center;">96.2% (1331/1384)</td>
<td style="text-align: center;">46% (260/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-v">V</a></td>
<td style="text-align: center;">21-Shot</td>
<td style="text-align: center;">83.28%</td>
<td style="text-align: center;">92% (273/296)</td>
<td style="text-align: center;">94.9% (1314/1384)</td>
<td style="text-align: center;">50% (281/563)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-w">W</a></td>
<td style="text-align: center;">15-Shot</td>
<td style="text-align: center;">81.55%</td>
<td style="text-align: center;">94% (279/298)</td>
<td style="text-align: center;">87.7% (1215/1386)</td>
<td style="text-align: center;">60% (340/565)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-x">X</a></td>
<td style="text-align: center;">30-Shot</td>
<td style="text-align: center;">81.74%</td>
<td style="text-align: center;">89% (261/293)</td>
<td style="text-align: center;">96.7% (1336/1381)</td>
<td style="text-align: center;">41% (229/560)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-y">Y</a></td>
<td style="text-align: center;">60-Shot</td>
<td style="text-align: center;">75.82%</td>
<td style="text-align: center;">66% (186/283)</td>
<td style="text-align: center;"><u><strong>99.8% (1368/1371)</strong></u></td>
<td style="text-align: center;">21% (117/550)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-z">Z</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">81.36%</td>
<td style="text-align: center;">80% (236/294)</td>
<td style="text-align: center;">99.4% (1374/1382)</td>
<td style="text-align: center;">37% (210/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-aa">AA</a></td>
<td style="text-align: center;">23-Shot</td>
<td style="text-align: center;">82.95%</td>
<td style="text-align: center;">93% (276/296)</td>
<td style="text-align: center;">94.9% (1314/1384)</td>
<td style="text-align: center;">48% (269/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ab">AB</a></td>
<td style="text-align: center;">25-Shot</td>
<td style="text-align: center;">83.70%</td>
<td style="text-align: center;">92% (270/294)</td>
<td style="text-align: center;">95.3% (1317/1382)</td>
<td style="text-align: center;">51% (287/563)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ac">AC</a></td>
<td style="text-align: center;">23-Shot</td>
<td style="text-align: center;">83.40%</td>
<td style="text-align: center;">95% (278/294)</td>
<td style="text-align: center;">93.8% (1296/1382)</td>
<td style="text-align: center;">52% (295/565)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ad">AD</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;"><u><strong>86.10%</strong></u></td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">95.5% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ae">AE</a></td>
<td style="text-align: center;">60-Shot</td>
<td style="text-align: center;">83.71%</td>
<td style="text-align: center;">83% (234/283)</td>
<td style="text-align: center;">97.8% (1341/1371)</td>
<td style="text-align: center;">49% (270/550)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-af">AF</a></td>
<td style="text-align: center;">15-Shot</td>
<td style="text-align: center;">82.00%</td>
<td style="text-align: center;">91% (272/298)</td>
<td style="text-align: center;">88.8% (1231/1386)</td>
<td style="text-align: center;">60% (341/565)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ag">AG</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.40%</td>
<td style="text-align: center;">84% (248/294)</td>
<td style="text-align: center;">97.8% (1351/1382)</td>
<td style="text-align: center;">52% (289/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ah">AH</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.67%</td>
<td style="text-align: center;">87% (256/294)</td>
<td style="text-align: center;">97.1% (1342/1382)</td>
<td style="text-align: center;">53% (296/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ai">AI</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.99%</td>
<td style="text-align: center;">88% (260/294)</td>
<td style="text-align: center;">97.3% (1345/1382)</td>
<td style="text-align: center;">50% (283/561)</td>
</tr>
</tbody>
</table>
</section>
<section id="prompt-a" class="level2">
<h2 class="anchored" data-anchor-id="prompt-a">Prompt A</h2>
<p>I’ll start out with a simple instruction.</p>
<div id="cell-16" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:42.003664Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:42.003063Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:42.007209Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:42.006564Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:42.003642Z&quot;}}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>promptA <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(promptA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: {text}</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-12T23:56:43.159481Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-12T23:56:43.158857Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-12T23:56:43.163344Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-12T23:56:43.162877Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-12T23:56:43.159459Z&quot;}}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>formatted_prompt <span class="op">=</span> promptA.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>Looks good! I’m able to generate a response.</p>
<div id="cell-19" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-12T23:57:26.818136Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-12T23:57:26.817640Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-12T23:57:27.897824Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-12T23:57:27.897098Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-12T23:57:26.818114Z&quot;}}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>generate_response(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>'neutral'</code></pre>
</div>
</div>
<p>At ~50ms per prompt, it would take about 2 minutes to run inference on the full 2264 item dataset.</p>
<div id="cell-21" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-12T23:57:39.546421Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-12T23:57:39.545795Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-12T23:57:42.725946Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-12T23:57:42.725423Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-12T23:57:39.546398Z&quot;}}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">10</span> generate_response(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>45.4 ms ± 829 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:59:48.041247Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:59:48.040737Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:01:32.078384Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:01:32.077727Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:59:48.041228Z&quot;}}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>Right off the bat, Qwen2-1.5B-Instruct has decent performance on sentiment classification. 81.85% is not bad at all! Let’s see if I can improve on that.</p>
<div id="cell-24" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:03:42.022799Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:03:42.022301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:03:42.026526Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:03:42.025975Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:03:42.022780Z&quot;}}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.8175795053003534</code></pre>
</div>
</div>
<p>Interesting to note: Qwen2-1.5B-Instruct does not classify any <code>other</code> values than <code>negative</code>, <code>neutral</code> and <code>positive</code>.</p>
<div id="cell-26" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:03:45.360417Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:03:45.359904Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:03:45.438188Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:03:45.437744Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:03:45.360398Z&quot;}}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-17-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-27" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:52:29.580743Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:52:29.580467Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:52:29.644754Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:52:29.644153Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:52:29.580723Z&quot;}}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_A.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-b" class="level2">
<h2 class="anchored" data-anchor-id="prompt-b">Prompt B</h2>
<p>I’ll repeat the instruction after providing the sentence, as this has usually improved performance.</p>
<div id="cell-30" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:54:00.844186Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:54:00.843927Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:54:00.847345Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:54:00.846792Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:54:00.844169Z&quot;}}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>promptB <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:54:03.643533Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:54:03.642967Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:55:48.597394Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:55:48.596850Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:54:03.643511Z&quot;}}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bcbefacc2c40475b8be7dbe5b2d9b2c2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral</code></pre>
</div>
</div>
<p>Interesting! Repeating the instruction usually increases the accuracy. Here, it drops by about 30%!</p>
<div id="cell-33" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:56:45.639844Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:56:45.639337Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:56:45.643528Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:56:45.643082Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:56:45.639823Z&quot;}}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0.5185512367491166</code></pre>
</div>
</div>
<p>The model actually gets better at <code>negative</code> classification but significantly plummets for the other two.</p>
<div id="cell-35" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:58:42.357605Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:58:42.356978Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:58:42.438603Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:58:42.438004Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:58:42.357583Z&quot;}}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-22-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-36" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T00:59:39.927223Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T00:59:39.926601Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T00:59:39.947632Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T00:59:39.947121Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T00:59:39.927201Z&quot;}}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_B.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-c" class="level2">
<h2 class="anchored" data-anchor-id="prompt-c">Prompt C</h2>
<p>I’ll return to Prompt A and change the format a bit.</p>
<div id="cell-39" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:08:07.523279Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:08:07.522757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:08:07.526780Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:08:07.525799Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:08:07.523258Z&quot;}}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>promptC <span class="op">=</span> <span class="st">"""Respond with a single word: negative, positive, or neutral</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:08:23.693302Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:08:23.692824Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:10:08.045550Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:10:08.044924Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:08:23.693282Z&quot;}}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2fa6fe3009e94ab3a3c79b4f32a62a63","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Respond with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>This yields a similar accuracy to Prompt A.</p>
<div id="cell-42" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:15:31.818581Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:15:31.817938Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:15:31.822582Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:15:31.822058Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:15:31.818560Z&quot;}}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>0.8140459363957597</code></pre>
</div>
</div>
<p>The model does quite well with <code>neutral</code> and <code>negative</code> sentences but terribly with <code>positive</code> sentences. In fact, Qwen2-1.5B-Instruct (96%) beats the best-performing phi-3 prompt (94%) in <code>neutral</code> True Positive Rate (TPR).</p>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:15:59.349054Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:15:59.348524Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:15:59.426498Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:15:59.425927Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:15:59.349033Z&quot;}}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-27-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-45" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:21:27.527307Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:21:27.526814Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:21:27.548183Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:21:27.547625Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:21:27.527288Z&quot;}}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_C.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-d" class="level2">
<h2 class="anchored" data-anchor-id="prompt-d">Prompt D</h2>
<p>I’ll add a period after the instruction.</p>
<div id="cell-48" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:23:14.254224Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:23:14.253672Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:23:14.257196Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:23:14.256513Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:23:14.254202Z&quot;}}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>promptD <span class="op">=</span> <span class="st">"""Respond with a single word: negative, positive, or neutral.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:23:15.881247Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:23:15.880632Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:24:59.957575Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:24:59.956916Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:23:15.881217Z&quot;}}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"146a2d89d47147f1818c3de0818e8bfa","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Respond with a single word: negative, positive, or neutral.
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>Nope! Period == bad.</p>
<div id="cell-51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:25:52.179044Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:25:52.178626Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:25:52.183154Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:25:52.182450Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:25:52.179022Z&quot;}}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.7853356890459364</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:26:15.117352Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:26:15.116749Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:26:15.200042Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:26:15.199416Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:26:15.117331Z&quot;}}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-32-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-53" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:26:46.939367Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:26:46.938857Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:26:46.957550Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:26:46.957048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:26:46.939347Z&quot;}}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_D.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-e" class="level2">
<h2 class="anchored" data-anchor-id="prompt-e">Prompt E</h2>
<p>I’ll repeat the instruction to see if it improves performance.</p>
<div id="cell-56" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:27:27.232178Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:27:27.231909Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:27:27.236318Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:27:27.235581Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:27:27.232161Z&quot;}}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>promptE <span class="op">=</span> <span class="st">"""Respond with a single word: negative, positive, or neutral</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with a single word: negative, positive, or neutral"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:27:41.200863Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:27:41.200608Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:29:25.605032Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:29:25.604368Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:27:41.200846Z&quot;}}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"dcd0b33fcd9244bfad13115bbf6c68c8","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Respond with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with a single word: negative, positive, or neutral</code></pre>
</div>
</div>
<p>Nope! The repeated instruction decreases the accuracy.</p>
<div id="cell-59" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:29:28.329470Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:29:28.329214Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:29:28.335316Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:29:28.334934Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:29:28.329453Z&quot;}}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.6621024734982333</code></pre>
</div>
</div>
<p>Note that the <code>negative</code> sentiment TPR is near perfect.</p>
<div id="cell-61" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:29:45.010100Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:29:45.009831Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:29:45.089053Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:29:45.088625Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:29:45.010081Z&quot;}}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-37-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-62" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:30:04.540867Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:30:04.540459Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:30:04.559410Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:30:04.558963Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:30:04.540846Z&quot;}}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_E.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-f" class="level2">
<h2 class="anchored" data-anchor-id="prompt-f">Prompt F</h2>
<p>I realized I didn’t have “Instruct:” at the start of the prompt so I’ll add that to Prompt C.</p>
<div id="cell-65" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:34:17.290333Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:34:17.289485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:34:17.293403Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:34:17.292780Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:34:17.290318Z&quot;}}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>promptF <span class="op">=</span> <span class="st">"""Instruct: Respond with a single word: negative, positive, or neutral</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-66" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:35:03.346918Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:35:03.346376Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:36:45.436690Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:36:45.435973Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:35:03.346896Z&quot;}}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"05bd97f2ca78430f8ff6a98fc6d734a2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: Respond with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>That decreases the accuracy by 3%.</p>
<div id="cell-68" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:37:09.279112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:37:09.278500Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:37:09.283352Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:37:09.282907Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:37:09.279088Z&quot;}}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>0.7804770318021201</code></pre>
</div>
</div>
<p>Note that this prompt yields the best <code>neutral</code> TPR so far (1355/1391 = 97.4%) for this model.</p>
<div id="cell-70" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:37:26.158203Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:37:26.157598Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:37:26.241699Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:37:26.241199Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:37:26.158176Z&quot;}}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-42-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-71" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:38:39.753088Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:38:39.752482Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:38:39.770540Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:38:39.769918Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:38:39.753066Z&quot;}}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_F.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-g" class="level2">
<h2 class="anchored" data-anchor-id="prompt-g">Prompt G</h2>
<p>I’ll now add some additional instructions.</p>
<div id="cell-74" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:40:24.224105Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:40:24.223592Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:40:24.227278Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:40:24.226659Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:40:24.224084Z&quot;}}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>promptG <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-75" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:40:28.735679Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:40:28.735264Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:42:12.811586Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:42:12.810932Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:40:28.735655Z&quot;}}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2376831ac1934b30909ec5ebfbc9c10a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.
Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<p>Additional instruction worsens the model’s performance by ~15%.</p>
<div id="cell-77" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:42:29.235922Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:42:29.235238Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:42:29.240085Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:42:29.239607Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:42:29.235898Z&quot;}}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>0.6669611307420494</code></pre>
</div>
</div>
<p>Nothing immediately notable about the results.</p>
<div id="cell-79" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:42:51.099979Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:42:51.099379Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:42:51.177921Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:42:51.177353Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:42:51.099957Z&quot;}}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-47-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-80" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:43:26.022759Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:43:26.021914Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:43:26.043508Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:43:26.043005Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:43:26.022736Z&quot;}}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_G.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-h" class="level2">
<h2 class="anchored" data-anchor-id="prompt-h">Prompt H</h2>
<p>I’ll now try a series of prompts suggested by Claude (based on the previous prompts and accuracies achieved). These prompts are simple and concise.</p>
<div id="cell-83" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:49:14.759138Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:49:14.758485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:49:14.761387Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:49:14.761008Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:49:14.759115Z&quot;}}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>promptH <span class="op">=</span> <span class="st">"""Sentiment: </span><span class="sc">{text}</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="st">Output: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-84" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:49:19.724808Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:49:19.724114Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:51:01.456341Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:51:01.455757Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:49:19.724785Z&quot;}}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ea8c7c0d57e945c98ab08c46eb50232a","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sentiment: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Output: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>I’m surprised that such a simple prompt performs well, though it’s 11% worse than my best prompts so far.</p>
<div id="cell-86" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:51:27.557878Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:51:27.557616Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:51:27.562673Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:51:27.561946Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:51:27.557859Z&quot;}}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>0.708922261484099</code></pre>
</div>
</div>
<p>What’s notable about this prompt’s results is the incredibly bad performance on <code>positive</code> sentiment (18%). Also noteworthy is that with this prompt there are now <code>other</code> responses than <code>negative</code>, <code>neutral</code> or <code>positive</code>.</p>
<div id="cell-88" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:52:00.340487Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:52:00.340205Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:52:00.424575Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:52:00.423985Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:52:00.340467Z&quot;}}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-52-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-89" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:53:38.618837Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:53:38.618322Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:53:38.635658Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:53:38.635218Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:53:38.618816Z&quot;}}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_H.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-i" class="level2">
<h2 class="anchored" data-anchor-id="prompt-i">Prompt I</h2>
<p>Another prompt suggested by Claude.</p>
<div id="cell-92" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:54:26.404619Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:54:26.403989Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:54:26.407468Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:54:26.406918Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:54:26.404597Z&quot;}}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>promptI <span class="op">=</span> <span class="st">"""Classify sentiment: </span><span class="sc">{text}</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="st">Answer: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-93" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:54:37.205718Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:54:37.205123Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:56:19.276065Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:56:19.275418Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:54:37.205697Z&quot;}}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e885f66323294cf482708b2ddc125c84","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Classify sentiment: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Answer: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>A similar performance to Prompt H.</p>
<div id="cell-95" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:56:47.286853Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:56:47.286592Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:56:47.290354Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:56:47.289917Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:56:47.286835Z&quot;}}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>0.691696113074205</code></pre>
</div>
</div>
<p>This prompt performs worse for all three sentiments, but especially <code>negative</code> and <code>positive</code>.</p>
<div id="cell-97" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:57:04.050873Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:57:04.050609Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:57:04.135403Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:57:04.134846Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:57:04.050855Z&quot;}}" data-execution_count="65">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-57-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-98" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:57:55.021831Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:57:55.021565Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:57:55.038542Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:57:55.037929Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:57:55.021813Z&quot;}}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_I.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-j" class="level2">
<h2 class="anchored" data-anchor-id="prompt-j">Prompt J</h2>
<div id="cell-100" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:58:21.010761Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:58:21.010496Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T01:58:21.013609Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T01:58:21.013092Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:58:21.010743Z&quot;}}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>promptJ <span class="op">=</span> <span class="st">"""Text: </span><span class="sc">{text}</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="st">Sentiment classification: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-101" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T01:58:33.832895Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T01:58:33.832275Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:00:15.293523Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:00:15.293010Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T01:58:33.832873Z&quot;}}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptJ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"016c2ee9d58241bfb2e03842796dec0f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Text: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Sentiment classification: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>This prompt yields a significantly worse performance.</p>
<div id="cell-103" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:00:18.081535Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:00:18.080605Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:00:18.085993Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:00:18.085346Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:00:18.081503Z&quot;}}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>0.5737632508833922</code></pre>
</div>
</div>
<div id="cell-104" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:00:22.241379Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:00:22.240540Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:00:22.321842Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:00:22.321260Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:00:22.241345Z&quot;}}" data-execution_count="70">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-62-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-105" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:00:53.179024Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:00:53.178477Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:00:53.195516Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:00:53.195006Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:00:53.179002Z&quot;}}" data-execution_count="71">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_J.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-k" class="level2">
<h2 class="anchored" data-anchor-id="prompt-k">Prompt K</h2>
<p>Another Claude suggested prompt:</p>
<div id="cell-108" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:03:49.704085Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:03:49.703461Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:03:49.706989Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:03:49.706488Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:03:49.704064Z&quot;}}" data-execution_count="72">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>promptK <span class="op">=</span> <span class="st">"""Analyze the sentiment of this text:</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{text}</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="st">Classification: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-109" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:04:02.197181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:04:02.196519Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:05:44.217989Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:05:44.217328Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:04:02.197156Z&quot;}}" data-execution_count="73">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptK)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"594bc11d78054d10b717d22f325b96c2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Analyze the sentiment of this text:
According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Classification: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>This prompt yields worse results.</p>
<div id="cell-111" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:05:50.987825Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:05:50.987301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:05:50.991958Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:05:50.991481Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:05:50.987804Z&quot;}}" data-execution_count="74">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>0.41872791519434627</code></pre>
</div>
</div>
<div id="cell-112" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:06:09.453833Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:06:09.453102Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:06:09.542094Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:06:09.541493Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:06:09.453809Z&quot;}}" data-execution_count="75">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-67-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/cell-67-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-113" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:06:36.313711Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:06:36.313198Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:06:36.330680Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:06:36.330198Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:06:36.313690Z&quot;}}" data-execution_count="76">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_K.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-l" class="level2">
<h2 class="anchored" data-anchor-id="prompt-l">Prompt L</h2>
<p>Another Claude suggested prompt (so far, has not yielded good results!).</p>
<div id="cell-116" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:08:39.307693Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:08:39.307428Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:08:39.310841Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:08:39.310344Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:08:39.307676Z&quot;}}" data-execution_count="77">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>promptL <span class="op">=</span> <span class="st">"""Categorize the following text as negative, positive, or neutral:</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{text}</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="st">Category:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-117" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:08:50.619156Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:08:50.618582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:10:35.160551Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:10:35.159925Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:08:50.619133Z&quot;}}" data-execution_count="78">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"dbdfb0ce734f4afaabd97952702b9db1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Categorize the following text as negative, positive, or neutral:
According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Category:</code></pre>
</div>
</div>
<p>Another subpar result.</p>
<div id="cell-119" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:12:01.622751Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:12:01.621919Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:12:01.626695Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:12:01.626054Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:12:01.622717Z&quot;}}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>0.4284452296819788</code></pre>
</div>
</div>
<div id="cell-120" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:12:13.296215Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:12:13.295579Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:12:13.387733Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:12:13.387062Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:12:13.296193Z&quot;}}" data-execution_count="80">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-72-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/cell-72-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-121" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:13:06.205788Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:13:06.205276Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:13:06.223609Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:13:06.222988Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:13:06.205767Z&quot;}}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_L.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-m" class="level2">
<h2 class="anchored" data-anchor-id="prompt-m">Prompt M</h2>
<p>Another Claude suggested prompt (3 more left to try out!)</p>
<div id="cell-124" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:14:31.017037Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:14:31.016519Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:14:31.019819Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:14:31.019304Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:14:31.017017Z&quot;}}" data-execution_count="82">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>promptM <span class="op">=</span> <span class="st">"""Sentiment analysis task:</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="st">Input: </span><span class="sc">{text}</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="st">Output: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-125" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:14:44.071326Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:14:44.070526Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:16:28.334499Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:16:28.333993Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:14:44.071303Z&quot;}}" data-execution_count="83">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1654332f234340eca2669a1084b9b53b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sentiment analysis task:
Input: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Output: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>Nope! No success with this one either (well, 51% success).</p>
<div id="cell-127" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:16:30.971777Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:16:30.971168Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:16:30.975280Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:16:30.974630Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:16:30.971755Z&quot;}}" data-execution_count="84">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>0.5145759717314488</code></pre>
</div>
</div>
<div id="cell-128" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:16:48.044181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:16:48.043551Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:16:48.119703Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:16:48.119295Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:16:48.044181Z&quot;}}" data-execution_count="85">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-77-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/cell-77-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-129" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:16:55.427723Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:16:55.426989Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:16:55.444338Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:16:55.443903Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:16:55.427698Z&quot;}}" data-execution_count="86">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_M.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-n" class="level2">
<h2 class="anchored" data-anchor-id="prompt-n">Prompt N</h2>
<div id="cell-131" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:17:26.014294Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:17:26.013826Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:17:26.016822Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:17:26.016403Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:17:26.014274Z&quot;}}" data-execution_count="88">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>promptN <span class="op">=</span> <span class="st">"""determine the sentiment:</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="sc">{text}</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="st">sentiment: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-132" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:17:27.325721Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:17:27.325037Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:19:10.303589Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:19:10.303098Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:17:27.325715Z&quot;}}" data-execution_count="89">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a649aa8638ea4d1eaf79566df1ebf6bf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>determine the sentiment:
According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
sentiment: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>This one was particularly bad.</p>
<div id="cell-134" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:21:15.890864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:21:15.890078Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:21:15.894748Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:21:15.894193Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:21:15.890841Z&quot;}}" data-execution_count="90">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>0.29770318021201414</code></pre>
</div>
</div>
<div id="cell-135" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:21:45.216570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:21:45.216300Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:21:45.295032Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:21:45.294440Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:21:45.216551Z&quot;}}" data-execution_count="91">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-82-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/cell-82-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-136" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:21:55.349372Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:21:55.348867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:21:55.369316Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:21:55.368870Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:21:55.349350Z&quot;}}" data-execution_count="92">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_N.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-o" class="level2">
<h2 class="anchored" data-anchor-id="prompt-o">Prompt O</h2>
<div id="cell-138" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:23:31.681229Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:23:31.680740Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:23:31.683900Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:23:31.683352Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:23:31.681209Z&quot;}}" data-execution_count="93">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>promptO <span class="op">=</span> <span class="st">"""Sentiment classification task:</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="st">'</span><span class="sc">{text}</span><span class="st">'</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="st">Label: [negative/positive/neutral]"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-139" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:24:00.897570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:24:00.897301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:25:46.719818Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:25:46.719188Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:24:00.897551Z&quot;}}" data-execution_count="94">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d1e6160a406749eea622888da84ea813","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Sentiment classification task:
'According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .'
Label: [negative/positive/neutral]</code></pre>
</div>
</div>
<p>Looks like I’ll stick with Prompt A for now!</p>
<div id="cell-141" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:26:21.475465Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:26:21.474931Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:26:21.479473Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:26:21.478867Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:26:21.475443Z&quot;}}" data-execution_count="95">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>0.609982332155477</code></pre>
</div>
</div>
<div id="cell-142" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:27:11.425095Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:27:11.424492Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:27:11.516581Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:27:11.515953Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:27:11.425073Z&quot;}}" data-execution_count="96">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-87-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/cell-87-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-143" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:27:24.834526Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:27:24.833758Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:27:24.851920Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:27:24.851358Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:27:24.834503Z&quot;}}" data-execution_count="97">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_O.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-p" class="level2">
<h2 class="anchored" data-anchor-id="prompt-p">Prompt P</h2>
<p>I’ll revisit Prompt A and give it a few examples.</p>
<div id="cell-146" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:01.191642Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:01.191485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:01.197504Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:01.196894Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:01.191630Z&quot;}}" data-execution_count="10">
<details class="code-fold">
<summary>Show updated <code>few_shot_responses</code> function</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> few_shot_responses(dataset, prompt, examples):</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}]</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-147" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:33:46.429286Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:33:46.428623Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:33:46.432142Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:33:46.431488Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:33:46.429266Z&quot;}}" data-execution_count="99">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-148" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:34:18.899066Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:34:18.898242Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:34:18.913802Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:34:18.913195Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:34:18.899040Z&quot;}}" data-execution_count="102">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>promptP_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>promptP_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2261
})</code></pre>
</div>
</div>
<div id="cell-149" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:34:30.007121Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:34:30.006697Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:34:30.011849Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:34:30.011382Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:34:30.007099Z&quot;}}" data-execution_count="103">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>[('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral'),
 ("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive'),
 ('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative')]</code></pre>
</div>
</div>
<div id="cell-150" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:35:08.140625Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:35:08.140198Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:37:10.449678Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:37:10.449173Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:35:08.140604Z&quot;}}" data-execution_count="104">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptP_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e784856318a64925b331946237897426","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<p>3-Shot prompting does not improve performance.</p>
<div id="cell-152" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:42:13.692155Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:42:13.691882Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:42:13.697220Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:42:13.696528Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:42:13.692137Z&quot;}}" data-execution_count="105">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>0.7819548872180451</code></pre>
</div>
</div>
<div id="cell-153" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:42:37.169902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:42:37.169638Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:42:37.255052Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:42:37.254427Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:42:37.169884Z&quot;}}" data-execution_count="106">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-95-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/cell-95-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-154" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:42:56.810129Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:42:56.809435Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:42:56.828384Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:42:56.827893Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:42:56.810105Z&quot;}}" data-execution_count="107">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_P.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-q" class="level2">
<h2 class="anchored" data-anchor-id="prompt-q">Prompt Q</h2>
<p>I’ll try 6-Shot prompting next.</p>
<div id="cell-157" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:44:17.241254Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:44:17.240644Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:44:17.253987Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:44:17.253502Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:44:17.241232Z&quot;}}" data-execution_count="110">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>]</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>promptQ_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>promptQ_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2258
})</code></pre>
</div>
</div>
<div id="cell-158" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:44:23.321497Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:44:23.321265Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:44:23.327622Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:44:23.326993Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:44:23.321479Z&quot;}}" data-execution_count="111">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>6</code></pre>
</div>
</div>
<div id="cell-159" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:44:29.806888Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:44:29.806623Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:47:08.486306Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:47:08.485621Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:44:29.806871Z&quot;}}" data-execution_count="112">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptQ_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"edbc09e9ac7d407c9a09a29e647fb199","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<p>6-Shot doesn’t fare much better.</p>
<div id="cell-161" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:47:17.258913Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:47:17.258322Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:47:17.262967Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:47:17.262286Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:47:17.258892Z&quot;}}" data-execution_count="113">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>0.7692648361381754</code></pre>
</div>
</div>
<div id="cell-162" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:47:36.931275Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:47:36.930747Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:47:37.011303Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:47:37.010794Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:47:36.931255Z&quot;}}" data-execution_count="114">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-101-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="index_files/figure-html/cell-101-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-163" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:47:57.095174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:47:57.094525Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:47:57.116766Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:47:57.116335Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:47:57.095144Z&quot;}}" data-execution_count="115">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_Q.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-r" class="level2">
<h2 class="anchored" data-anchor-id="prompt-r">Prompt R</h2>
<p>I’ll now bump it up to 20 examples.</p>
<div id="cell-166" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:49:52.436608Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:49:52.436099Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:49:52.439646Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:49:52.439231Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:49:52.436587Z&quot;}}" data-execution_count="117">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="co"># positive</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="co"># negative</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">274</span>, <span class="dv">283</span> <span class="co"># neutral</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-167" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:49:55.123883Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:49:55.123397Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:49:55.135294Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:49:55.134856Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:49:55.123862Z&quot;}}" data-execution_count="118">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>promptR_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>promptR_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2244
})</code></pre>
</div>
</div>
<div id="cell-168" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:50:08.595709Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:50:08.594940Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:50:08.601679Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:50:08.601269Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:50:08.595686Z&quot;}}" data-execution_count="119">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>20</code></pre>
</div>
</div>
<div id="cell-169" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:50:44.138747Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:50:44.138485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:56:33.924549Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:56:33.923971Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:50:44.138729Z&quot;}}" data-execution_count="120">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptR_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f43a929a6fc84cb68dbf96e9889a55fb","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Finnish Talentum reports its operating profit increased to EUR 20.5 mn in 2005 from EUR 9.3 mn in 2004 , and net sales totaled EUR 103.3 mn , up from EUR 96.4 mn .</code></pre>
</div>
</div>
<p>Interestingly, the 20-Shot prompt yields a worse accuracy than the 0-Shot prompt.</p>
<div id="cell-171" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:57:51.399230Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:57:51.398971Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:57:51.402910Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:57:51.402456Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:57:51.399212Z&quot;}}" data-execution_count="121">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>0.8141711229946524</code></pre>
</div>
</div>
<p>Compared to 0-Shot Prompt A (85%), the 20-Shot prompt has a significantly higher TPR for <code>neutral</code> sentiment (94%) whereas <code>negative</code> and <code>positive</code> perform worse.</p>
<div id="cell-173" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T02:58:25.779764Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T02:58:25.779502Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T02:58:25.861599Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T02:58:25.861092Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T02:58:25.779745Z&quot;}}" data-execution_count="122">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-108-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/cell-108-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-174" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:00:58.292027Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:00:58.291758Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:00:58.311570Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:00:58.311085Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:00:58.292001Z&quot;}}" data-execution_count="123">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_R.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-s" class="level2">
<h2 class="anchored" data-anchor-id="prompt-s">Prompt S</h2>
<p>I’ll increase the number of examples to 30, but will only add <code>negative</code> and <code>positive</code> examples as the model’s performance was lacking for those sentiments.</p>
<div id="cell-177" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:05:58.128963Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:05:58.128681Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:05:58.132358Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:05:58.131866Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:05:58.128939Z&quot;}}" data-execution_count="134">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">274</span>, <span class="dv">283</span> <span class="co"># neutral</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-178" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:06:00.608594Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:06:00.608332Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:06:00.621897Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:06:00.621197Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:06:00.608577Z&quot;}}" data-execution_count="135">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>promptS_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>promptS_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
})</code></pre>
</div>
</div>
<div id="cell-179" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:06:04.043102Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:06:04.042837Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:06:04.051241Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:06:04.050686Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:06:04.043082Z&quot;}}" data-execution_count="136">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<pre><code>30</code></pre>
</div>
</div>
<div id="cell-180" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:06:08.666437Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:06:08.666223Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:14:39.260729Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:14:39.260066Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:06:08.666418Z&quot;}}" data-execution_count="137">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptS_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"276e6a04be414ff294fcdd416cd106d4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>Increasing the number of examples and changing the proportions has not improved the overall accuracy.</p>
<div id="cell-182" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:15:11.478492Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:15:11.478259Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:15:11.483259Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:15:11.482768Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:15:11.478475Z&quot;}}" data-execution_count="138">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>0.815129811996419</code></pre>
</div>
</div>
<p>Interestingly, the number of correctly predicted <code>neutral</code> sentences has increased with this prompt while the number of correctly predicted <code>negative</code> and <code>positive</code> sentences decreased.</p>
<div id="cell-184" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:15:45.177508Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:15:45.176896Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:15:45.255000Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:15:45.254537Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:15:45.177484Z&quot;}}" data-execution_count="139">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-115-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="index_files/figure-html/cell-115-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-185" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:20:07.089419Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:20:07.088756Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:20:07.110474Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:20:07.109955Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:20:07.089396Z&quot;}}" data-execution_count="140">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_S.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-t" class="level2">
<h2 class="anchored" data-anchor-id="prompt-t">Prompt T</h2>
<p>As the number of examples have increased, the model is classifying more and more negative and positive sentences as neutral. After chatting with Claude: I’ll start removing neutral sentences from the example to see if that reverses this trend.</p>
<p>I’ll start by giving the model 9 examples per sentiment.</p>
<div id="cell-188" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:26:01.252527Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:26:01.251932Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:26:01.256038Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:26:01.255379Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:26:01.252504Z&quot;}}" data-execution_count="143">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span> <span class="co"># neutral</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-189" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:26:06.804303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:26:06.803685Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:26:06.816548Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:26:06.816081Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:26:06.804281Z&quot;}}" data-execution_count="144">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>promptT_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>promptT_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2237
})</code></pre>
</div>
</div>
<div id="cell-190" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:26:18.938875Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:26:18.938273Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:26:18.945826Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:26:18.945245Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:26:18.938855Z&quot;}}" data-execution_count="145">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>27</code></pre>
</div>
</div>
<div id="cell-191" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:26:38.162921Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:26:38.162275Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:34:42.884773Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:34:42.884119Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:26:38.162898Z&quot;}}" data-execution_count="146">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptT_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c8887387f36047f89114ec98fcd2e860","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>Hooray! This strategy yielded results. The accuracy increases by a couple percent.</p>
<div id="cell-193" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:35:16.682137Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:35:16.681398Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:35:16.685904Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:35:16.685368Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:35:16.682113Z&quot;}}" data-execution_count="147">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<pre><code>0.8372820742065266</code></pre>
</div>
</div>
<p>The <code>neutral</code> TPR has decreased, as expected, but <code>negative</code> and <code>positive</code> are now making a comeback.</p>
<div id="cell-195" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:35:47.552172Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:35:47.551655Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:35:47.634351Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:35:47.633695Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:35:47.552151Z&quot;}}" data-execution_count="148">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-122-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="index_files/figure-html/cell-122-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-196" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:44:11.739583Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:44:11.738923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:44:11.761991Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:44:11.761506Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:44:11.739560Z&quot;}}" data-execution_count="149">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_T.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-u" class="level2">
<h2 class="anchored" data-anchor-id="prompt-u">Prompt U</h2>
<p>I’ll continue to decrease the number of examples, this time by decreasing the number of neutral examples.</p>
<div id="cell-199" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:48:16.012764Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:48:16.012128Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:48:16.016243Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:48:16.015616Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:48:16.012741Z&quot;}}" data-execution_count="151">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span> <span class="co"># neutral</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-200" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:48:17.431014Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:48:17.430494Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:48:17.443142Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:48:17.442592Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:48:17.430994Z&quot;}}" data-execution_count="152">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>promptU_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>promptU_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2239
})</code></pre>
</div>
</div>
<div id="cell-201" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:48:28.608315Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:48:28.607792Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:48:28.615580Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:48:28.615034Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:48:28.608296Z&quot;}}" data-execution_count="153">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="153">
<pre><code>25</code></pre>
</div>
</div>
<div id="cell-202" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:48:35.434049Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:48:35.433435Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:55:47.666785Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:55:47.666319Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:48:35.434027Z&quot;}}" data-execution_count="154">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptU_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c8d63b6ff24d41aaa546da5e12a69a72","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>Decreasing the number of neutral examples decreases the accuracy.</p>
<div id="cell-204" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:57:54.860959Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:57:54.860193Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:57:54.864271Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:57:54.863796Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:57:54.860937Z&quot;}}" data-execution_count="155">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<pre><code>0.829388119696293</code></pre>
</div>
</div>
<p>The model is actually worse at predicting <code>negative</code> and <code>positive</code> sentences.</p>
<div id="cell-206" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:59:49.645127Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:59:49.644617Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:59:49.729181Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:59:49.727938Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:59:49.645105Z&quot;}}" data-execution_count="156">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-129-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="index_files/figure-html/cell-129-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-207" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T03:59:52.372105Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T03:59:52.371838Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T03:59:52.391122Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T03:59:52.390526Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T03:59:52.372087Z&quot;}}" data-execution_count="157">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_U.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-v" class="level2">
<h2 class="anchored" data-anchor-id="prompt-v">Prompt V</h2>
<p>I’ll continue decreasing examples, with equal amounts from each sentiment for a 21-Shot prompt.</p>
<div id="cell-210" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:05:16.053456Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:05:16.053173Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:05:16.057249Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:05:16.056561Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:05:16.053438Z&quot;}}" data-execution_count="161">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="co"># positive</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>,  <span class="co"># negative</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span> <span class="co"># neutral</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-211" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:05:17.156673Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:05:17.156193Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:05:17.168734Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:05:17.168208Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:05:17.156651Z&quot;}}" data-execution_count="162">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>promptV_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>promptV_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="162">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2243
})</code></pre>
</div>
</div>
<div id="cell-212" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:05:18.942118Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:05:18.941313Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:05:18.949797Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:05:18.949094Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:05:18.942092Z&quot;}}" data-execution_count="163">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="163">
<pre><code>21</code></pre>
</div>
</div>
<div id="cell-213" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:05:25.030862Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:05:25.030349Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:11:37.317508Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:11:37.316912Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:05:25.030840Z&quot;}}" data-execution_count="164">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptV_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ac3a1b88a9d94b6887aee3402d67b5b2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Foundries division reports its sales increased by 9.7 % to EUR 63.1 mn from EUR 57.5 mn in the corresponding period in 2006 , and sales of the Machine Shop division increased by 16.4 % to EUR 41.2 mn from EUR 35.4 mn in the corresponding period in 2006 .</code></pre>
</div>
</div>
<p>The accuracy improves, but is still second-best so far.</p>
<div id="cell-215" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:12:51.010375Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:12:51.010030Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:12:51.014682Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:12:51.014150Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:12:51.010325Z&quot;}}" data-execution_count="165">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="165">
<pre><code>0.8328131966116807</code></pre>
</div>
</div>
<p>Compared to my best-performing prompting strategy, this prompt yields one more correct <code>negative</code> sentence, 11 more correct <code>neutral</code>s and 17 fewer correct <code>positive</code>s.</p>
<div id="cell-217" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:13:29.823070Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:13:29.822547Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:13:29.907173Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:13:29.906516Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:13:29.823048Z&quot;}}" data-execution_count="166">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-136-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="index_files/figure-html/cell-136-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-218" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:14:50.517696Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:14:50.517187Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:14:50.535259Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:14:50.534775Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:14:50.517675Z&quot;}}" data-execution_count="167">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_V.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-w" class="level2">
<h2 class="anchored" data-anchor-id="prompt-w">Prompt W</h2>
<p>I’ll try one more reduction in examples to 15 before increasing them past 27.</p>
<div id="cell-221" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:15:41.850880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:15:41.850376Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:15:41.853828Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:15:41.853351Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:15:41.850860Z&quot;}}" data-execution_count="168">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,  <span class="co"># positive</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>,   <span class="co"># negative</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span> <span class="co"># neutral</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-222" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:15:54.330551Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:15:54.329891Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:15:54.343145Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:15:54.342588Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:15:54.330527Z&quot;}}" data-execution_count="169">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>promptW_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>promptW_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2249
})</code></pre>
</div>
</div>
<div id="cell-223" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:16:03.514829Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:16:03.514323Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:16:03.520748Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:16:03.520257Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:16:03.514805Z&quot;}}" data-execution_count="170">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="170">
<pre><code>15</code></pre>
</div>
</div>
<div id="cell-224" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:16:16.620911Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:16:16.620652Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:21:29.448146Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:21:29.447465Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:16:16.620894Z&quot;}}" data-execution_count="171">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptW_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"84d6ef05f19d4ba5bd1e41dfe07bcc2c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Clothing retail chain Sepp+ñl+ñ 's sales increased by 8 % to EUR 155.2 mn , and operating profit rose to EUR 31.1 mn from EUR 17.1 mn in 2004 .</code></pre>
</div>
</div>
<p>Decreasing the number of examples to 15 has worsened the accuracy.</p>
<div id="cell-226" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:22:54.622056Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:22:54.621487Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:22:54.626337Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:22:54.625723Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:22:54.622032Z&quot;}}" data-execution_count="173">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="173">
<pre><code>0.8154735437972432</code></pre>
</div>
</div>
<p>Interestingly, here the <code>negative</code> and <code>positive</code> sentiments perform better but <code>neutral</code> performs worse (compared to the best- performing prompt).</p>
<div id="cell-228" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:22:56.372903Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:22:56.372380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:22:56.453197Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:22:56.452533Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:22:56.372882Z&quot;}}" data-execution_count="174">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-143-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="index_files/figure-html/cell-143-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-229" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:23:00.842007Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:23:00.841243Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:23:00.861876Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:23:00.861344Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:23:00.841986Z&quot;}}" data-execution_count="175">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_W.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-x" class="level2">
<h2 class="anchored" data-anchor-id="prompt-x">Prompt X</h2>
<p>I’ll now go in the other direction and increase the number of prompts from 27 to 30 (10 per sentiment).</p>
<div id="cell-232" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:26:07.579063Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:26:07.578506Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:26:07.582986Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:26:07.582301Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:26:07.579043Z&quot;}}" data-execution_count="179">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>,  <span class="co"># positive</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="dv">353</span>, <span class="co"># negative</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span> <span class="co"># neutral</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-233" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:26:53.801382Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:26:53.800882Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:26:53.814626Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:26:53.814164Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:26:53.801362Z&quot;}}" data-execution_count="182">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>promptX_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>promptX_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="182">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
})</code></pre>
</div>
</div>
<div id="cell-234" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:27:16.500653Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:27:16.499951Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:27:16.508076Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:27:16.507645Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:27:16.500630Z&quot;}}" data-execution_count="183">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="183">
<pre><code>30</code></pre>
</div>
</div>
<div id="cell-235" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:27:23.378899Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:27:23.378287Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:36:04.582221Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:36:04.581629Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:27:23.378877Z&quot;}}" data-execution_count="184">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptX_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2d647fed6c6d45d8a95812e14b845f53","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: MegaFon 's subscriber base increased 16.1 % in 2009 to 50.5 million users as of December 31 , while its market share by the number of customers amounted to 24 % as of late 2009 , up from 23 % as of late 2008 , according to TeliaSonera estimates .</code></pre>
</div>
</div>
<p>Nope! Increasing the prompts to 30 doesn’t yield better results.</p>
<div id="cell-237" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:37:25.187520Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:37:25.186681Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:37:25.191297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:37:25.190862Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:37:25.187499Z&quot;}}" data-execution_count="185">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="185">
<pre><code>0.8173679498657117</code></pre>
</div>
</div>
<p>A similar trend as before is appearing: the model gets a lot better at predicting <code>neutral</code> sentences at the cost of <code>negative</code> and <code>positive</code> sentences.</p>
<div id="cell-239" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:37:43.937466Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:37:43.936951Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:37:44.023794Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:37:44.023111Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:37:43.937444Z&quot;}}" data-execution_count="186">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-150-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="index_files/figure-html/cell-150-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-240" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T04:38:44.878165Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T04:38:44.877881Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T04:38:44.896277Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T04:38:44.895585Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T04:38:44.878128Z&quot;}}" data-execution_count="187">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_X.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-y" class="level2">
<h2 class="anchored" data-anchor-id="prompt-y">Prompt Y</h2>
<p>Before I return to the best-performing 21-Shot prompt, I’ll try and give the model a significantly higher number of examples (60) to see if that improves performance.</p>
<div id="cell-243" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:36:47.656707Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:36:47.656404Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:36:47.660925Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:36:47.660247Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:36:47.656686Z&quot;}}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>,<span class="co"># positive</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="dv">353</span>, <span class="dv">354</span>, <span class="dv">355</span>, <span class="dv">356</span>, <span class="dv">357</span>, <span class="dv">358</span>, <span class="dv">359</span>, <span class="dv">360</span>, <span class="dv">361</span>, <span class="dv">362</span>, <span class="dv">370</span>, <span class="co"># negative</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">271</span>, <span class="dv">272</span>, <span class="dv">273</span>, <span class="dv">274</span>, <span class="dv">275</span>, <span class="dv">276</span>, <span class="dv">277</span>, <span class="dv">278</span>, <span class="dv">279</span>, <span class="dv">280</span> <span class="co"># neutral</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-244" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:39:06.205160Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:39:06.204890Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:39:06.230950Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:39:06.230335Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:39:06.205142Z&quot;}}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>promptY_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>promptY_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
})</code></pre>
</div>
</div>
<div id="cell-245" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:39:22.186495Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:39:22.185657Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:39:22.197085Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:39:22.196204Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:39:22.186480Z&quot;}}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>60</code></pre>
</div>
</div>
<div id="cell-246" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:40:02.874729Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:40:02.874111Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:56:00.243053Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:56:00.242575Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:40:02.874707Z&quot;}}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptY_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1deecfe99d934f069bcb7aacba0bd636","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: The fair value of the property portfolio doubled as a result of the Kapiteeli acquisition and totalled EUR 2,686.2 1,259.7 million .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.</code></pre>
</div>
</div>
<p>Nope! 60 examples does not improve performance.</p>
<div id="cell-248" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:56:21.228432Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:56:21.227630Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:56:21.231635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:56:21.231245Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:56:21.228408Z&quot;}}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>0.7581669691470054</code></pre>
</div>
</div>
<p>Interestingly this prompt causes the model to perform ridiculously well on <code>neutral</code> sentences (1368/1371 = 99.8%), but abysmally on <code>negative</code> and especially <code>positive</code> sentences (117/550 = 21%).</p>
<div id="cell-250" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T20:56:38.378086Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T20:56:38.377439Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T20:56:38.491329Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T20:56:38.490864Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T20:56:38.378068Z&quot;}}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-157-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="index_files/figure-html/cell-157-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-251" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:04:39.085074Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:04:39.084390Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:04:39.122395Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:04:39.121745Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:04:39.085045Z&quot;}}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_Y.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-z" class="level2">
<h2 class="anchored" data-anchor-id="prompt-z">Prompt Z</h2>
<p>I’ll return to the best-performing prompt: 27-Shot Prompt A. I’ll see if adding instructions helps.</p>
<div id="cell-254" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:20.595468Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:20.594867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:24:20.598603Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:24:20.597786Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:20.595443Z&quot;}}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>promptZ <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-255" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:21.943846Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:21.943243Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:24:21.947360Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:24:21.946639Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:21.943825Z&quot;}}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(promptZ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
TEXT: {text}</code></pre>
</div>
</div>
<div id="cell-256" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:25.822833Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:25.822178Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:24:25.826474Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:24:25.825901Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:25.822806Z&quot;}}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span> <span class="co"># neutral</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-257" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:28.397160Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:28.396699Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:24:28.410046Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:24:28.409501Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:28.397142Z&quot;}}" data-execution_count="70">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>promptZ_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>promptZ_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2237
})</code></pre>
</div>
</div>
<div id="cell-258" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:32.648423Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:32.648154Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:24:32.655472Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:24:32.654960Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:32.648405Z&quot;}}" data-execution_count="71">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>27</code></pre>
</div>
</div>
<div id="cell-259" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:24:43.274751Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:24:43.274470Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:34:01.697496Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:34:01.696832Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:24:43.274732Z&quot;}}" data-execution_count="72">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptZ_ds, promptZ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5c5ea91cad5249baacce8eb0f3df9981","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>The modified prompt resulted in a ~2% drop in accuracy.</p>
<div id="cell-261" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:34:01.699564Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:34:01.698984Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:34:01.703624Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:34:01.703060Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:34:01.699536Z&quot;}}" data-execution_count="73">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>0.813589628967367</code></pre>
</div>
</div>
<p>This prompt performs better than the best-performing one for <code>neutral</code> sentences (1374 &gt; 1300) at the cost of <code>negative</code> and <code>positive</code> sentences.</p>
<div id="cell-263" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:34:01.704965Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:34:01.704793Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:34:01.800100Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:34:01.799650Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:34:01.704950Z&quot;}}" data-execution_count="74">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-166-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="index_files/figure-html/cell-166-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-264" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T21:34:01.801639Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T21:34:01.801147Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T21:34:01.822470Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T21:34:01.821979Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T21:34:01.801615Z&quot;}}" data-execution_count="75">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_Z.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-aa" class="level2">
<h2 class="anchored" data-anchor-id="prompt-aa">Prompt AA</h2>
<p>Since <code>positive</code> sentiment is performing the worst, I’ll see if reducing <code>neutral</code> and <code>negative</code> examples improves its performance. I’ll stick with the original Prompt A.</p>
<div id="cell-267" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:20:46.361642Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:20:46.361012Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:20:46.364643Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:20:46.364105Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:20:46.361622Z&quot;}}" data-execution_count="78">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>,  <span class="co"># negative</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span> <span class="co"># neutral</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-268" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:21:01.546638Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:21:01.546376Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:21:01.559528Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:21:01.558871Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:21:01.546621Z&quot;}}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>promptAA_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>promptAA_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2241
})</code></pre>
</div>
</div>
<div id="cell-269" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:21:19.932275Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:21:19.931601Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:21:19.939688Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:21:19.938986Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:21:19.932248Z&quot;}}" data-execution_count="80">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>23</code></pre>
</div>
</div>
<div id="cell-270" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:21:46.006357Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:21:46.005847Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:28:36.278144Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:28:36.277500Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:21:46.006336Z&quot;}}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAA_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e3e1865e458642eb8db306c348e3b214","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>The overall accuracy drops a bit.</p>
<div id="cell-272" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:30:04.671977Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:30:04.671505Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:30:04.675731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:30:04.675122Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:30:04.671957Z&quot;}}" data-execution_count="82">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>0.8295403837572513</code></pre>
</div>
</div>
<p>The <code>positive</code> performance deteriorates while <code>negative</code> and <code>neutral</code> get better.</p>
<div id="cell-274" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:30:08.265304Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:30:08.264701Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:30:08.347297Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:30:08.346694Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:30:08.265281Z&quot;}}" data-execution_count="83">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-173-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="index_files/figure-html/cell-173-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-275" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:35:25.295211Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:35:25.294944Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:35:25.315402Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:35:25.314767Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:35:25.295193Z&quot;}}" data-execution_count="90">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AA.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ab" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ab">Prompt AB</h2>
<p>I’ll now reduce the <code>positive</code> examples while keeping the other two the same as my best-performing prompt.</p>
<div id="cell-278" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:35:34.587913Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:35:34.587650Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:35:34.591428Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:35:34.590831Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:35:34.587896Z&quot;}}" data-execution_count="91">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>,  <span class="co"># positive</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span> <span class="co"># neutral</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-279" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:35:38.313607Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:35:38.313280Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:35:38.332196Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:35:38.331517Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:35:38.313579Z&quot;}}" data-execution_count="92">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>promptAB_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>promptAB_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2239
})</code></pre>
</div>
</div>
<div id="cell-280" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:35:40.582631Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:35:40.582096Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:35:40.590973Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:35:40.589957Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:35:40.582609Z&quot;}}" data-execution_count="93">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>25</code></pre>
</div>
</div>
<div id="cell-281" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:35:43.460580Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:35:43.459715Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:42:45.942219Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:42:45.941368Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:35:43.460555Z&quot;}}" data-execution_count="94">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAB_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"913953ce78a74f6b9913ef2ab3ece272","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Foundries division reports its sales increased by 9.7 % to EUR 63.1 mn from EUR 57.5 mn in the corresponding period in 2006 , and sales of the Machine Shop division increased by 16.4 % to EUR 41.2 mn from EUR 35.4 mn in the corresponding period in 2006 .</code></pre>
</div>
</div>
<p>While still a bit lower than my best-performing accuracy, this approach might be worth expanding on.</p>
<div id="cell-283" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:42:45.945520Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:42:45.945386Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:42:45.950110Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:42:45.949463Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:42:45.945500Z&quot;}}" data-execution_count="95">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>0.8369807949977669</code></pre>
</div>
</div>
<p>The number of correctly predicted <code>neutral</code> sentences increases, while the other two decrease.</p>
<div id="cell-285" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:42:45.953072Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:42:45.952923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:42:46.039536Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:42:46.038999Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:42:45.953059Z&quot;}}" data-execution_count="96">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-180-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="index_files/figure-html/cell-180-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-286" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:46:26.664066Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:46:26.663485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:46:26.682551Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:46:26.682018Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:46:26.664045Z&quot;}}" data-execution_count="97">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AB.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ac" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ac">Prompt AC</h2>
<p>I’ll continue reducing <code>positive</code> examples.</p>
<div id="cell-289" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:47:56.855579Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:47:56.854961Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:47:56.858972Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:47:56.858366Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:47:56.855558Z&quot;}}" data-execution_count="98">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,  <span class="co"># positive</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span> <span class="co"># neutral</span></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-290" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:48:15.531165Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:48:15.530631Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:48:15.544299Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:48:15.543778Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:48:15.531144Z&quot;}}" data-execution_count="99">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>promptAC_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>promptAC_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2241
})</code></pre>
</div>
</div>
<div id="cell-291" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:48:29.820351Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:48:29.819852Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:48:29.828343Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:48:29.827658Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:48:29.820329Z&quot;}}" data-execution_count="100">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>23</code></pre>
</div>
</div>
<div id="cell-292" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:48:59.540326Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:48:59.539795Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:55:41.951257Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:55:41.950602Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:48:59.540302Z&quot;}}" data-execution_count="101">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAC_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b0d291e57fb6445ba4333171d3f14285","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Clothing retail chain Sepp+ñl+ñ 's sales increased by 8 % to EUR 155.2 mn , and operating profit rose to EUR 31.1 mn from EUR 17.1 mn in 2004 .</code></pre>
</div>
</div>
<p>Nope! That doesn’t improve accuracy.</p>
<div id="cell-294" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:55:41.954694Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:55:41.954534Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:55:41.958938Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:55:41.958138Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:55:41.954678Z&quot;}}" data-execution_count="102">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>0.8340026773761714</code></pre>
</div>
</div>
<p><code>neutral</code> and <code>positive</code> sentences are correctly predicted at a worse rate, <code>negative</code> sentences predicted a bit better.</p>
<div id="cell-296" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:55:41.961690Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:55:41.961539Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:55:42.043169Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:55:42.042557Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:55:41.961674Z&quot;}}" data-execution_count="103">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-187-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="index_files/figure-html/cell-187-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-297" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-13T23:55:42.046219Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-13T23:55:42.045806Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-13T23:55:42.065136Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-13T23:55:42.064562Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-13T23:55:42.046201Z&quot;}}" data-execution_count="104">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AC.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ad" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ad">Prompt AD</h2>
<p>As I was staring at <code>exclude_idxs</code> I realized that they are sorted by sentiment with <code>positive</code> first, then <code>negative</code> and then <code>neutral</code>. Perhaps this order affects the generations? I’ll try randomizing the order of the 27 examples that yielded the best accuracy.</p>
<div id="cell-300" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:09.918476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:09.917953Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:09.921772Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:09.921138Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:09.918457Z&quot;}}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>,  <span class="co"># positive</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="co"># negative</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span> <span class="co"># neutral</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-301" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:14.844890Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:14.844439Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:14.852237Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:14.851636Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:14.844872Z&quot;}}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>random.shuffle(exclude_idxs)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>exclude_idxs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>[293,
 266,
 264,
 6,
 347,
 7,
 263,
 9,
 38,
 37,
 0,
 352,
 5,
 4,
 351,
 350,
 40,
 294,
 1,
 8,
 349,
 2,
 348,
 292,
 3,
 39,
 265]</code></pre>
</div>
</div>
<div id="cell-302" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:24.890893Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:24.890616Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:24.920924Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:24.920376Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:24.890874Z&quot;}}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>promptAD_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>promptAD_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2237
})</code></pre>
</div>
</div>
<div id="cell-303" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:28.321166Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:28.320630Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:32:28.328935Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:32:28.328172Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:28.321147Z&quot;}}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>27</code></pre>
</div>
</div>
<div id="cell-304" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:32:49.429592Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:32:49.429346Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:41:04.774624Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:41:04.774015Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:32:49.429575Z&quot;}}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAD_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bd1950d7e4f9430cb92c8daa4d62b39e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.</code></pre>
</div>
</div>
<p>Wow, that actually improved my accuracy! It’s making me question all previous few-shot prompt results!</p>
<div id="cell-306" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:41:04.776248Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:41:04.775923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:41:04.780189Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:41:04.779639Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:41:04.776232Z&quot;}}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>0.8609745194456861</code></pre>
</div>
</div>
<p><code>negative</code> TPR decreases, <code>neutral</code> and <code>positive</code> increase quite a bit!</p>
<div id="cell-308" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:41:04.780927Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:41:04.780775Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:41:04.895018Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:41:04.894367Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:41:04.780914Z&quot;}}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-195-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="index_files/figure-html/cell-195-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-309" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:45:46.135465Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:45:46.134910Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:45:46.157200Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:45:46.156556Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:45:46.135447Z&quot;}}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AD.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ae" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ae">Prompt AE</h2>
<p>I’ll return to my 60-Shot prompt and shuffle the examples to see if that improves the accuracy.</p>
<div id="cell-312" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:13:29.895400Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:13:29.894858Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:13:29.899373Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:13:29.898596Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:13:29.895373Z&quot;}}" data-execution_count="118">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>,<span class="co"># positive</span></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>, <span class="dv">349</span>, <span class="dv">350</span>, <span class="dv">351</span>, <span class="dv">352</span>, <span class="dv">353</span>, <span class="dv">354</span>, <span class="dv">355</span>, <span class="dv">356</span>, <span class="dv">357</span>, <span class="dv">358</span>, <span class="dv">359</span>, <span class="dv">360</span>, <span class="dv">361</span>, <span class="dv">362</span>, <span class="dv">370</span>, <span class="co"># negative</span></span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">271</span>, <span class="dv">272</span>, <span class="dv">273</span>, <span class="dv">274</span>, <span class="dv">275</span>, <span class="dv">276</span>, <span class="dv">277</span>, <span class="dv">278</span>, <span class="dv">279</span>, <span class="dv">280</span> <span class="co"># neutral</span></span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-313" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:13:32.165122Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:13:32.164409Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:13:32.169671Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:13:32.169159Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:13:32.165093Z&quot;}}" data-execution_count="119">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>random.shuffle(exclude_idxs)</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a>exclude_idxs[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>[15, 37, 358, 16, 0]</code></pre>
</div>
</div>
<div id="cell-314" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:13:39.750594Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:13:39.749741Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:13:39.766012Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:13:39.765365Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:13:39.750571Z&quot;}}" data-execution_count="120">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>promptAE_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>promptAE_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
})</code></pre>
</div>
</div>
<div id="cell-315" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:13:49.638961Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:13:49.638508Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:13:49.648704Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:13:49.648213Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:13:49.638941Z&quot;}}" data-execution_count="121">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>60</code></pre>
</div>
</div>
<div id="cell-316" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:14:04.428386Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:14:04.427595Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:29:59.056333Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:29:59.055620Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:14:04.428373Z&quot;}}" data-execution_count="122">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAE_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c7d230d549314afda6ca4311282ef8cf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: The fair value of the property portfolio doubled as a result of the Kapiteeli acquisition and totalled EUR 2,686.2 1,259.7 million .</code></pre>
</div>
</div>
<p>The shuffled 60-Shot prompt does not yield better results.</p>
<div id="cell-318" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:29:59.059052Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:29:59.058910Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:29:59.063043Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:29:59.062528Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:29:59.059038Z&quot;}}" data-execution_count="123">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>0.8371143375680581</code></pre>
</div>
</div>
<p>Interestingly it gets the same number of <code>neutral</code> sentences right (1341) but get lower counts for the other two.</p>
<div id="cell-320" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:29:59.065904Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:29:59.065767Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:29:59.149985Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:29:59.149413Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:29:59.065891Z&quot;}}" data-execution_count="124">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-203-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="index_files/figure-html/cell-203-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-321" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:29:59.152292Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:29:59.152147Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:29:59.170037Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:29:59.169429Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:29:59.152278Z&quot;}}" data-execution_count="125">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AE.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-af" class="level2">
<h2 class="anchored" data-anchor-id="prompt-af">Prompt AF</h2>
<p>I’ll now try a shuffled 15-Shot prompt.</p>
<div id="cell-324" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:32:18.212439Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:32:18.211680Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:32:18.215886Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:32:18.215128Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:32:18.212417Z&quot;}}" data-execution_count="126">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>,  <span class="co"># positive</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">348</span>,   <span class="co"># negative</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span> <span class="co"># neutral</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-325" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:32:32.469864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:32:32.469607Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:32:32.474283Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:32:32.473788Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:32:32.469847Z&quot;}}" data-execution_count="127">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>random.shuffle(exclude_idxs)</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>exclude_idxs[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<pre><code>[292, 38, 1, 0, 4]</code></pre>
</div>
</div>
<div id="cell-326" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:36:27.015500Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:36:27.014780Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:36:27.028063Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:36:27.027389Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:36:27.015478Z&quot;}}" data-execution_count="128">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>promptAF_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>promptAF_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2249
})</code></pre>
</div>
</div>
<div id="cell-327" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:36:47.098744Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:36:47.098037Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:36:47.105871Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:36:47.105307Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:36:47.098715Z&quot;}}" data-execution_count="129">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>15</code></pre>
</div>
</div>
<div id="cell-328" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:37:09.167714Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:37:09.167454Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:42:22.790839Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:42:22.790210Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:37:09.167697Z&quot;}}" data-execution_count="130">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAF_ds, promptA, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"74bc8019d63f46368f97fd62602b5fc7","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Clothing retail chain Sepp+ñl+ñ 's sales increased by 8 % to EUR 155.2 mn , and operating profit rose to EUR 31.1 mn from EUR 17.1 mn in 2004 .</code></pre>
</div>
</div>
<p>Shuffling the 15-Shot prompt doesn’t beat the 27-Shot prompt.</p>
<div id="cell-330" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:42:22.793569Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:42:22.793433Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:42:22.797739Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:42:22.797208Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:42:22.793552Z&quot;}}" data-execution_count="131">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>0.8199199644286349</code></pre>
</div>
</div>
<div id="cell-331" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:42:22.800565Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:42:22.800372Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:42:22.886315Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:42:22.885768Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:42:22.800537Z&quot;}}" data-execution_count="132">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-211-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="index_files/figure-html/cell-211-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-332" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T00:42:22.888694Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T00:42:22.888560Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T00:42:22.907142Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T00:42:22.906544Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T00:42:22.888693Z&quot;}}" data-execution_count="133">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AF.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ag" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ag">Prompt AG</h2>
<p>The last thing I’ll experiment with is adding a system prompt.</p>
<div id="cell-335" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:46:29.465847Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:46:29.465595Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:46:29.472061Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:46:29.471413Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:46:29.465831Z&quot;}}" data-execution_count="23">
<details class="code-fold">
<summary>Show updated <code>few_shot_responses</code> function</summary>
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> few_shot_responses(dataset, prompt, examples, sp):</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb321-12"><a href="#cb321-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb321-13"><a href="#cb321-13" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> [{<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: sp}] <span class="op">+</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}]</span>
<span id="cb321-14"><a href="#cb321-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb321-15"><a href="#cb321-15" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb321-16"><a href="#cb321-16" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb321-17"><a href="#cb321-17" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb321-18"><a href="#cb321-18" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb321-19"><a href="#cb321-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb321-20"><a href="#cb321-20" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb321-21"><a href="#cb321-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-22"><a href="#cb321-22" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb321-23"><a href="#cb321-23" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb321-24"><a href="#cb321-24" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb321-25"><a href="#cb321-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb321-26"><a href="#cb321-26" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb321-27"><a href="#cb321-27" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb321-28"><a href="#cb321-28" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb321-29"><a href="#cb321-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-30"><a href="#cb321-30" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb321-31"><a href="#cb321-31" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb321-32"><a href="#cb321-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb321-33"><a href="#cb321-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb321-34"><a href="#cb321-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb321-35"><a href="#cb321-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb321-36"><a href="#cb321-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb321-37"><a href="#cb321-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb321-38"><a href="#cb321-38" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb321-39"><a href="#cb321-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb321-40"><a href="#cb321-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-336" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:46:33.317834Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:46:33.317563Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:46:33.323794Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:46:33.323118Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:46:33.317816Z&quot;}}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> <span class="st">"You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral. Consider the overall impact and implications of the statement when making your classification. If the amount of money, market share, or key performance indicators are not explicitly increasing or decreasing, respond with neutral. Consider terms like 'growth', 'decline', 'improvement', or 'deterioration' as indicators of change."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-337" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:46:35.614930Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:46:35.614690Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:46:35.617808Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:46:35.617262Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:46:35.614913Z&quot;}}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral. Consider the overall impact and implications of the statement when making your classification. If the amount of money, market share, or key performance indicators are not explicitly increasing or decreasing, respond with neutral. Consider terms like 'growth', 'decline', 'improvement', or 'deterioration' as indicators of change.</code></pre>
</div>
</div>
<div id="cell-338" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:46:53.925453Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:46:53.924811Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:55:25.175080Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:55:25.174622Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:46:53.925424Z&quot;}}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAD_ds, promptA, examples, sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e57bdcdd635c4a6fab9c1b2e16ceb945","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>This particular system prompt doesn’t improve the accuracy.</p>
<div id="cell-340" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:55:25.177732Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:55:25.177476Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:55:25.180908Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:55:25.180578Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:55:25.177716Z&quot;}}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.8439874832364774</code></pre>
</div>
</div>
<div id="cell-341" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:55:25.183332Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:55:25.183054Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:55:25.260312Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:55:25.259904Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:55:25.183317Z&quot;}}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-218-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="index_files/figure-html/cell-218-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-342" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:56:20.584955Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:56:20.584221Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:56:20.604221Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:56:20.603767Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:56:20.584935Z&quot;}}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AG.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ah" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ah">Prompt AH</h2>
<p>I’ll simplify the system prompt.</p>
<div id="cell-345" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:56:26.932892Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:56:26.931950Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:56:26.935513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:56:26.934999Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:56:26.932834Z&quot;}}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> <span class="st">"You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral. Consider the overall impact and implications of the statement when making your classification."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-346" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:56:29.622879Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:56:29.622283Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T02:56:29.625649Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T02:56:29.625206Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:56:29.622857Z&quot;}}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral. Consider the overall impact and implications of the statement when making your classification.</code></pre>
</div>
</div>
<div id="cell-347" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T02:56:34.445712Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T02:56:34.445265Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:04:53.578178Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:04:53.577581Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T02:56:34.445695Z&quot;}}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAD_ds, promptA, examples, sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"da4d73e64cfb4d46bfd86b840c296035","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>Using a simpler system prompt lowers the accuracy.</p>
<div id="cell-349" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:04:53.581100Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:04:53.580957Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:04:53.585114Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:04:53.584663Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:04:53.581085Z&quot;}}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0.8466696468484578</code></pre>
</div>
</div>
<p>The model gets 22 more <code>neutral</code> sentences correct but does worse on <code>negative</code> and <code>positive</code> sentences (when compared to the best-performing Prompt AD).</p>
<div id="cell-351" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:07:55.761740Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:07:55.760949Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:07:55.847131Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:07:55.846427Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:07:55.761719Z&quot;}}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-224-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="index_files/figure-html/cell-224-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-352" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:08:03.853159Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:08:03.852461Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:08:03.873045Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:08:03.872596Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:08:03.853127Z&quot;}}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AH.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ai" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ai">Prompt AI</h2>
<p>I’ll further simplify the system prompt.</p>
<div id="cell-355" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:08:54.393967Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:08:54.393672Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:08:54.397604Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:08:54.396972Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:08:54.393947Z&quot;}}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> <span class="st">"You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-356" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:08:56.395388Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:08:56.394698Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:08:56.399472Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:08:56.398604Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:08:56.395377Z&quot;}}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You are an expert in financial sentiment analysis. Your task is to accurately classify the sentiment of financial statements as negative, positive, or neutral.</code></pre>
</div>
</div>
<div id="cell-357" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:09:06.501356Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:09:06.500844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:17:24.425543Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:17:24.425038Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:09:06.501335Z&quot;}}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> few_shot_responses(promptAD_ds, promptA, examples, sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a34810bc57684c72b3e1c9e7e953c2fa","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: Its board of directors will propose a dividend of EUR0 .12 per share for 2010 , up from the EUR0 .08 per share paid in 2009 .</code></pre>
</div>
</div>
<p>I still can’t recover (or improve upon) the best-performing accuracy of 86%.</p>
<div id="cell-359" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:17:24.428023Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:17:24.427740Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:17:24.431073Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:17:24.430742Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:17:24.428007Z&quot;}}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.8439874832364774</code></pre>
</div>
</div>
<p>The <code>neutral</code> performance continues to increase while <code>negative</code> and <code>positive</code> sentences suffer.</p>
<div id="cell-361" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:17:24.433571Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:17:24.433230Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:17:24.510854Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:17:24.510398Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:17:24.433556Z&quot;}}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-230-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="index_files/figure-html/cell-230-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="cell-362" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:18:53.531626Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:18:53.531114Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:18:53.553128Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:18:53.552677Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:18:53.531603Z&quot;}}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-1.5B-Instruct_AI.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-inference-10-times-using-the-best-prompt" class="level2">
<h2 class="anchored" data-anchor-id="running-inference-10-times-using-the-best-prompt">Running Inference 10 Times Using the Best Prompt</h2>
<div id="cell-364" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:21:54.140776Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:21:54.140505Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:21:54.147440Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:21:54.146801Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:21:54.140760Z&quot;}}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_gen(examples):</span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: promptA.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: promptA.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])}]</span>
<span id="cb349-9"><a href="#cb349-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb349-10"><a href="#cb349-10" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb349-11"><a href="#cb349-11" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb349-12"><a href="#cb349-12" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb349-13"><a href="#cb349-13" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb349-14"><a href="#cb349-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb349-15"><a href="#cb349-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb349-16"><a href="#cb349-16" aria-hidden="true" tabindex="-1"></a>    model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb349-17"><a href="#cb349-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-18"><a href="#cb349-18" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb349-19"><a href="#cb349-19" aria-hidden="true" tabindex="-1"></a>        model_inputs.input_ids,</span>
<span id="cb349-20"><a href="#cb349-20" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb349-21"><a href="#cb349-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb349-22"><a href="#cb349-22" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> [</span>
<span id="cb349-23"><a href="#cb349-23" aria-hidden="true" tabindex="-1"></a>        output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb349-24"><a href="#cb349-24" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb349-25"><a href="#cb349-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-26"><a href="#cb349-26" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb349-27"><a href="#cb349-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-365" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:22:00.642342Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:22:00.641808Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:22:15.241067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:22:15.240129Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:22:00.642322Z&quot;}}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">10</span> test_gen(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>208 ms ± 1.93 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<div id="cell-366" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:23:12.852903Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:23:12.852349Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:23:12.859392Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:23:12.858613Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:23:12.852885Z&quot;}}" data-execution_count="59">
<details class="code-fold">
<summary>Show updated <code>few_shot_responses</code> function</summary>
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> few_shot_responses(dataset, prompt, examples):</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb352-6"><a href="#cb352-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb352-7"><a href="#cb352-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb352-8"><a href="#cb352-8" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb352-9"><a href="#cb352-9" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb352-10"><a href="#cb352-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb352-11"><a href="#cb352-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb352-12"><a href="#cb352-12" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}]</span>
<span id="cb352-13"><a href="#cb352-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb352-14"><a href="#cb352-14" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb352-15"><a href="#cb352-15" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb352-16"><a href="#cb352-16" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb352-17"><a href="#cb352-17" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb352-18"><a href="#cb352-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb352-19"><a href="#cb352-19" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb352-20"><a href="#cb352-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-21"><a href="#cb352-21" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb352-22"><a href="#cb352-22" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb352-23"><a href="#cb352-23" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb352-24"><a href="#cb352-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb352-25"><a href="#cb352-25" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb352-26"><a href="#cb352-26" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb352-27"><a href="#cb352-27" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb352-28"><a href="#cb352-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-29"><a href="#cb352-29" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb352-30"><a href="#cb352-30" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb352-31"><a href="#cb352-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb352-32"><a href="#cb352-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb352-33"><a href="#cb352-33" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb352-34"><a href="#cb352-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb352-35"><a href="#cb352-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb352-36"><a href="#cb352-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb352-37"><a href="#cb352-37" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb352-38"><a href="#cb352-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb352-39"><a href="#cb352-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-367" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:23:44.252736Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:23:44.252488Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:23:44.257792Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:23:44.257077Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:23:44.252719Z&quot;}}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>27</code></pre>
</div>
</div>
<div id="cell-368" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:24:01.005302Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:24:01.005028Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T03:24:01.010144Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T03:24:01.009537Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:24:01.005284Z&quot;}}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>[293, 266, 264, 6, 347, 7, 263, 9, 38, 37]</code></pre>
</div>
</div>
<div id="cell-369" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T03:25:30.161693Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T03:25:30.161034Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T04:48:10.351949Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T04:48:10.351435Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T03:25:30.161666Z&quot;}}">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>accs <span class="op">=</span> []</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>    df, acc <span class="op">=</span> few_shot_responses(promptAD_ds, promptA, examples)</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>    accs.append(acc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This prompt results in a pretty consistent overall accuracy, around 86%.</p>
<div id="cell-371" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-09-14T04:48:10.355166Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-09-14T04:48:10.355021Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-09-14T04:48:10.363096Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-09-14T04:48:10.362519Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-09-14T04:48:10.355153Z&quot;}}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>pd.Series(accs).describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>count    10.000000
mean      0.859321
std       0.004617
min       0.847564
25%       0.858739
50%       0.860304
75%       0.861310
max       0.865445
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Here are the results from my experiments so far (**the best-performing prompt from this notebook):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Prompting Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">claude-3-5-sonnet-20240620</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">94.78%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">94% (1302/1391)</td>
<td style="text-align: center;">95% (544/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">claude-3-opus-20240229</td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">94.13%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">96% (1333/1391)</td>
<td style="text-align: center;">88% (501/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">phi-3.5</td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">93.94%</td>
<td style="text-align: center;">96% (286/299)</td>
<td style="text-align: center;">98% (1355/1379)</td>
<td style="text-align: center;">83% (467/566)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-3</td>
<td style="text-align: center;">30-Shot w/System Prompt</td>
<td style="text-align: center;">92.79%</td>
<td style="text-align: center;">98% (290/297)</td>
<td style="text-align: center;">94% (1284/1373)</td>
<td style="text-align: center;">88% (499/564)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">claude-3-haiku-20240307</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">92.39%</td>
<td style="text-align: center;">90% (272/303)</td>
<td style="text-align: center;">91% (1267/1391)</td>
<td style="text-align: center;">96% (550/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-2</td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91.94%</td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">**Qwen2-1.5B</td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">86.10%</td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">95.5% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
</tbody>
</table>
<p>Here are the results from this notebook. The best-performing prompt was a randomly shuffled 27-Shot prompt (<a href="#prompt-ad">Prompt AD</a>), yielding an overall accuracy of 86.10%.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">prompt</th>
<th style="text-align: center;">strategy</th>
<th style="text-align: center;">accuracy</th>
<th style="text-align: center;">negative</th>
<th style="text-align: center;">neutral</th>
<th style="text-align: center;">positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-a">A</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81.76%</td>
<td style="text-align: center;">97% (293/303)</td>
<td style="text-align: center;">85% (1185/1391)</td>
<td style="text-align: center;">65% (373/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-b">B</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">51.86%</td>
<td style="text-align: center;">99% (300/303)</td>
<td style="text-align: center;">61% (846/1391)</td>
<td style="text-align: center;">5% (28/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-c">C</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81.40%</td>
<td style="text-align: center;">93% (283/303)</td>
<td style="text-align: center;">96% (1330/1391)</td>
<td style="text-align: center;">40% (230/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-d">D</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">78.53%</td>
<td style="text-align: center;">92% (279/303)</td>
<td style="text-align: center;">92% (1281/1391)</td>
<td style="text-align: center;">38% (218/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-e">E</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">66.21%</td>
<td style="text-align: center;"><u><strong>100% (302/303)</strong></u></td>
<td style="text-align: center;">82% (1145/1391)</td>
<td style="text-align: center;">9% (52/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-f">F</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">78.05%</td>
<td style="text-align: center;">88% (267/303)</td>
<td style="text-align: center;">97% (1355/1391)</td>
<td style="text-align: center;">25% (145/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-g">G</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">66.70%</td>
<td style="text-align: center;">94% (285/303)</td>
<td style="text-align: center;">80% (1107/1391)</td>
<td style="text-align: center;">21% (118/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-h">H</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">70.89%</td>
<td style="text-align: center;">85% (259/303)</td>
<td style="text-align: center;">90% (1247/1391)</td>
<td style="text-align: center;">17% (99/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-i">I</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">69.17%</td>
<td style="text-align: center;">58% (176/303)</td>
<td style="text-align: center;">86% (1201/1391)</td>
<td style="text-align: center;">33% (189/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-j">J</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">57.38%</td>
<td style="text-align: center;">47% (142/303)</td>
<td style="text-align: center;">78% (1086/1391)</td>
<td style="text-align: center;">12% (71/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-k">K</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">41.87%</td>
<td style="text-align: center;">34% (102/303)</td>
<td style="text-align: center;">52% (728/1391)</td>
<td style="text-align: center;">21% (118/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-l">L</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">42.84%</td>
<td style="text-align: center;">66% (200/303)</td>
<td style="text-align: center;">45% (629/1391)</td>
<td style="text-align: center;">25% (141/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-m">M</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">51.46%</td>
<td style="text-align: center;">26% (79/303)</td>
<td style="text-align: center;">77% (1078/1391)</td>
<td style="text-align: center;">1% (8/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-n">N</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">29.77%</td>
<td style="text-align: center;">11% (33/303)</td>
<td style="text-align: center;">44% (608/1391)</td>
<td style="text-align: center;">6% (33/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-o">O</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">61.00%</td>
<td style="text-align: center;">37% (113/303)</td>
<td style="text-align: center;">90% (1257/1391)</td>
<td style="text-align: center;">2% (11/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-p">P</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">78.20%</td>
<td style="text-align: center;">91% (275/302)</td>
<td style="text-align: center;">91% (1266/1390)</td>
<td style="text-align: center;">40% (227/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-q">Q</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">76.93%</td>
<td style="text-align: center;">96% (289/302)</td>
<td style="text-align: center;">73% (1010/1387)</td>
<td style="text-align: center;"><u><strong>77% (438/569)</strong></u></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-r">R</a></td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">81.42%</td>
<td style="text-align: center;">92% (274/299)</td>
<td style="text-align: center;">94% (1301/1379)</td>
<td style="text-align: center;">45% (252/566)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-s">S</a></td>
<td style="text-align: center;">30-Shot</td>
<td style="text-align: center;">81.51%</td>
<td style="text-align: center;">87% (255/294)</td>
<td style="text-align: center;">98% (1345/1379)</td>
<td style="text-align: center;">39% (221/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-t">T</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">83.73%</td>
<td style="text-align: center;">93% (272/294)</td>
<td style="text-align: center;">94.3% (1303/1382)</td>
<td style="text-align: center;">53% (298/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-u">U</a></td>
<td style="text-align: center;">25-Shot</td>
<td style="text-align: center;">82.94%</td>
<td style="text-align: center;">90% (266/294)</td>
<td style="text-align: center;">96.2% (1331/1384)</td>
<td style="text-align: center;">46% (260/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-v">V</a></td>
<td style="text-align: center;">21-Shot</td>
<td style="text-align: center;">83.28%</td>
<td style="text-align: center;">92% (273/296)</td>
<td style="text-align: center;">94.9% (1314/1384)</td>
<td style="text-align: center;">50% (281/563)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-w">W</a></td>
<td style="text-align: center;">15-Shot</td>
<td style="text-align: center;">81.55%</td>
<td style="text-align: center;">94% (279/298)</td>
<td style="text-align: center;">87.7% (1215/1386)</td>
<td style="text-align: center;">60% (340/565)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-x">X</a></td>
<td style="text-align: center;">30-Shot</td>
<td style="text-align: center;">81.74%</td>
<td style="text-align: center;">89% (261/293)</td>
<td style="text-align: center;">96.7% (1336/1381)</td>
<td style="text-align: center;">41% (229/560)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-y">Y</a></td>
<td style="text-align: center;">60-Shot</td>
<td style="text-align: center;">75.82%</td>
<td style="text-align: center;">66% (186/283)</td>
<td style="text-align: center;"><u><strong>99.8% (1368/1371)</strong></u></td>
<td style="text-align: center;">21% (117/550)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-z">Z</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">81.36%</td>
<td style="text-align: center;">80% (236/294)</td>
<td style="text-align: center;">99.4% (1374/1382)</td>
<td style="text-align: center;">37% (210/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-aa">AA</a></td>
<td style="text-align: center;">23-Shot</td>
<td style="text-align: center;">82.95%</td>
<td style="text-align: center;">93% (276/296)</td>
<td style="text-align: center;">94.9% (1314/1384)</td>
<td style="text-align: center;">48% (269/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ab">AB</a></td>
<td style="text-align: center;">25-Shot</td>
<td style="text-align: center;">83.70%</td>
<td style="text-align: center;">92% (270/294)</td>
<td style="text-align: center;">95.3% (1317/1382)</td>
<td style="text-align: center;">51% (287/563)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ac">AC</a></td>
<td style="text-align: center;">23-Shot</td>
<td style="text-align: center;">83.40%</td>
<td style="text-align: center;">95% (278/294)</td>
<td style="text-align: center;">93.8% (1296/1382)</td>
<td style="text-align: center;">52% (295/565)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ad">AD</a></td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;"><u><strong>86.10%</strong></u></td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">95.5% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ae">AE</a></td>
<td style="text-align: center;">60-Shot</td>
<td style="text-align: center;">83.71%</td>
<td style="text-align: center;">83% (234/283)</td>
<td style="text-align: center;">97.8% (1341/1371)</td>
<td style="text-align: center;">49% (270/550)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-af">AF</a></td>
<td style="text-align: center;">15-Shot</td>
<td style="text-align: center;">82.00%</td>
<td style="text-align: center;">91% (272/298)</td>
<td style="text-align: center;">88.8% (1231/1386)</td>
<td style="text-align: center;">60% (341/565)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ag">AG</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.40%</td>
<td style="text-align: center;">84% (248/294)</td>
<td style="text-align: center;">97.8% (1351/1382)</td>
<td style="text-align: center;">52% (289/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-ah">AH</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.67%</td>
<td style="text-align: center;">87% (256/294)</td>
<td style="text-align: center;">97.1% (1342/1382)</td>
<td style="text-align: center;">53% (296/561)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-ai">AI</a></td>
<td style="text-align: center;">27-Shot w/System Prompt</td>
<td style="text-align: center;">84.99%</td>
<td style="text-align: center;">88% (260/294)</td>
<td style="text-align: center;">97.3% (1345/1382)</td>
<td style="text-align: center;">50% (283/561)</td>
</tr>
</tbody>
</table>
<p>Here are my takeaways from working with Qwen2-1.5B-Instruct:</p>
<ul>
<li><strong>It was easy to get a decent overall accuracy (on my first try!) but quite difficult to improve upon it.</strong> Although I tested out 35 prompts, there’s still much more room for experimentation.</li>
<li><strong>The <code>positive</code> sentiment True Positive Rate was considerably worse than <code>neutral</code> or <code>negative</code> sentiments.</strong> The most accurate <code>positive</code> sentiment classification was 77% (Prompt Q) compared to 99.8% for <code>negative</code> (Prompt Y) and 100% for <code>neutral</code> (Prompt E).</li>
<li><strong>Randomizing the order of the examples improved my 27-Shot prompt’s overall accuracy.</strong> I had not tried this before and is something I’ll make sure to use again in the future.</li>
<li><strong>The best-performing prompt contained an equal number of examples from each sentiment (9 per sentiment).</strong> Decreasing the representation of each sentiment worsened the overall accuracy.</li>
<li><strong>The best performing prompt for each sentiment is not the best overall prompt.</strong> This is important to note because there may be situations where one type of sentiment is more critical than the other. For example, it may be “safer” to have a high TPR for <code>negative</code> or <code>positive</code> sentiment if people are making decisions based on the predicted sentiment.</li>
</ul>
<p>I hope you enjoyed this blog post! Follow me on Twitter <a href="https://twitter.com/vishal_learner"><span class="citation" data-cites="vishal_learner">@vishal_learner</span></a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/vishalbakshi\.github\.io\/blog");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>