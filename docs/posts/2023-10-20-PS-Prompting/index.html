<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2023-10-20">
<meta name="description" content="In this notebook I summarize the findings from the paper “Plan-and-Solve Prompting: Improving Zero-Shot Chain-of-Thought Reasoning by Large Language Models” by Lei Wang, et al.">

<title>vishal bakshi - Paper Summary: Plan-and-Solve Prompting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">vishal bakshi</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#what-is-the-problem-which-llms-are-failing-to-solve" id="toc-what-is-the-problem-which-llms-are-failing-to-solve" class="nav-link" data-scroll-target="#what-is-the-problem-which-llms-are-failing-to-solve">1) What is the problem which LLMs are failing to solve?</a></li>
  <li><a href="#an-overview-of-the-prompting-strategy" id="toc-an-overview-of-the-prompting-strategy" class="nav-link" data-scroll-target="#an-overview-of-the-prompting-strategy">2) An overview of the prompting strategy</a>
  <ul class="collapse">
  <li><a href="#plan-and-solve-ps-prompting" id="toc-plan-and-solve-ps-prompting" class="nav-link" data-scroll-target="#plan-and-solve-ps-prompting">Plan-and-Solve (PS) Prompting</a></li>
  <li><a href="#ps-prompting" id="toc-ps-prompting" class="nav-link" data-scroll-target="#ps-prompting">PS+ Prompting</a></li>
  </ul></li>
  <li><a href="#an-example-of-the-xot-prompt" id="toc-an-example-of-the-xot-prompt" class="nav-link" data-scroll-target="#an-example-of-the-xot-prompt">3) An example of the XoT prompt</a>
  <ul class="collapse">
  <li><a href="#ps-prompting-1" id="toc-ps-prompting-1" class="nav-link" data-scroll-target="#ps-prompting-1">PS Prompting</a></li>
  <li><a href="#ps-prompting-2" id="toc-ps-prompting-2" class="nav-link" data-scroll-target="#ps-prompting-2">PS+ Prompting</a></li>
  </ul></li>
  <li><a href="#improvement-on-benchmarks" id="toc-improvement-on-benchmarks" class="nav-link" data-scroll-target="#improvement-on-benchmarks">4) Improvement on benchmarks</a>
  <ul class="collapse">
  <li><a href="#arithmetic-reasoning-dataset-performance" id="toc-arithmetic-reasoning-dataset-performance" class="nav-link" data-scroll-target="#arithmetic-reasoning-dataset-performance">Arithmetic Reasoning Dataset Performance</a></li>
  <li><a href="#common-sense-reasoning-dataset-performance" id="toc-common-sense-reasoning-dataset-performance" class="nav-link" data-scroll-target="#common-sense-reasoning-dataset-performance">Common Sense Reasoning Dataset Performance</a></li>
  <li><a href="#symbolic-reasoning-dataset-performance" id="toc-symbolic-reasoning-dataset-performance" class="nav-link" data-scroll-target="#symbolic-reasoning-dataset-performance">Symbolic Reasoning Dataset Performance</a></li>
  <li><a href="#addressing-issues-of-zero-shot-cot-prompting" id="toc-addressing-issues-of-zero-shot-cot-prompting" class="nav-link" data-scroll-target="#addressing-issues-of-zero-shot-cot-prompting">Addressing Issues of Zero-shot-CoT Prompting</a></li>
  </ul></li>
  <li><a href="#does-this-prompt-strategy-strike-you-as-useful-what-are-the-downsides" id="toc-does-this-prompt-strategy-strike-you-as-useful-what-are-the-downsides" class="nav-link" data-scroll-target="#does-this-prompt-strategy-strike-you-as-useful-what-are-the-downsides">5) Does this prompt strategy strike you as useful? What are the downsides?</a></li>
  <li><a href="#test-the-prompt-using-a-local-model-or-api" id="toc-test-the-prompt-using-a-local-model-or-api" class="nav-link" data-scroll-target="#test-the-prompt-using-a-local-model-or-api">6) Test the prompt using a local model or api</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Paper Summary: Plan-and-Solve Prompting</h1>
  <div class="quarto-categories">
    <div class="quarto-category">deep learning</div>
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    In this notebook I summarize the findings from the paper “Plan-and-Solve Prompting: Improving Zero-Shot Chain-of-Thought Reasoning by Large Language Models” by Lei Wang, et al.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this notebook I’ll summarize the paper <a href="https://arxiv.org/pdf/2305.04091.pdf">Plan-and-Solve Prompting: Improving Zero-Shot Chain-of-Thought Reasoning by Large Language Models</a> (Lei Wang, et al) with the following questions. This exercise is part of a fastai study group assignment where we had multiple study group members present the different Chain-of-Thought papers.</p>
<p>This notebook has the following sections:</p>
<ol type="1">
<li>What is the problem which LLMs are failing to solve?</li>
<li>An overview of the prompting strategy</li>
<li>An example of the XoT prompt</li>
<li>Improvements on benchmarks</li>
<li>Does this prompt strategy strike you as useful? What are the downsides?</li>
<li>Test the prompt using a local model or API</li>
</ol>
</section>
<section id="what-is-the-problem-which-llms-are-failing-to-solve" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-problem-which-llms-are-failing-to-solve">1) What is the problem which LLMs are failing to solve?</h2>
<p>Zero-shot-CoT (CoT = Chain-of-Thought) prompting involves appending the phrase <em>“Let’s think step by step”</em> to the end of a prompt and has <a href="https://arxiv.org/pdf/2205.11916.pdf">shown to improve LLM performance on reasoning tasks</a> when compared to zero-shot prompting.</p>
<p>An example of a Zero-shot-CoT prompt:</p>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: Let’s think step by step.</p>
</blockquote>
<p>From the abstract of this paper (emphasis mine):</p>
<blockquote class="blockquote">
<p>Despite the success of Zero-shot-CoT, it still suffers from three pitfalls: <strong>calculation errors, missing-step errors, and semantic misunderstanding errors</strong>.</p>
</blockquote>
<p>The authors address calculation errors and missing-step errors with Plan-and-Solve (PS) Prompting and PS+ Prompting. PS+ Prompting extends PS Prompting with more detailed instructions.</p>
</section>
<section id="an-overview-of-the-prompting-strategy" class="level2">
<h2 class="anchored" data-anchor-id="an-overview-of-the-prompting-strategy">2) An overview of the prompting strategy</h2>
<p>The prompting template for PS and PS+ prompting is fundamentally the same as Zero-shot-CoT</p>
<blockquote class="blockquote">
<p>Q: <code>[X]</code>.</p>
<p>A: <code>[T]</code>.</p>
</blockquote>
<p>Where <code>[X]</code> contains the input problem statement and <code>[T]</code> is a hand-crafted instruction.</p>
<p>The prompting strategy extends the Zero-shot-CoT prompt by adding more detailed instructions <code>[T]</code> on how the LLM should answer reasoning tasks to encourage the model to devise a plan, carry out the plan and lists intermediate steps.</p>
<section id="plan-and-solve-ps-prompting" class="level3">
<h3 class="anchored" data-anchor-id="plan-and-solve-ps-prompting">Plan-and-Solve (PS) Prompting</h3>
<p>This prompting strategy replaces the Zero-shot-CoT prompt of <em>“Let’s think step by step”</em> with the following in order to address the issue of Zero-shot-CoT caused by missing reasoning steps:</p>
<blockquote class="blockquote">
<p>Q: <code>[X]</code>.</p>
<p>A: Let’s first understand the problem and devise a plan to solve the problem. Then, let’s carry out the plan and solve the problem step by step.</p>
</blockquote>
</section>
<section id="ps-prompting" class="level3">
<h3 class="anchored" data-anchor-id="ps-prompting">PS+ Prompting</h3>
<p>This prompting strategy extends PS Prompting with the following instruction to address the calculation errors of Zero-shot-CoT:</p>
<blockquote class="blockquote">
<p><em>“pay attention to calculation”</em></p>
</blockquote>
<p>and the following instruction to address missing-step errors:</p>
<blockquote class="blockquote">
<p><em>“extract relevant variables and their corresponding numerals”</em></p>
</blockquote>
<p>It also includes the following instruction to enhance the LLMs ability to generate relevant and important reasoning steps:</p>
<blockquote class="blockquote">
<p><em>“calculate intermediate results”</em></p>
</blockquote>
<p>An example of the full PS+ Prompting strategy:</p>
<blockquote class="blockquote">
<p>Q: <code>[X]</code></p>
<p>A: Let’s first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let’s carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</p>
</blockquote>
<p>This prompting strategy can be easily customized to solve a variety of problems other than math reasoning.</p>
</section>
</section>
<section id="an-example-of-the-xot-prompt" class="level2">
<h2 class="anchored" data-anchor-id="an-example-of-the-xot-prompt">3) An example of the XoT prompt</h2>
<section id="ps-prompting-1" class="level3">
<h3 class="anchored" data-anchor-id="ps-prompting-1">PS Prompting</h3>
<p>Using the same restaurant bill math problem as before, here is how it would be structured as a PS prompt:</p>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: Let’s first understand the problem and devise a plan to solve the problem. Then, let’s carry out the plan and solve the problem step by step.</p>
</blockquote>
</section>
<section id="ps-prompting-2" class="level3">
<h3 class="anchored" data-anchor-id="ps-prompting-2">PS+ Prompting</h3>
<p>And here is how it would be structured with the more detailed PS+ prompt:</p>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: Let’s first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let’s carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</p>
</blockquote>
</section>
</section>
<section id="improvement-on-benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="improvement-on-benchmarks">4) Improvement on benchmarks</h2>
<p>The authors evaluated their prompting on the following:</p>
<ul>
<li>6 math reasoning datasets
<ul>
<li><strong>AQUA</strong>: Algebraic word problems with natural language rationales.</li>
<li><strong>GSM8K</strong>: High quality linguistically diverse grade school math word problems.</li>
<li><strong>MultiArith</strong>: Math word problems requiring multiple reasoning steps and operations.</li>
<li><strong>AddSub</strong>: Addition and subtraction arithmetic word problems.</li>
<li><strong>SingleEq</strong>: Single-equation grade school algebra word problems with multiple math operations over non-negative rational numbers and one variable.</li>
<li><strong>SVAMP</strong>: One-unknown arithmetic word problems for up-to-4 grade level students.</li>
</ul></li>
<li>2 common sense reasoning datasets
<ul>
<li><strong>CommonsenseQA</strong>: Multiple choice questions that require different types of commonsense knowledge to obtain the correct answers.</li>
<li><strong>StrategyQA</strong>: Questions requiring multi-step reasoning but the reasoning steps are not given.</li>
</ul></li>
<li>2 symbolic reasoning datasets
<ul>
<li><strong>Last Letter Concatenation</strong>: Questions requiring the last letters of words in a name to be concatenated.</li>
<li><strong>Coin Flip</strong>: Questions on whether a coin is still heads up after it is flipped or not flipped based on steps given in the questions.</li>
</ul></li>
</ul>
<section id="arithmetic-reasoning-dataset-performance" class="level3">
<h3 class="anchored" data-anchor-id="arithmetic-reasoning-dataset-performance">Arithmetic Reasoning Dataset Performance</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="table2.png" class="img-fluid figure-img"></p>
<figcaption>Math Reasoning Dataset Evaluation Results</figcaption>
</figure>
</div>
<p>Takeaways:</p>
<ul>
<li>PS and PS+ Prompting out-perform Zero-shot-CoT across all arithmetic reasoning datasets.</li>
<li>PS+ Prompting out-performs Zero-shot-PoT on five out of six arithmetic datasets.</li>
<li>PS Prompting out-performs Zero-shot-PoT on three arithmetic datasets.</li>
<li>Average accuracy of PS+ slightly lower than Manual-CoT and slightly higher than Auto-CoT.</li>
</ul>
</section>
<section id="common-sense-reasoning-dataset-performance" class="level3">
<h3 class="anchored" data-anchor-id="common-sense-reasoning-dataset-performance">Common Sense Reasoning Dataset Performance</h3>
<p><img src="table3.png" alt="Commonsense Reasoning Dataset Evaluation Results" style="width:50%;"></p>
<p>Takeaways:</p>
<ul>
<li>PS+ Prompting out-performs Zero-shot-CoT and underperforms versus Few-Shot-CoT</li>
</ul>
</section>
<section id="symbolic-reasoning-dataset-performance" class="level3">
<h3 class="anchored" data-anchor-id="symbolic-reasoning-dataset-performance">Symbolic Reasoning Dataset Performance</h3>
<p><img src="table4.png" alt="Symbolic Reasoning Dataset Evaluation Results" style="width:50%;"></p>
<p>Takeaways:</p>
<ul>
<li>PS+ out-performs Zero-shot-CoT and Few-Shot-CoT on the Last Letter dataset.</li>
<li>PS+ out-performs Zero-shot-CoT and underperforms compared to Few-Shot-CoT on the Coin Flip dataset.</li>
</ul>
</section>
<section id="addressing-issues-of-zero-shot-cot-prompting" class="level3">
<h3 class="anchored" data-anchor-id="addressing-issues-of-zero-shot-cot-prompting">Addressing Issues of Zero-shot-CoT Prompting</h3>
<p>At the start of the paper, the authors identify three issues with Zero-shot-CoT prompting: Calculation errors, Missing-step errors and Semantic misunderstanding errors. PS has fewer Missing-step and Semantic misunderstanding errors. PS+ has fewer Calculation and Missing-step errors.</p>
<p><img src="errors.png" alt="Performance of Different Prompting Strategies on Calculation, Missing and Semantic Errors" style="width:50%;"></p>
</section>
</section>
<section id="does-this-prompt-strategy-strike-you-as-useful-what-are-the-downsides" class="level2">
<h2 class="anchored" data-anchor-id="does-this-prompt-strategy-strike-you-as-useful-what-are-the-downsides">5) Does this prompt strategy strike you as useful? What are the downsides?</h2>
<p>This prompt strategy seems somewhat useful. On one hand, it provides a framework for the LLM to respond with and performs better than zero-shot prompting in the paper’s evaluation. On the other hand, for some of the models I tested, Zero-shot-CoT performed better than PS+ on a small set of 20 samples.</p>
<p>There are elements of the PS+ Prompting instruction that are also present in the system prompt that Jeremy recommended (emphasis mine):</p>
<blockquote class="blockquote">
<p>Since you are autoregressive, each token you produce is another opportunity to use computation, therefore <strong>you always spend a few sentences explaining background context, assumptions, and step-by-step thinking BEFORE you try to answer a question</strong>. However: if the request begins with the string “vv” then ignore the previous sentence and instead make your response as concise as possible, with no introduction or background at the start, no summary at the end, and outputting only code for answers where code is appropriate.</p>
<p>Your users are experts in AI and ethics, so they already know you’re a language model and your capabilities and limitations, so don’t remind them of that. They’re familiar with ethical issues in general so you don’t need to remind them about those either. Don’t be verbose in your answers, but <strong>do provide details and examples where it might help the explanation</strong>. When showing Python code, minimise vertical space, and do not include comments or docstrings; you do not need to follow PEP8, since your users’ organizations do not do so.</p>
</blockquote>
</section>
<section id="test-the-prompt-using-a-local-model-or-api" class="level2">
<h2 class="anchored" data-anchor-id="test-the-prompt-using-a-local-model-or-api">6) Test the prompt using a local model or api</h2>
<p>In the paper’s appendix, the authors provide two example PS+ prompts and corresponding outputs for each of the ten reasoning datasets they used. I tried out these given prompts on the following models, using HuggingChat and ChatGPT:</p>
<ul>
<li>HuggingFaceH4/zephyr-7b-alpha</li>
<li>mistralai/Mistral-7B-Instruct-v0.1</li>
<li>meta-llama/Llama-2-70b-chat-hf</li>
<li>GPT-3.5</li>
</ul>
<p>Here is a summary of accuracy of these models across the 20 samples:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Zephyr</th>
<th style="text-align: center;">Mistral</th>
<th style="text-align: center;">Llama-2</th>
<th style="text-align: center;">GPT-3.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Zero-shot-CoT</strong></td>
<td style="text-align: center;"><u>65%</u></td>
<td style="text-align: center;">60%</td>
<td style="text-align: center;"><u>70%</u></td>
<td style="text-align: center;">80%</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>PS+</strong></td>
<td style="text-align: center;">45%</td>
<td style="text-align: center;"><u>65%</u></td>
<td style="text-align: center;">60%</td>
<td style="text-align: center;"><u>85%</u></td>
</tr>
</tbody>
</table>
<p><br></p>
<p>I have linked the individual chats in the table below for reference (Z = Zero-shot-CoT). I wasn’t able to test the Zephyr Zero-shot-CoT prompts before HuggingChat removed that model from that interface, and the shared chats in the Zephyr Chat HuggingFace Space expire after a few days, so I’ve documented the results for Zephyr (Z) in <a href="https://docs.google.com/document/d/1D5mhpN9dw3NXUn4Vc1KI4RzNFAkcex_CtpB1_mtjZUk/edit?usp=sharing">this Google document</a>.</p>
<p><br></p>
<ul>
<li>0 = Incorrect</li>
<li>1 = Correct</li>
</ul>
<p><br></p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Dataset</th>
<th style="text-align: left;">Avg</th>
<th style="text-align: left;">Zephyr (Z)</th>
<th style="text-align: left;">Zephyr (PS+)</th>
<th style="text-align: left;">Mistral (Z)</th>
<th style="text-align: left;">Mistral (PS+)</th>
<th style="text-align: left;">Llama-2 (Z)</th>
<th style="text-align: left;">Llama-2 (PS+)</th>
<th style="text-align: left;">GPT-3.5 (Z)</th>
<th style="text-align: left;">GPT-3.5 (PS+)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AQuA</td>
<td style="text-align: left;">25%</td>
<td style="text-align: left;">0, 0</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/zM3AJ_3">0</a>, <a href="https://hf.co/chat/r/plFbVxU">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/pEi9CzH">0</a>, <a href="https://hf.co/chat/r/pLqIr3u">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/ioJezfG">0</a>, <a href="https://hf.co/chat/r/x1bLxWh">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/QFRFn9p">0</a>, <a href="https://hf.co/chat/r/5u7k6dE">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/cApd104">0</a>, <a href="https://hf.co/chat/r/2zpSsCF">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/0dedf861-4628-463c-8901-90a21e887f82">1</a>, <a href="https://chat.openai.com/share/0990a57b-9dfe-47eb-acb2-eb648dfecb02">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/6f052c43-45d7-438e-98bf-add1573cf9bc">1</a>, <a href="https://chat.openai.com/share/731d81ad-a406-4cd8-ade5-4b7e97228bd1">0</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">GSM8K</td>
<td style="text-align: left;">69%</td>
<td style="text-align: left;">1, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/fuwOr7W">0</a>, <a href="https://hf.co/chat/r/I5BGcYS">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/2w9nwS7">1</a>, <a href="https://hf.co/chat/r/L_fK1Fk">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/QulOu5P">1</a>, <a href="https://hf.co/chat/r/APItdpT">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/c-aXZP1">0</a>, <a href="https://hf.co/chat/r/4h-59fN">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/Y7Fivsi">0</a>, <a href="https://hf.co/chat/r/rJuuUBR">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/4cd70e29-ff18-4cb9-b188-1fbc9c48a204">1</a>, <a href="https://chat.openai.com/share/e712124d-3100-4483-96cc-64b817027435">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/3b83fed8-1f06-44c0-95bd-b399d756f3f2">1</a>, <a href="https://chat.openai.com/share/675c6dc3-29ad-4cc1-a54f-28a9bc541fdb">1</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">MultiArith</td>
<td style="text-align: left;">56%</td>
<td style="text-align: left;">0, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/KmeC0ow">0</a>, <a href="https://hf.co/chat/r/gkErQYJ">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/gKtMIEB">1</a>, <a href="https://hf.co/chat/r/I6eW4qn">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/cKDU-Fx">1</a>, <a href="https://hf.co/chat/r/vP0zZG2">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/xPD-3qQ">1</a>, <a href="https://hf.co/chat/r/O7SWLEp">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/SvLTGtl">0</a>, <a href="https://hf.co/chat/r/8qlkQ9a">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/c04bade3-acd2-4f73-8d16-f9b452ab0fab">0</a>, <a href="https://chat.openai.com/share/5cdef4b6-7d11-485d-a07e-fdbd53cefeff">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/a7998a64-e387-4b0e-808a-a1009fd8be56">1</a>, <a href="https://chat.openai.com/share/3711e4a1-2a21-48bb-b013-62b8b18633fd">1</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">SVAMP</td>
<td style="text-align: left;">88%</td>
<td style="text-align: left;">1, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/zQKHJ3l">1</a>, <a href="https://hf.co/chat/r/HQG-W9o">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/v5Unhi3">1</a>, <a href="https://hf.co/chat/r/_ZSSlWJ">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/OLBm0ct">1</a>, <a href="https://hf.co/chat/r/3l3Uwgj">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/MdORtPF">1</a>, <a href="https://hf.co/chat/r/s2q-k3s">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/iOajLWp">1</a>, <a href="https://hf.co/chat/r/X9elCAo">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/ce8f994a-8ff4-4a74-9b48-c7ccd05df4ba">1</a>, <a href="https://chat.openai.com/share/a86edc6f-97a3-4510-9819-a5f1d504870d">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/88aa9d4a-f675-493c-8857-1a7bde411f26">1</a>, <a href="https://chat.openai.com/share/0228aacc-9d78-47e2-b476-b9a4b2da7f2b">1</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">AddSub</td>
<td style="text-align: left;"><u>94%</u></td>
<td style="text-align: left;">1, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/HHseH12">1</a>, <a href="https://hf.co/chat/r/Y1Zog8Y">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/pygZ67S">1</a>, <a href="https://hf.co/chat/r/EI-XdIs">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/LOkpe9J">1</a>, <a href="https://hf.co/chat/r/3aCbK8b">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/la-Xv6E">1</a>, <a href="https://hf.co/chat/r/6NzqP0m">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/yAM421F">1</a>, <a href="https://hf.co/chat/r/sHPyX3X">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/983091a0-9c93-46e3-96e9-91ef14e725f1">1</a>, <a href="https://chat.openai.com/share/98b3e055-5a07-4d2d-a027-e86a836561c5">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/74a9f95a-1d7d-4b8e-808d-2220d721623f">1</a>, <a href="https://chat.openai.com/share/648b6287-b478-42fd-8ccb-12a549675745">1</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">SingleEq</td>
<td style="text-align: left;">81%</td>
<td style="text-align: left;">1, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/XcUUALE">1</a>, <a href="https://hf.co/chat/r/rHbFPl-">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/FfXOnzY">1</a>, <a href="https://hf.co/chat/r/xvxgptS">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/U-LtaL0">0</a>, <a href="https://hf.co/chat/r/8Q7IWdQ">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/mR_J9or">0</a>, <a href="https://hf.co/chat/r/5l0SsQ5">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/a7HWg22">0</a>, <a href="https://hf.co/chat/r/J3OSbm5">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/0732c977-65e6-439a-bab7-8dba34741f43">1</a>, <a href="https://chat.openai.com/share/0b01b3e7-83c3-41d8-893b-e5d0ec2da160">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/ad32659e-b1e5-4193-9603-be5e7d44b107">1</a>, <a href="https://chat.openai.com/share/083bb423-fed6-4ad5-aeed-7967a2a76ccb">1</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">CommonsenseQA</td>
<td style="text-align: left;">56%</td>
<td style="text-align: left;">1, 0</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/wB0Zr8o">1</a>, <a href="https://hf.co/chat/r/aHyplu9">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/uwg3ML7">1</a>, <a href="https://hf.co/chat/r/GUta4fN">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/kBaVY6J">1</a>, <a href="https://hf.co/chat/r/vNBLOkf">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/t86EgAL">1</a>, <a href="https://hf.co/chat/r/m4IT419">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/qxBFyHz">1</a>, <a href="https://hf.co/chat/r/oqCYnxL">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/d86f92e1-2225-414b-ae10-65a67dd467b4">1</a>, <a href="https://chat.openai.com/share/40cfc746-6776-4ef6-8fdc-059f930a0570">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/d04155cf-8d70-4816-9102-23d8bcfef389">1</a>, <a href="https://chat.openai.com/share/16f96b90-0ac9-4b74-9206-de100f1d2725">0</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">StrategyQA</td>
<td style="text-align: left;">56%</td>
<td style="text-align: left;">0, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/iDxT0pO">0</a>, <a href="https://hf.co/chat/r/vyC-LEd">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/ImTDLWk">0</a>, <a href="https://hf.co/chat/r/k6CyU2X">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/N3WqgU3">0</a>, <a href="https://hf.co/chat/r/tPE-FxN">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/MS-u84s">1</a>, <a href="https://hf.co/chat/r/9R6Iu9x">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/mVrnva3">0</a>, <a href="https://hf.co/chat/r/AuSw516">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/d7191b42-538b-4b4e-854a-eda5ea0dae9a">1</a>, <a href="https://chat.openai.com/share/7136b56d-27dc-44f1-ad23-96846966010c">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/45481ce8-384f-4094-8bab-0194cd9bced0">1</a>, <a href="https://chat.openai.com/share/c4f906cf-6a4d-45f2-bf26-da831a589d05">1</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Last Letters</td>
<td style="text-align: left;">38%</td>
<td style="text-align: left;">0, 0</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/caDeIpj">0</a>, <a href="https://hf.co/chat/r/U7ZFkMU">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/SKnXfhL">0</a>, <a href="https://hf.co/chat/r/2AFI-8J">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/KyKlV5L">0</a>, <a href="https://hf.co/chat/r/S5R3TZA">0</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/s2cSASq">1</a>, <a href="https://hf.co/chat/r/wZTTaTQ">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/-tQ8DL6">1</a>, <a href="https://hf.co/chat/r/aGmbjUW">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/e6384359-c26e-4d9d-bc6e-66cdbecf523d">1</a>, <a href="https://chat.openai.com/share/0a974c18-f004-42ee-bad9-b52638ec26ea">0</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/c251d77c-1ff5-498f-883e-ff7af350cc96">1</a>, <a href="https://chat.openai.com/share/0565b6f5-0e8e-49b4-94bf-c8c0102c0c21">0</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">Coin Flip</td>
<td style="text-align: left;"><strong>100%</strong></td>
<td style="text-align: left;">1, 1</td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/j0qlCL3">1</a>, <a href="https://hf.co/chat/r/s6fvq44">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/RvNqC9Q">1</a>, <a href="https://hf.co/chat/r/4cachIM">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/9I7pyOe">1</a>, <a href="https://hf.co/chat/r/ELgmV-Y">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/TncZsxF">1</a>, <a href="https://hf.co/chat/r/QKptKiE">1</a></td>
<td style="text-align: left;"><a href="https://hf.co/chat/r/e0jhRvT">1</a>, <a href="https://hf.co/chat/r/rc2T8hh">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/d2282611-1d1c-43a1-9358-6992320dff80">1</a>, <a href="https://chat.openai.com/share/e7127b3a-085d-4932-9be8-ee054e73b804">1</a></td>
<td style="text-align: left;"><a href="https://chat.openai.com/share/f0be0db4-52f2-47ee-93fe-30cc526e9f35">1</a>, <a href="https://chat.openai.com/share/d35b9041-4045-4f23-9056-fe478d1ce19d">1</a></td>
</tr>
</tbody>
</table>
<p>I hope you enjoyed this blog post!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>