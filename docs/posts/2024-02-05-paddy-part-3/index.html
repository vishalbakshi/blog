<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-02-05">
<meta name="description" content="In this notebook I work through Jeremy Howard’s Live Coding 10 video in which he continues working on the Paddy Doctor Disease Classification Kaggle Competition.">

<title>Vishal Bakshi’s Blog - Paddy Doctor Kaggle Competition - Part 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#the-best-models-for-fine-tuning-image-recognition" id="toc-the-best-models-for-fine-tuning-image-recognition" class="nav-link" data-scroll-target="#the-best-models-for-fine-tuning-image-recognition">The best models for fine tuning image recognition</a></li>
  <li><a href="#applying-learning-on-paddy-notebook-with-small-models" id="toc-applying-learning-on-paddy-notebook-with-small-models" class="nav-link" data-scroll-target="#applying-learning-on-paddy-notebook-with-small-models">Applying learning on Paddy notebook with small models</a>
  <ul class="collapse">
  <li><a href="#preparing-an-ensemble-for-kaggle-submission" id="toc-preparing-an-ensemble-for-kaggle-submission" class="nav-link" data-scroll-target="#preparing-an-ensemble-for-kaggle-submission">Preparing an Ensemble for Kaggle Submission</a></li>
  </ul></li>
  <li><a href="#gradient-accumulation-to-prevent-out-of-memory" id="toc-gradient-accumulation-to-prevent-out-of-memory" class="nav-link" data-scroll-target="#gradient-accumulation-to-prevent-out-of-memory">Gradient accumulation to prevent out of memory</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Paddy Doctor Kaggle Competition - Part 3</h1>
  <div class="quarto-categories">
    <div class="quarto-category">deep learning</div>
    <div class="quarto-category">fastai</div>
    <div class="quarto-category">kaggle competition</div>
    <div class="quarto-category">paddy doctor</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    In this notebook I work through Jeremy Howard’s Live Coding 10 video in which he continues working on the Paddy Doctor Disease Classification Kaggle Competition.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In the fastai course Part 1 <a href="https://youtu.be/AdhG64NF76E?feature=shared&amp;t=3117">Lesson 6 video</a> Jeremy Howard walked through the notebooks <a href="https://www.kaggle.com/code/jhoward/first-steps-road-to-the-top-part-1">First Steps: Road to the Top, Part 1</a> and <a href="https://www.kaggle.com/code/jhoward/small-models-road-to-the-top-part-2">Small models: Road to the Top, Part 2</a> where he builds increasingly accurate solutions to the <a href="https://www.kaggle.com/competitions/paddy-disease-classification">Paddy Doctor: Paddy Disease Classification</a> Kaggle Competition. In the video, Jeremy referenced a series of walkthrough videos that he made while working through the four-notebook series for this competition. I’m excited to watch these walkthroughs to better understand how to approach a Kaggle competition from the perspective of a former #1 Kaggle grandmaster.</p>
<p>In this blog post series, I’ll walk through the code Jeremy shared in each of the 6 Live Coding videos focused on this competition, submitting predictions to Kaggle along the way. My last two blog posts in this series reference Jeremy’s <a href="https://www.kaggle.com/code/jhoward/scaling-up-road-to-the-top-part-3">Scaling Up: Road to the Top, Part 3</a> notebook to improve my large model ensemble predictions. Here are the links to each of the blog posts in this series:</p>
<ul>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-1/">Part 1: Live Coding 8</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-2/">Part 2: Live Coding 9</a></li>
<li>Part 3: Live Coding 10 (You are here)</li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-4/">Part 4: Live Coding 11</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-5/">Part 5: Live Coding 12</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-6/">Part 6: Live Coding 13</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-7/">Part 7: Improving My Large Ensemble, Part 1</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-8/">Part 8: Improving My Large Ensemble, Part 2</a></li>
</ul>
<p><a href="https://www.youtube.com/watch?v=zhBRynq9Yvo">Link to the Live Coding 10 video</a></p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T22:31:30.665410Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T22:31:30.664719Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T22:31:50.679968Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T22:31:50.679080Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T22:31:30.665380Z&quot;}" data-trusted="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>qq timm<span class="op">==</span><span class="fl">0.6.13</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>timm.__version__</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>'0.6.13'</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T22:31:53.714840Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T22:31:53.714125Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T22:32:20.935030Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T22:32:20.933980Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T22:31:53.714806Z&quot;}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install fastkaggle if not available</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: <span class="im">import</span> fastkaggle</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ModuleNotFoundError:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">-</span>Uq fastkaggle</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastkaggle <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> <span class="st">'paddy-disease-classification'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> setup_comp(comp, install<span class="op">=</span><span class="st">'fastai'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/scipy/__init__.py:146: UserWarning: A NumPy version &gt;=1.16.5 and &lt;1.23.0 is required for this version of SciPy (detected version 1.24.3
  warnings.warn(f"A NumPy version &gt;={np_minversion} and &lt;{np_maxversion}"</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T22:32:20.938237Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T22:32:20.937216Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T22:32:20.946005Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T22:32:20.945072Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T22:32:20.938200Z&quot;}" data-trusted="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>path.ls()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(#4) [Path('../input/paddy-disease-classification/sample_submission.csv'),Path('../input/paddy-disease-classification/train_images'),Path('../input/paddy-disease-classification/train.csv'),Path('../input/paddy-disease-classification/test_images')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T22:32:20.948463Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T22:32:20.947594Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T22:32:20.953334Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T22:32:20.952502Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T22:32:20.948437Z&quot;}" data-trusted="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>trn_path <span class="op">=</span> path<span class="op">/</span><span class="st">'train_images'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-best-models-for-fine-tuning-image-recognition" class="level2">
<h2 class="anchored" data-anchor-id="the-best-models-for-fine-tuning-image-recognition">The best models for fine tuning image recognition</h2>
<p>All deep learning models will return a set of probabilities. That’s what their final layer returns and we decode them using <code>argmax</code> across them. There’s nothing to stop you from using those probabilities directly.</p>
<p>The Paddy Classification competition are kind of like the natural images you see in ImageNet, but ImageNet doesn’t have any categories about diseases, they have categories about what’s the main object in this image, such as different types of grass or fields or something. It’s a bit different to ImageNet, which is what most of our pretrained models are trained on. Nearly all of the images are the same shape and size in this competition.</p>
<p>There are two key dimensions that really seem to impact how well a model can be fine-tuned: - How similar is your dataset to the dataset used for the pretrained model? - If it’s similar (like PETS to ImageNet), then the critical factor is how well does the fine-tuning of the model maintain the weights that are pretrained. They’re probably not going to change very much. And you can take advantage of really big accurate models that have learned to do almost the exact same thing that you are trying to do. - If it’s not similar (like Planets to ImageNet), a lot of the weights of a pretrained model are going to be useless for fine-tuning this because they’e learned specific features (like what does text look like, what do eyeballs look like, what does fur look like) none of which are going to be useful at all. - How big is your dataset? - On a big dataset, you’ve got time and epochs to take advantage of having lots of parameters in the model to learn to use them effectively. If you don’t have much data you don’t have much ability to do that.</p>
<p>Jeremy and Thomas Capelle analyze which models are the best for fine-tuning and Jeremy published the results in <a href="https://www.kaggle.com/code/jhoward/the-best-vision-models-for-fine-tuning">this notebook</a>. They used <a href="https://github.com/tcapelle/fastai_timm/blob/main/sweep_planets_lr.yaml">YAML files</a> for Weights and Biases to define the different models and parameters that they wanted to test. You can use the wandb web GUI to view the training results. This <a href="https://gist.githubusercontent.com/jph00/959aaf8695e723246b5e21f3cd5deb02/raw/sweep.csv">gist</a> has the results.</p>
<p>You can export a <code>pandas.DataFrame</code> to a <code>StringIO()</code> object which essentially stores the data as a string.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>strm <span class="op">=</span> StringIO()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df.to_csv(strm, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>txt <span class="op">=</span> strm.getvalue()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also create a gist programatically:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ghapi.core <span class="im">as</span> gh</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> gh.GhApi()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>gist <span class="op">=</span> g.create_gist(<span class="st">'name'</span>, txt, filename<span class="op">=</span><span class="st">'name.csv'</span>, public<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view URL</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>gist.html_url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>vit</code> family of models is particularly good at rapidly identifying features of data types it hasn’t seen before (like medical imaging or satellite imagery). They also have good error rate with low memory usage. The <code>swin</code> family, also a transformers-based model like <code>vit</code>, was the most accurate for fine-tuning the Planets dataset. For the Planets dataset, the really big slow models don’t necessarily have better error rates. Which makes sense because if they have heaps of parameters but they’re trying to learn something they’ve never seen before it’s unlikely that we will be able to take advantage of those parameters.</p>
<p>For some models (like vit_small_patch16_224) you can only use 224x224 image sizes, while with others (like convnext_tiny) you can use any sized images.</p>
<p>Jeremy ran the vision model fine-tuning on 3 RTX GPUs for about 12 hours. They didn’t try all combinations of all parameters. Thomas ran a learning rate sweep to get a sense of what learning rates work well, and then they tried a couple of learning rates, a couple of the best resize methods and a couple of the best pooling types across a few broadly different kinds of models across the two different datasets. In every single case, the same learning rate, resize method and pooling method was the best.</p>
</section>
<section id="applying-learning-on-paddy-notebook-with-small-models" class="level2">
<h2 class="anchored" data-anchor-id="applying-learning-on-paddy-notebook-with-small-models">Applying learning on Paddy notebook with small models</h2>
<p>Let’s try out some of these models for the paddy classification task to identify which ones’ larger versions we should try training next. We use a fixed validation seed (<code>seed=42</code>) so that the same validation set is created each time we run <code>train</code>. The final batch size in a convnext model is 32x32 you generally you want both sides of the image to be sized in multiples of 32. The correct dimensions for <code>Resize</code> is <code>640</code> by <code>480</code>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T15:26:36.245757Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T15:26:36.245360Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T15:26:36.252673Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T15:26:36.251565Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T15:26:36.245724Z&quot;}" data-trusted="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(arch, item, batch, accum<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    kwargs <span class="op">=</span> {<span class="st">'bs'</span>: <span class="dv">16</span>} <span class="cf">if</span> accum <span class="cf">else</span> {}</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, seed<span class="op">=</span><span class="dv">42</span>, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>item, batch_tfms<span class="op">=</span>batch, <span class="op">**</span>kwargs)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    cbs <span class="op">=</span> GradientAccumulation(<span class="dv">4</span>) <span class="cf">if</span> accum <span class="cf">else</span> []</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    learn <span class="op">=</span> vision_learner(dls, arch, metrics<span class="op">=</span>error_rate, cbs<span class="op">=</span>cbs).to_fp16()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    learn.fine_tune(<span class="dv">12</span>, <span class="fl">0.01</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T15:26:36.945535Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T15:26:36.944577Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T15:26:36.950830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T15:26:36.949821Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T15:26:36.945492Z&quot;}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'convnext_small_in22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T15:26:52.189700Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T15:26:52.188867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T15:47:18.484812Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T15:47:18.483687Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T15:26:52.189654Z&quot;}" data-trusted="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_small_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_small_22k_224.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.069485</td>
      <td>0.617368</td>
      <td>0.193657</td>
      <td>01:13</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.513920</td>
      <td>0.278679</td>
      <td>0.093224</td>
      <td>01:31</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.369457</td>
      <td>0.236429</td>
      <td>0.076886</td>
      <td>01:33</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.344589</td>
      <td>0.229747</td>
      <td>0.074003</td>
      <td>01:30</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.259019</td>
      <td>0.175089</td>
      <td>0.050457</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.224322</td>
      <td>0.149210</td>
      <td>0.041326</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.176708</td>
      <td>0.155431</td>
      <td>0.047573</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.128338</td>
      <td>0.155574</td>
      <td>0.040846</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.096755</td>
      <td>0.103420</td>
      <td>0.026430</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.083143</td>
      <td>0.086435</td>
      <td>0.025469</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.053020</td>
      <td>0.089935</td>
      <td>0.021624</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.038454</td>
      <td>0.082519</td>
      <td>0.021624</td>
      <td>01:31</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.041188</td>
      <td>0.081926</td>
      <td>0.019222</td>
      <td>01:32</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>TensorBase(0.0211)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T15:49:53.371490Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T15:49:53.370527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T16:09:22.416910Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T16:09:22.415765Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T15:49:53.371442Z&quot;}" data-trusted="true" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.092957</td>
      <td>0.656337</td>
      <td>0.207593</td>
      <td>01:12</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.534311</td>
      <td>0.283374</td>
      <td>0.097069</td>
      <td>01:29</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.404589</td>
      <td>0.271343</td>
      <td>0.091783</td>
      <td>01:30</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.366122</td>
      <td>0.263794</td>
      <td>0.077367</td>
      <td>01:28</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.291584</td>
      <td>0.194437</td>
      <td>0.056223</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.245451</td>
      <td>0.202364</td>
      <td>0.058145</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.176800</td>
      <td>0.145820</td>
      <td>0.043248</td>
      <td>01:27</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.141820</td>
      <td>0.128727</td>
      <td>0.038443</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.105305</td>
      <td>0.103860</td>
      <td>0.029313</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.082278</td>
      <td>0.099908</td>
      <td>0.024988</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.061129</td>
      <td>0.090908</td>
      <td>0.020183</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.049765</td>
      <td>0.085010</td>
      <td>0.017780</td>
      <td>01:26</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.042815</td>
      <td>0.082840</td>
      <td>0.018260</td>
      <td>01:26</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>TensorBase(0.0202)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T16:09:22.419740Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T16:09:22.419176Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T16:33:29.633998Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T16:33:29.632894Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T16:09:22.419700Z&quot;}" data-trusted="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize((<span class="dv">640</span>,<span class="dv">480</span>)), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span>(<span class="dv">288</span>,<span class="dv">224</span>), min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.074075</td>
      <td>0.577121</td>
      <td>0.189332</td>
      <td>01:27</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.515035</td>
      <td>0.284355</td>
      <td>0.092263</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.400951</td>
      <td>0.292205</td>
      <td>0.091783</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.322861</td>
      <td>0.263579</td>
      <td>0.079769</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.302507</td>
      <td>0.182555</td>
      <td>0.056223</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.240202</td>
      <td>0.166032</td>
      <td>0.049015</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.181676</td>
      <td>0.171471</td>
      <td>0.046132</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.128153</td>
      <td>0.124866</td>
      <td>0.036040</td>
      <td>01:47</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.105105</td>
      <td>0.111518</td>
      <td>0.028352</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.073392</td>
      <td>0.093408</td>
      <td>0.024988</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.051107</td>
      <td>0.083389</td>
      <td>0.024027</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.042867</td>
      <td>0.083621</td>
      <td>0.023066</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.038255</td>
      <td>0.084581</td>
      <td>0.022585</td>
      <td>01:48</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>TensorBase(0.0187)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T16:33:29.636570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T16:33:29.635931Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T17:00:41.125102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T17:00:41.123972Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T16:33:29.636536Z&quot;}" data-trusted="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize((<span class="dv">640</span>,<span class="dv">480</span>)), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span>(<span class="dv">320</span>,<span class="dv">240</span>), min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.043271</td>
      <td>0.641115</td>
      <td>0.211917</td>
      <td>01:40</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.481680</td>
      <td>0.278677</td>
      <td>0.089380</td>
      <td>02:02</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.364523</td>
      <td>0.263106</td>
      <td>0.082653</td>
      <td>02:02</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.349608</td>
      <td>0.226119</td>
      <td>0.063431</td>
      <td>02:02</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.297600</td>
      <td>0.197567</td>
      <td>0.056223</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.221989</td>
      <td>0.189447</td>
      <td>0.058145</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.160790</td>
      <td>0.156223</td>
      <td>0.037482</td>
      <td>02:02</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.120237</td>
      <td>0.125078</td>
      <td>0.037963</td>
      <td>02:02</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.092999</td>
      <td>0.136008</td>
      <td>0.035079</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.070052</td>
      <td>0.101822</td>
      <td>0.027391</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.051421</td>
      <td>0.095571</td>
      <td>0.024507</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.037683</td>
      <td>0.093875</td>
      <td>0.023066</td>
      <td>02:01</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.040058</td>
      <td>0.093482</td>
      <td>0.023066</td>
      <td>02:01</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>TensorBase(0.0226)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T17:00:41.127808Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T17:00:41.127492Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T17:00:41.132803Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T17:00:41.131683Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T17:00:41.127779Z&quot;}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'vit_small_patch16_224'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T17:00:41.134378Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T17:00:41.134037Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T17:15:43.926928Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T17:15:43.925881Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T17:00:41.134345Z&quot;}" data-trusted="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.241114</td>
      <td>0.609537</td>
      <td>0.202787</td>
      <td>01:00</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.603312</td>
      <td>0.330619</td>
      <td>0.102355</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.454617</td>
      <td>0.272407</td>
      <td>0.090822</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.432220</td>
      <td>0.399525</td>
      <td>0.128784</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.343562</td>
      <td>0.381830</td>
      <td>0.123018</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.276432</td>
      <td>0.273114</td>
      <td>0.068717</td>
      <td>01:06</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.229089</td>
      <td>0.318629</td>
      <td>0.077847</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.167870</td>
      <td>0.146931</td>
      <td>0.033157</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.117221</td>
      <td>0.128760</td>
      <td>0.037963</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.090773</td>
      <td>0.112749</td>
      <td>0.031235</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.073209</td>
      <td>0.105501</td>
      <td>0.028352</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.060867</td>
      <td>0.107474</td>
      <td>0.027871</td>
      <td>01:05</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.061845</td>
      <td>0.104577</td>
      <td>0.028832</td>
      <td>01:05</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>TensorBase(0.0245)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T17:15:43.930518Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T17:15:43.928568Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T17:30:02.421245Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T17:30:02.420161Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T17:15:43.930486Z&quot;}" data-trusted="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.264427</td>
      <td>0.745677</td>
      <td>0.241711</td>
      <td>00:57</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.636773</td>
      <td>0.356237</td>
      <td>0.111485</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.512687</td>
      <td>0.324432</td>
      <td>0.112926</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.445590</td>
      <td>0.373493</td>
      <td>0.122537</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.386593</td>
      <td>0.335397</td>
      <td>0.106679</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.314561</td>
      <td>0.262394</td>
      <td>0.074003</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.236516</td>
      <td>0.197571</td>
      <td>0.060067</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.197938</td>
      <td>0.153093</td>
      <td>0.040846</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.159178</td>
      <td>0.132239</td>
      <td>0.038924</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.109954</td>
      <td>0.117727</td>
      <td>0.029313</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.084283</td>
      <td>0.104230</td>
      <td>0.025469</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.073850</td>
      <td>0.100741</td>
      <td>0.024988</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.064490</td>
      <td>0.098695</td>
      <td>0.024988</td>
      <td>01:03</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>TensorBase(0.0250)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T17:30:02.423389Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T17:30:02.423006Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T17:45:59.205230Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T17:45:59.204182Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T17:30:02.423349Z&quot;}" data-trusted="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">640</span>, method<span class="op">=</span>ResizeMethod.Pad, pad_mode<span class="op">=</span>PadMode.Zeros), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.313841</td>
      <td>0.846934</td>
      <td>0.269582</td>
      <td>01:04</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.678171</td>
      <td>0.413112</td>
      <td>0.135031</td>
      <td>01:11</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.497201</td>
      <td>0.349746</td>
      <td>0.111004</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.411814</td>
      <td>0.311638</td>
      <td>0.098991</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.410544</td>
      <td>0.440684</td>
      <td>0.128784</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.309415</td>
      <td>0.252958</td>
      <td>0.070159</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.241980</td>
      <td>0.270128</td>
      <td>0.073042</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.186923</td>
      <td>0.202601</td>
      <td>0.056223</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.130820</td>
      <td>0.165027</td>
      <td>0.043729</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.092804</td>
      <td>0.121890</td>
      <td>0.030274</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.072829</td>
      <td>0.123613</td>
      <td>0.029313</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.069157</td>
      <td>0.110147</td>
      <td>0.029793</td>
      <td>01:10</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.054325</td>
      <td>0.108744</td>
      <td>0.026430</td>
      <td>01:09</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>TensorBase(0.0221)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T18:01:38.749895Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T18:01:38.749517Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T18:01:38.754302Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T18:01:38.753309Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T18:01:38.749864Z&quot;}" data-trusted="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'swinv2_base_window12_192_22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T18:01:40.418264Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T18:01:40.417450Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T18:36:59.261479Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T18:36:59.260379Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T18:01:40.418226Z&quot;}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/torch/functional.py:504: UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /usr/local/src/pytorch/aten/src/ATen/native/TensorShape.cpp:3483.)
  return _VF.meshgrid(tensors, **kwargs)  # type: ignore[attr-defined]
Downloading: "https://github.com/SwinTransformer/storage/releases/download/v2.0.0/swinv2_base_patch4_window12_192_22k.pth" to /root/.cache/torch/hub/checkpoints/swinv2_base_patch4_window12_192_22k.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.036088</td>
      <td>0.583672</td>
      <td>0.193176</td>
      <td>02:14</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.509049</td>
      <td>0.234983</td>
      <td>0.078328</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.385443</td>
      <td>0.205435</td>
      <td>0.070159</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.334598</td>
      <td>0.355438</td>
      <td>0.089380</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.285663</td>
      <td>0.368389</td>
      <td>0.106679</td>
      <td>02:39</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.238095</td>
      <td>0.159115</td>
      <td>0.045651</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.183420</td>
      <td>0.140284</td>
      <td>0.041326</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.141127</td>
      <td>0.129525</td>
      <td>0.036040</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.103826</td>
      <td>0.111331</td>
      <td>0.029313</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.077789</td>
      <td>0.109304</td>
      <td>0.027391</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.053972</td>
      <td>0.096646</td>
      <td>0.022585</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.041229</td>
      <td>0.088552</td>
      <td>0.021624</td>
      <td>02:38</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.034090</td>
      <td>0.088425</td>
      <td>0.021144</td>
      <td>02:38</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>TensorBase(0.0173)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T18:36:59.263970Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T18:36:59.263645Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T19:20:14.521960Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T19:20:14.520731Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T18:36:59.263942Z&quot;}" data-trusted="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.345018</td>
      <td>0.807008</td>
      <td>0.224892</td>
      <td>02:29</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.566454</td>
      <td>0.335172</td>
      <td>0.117251</td>
      <td>03:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.569964</td>
      <td>0.336681</td>
      <td>0.125901</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.562002</td>
      <td>0.343439</td>
      <td>0.118212</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.469339</td>
      <td>0.393603</td>
      <td>0.124459</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.297434</td>
      <td>0.332929</td>
      <td>0.090822</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.269842</td>
      <td>0.198136</td>
      <td>0.051898</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.186959</td>
      <td>0.181704</td>
      <td>0.054781</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.134943</td>
      <td>0.134798</td>
      <td>0.036040</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.113144</td>
      <td>0.102160</td>
      <td>0.030274</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.085017</td>
      <td>0.104802</td>
      <td>0.025469</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.048129</td>
      <td>0.101891</td>
      <td>0.022105</td>
      <td>03:17</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.057491</td>
      <td>0.094901</td>
      <td>0.022585</td>
      <td>03:17</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>TensorBase(0.0183)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T19:20:14.524822Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T19:20:14.524095Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T20:04:53.584208Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T20:04:53.583056Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T19:20:14.524785Z&quot;}" data-trusted="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">640</span>, method<span class="op">=</span>ResizeMethod.Pad, pad_mode<span class="op">=</span>PadMode.Zeros), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.316884</td>
      <td>1.035790</td>
      <td>0.263335</td>
      <td>02:35</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.617098</td>
      <td>0.291554</td>
      <td>0.094666</td>
      <td>03:22</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.603711</td>
      <td>0.409637</td>
      <td>0.126862</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.573029</td>
      <td>0.425025</td>
      <td>0.127823</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.401325</td>
      <td>0.402042</td>
      <td>0.117732</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.340665</td>
      <td>0.308467</td>
      <td>0.089380</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.236972</td>
      <td>0.177212</td>
      <td>0.046132</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.212541</td>
      <td>0.151314</td>
      <td>0.041807</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.099307</td>
      <td>0.110350</td>
      <td>0.026430</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.054712</td>
      <td>0.108030</td>
      <td>0.022105</td>
      <td>03:23</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.051622</td>
      <td>0.100666</td>
      <td>0.020183</td>
      <td>03:22</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.032429</td>
      <td>0.102271</td>
      <td>0.022105</td>
      <td>03:22</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.031421</td>
      <td>0.097009</td>
      <td>0.022105</td>
      <td>03:22</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>TensorBase(0.0192)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T20:20:55.748700Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T20:20:55.747987Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T20:20:55.752711Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T20:20:55.751746Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T20:20:55.748668Z&quot;}" data-trusted="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'swin_small_patch4_window7_224'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T20:20:56.234453Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T20:20:56.233773Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T20:45:20.572064Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T20:45:20.570926Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T20:20:56.234419Z&quot;}" data-trusted="true" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://github.com/SwinTransformer/storage/releases/download/v1.0.0/swin_small_patch4_window7_224.pth" to /root/.cache/torch/hub/checkpoints/swin_small_patch4_window7_224.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.424551</td>
      <td>0.834437</td>
      <td>0.278712</td>
      <td>01:35</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.659169</td>
      <td>0.377870</td>
      <td>0.125420</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.487998</td>
      <td>0.293272</td>
      <td>0.092263</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.439836</td>
      <td>0.344214</td>
      <td>0.101874</td>
      <td>01:49</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.337822</td>
      <td>0.243527</td>
      <td>0.074964</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.262154</td>
      <td>0.199788</td>
      <td>0.065353</td>
      <td>01:49</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.206655</td>
      <td>0.129096</td>
      <td>0.038924</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.179885</td>
      <td>0.116743</td>
      <td>0.031716</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.118040</td>
      <td>0.118282</td>
      <td>0.035079</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.092112</td>
      <td>0.114298</td>
      <td>0.028832</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.078792</td>
      <td>0.105398</td>
      <td>0.025949</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.064473</td>
      <td>0.097622</td>
      <td>0.024027</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.057387</td>
      <td>0.097082</td>
      <td>0.024027</td>
      <td>01:49</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>TensorBase(0.0207)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T20:45:20.575060Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T20:45:20.574636Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T21:09:30.637621Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T21:09:30.636382Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T20:45:20.575004Z&quot;}" data-trusted="true" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.420280</td>
      <td>0.869214</td>
      <td>0.276790</td>
      <td>01:34</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.727566</td>
      <td>0.402595</td>
      <td>0.133109</td>
      <td>01:47</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.549589</td>
      <td>0.400400</td>
      <td>0.129265</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.440090</td>
      <td>0.304687</td>
      <td>0.101394</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.397689</td>
      <td>0.340592</td>
      <td>0.112926</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.288660</td>
      <td>0.184638</td>
      <td>0.057184</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.246669</td>
      <td>0.180551</td>
      <td>0.049976</td>
      <td>01:47</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.189145</td>
      <td>0.161568</td>
      <td>0.043729</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.151034</td>
      <td>0.160868</td>
      <td>0.039885</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.110399</td>
      <td>0.115093</td>
      <td>0.026910</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.084655</td>
      <td>0.098188</td>
      <td>0.025469</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.070253</td>
      <td>0.093308</td>
      <td>0.023066</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.064076</td>
      <td>0.095348</td>
      <td>0.024027</td>
      <td>01:48</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>TensorBase(0.0231)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T21:09:30.640513Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T21:09:30.639687Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T21:35:17.390800Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T21:35:17.389617Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T21:09:30.640480Z&quot;}" data-trusted="true" data-execution_count="26">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">640</span>, method<span class="op">=</span>ResizeMethod.Pad, pad_mode<span class="op">=</span>PadMode.Zeros), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.479291</td>
      <td>1.005589</td>
      <td>0.330610</td>
      <td>01:41</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.758326</td>
      <td>0.441894</td>
      <td>0.145123</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.548370</td>
      <td>0.436102</td>
      <td>0.139356</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.444455</td>
      <td>0.361651</td>
      <td>0.104277</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.370136</td>
      <td>0.280115</td>
      <td>0.088419</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.269262</td>
      <td>0.184901</td>
      <td>0.059106</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.242950</td>
      <td>0.177827</td>
      <td>0.054781</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.171754</td>
      <td>0.153312</td>
      <td>0.039404</td>
      <td>01:55</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.128885</td>
      <td>0.118345</td>
      <td>0.030754</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.098144</td>
      <td>0.103212</td>
      <td>0.025949</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.078017</td>
      <td>0.098263</td>
      <td>0.024988</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.062568</td>
      <td>0.092275</td>
      <td>0.021624</td>
      <td>01:54</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.055316</td>
      <td>0.091669</td>
      <td>0.021624</td>
      <td>01:54</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>TensorBase(0.0183)</code></pre>
</div>
</div>
<p>I’ll summarize the training run parameters and resulting TTA error rates on the validation set in the following table. I have sorted this table by model name and descening TTA Error Rate (First Run).</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">item_tfms</th>
<th style="text-align: left;">batch_tfms</th>
<th style="text-align: left;">TTA Error Rate (First Run)</th>
<th style="text-align: left;">Minutes per epoch (First Run)</th>
<th style="text-align: left;">TTA Error Rate (Second Run)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">convnext_small_in22k</td>
<td style="text-align: left;"><code>Resize((640,480))</code></td>
<td style="text-align: left;"><code>aug_transforms(size=(288,224), min_scale=0.75)</code></td>
<td style="text-align: left;">0.0178*</td>
<td style="text-align: left;">01:51</td>
<td style="text-align: left;">0.0187</td>
</tr>
<tr class="even">
<td style="text-align: left;">convnext_small_in22k</td>
<td style="text-align: left;"><code>Resize((640,480))</code></td>
<td style="text-align: left;"><code>aug_transforms(size=(320,240), min_scale=0.75)</code></td>
<td style="text-align: left;">0.0202</td>
<td style="text-align: left;">02:07</td>
<td style="text-align: left;">0.0226</td>
</tr>
<tr class="odd">
<td style="text-align: left;">convnext_small_in22k</td>
<td style="text-align: left;"><code>Resize(480, method='squish')</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0211</td>
<td style="text-align: left;">01:30</td>
<td style="text-align: left;">0.0211</td>
</tr>
<tr class="even">
<td style="text-align: left;">convnext_small_in22k</td>
<td style="text-align: left;"><code>Resize(480)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0216</td>
<td style="text-align: left;">01:29</td>
<td style="text-align: left;">0.0202</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vit_small_patch16_224</td>
<td style="text-align: left;"><code>Resize(480)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0202*</td>
<td style="text-align: left;">00:44</td>
<td style="text-align: left;">0.0250</td>
</tr>
<tr class="even">
<td style="text-align: left;">vit_small_patch16_224</td>
<td style="text-align: left;"><code>Resize(480, method='squish')</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0216</td>
<td style="text-align: left;">00:47</td>
<td style="text-align: left;">0.0245</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vit_small_patch16_224</td>
<td style="text-align: left;"><code>Resize(640, method=ResizeMethod.Pad, pad_mode=PadMode.Zeros)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0226</td>
<td style="text-align: left;">00:50</td>
<td style="text-align: left;">0.0221</td>
</tr>
<tr class="even">
<td style="text-align: left;">swinv2_base_window12_192_22k</td>
<td style="text-align: left;"><code>Resize(480, method='squish')</code></td>
<td style="text-align: left;"><code>aug_transforms(size=192, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0163*</td>
<td style="text-align: left;">02:30</td>
<td style="text-align: left;">0.0173</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swinv2_base_window12_192_22k</td>
<td style="text-align: left;"><code>Resize(640, method=ResizeMethod.Pad, pad_mode=PadMode.Zeros)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=192, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0187</td>
<td style="text-align: left;">03:27</td>
<td style="text-align: left;">0.0192</td>
</tr>
<tr class="even">
<td style="text-align: left;">swinv2_base_window12_192_22k</td>
<td style="text-align: left;"><code>Resize(480)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=192, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0197</td>
<td style="text-align: left;">03:22</td>
<td style="text-align: left;">0.0183</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swin_small_patch4_window7_224</td>
<td style="text-align: left;"><code>Resize(480, method='squish')</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0202*</td>
<td style="text-align: left;">01:48</td>
<td style="text-align: left;">0.0207</td>
</tr>
<tr class="even">
<td style="text-align: left;">swin_small_patch4_window7_224</td>
<td style="text-align: left;"><code>Resize(480)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0207</td>
<td style="text-align: left;">01:47</td>
<td style="text-align: left;">0.0231</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swin_small_patch4_window7_224</td>
<td style="text-align: left;"><code>Resize(640, method=ResizeMethod.Pad, pad_mode=PadMode.Zeros)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0221</td>
<td style="text-align: left;">01:54</td>
<td style="text-align: left;">0.0183</td>
</tr>
</tbody>
</table>
<p>* = lowest error rate for the architecture</p>
<section id="preparing-an-ensemble-for-kaggle-submission" class="level3">
<h3 class="anchored" data-anchor-id="preparing-an-ensemble-for-kaggle-submission">Preparing an Ensemble for Kaggle Submission</h3>
<p>I’ll retrain and create an ensemble of the top 3 models based on TTA Error Rate (First Run):</p>
<ul>
<li>swinv2_base_window12_192_22k (0.0163)</li>
<li>convnext_small_in22k (0.0178)</li>
<li>vit_small_patch16_224 (0.0202)</li>
</ul>
<p>The swin_small_patch4_window7_224 models did not outperform the quicker/smaller vit model so I won’t use them in this submission.</p>
<p>Later on in the video, Jeremy walks through an example of how he trained large versions of the small models he tested. In this section, he used the following training function, which I’ll use here for these small models, to prepare my submission predictions. Note that Jeremy has removed <code>seed=42</code> since in the ensemble for submission we want to use different validation sets when training each model (whereas before we wanted to use the same validation set to better compare the performance between models). I’ve also changed a couple of things (I’m not exporting the models, and I’m using a smaller batch size).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T23:29:42.676552Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T23:29:42.676185Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T23:29:42.682019Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T23:29:42.680884Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T23:29:42.676523Z&quot;}" data-trusted="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store the tta predictions in a list</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T23:29:43.050883Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T23:29:43.050291Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T23:29:45.787979Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T23:29:45.787151Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T23:29:43.050844Z&quot;}" data-trusted="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run this once and re-use for all trainings</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T23:29:53.943540Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T23:29:53.942564Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T23:29:53.949801Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T23:29:53.948874Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T23:29:53.943507Z&quot;}" data-trusted="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(arch, item, batch, accum<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    kwargs <span class="op">=</span> {<span class="st">'bs'</span>: <span class="dv">16</span>} <span class="cf">if</span> accum <span class="cf">else</span> {}</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>item, batch_tfms<span class="op">=</span>batch, <span class="op">**</span>kwargs)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    cbs <span class="op">=</span> GradientAccumulation(<span class="dv">2</span>) <span class="cf">if</span> accum <span class="cf">else</span> []</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    learn <span class="op">=</span> vision_learner(dls, arch, metrics<span class="op">=</span>error_rate, cbs<span class="op">=</span>cbs).to_fp16()</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    learn.fine_tune(<span class="dv">12</span>, <span class="fl">0.01</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TTA predictions using test dataset</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    tta_res.append(learn.tta(dl<span class="op">=</span>dls.test_dl(tst_files)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T23:29:56.030572Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T23:29:56.029712Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T23:29:56.034427Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T23:29:56.033497Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T23:29:56.030538Z&quot;}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'swinv2_base_window12_192_22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T23:29:59.411359Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T23:29:59.410976Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:05:25.685705Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:05:25.684596Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T23:29:59.411334Z&quot;}" data-trusted="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.093678</td>
      <td>0.758215</td>
      <td>0.250360</td>
      <td>02:12</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.472679</td>
      <td>0.248962</td>
      <td>0.077847</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.383199</td>
      <td>0.263211</td>
      <td>0.081211</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.360025</td>
      <td>0.292500</td>
      <td>0.103316</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.305790</td>
      <td>0.223976</td>
      <td>0.066314</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.232600</td>
      <td>0.209275</td>
      <td>0.058145</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.185068</td>
      <td>0.171094</td>
      <td>0.043729</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.134446</td>
      <td>0.165977</td>
      <td>0.039885</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.108682</td>
      <td>0.135310</td>
      <td>0.031716</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.074768</td>
      <td>0.124852</td>
      <td>0.026430</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.052246</td>
      <td>0.107549</td>
      <td>0.024027</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.040028</td>
      <td>0.102177</td>
      <td>0.023546</td>
      <td>02:36</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.038975</td>
      <td>0.102109</td>
      <td>0.022585</td>
      <td>02:36</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:05:25.688827Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:05:25.688111Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:05:25.695105Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:05:25.694069Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:05:25.688788Z&quot;}" data-trusted="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>(1, 3469)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:23:27.820047Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:23:27.818688Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:23:27.824155Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:23:27.823260Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:23:27.820007Z&quot;}" data-trusted="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'convnext_small_in22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:23:28.387631Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:23:28.386882Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:47:42.711245Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:47:42.710097Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:23:28.387599Z&quot;}" data-trusted="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize((<span class="dv">640</span>,<span class="dv">480</span>)), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span>(<span class="dv">288</span>,<span class="dv">224</span>), min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_small_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_small_22k_224.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.088028</td>
      <td>0.659407</td>
      <td>0.192696</td>
      <td>01:26</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.488645</td>
      <td>0.251234</td>
      <td>0.082172</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.394844</td>
      <td>0.260079</td>
      <td>0.086497</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.341203</td>
      <td>0.206835</td>
      <td>0.065834</td>
      <td>01:46</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.294899</td>
      <td>0.183829</td>
      <td>0.057665</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.224933</td>
      <td>0.172018</td>
      <td>0.045651</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.179294</td>
      <td>0.139805</td>
      <td>0.037482</td>
      <td>01:46</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.131405</td>
      <td>0.104101</td>
      <td>0.027871</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.094273</td>
      <td>0.112815</td>
      <td>0.031235</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.064216</td>
      <td>0.106544</td>
      <td>0.029313</td>
      <td>01:46</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.045855</td>
      <td>0.091775</td>
      <td>0.021144</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.039155</td>
      <td>0.086264</td>
      <td>0.021624</td>
      <td>01:45</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.027725</td>
      <td>0.083699</td>
      <td>0.020183</td>
      <td>01:45</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:47:42.714126Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:47:42.713716Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:47:42.721693Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:47:42.720554Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:47:42.714097Z&quot;}" data-trusted="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(2, 3469, 3469)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:47:42.723264Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:47:42.722983Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T00:47:42.732976Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T00:47:42.731992Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:47:42.723239Z&quot;}" data-trusted="true" data-execution_count="24">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'vit_small_patch16_224'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T00:47:42.736304Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T00:47:42.735972Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:02:18.133726Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:02:18.132600Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T00:47:42.736279Z&quot;}" data-trusted="true" data-execution_count="25">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.258543</td>
      <td>0.658905</td>
      <td>0.220087</td>
      <td>00:56</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.630974</td>
      <td>0.367167</td>
      <td>0.113407</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.496218</td>
      <td>0.381497</td>
      <td>0.124940</td>
      <td>01:03</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.424657</td>
      <td>0.341580</td>
      <td>0.111004</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.381134</td>
      <td>0.273908</td>
      <td>0.087458</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.326845</td>
      <td>0.227150</td>
      <td>0.072561</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.253998</td>
      <td>0.209598</td>
      <td>0.062951</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.179893</td>
      <td>0.189200</td>
      <td>0.046612</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.146728</td>
      <td>0.211501</td>
      <td>0.045651</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.113472</td>
      <td>0.159040</td>
      <td>0.036040</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.076088</td>
      <td>0.145309</td>
      <td>0.033157</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>10</td>
      <td>0.068731</td>
      <td>0.140491</td>
      <td>0.031716</td>
      <td>01:02</td>
    </tr>
    <tr>
      <td>11</td>
      <td>0.059864</td>
      <td>0.140173</td>
      <td>0.030754</td>
      <td>01:02</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:02:18.135500Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:02:18.135195Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:02:18.143167Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:02:18.142348Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:02:18.135472Z&quot;}" data-trusted="true" data-execution_count="26">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(3, 3469, 3469, 3469)</code></pre>
</div>
</div>
<p>Before I stack the predictions and prepare them for the submission, I’ll save the list of predictions:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-12-13T03:25:17.325129Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-12-13T03:25:17.324070Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-12-13T03:25:17.332115Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-12-13T03:25:17.331194Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-12-13T03:25:17.325090Z&quot;}" data-trusted="true">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>save_pickle(<span class="st">'/kaggle/working/tta_res.pkl'</span>, tta_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll take a quick detour and follow the steps Jeremy shares in <a href="https://youtu.be/j-zMF2VirA8?feature=shared&amp;t=3311">Live Coding 11</a>.</p>
<p>First, he takes the first item from each list in <code>tta_res</code> (the predictions) and stores them in a list called <code>tta_prs</code>. The list returned by <code>learn.tta</code> has a second item of <code>None</code>, which represents the targets (which we don’t have in the test set) we need to pick out just the first item (the predictions).</p>
<p><code>zip</code>ping the items in <code>tta_res</code> creates a list of two tuples: a tuple with the three sets of predictions (the first item in each element of <code>tta_res</code>) and a tuple with three <code>None</code>s (the second item of each element of <code>tta_res</code>).</p>
<p>Here’s a toy example to illustrate:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:39:57.450548Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:39:57.450097Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:39:57.457783Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:39:57.456686Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:39:57.450514Z&quot;}" data-trusted="true" data-execution_count="27">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>[[(<span class="dv">1</span>), <span class="va">None</span>],[(<span class="dv">2</span>), <span class="va">None</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>[(1, 2), (None, None)]</code></pre>
</div>
</div>
<p>The <code>first</code> function rerurns the first element of an iterable object.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:43:47.758733Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:43:47.757911Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:43:47.776802Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:43:47.776095Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:43:47.758698Z&quot;}" data-trusted="true" data-execution_count="40">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>first??</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">Signature:</span> first<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> negate<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Source:</span>   
<span class="ansi-green-fg">def</span> first<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> negate<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
    <span class="ansi-blue-fg">"First element of `x`, optionally filtered by `f`, or None if missing"</span>
    x <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">if</span> f<span class="ansi-blue-fg">:</span> x <span class="ansi-blue-fg">=</span> filter_ex<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">=</span>f<span class="ansi-blue-fg">,</span> negate<span class="ansi-blue-fg">=</span>negate<span class="ansi-blue-fg">,</span> gen<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
    <span class="ansi-green-fg">return</span> next<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">File:</span>      /opt/conda/lib/python3.10/site-packages/fastcore/basics.py
<span class="ansi-red-fg">Type:</span>      function</pre>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:00.673174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:00.672342Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:00.679372Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:00.678441Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:00.673142Z&quot;}" data-trusted="true" data-execution_count="28">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>first(<span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>[[(<span class="dv">1</span>), <span class="va">None</span>],[(<span class="dv">2</span>), <span class="va">None</span>]])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(1, 2)</code></pre>
</div>
</div>
<p>The second element of the zipped <code>tta_res</code> list is a tuple of <code>None</code>s.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:02.909275Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:02.908394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:02.914819Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:02.913898Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:02.909241Z&quot;}" data-trusted="true" data-execution_count="29">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>tta_res))[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(None, None, None)</code></pre>
</div>
</div>
<p>I’ll now apply this code to <code>tta_res</code>:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:08.678616Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:08.678213Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:08.683477Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:08.682534Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:08.678584Z&quot;}" data-trusted="true" data-execution_count="30">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tta_prs <span class="op">=</span> first(<span class="bu">zip</span>(<span class="op">*</span>tta_res))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:11.689102Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:11.688488Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:11.694952Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:11.694102Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:11.689069Z&quot;}" data-trusted="true" data-execution_count="31">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_prs[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>3469</code></pre>
</div>
</div>
<p>Next, in order to take the mean value of the predictions, we <code>stack</code> them into a tensor:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:13.993695Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:13.993308Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:13.998586Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:13.997611Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:13.993667Z&quot;}" data-trusted="true" data-execution_count="32">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>t_tta <span class="op">=</span> torch.stack(tta_prs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:15.489041Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:15.488653Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:15.495285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:15.494218Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:15.489013Z&quot;}" data-trusted="true" data-execution_count="33">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>t_tta.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>torch.Size([3, 3469, 10])</code></pre>
</div>
</div>
<p>Then, we take the mean of the three predictions for each of the 10 classes for each image.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:19.369945Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:19.369211Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:19.374518Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:19.373459Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:19.369914Z&quot;}" data-trusted="true" data-execution_count="34">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>avg_pr <span class="op">=</span> t_tta.mean(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:19.797893Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:19.797167Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:19.803565Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:19.802455Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:19.797862Z&quot;}" data-trusted="true" data-execution_count="35">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>avg_pr.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>torch.Size([3469, 10])</code></pre>
</div>
</div>
<p>We then get the index of the largest probability out of the 10 classes for each image, which is the “prediction” that the model has made for the image.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:22.956741Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:22.956360Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:22.963069Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:22.962016Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:22.956712Z&quot;}" data-trusted="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>idxs <span class="op">=</span> avg_pr.argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>idxs.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>torch.Size([3469])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:24.001285Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:24.000582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:24.009557Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:24.008706Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:24.001250Z&quot;}" data-trusted="true" data-execution_count="37">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>idxs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>tensor([7, 8, 3,  ..., 8, 1, 5])</code></pre>
</div>
</div>
<p>Finally, we convert those indexes to strings of disease names using the <code>vocab</code> and prepare the submission file:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:37.377361Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:37.376987Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:40.765833Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:40.765018Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:37.377334Z&quot;}" data-trusted="true" data-execution_count="38">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">enumerate</span>(dls.vocab))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ss <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'sample_submission.csv'</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.Series(idxs.numpy(), name<span class="op">=</span><span class="st">'idxs'</span>).<span class="bu">map</span>(mapping)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>ss.label <span class="op">=</span> results</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>ss.to_csv(<span class="st">'ensemble_subm.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-30T01:40:42.602218Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T01:40:42.601833Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T01:40:43.618262Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T01:40:43.617211Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T01:40:42.602192Z&quot;}" data-trusted="true" data-execution_count="39">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head ensemble_subm.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label
200001.jpg,hispa
200002.jpg,normal
200003.jpg,blast
200004.jpg,blast
200005.jpg,blast
200006.jpg,brown_spot
200007.jpg,dead_heart
200008.jpg,brown_spot
200009.jpg,hispa</code></pre>
</div>
</div>
</section>
</section>
<section id="gradient-accumulation-to-prevent-out-of-memory" class="level2">
<h2 class="anchored" data-anchor-id="gradient-accumulation-to-prevent-out-of-memory">Gradient accumulation to prevent out of memory</h2>
<p>If you run out of memory while training any of these large models, you can use <code>GradientAccumulation</code> to lower the memory usage. In the training loop we get the gradients, we add the gradients times the learning rate to the weights, and then we zero the gradients. What you could do is halve the batch size, so for example from 64 to 32, and then only zero the gradients every two iterations, and only do the update every two iterations. So you calculate in two batches what you calculate in one batch and it will be mathematically identical, That’s called <code>GradientAccumulation</code>, which added to the <code>Learner</code> as a callback, which are things that change the behavior of the training.</p>
<p>How batches work: we randomly shuffle the dataset, and grab the next batch size of images, we resize them all to be the same size, and we stack them on top of each other. If it’s black and white images for example, we would have 64 (or whatever the batch size is) 640 x 480 (or whatever image size you want) images so we end up with a 64 x 640 x 480 tensor. Pretty much all of the functionality provided by PyTorch will work fine for a mini batch of things just as it would for a single thing.</p>
<p>Inference is often done on CPU instead of GPU since you only need to process one thing at a time. Or people will queue a few of them up and stick them on a GPU.</p>
<p>In my <a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-4/">next blog post</a> I walk through the discussion and code from Live Coding 11.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>