<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-02-05">
<meta name="description" content="In this notebook I work through Jeremy Howard’s Live Coding 11 video in which he continues working on the Paddy Doctor Disease Classification Kaggle Competition.">

<title>Paddy Doctor Kaggle Competition - Part 4 – Vishal Bakshi’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9c1ae87ad5063dce4f793ccd314a7566.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#recap-on-paddy-competition" id="toc-recap-on-paddy-competition" class="nav-link" data-scroll-target="#recap-on-paddy-competition">Recap on Paddy Competition</a></li>
  <li><a href="#tips-on-getting-votes-for-kaggle-notebooks" id="toc-tips-on-getting-votes-for-kaggle-notebooks" class="nav-link" data-scroll-target="#tips-on-getting-votes-for-kaggle-notebooks">Tips on getting votes for Kaggle notebooks</a></li>
  <li><a href="#weights-and-biases-sweep" id="toc-weights-and-biases-sweep" class="nav-link" data-scroll-target="#weights-and-biases-sweep">Weights and Biases Sweep</a></li>
  <li><a href="#brute-force-hyperparameter-optimisation-vs-human-approach" id="toc-brute-force-hyperparameter-optimisation-vs-human-approach" class="nav-link" data-scroll-target="#brute-force-hyperparameter-optimisation-vs-human-approach">Brute force hyperparameter optimisation vs human approach</a></li>
  <li><a href="#learning-rate-finder" id="toc-learning-rate-finder" class="nav-link" data-scroll-target="#learning-rate-finder">Learning rate finder</a></li>
  <li><a href="#debugging-port-issues-with-ps" id="toc-debugging-port-issues-with-ps" class="nav-link" data-scroll-target="#debugging-port-issues-with-ps">Debugging port issues with ps</a></li>
  <li><a href="#background-sessions-in-tmux" id="toc-background-sessions-in-tmux" class="nav-link" data-scroll-target="#background-sessions-in-tmux">Background sessions in tmux</a></li>
  <li><a href="#strategy-for-iterating-between-notebooks" id="toc-strategy-for-iterating-between-notebooks" class="nav-link" data-scroll-target="#strategy-for-iterating-between-notebooks">Strategy for iterating between notebooks</a></li>
  <li><a href="#building-an-ensemble---appending-predictions" id="toc-building-an-ensemble---appending-predictions" class="nav-link" data-scroll-target="#building-an-ensemble---appending-predictions">Building an ensemble - appending predictions</a></li>
  <li><a href="#model-stacking" id="toc-model-stacking" class="nav-link" data-scroll-target="#model-stacking">Model stacking</a></li>
  <li><a href="#keeping-track-of-submission-notebooks" id="toc-keeping-track-of-submission-notebooks" class="nav-link" data-scroll-target="#keeping-track-of-submission-notebooks">Keeping track of submission notebooks</a></li>
  <li><a href="#training-large-models" id="toc-training-large-models" class="nav-link" data-scroll-target="#training-large-models">Training Large Models</a>
  <ul class="collapse">
  <li><a href="#improving-the-large-model-ensemble" id="toc-improving-the-large-model-ensemble" class="nav-link" data-scroll-target="#improving-the-large-model-ensemble">Improving the Large Model Ensemble</a></li>
  </ul></li>
  <li><a href="#improving-the-large-model-ensemble-1" id="toc-improving-the-large-model-ensemble-1" class="nav-link" data-scroll-target="#improving-the-large-model-ensemble-1">Improving the Large Model Ensemble</a>
  <ul class="collapse">
  <li><a href="#determine-ideal-number-of-epochs" id="toc-determine-ideal-number-of-epochs" class="nav-link" data-scroll-target="#determine-ideal-number-of-epochs">Determine Ideal Number of Epochs</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Paddy Doctor Kaggle Competition - Part 4</h1>
  <div class="quarto-categories">
    <div class="quarto-category">deep learning</div>
    <div class="quarto-category">fastai</div>
    <div class="quarto-category">kaggle competition</div>
    <div class="quarto-category">paddy doctor</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    In this notebook I work through Jeremy Howard’s Live Coding 11 video in which he continues working on the Paddy Doctor Disease Classification Kaggle Competition.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In the fastai course Part 1 <a href="https://youtu.be/AdhG64NF76E?feature=shared&amp;t=3117">Lesson 6 video</a> Jeremy Howard walked through the notebooks <a href="https://www.kaggle.com/code/jhoward/first-steps-road-to-the-top-part-1">First Steps: Road to the Top, Part 1</a> and <a href="https://www.kaggle.com/code/jhoward/small-models-road-to-the-top-part-2">Small models: Road to the Top, Part 2</a> where he builds increasingly accurate solutions to the <a href="https://www.kaggle.com/competitions/paddy-disease-classification">Paddy Doctor: Paddy Disease Classification</a> Kaggle Competition. In the video, Jeremy referenced a series of walkthrough videos that he made while working through the four-notebook series for this competition. I’m excited to watch these walkthroughs to better understand how to approach a Kaggle competition from the perspective of a former #1 Kaggle grandmaster.</p>
<p>In this blog post series, I’ll walk through the code Jeremy shared in each of the 6 Live Coding videos focused on this competition, submitting predictions to Kaggle along the way. My last two blog posts in this series reference Jeremy’s <a href="https://www.kaggle.com/code/jhoward/scaling-up-road-to-the-top-part-3">Scaling Up: Road to the Top, Part 3</a> notebook to improve my large model ensemble predictions. Here are the links to each of the blog posts in this series:</p>
<ul>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-1/">Part 1: Live Coding 8</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-2/">Part 2: Live Coding 9</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-3/">Part 3: Live Coding 10</a></li>
<li>Part 4: Live Coding 11 (You are here)</li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-5/">Part 5: Live Coding 12</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-6/">Part 6: Live Coding 13</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-7/">Part 7: Improving My Large Ensemble, Part 1</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-8/">Part 8: Improving My Large Ensemble, Part 2</a></li>
</ul>
<p><a href="https://www.youtube.com/watch?v=j-zMF2VirA8">Link to the Live Coding 11 video</a></p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div id="cell-4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-30T03:08:49.348738Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T03:08:49.348380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T03:09:19.100361Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T03:09:19.099342Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T03:08:49.348709Z&quot;}}" data-trusted="true" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>qq timm<span class="op">==</span><span class="fl">0.6.13</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>timm.__version__</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'0.6.13'</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-30T03:11:50.014129Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T03:11:50.013178Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T03:12:18.631754Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T03:12:18.630377Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T03:11:50.014089Z&quot;}}" data-trusted="true" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install fastkaggle if not available</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: <span class="im">import</span> fastkaggle</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ModuleNotFoundError</span>:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">-</span>Uq fastkaggle</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastkaggle <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> <span class="st">'paddy-disease-classification'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> setup_comp(comp, install<span class="op">=</span><span class="st">'fastai'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-30T03:12:18.634277Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T03:12:18.633771Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T03:12:18.645444Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T03:12:18.644510Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T03:12:18.634245Z&quot;}}" data-trusted="true" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>path.ls()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(#4) [Path('../input/paddy-disease-classification/sample_submission.csv'),Path('../input/paddy-disease-classification/train_images'),Path('../input/paddy-disease-classification/train.csv'),Path('../input/paddy-disease-classification/test_images')]</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-30T03:12:18.647482Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-30T03:12:18.646611Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-30T03:12:18.651488Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-30T03:12:18.650577Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-30T03:12:18.647453Z&quot;}}" data-trusted="true" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>trn_path <span class="op">=</span> path<span class="op">/</span><span class="st">'train_images'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recap-on-paddy-competition" class="level2">
<h2 class="anchored" data-anchor-id="recap-on-paddy-competition">Recap on Paddy Competition</h2>
<p>Jeremy submitted two more entries to the Paddy competition:</p>
<ul>
<li>Ensembled the models we had (improved the submission)</li>
<li>Since the VIT models were better than the rest, doubled their weights (that improved it as well)</li>
</ul>
</section>
<section id="tips-on-getting-votes-for-kaggle-notebooks" class="level2">
<h2 class="anchored" data-anchor-id="tips-on-getting-votes-for-kaggle-notebooks">Tips on getting votes for Kaggle notebooks</h2>
<p>To get more Kaggle notebook votes, create them in response to a popular competition. Much harder to get votes for a notebook that’s not part of a competition.</p>
</section>
<section id="weights-and-biases-sweep" class="level2">
<h2 class="anchored" data-anchor-id="weights-and-biases-sweep">Weights and Biases Sweep</h2>
<p>In tmux, press shift+D and select a client to disconnect it (in order to removed dotted-background in terminal).</p>
<p>In Weights &amp; Biases: you can run a “sweep” which runs lots of copies of your program feeding it different configurations. You can run the wandb client as many times as you want, setting it to a different CUDA device each time. Jeremy turns his model training routine into a python script, taking in arguments and passing them to a training function which initializes wandb using the given configuration, fine-tunes it, and does logging. NVIDIA tells you the GPU power usage (among other metrics). The key thing is the maximum memory use (<code>wandb.summary["GPU_mem"]</code>).</p>
<p>fastai has a thing called fastgpu which is a “queue service for quickly developing scripts that use all of your GPUs efficiently.” wandb takes this much further.</p>
<p>Note: The information about your git repo is in <code>.git/config</code>.</p>
<p>wandb API gives access to the runs logs (list of dictionaries) that we can then chuck into a <code>DataFrame</code>.</p>
<p>Note: plotly has interactive <a href="https://plotly.com/python/parallel-coordinates-plot/">parallel coordinates plot</a>.</p>
</section>
<section id="brute-force-hyperparameter-optimisation-vs-human-approach" class="level2">
<h2 class="anchored" data-anchor-id="brute-force-hyperparameter-optimisation-vs-human-approach">Brute force hyperparameter optimisation vs human approach</h2>
<p>In general, Jeremy doesn’t do Bayesian hyperparameter stuff ever. Which is funny because he taught wandb about the method they use for hyperparameter optimization. Used it once specifically for finding a good set of dropouts for AWD_LSTM—coded a random forest that actually tries to predict how accurate something’s going to be and then use that random forest to target better sets of hyperparameters. Jeremy likes to use a much more human-driven approach—what’s the hypothesis I’m trying to test, how can I test that as fast as possible. Most hyperparameters are independent of other hyperparameters. You don’t have to do a huge grid search. For example learning rate of 0.008 is always the best so let’s not try every learning rate for every model for every resize type, etc., let’s just use that learning rate. Same thing for resize method—crop was always better than squish for the few things we tried it on so we don’t have to try every combination. Jeremy also feels that he learns a lot more about deep learning when he asks like what do I want to know about this thing? Or is that thing independent of that other thing? Or are they connected or not? Next time I do another project I can leverage the knowledge of what I’ve learnt rather than do yet another huge hyperparameter sweep. My brain is the thing that’s learning. People at big companies that spend all of their time doing this big hyperparameter optimizations I always feel in talking to them they don’t seem to know much about the practice of deep learning. Like they don’t seem to know like what generally works and what generally doesn’t work because they never bother trying to figure out the answers to those questions, but instead they just chuck in a huge hyperparameter optimization thing into a thousand GPUs.</p>
<p>Hyperparameters generalize across different architectures and models (see <a href="https://www.platform.ai/post/optimizing-hyperparams-for-image-datasets-in-fastai">this study</a>). Across 90 different models they all had basically the same best learning rate (or close enough). This is true of computer vision, but not necessarily for tabular. All computer vision problems do all look pretty similar, the data for them looks pretty similar, Jeremy suspects that’s also true of object recognition. Nobody seems to be testing this but we should do similar tests for segmentation, bounding boxes, and so forth. Jeremy’s pretty sure we’d find the same thing.</p>
</section>
<section id="learning-rate-finder" class="level2">
<h2 class="anchored" data-anchor-id="learning-rate-finder">Learning rate finder</h2>
<p>Jeremy hardly uses learning rate finder, hasn’t mentioned it yet in this course. fastai learning rate default is a bit lower than the optimal just because Jeremy didn’t want to push it, rather it always worked pretty well rather than be pretty much the best.</p>
</section>
<section id="debugging-port-issues-with-ps" class="level2">
<h2 class="anchored" data-anchor-id="debugging-port-issues-with-ps">Debugging port issues with ps</h2>
<p>Normally the Jupyter server uses port 8888, Jeremy only has his SSH server setup to forward to port 8888. The fact that it’s using a different port, 8889, suggests that it’s already running somewhere. To find out where it’s running type <code>ps waux</code> to list all of your processes. To filter them to ones that contain jupyter or notebook: <code>ps waux | grep jupyter</code>.</p>
</section>
<section id="background-sessions-in-tmux" class="level2">
<h2 class="anchored" data-anchor-id="background-sessions-in-tmux">Background sessions in tmux</h2>
<p><code>tmux ls</code> lists all of your tmux sessions. <code>Ctrl+Z</code> to put a job into the background (and also stops the job), <code>fg</code> to bring it into the foreground. If you type <code>bg</code> (and optionally followed the job number, defaults to the last job put into the background) it will run the last job put in the background. It will still print output even if it’s in the background. Jeremy doesn’t so this very much because if he wants to run a job at the same time as the other he chucks it into another tmux pane. If you run something with <code>&amp;</code> at the end, it always runs it in the background. To run processes in parallel put an <code>&amp;</code> after each one. To kill a process type <code>fg</code> to foreground it and then type <code>Ctrl+C</code>. See <a href="https://www.gnu.org/software/bash/manual/html_node/Job-Control-Basics.html">bash job control</a> for more information. The job number has a <code>%</code> at the start.</p>
<p>From wikipedia: <em>tmux is an open-source terminal multiplexer for Unix-like operating systems. It allows multiple terminal sessions to be accessed simultaneously in a single window. It is useful for running more than one command-line program at the same time.</em></p>
</section>
<section id="strategy-for-iterating-between-notebooks" class="level2">
<h2 class="anchored" data-anchor-id="strategy-for-iterating-between-notebooks">Strategy for iterating between notebooks</h2>
<p>When Jeremy iterates through notebooks, what he tends to do is that once he’s got something vaguely working, he generally duplicates it and then tries to get something else vaguely working (change a parameter, try a different method, etc.), and once that starts vaguely working, he renames it. Then, from time to time, he cleans up the duplicated notebook versions that he didn’t end up using and he can tell which ones those are because he hasn’t renamed them yet (<code>paddy_base_Copy1.ipynb</code>, <code>paddy_base_Copy2.ipynb</code>, etc.).</p>
<p>In this case, Jeremy started out with <code>paddy.ipynb</code>, and just experimented (<code>show_batch</code>, <code>lr_find</code> and try to get something running). From that he dupicated it (<code>paddy_Copy1.ipynb</code>). In that he wanted to try different architectures, batch transforms and item transforms so he created a <code>train</code> function which takes those three things, creates a set of <code>ImageDataLoaders</code> with those transforms, use a fixed <code>seed</code> to get the same validation set each time (to compare performance across architectures), train it with an architecture, and then return the tta error rate. He then goes through the notebook trying different small architectures (small so they will run decently quickly), batch and item transforms. From that he gets a sense of which batch and item transforms work well for which architectures. He renames this notebook<code>paddy-small.ipynb</code>.</p>
<p>Jeremy is looking at two things: error rate at the end of training and tta error rate. The main one he cares about is the tta error rate since that’s the one he’s going to end up using.</p>
<p>If you pass an <code>int</code> instead of a <code>tuple</code> to item or batch transforms’ <code>size</code> parameter it will resize to a square.</p>
<p>Most frameworks (at the time of this video) doesn’t provide a test time augmentation method (except for one unnamed group that copies everything from fastai).</p>
<p>The cool kids on Kaggle (at the time of this videoin 2022) use <code>swin2</code>, which has fixed resolution and for larger model sizes has image size options of 192 and 256.</p>
<p>None of the <code>crop</code> resize method runs were doing well for vit or swin2, but were doing well for convnext.</p>
</section>
<section id="building-an-ensemble---appending-predictions" class="level2">
<h2 class="anchored" data-anchor-id="building-an-ensemble---appending-predictions">Building an ensemble - appending predictions</h2>
<p>Jeremy then duplicated <code>paddy_small.ipynb</code>, picked the models that performed well (and delete the rest), and did a search and replace of <code>small</code> with <code>large</code>. He got rid of the fixed random <code>seed</code> when creating the <code>ImageDataLoaders</code> in the <code>train</code> function, giving a different training set each time (meaning the models will not be comparable, which is fine). Jeremy appends to an empty starting list <code>tta_res</code> the tta predictions from each model.</p>
<p>For the very last Kaggle entry: Jeremy took the two best models (in his case the ViTs) and appending their tta predictions to the list <code>tta_res</code> so that they were there twice. A slightly clunky way of doing a weighted average. Then he stacked them all together, took the mean of the predictions, found the argmax (index of the class with the largest prediction) and then submit in the same way as before. This is Jeremy’s process which is not particularly thoughtful, but rather mechanical, which is what he likes about it as it can probably be automated.</p>
</section>
<section id="model-stacking" class="level2">
<h2 class="anchored" data-anchor-id="model-stacking">Model stacking</h2>
<p>Question: how critical is model stacking in Kaggle? Next time we’ll submit just the best ViT predictions and compare it to the stacked predictions. That will give us a sense of how much the ensembling matters.</p>
<p>For convnext: the large ensemble model had half the error rate of the small single model.</p>
</section>
<section id="keeping-track-of-submission-notebooks" class="level2">
<h2 class="anchored" data-anchor-id="keeping-track-of-submission-notebooks">Keeping track of submission notebooks</h2>
<p>Question: how do you keep track of which submissions are tied to which notebook? Jeremy just provides a small description to the submission to remind him. A better approach would be to actually write the notebook name there, which is what Jeremy normally does. Don’t change those notebooks after submission, duplicate them, make changes in the duplicate and rename them to something sensible. This all ends up back in github. Using this approach you will actually become a better deep learning practitioner. There are very few people who actually use this approach and there are very few people Jeremy comes across who are actually good deep learning practitioners. Not many people seem to know what works and what doesn’t.</p>
<p>The only way Jeremy can do this approach (small number of models) is because of already running a lot of models prior and logging their performance.</p>
<hr>
</section>
<section id="training-large-models" class="level2">
<h2 class="anchored" data-anchor-id="training-large-models">Training Large Models</h2>
<p>After going through walkthrough 11, I’ll now imitate the same approach Jeremy used and create an ensemble of models for my next Kaggle submission.</p>
<p>I’ll train the large versions of the following three small models (and transforms), which performed the best on TTA error rate:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Architecture</th>
<th style="text-align: left;">item_tfms</th>
<th style="text-align: left;">batch_tfms</th>
<th style="text-align: left;">Error Rate (First Run)</th>
<th style="text-align: left;">Minutes (per epoch)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">swinv2_base_window12_192_22k</td>
<td style="text-align: left;"><code>Resize(480, method='squish')</code></td>
<td style="text-align: left;"><code>aug_transforms(size=192, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0163*</td>
<td style="text-align: left;">02:30</td>
</tr>
<tr class="even">
<td style="text-align: left;">convnext_small_in22k</td>
<td style="text-align: left;"><code>Resize((640,480))</code></td>
<td style="text-align: left;"><code>aug_transforms(size=(288,224), min_scale=0.75)</code></td>
<td style="text-align: left;">0.0178*</td>
<td style="text-align: left;">01:51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vit_small_patch16_224</td>
<td style="text-align: left;"><code>Resize(480)</code></td>
<td style="text-align: left;"><code>aug_transforms(size=224, min_scale=0.75)</code></td>
<td style="text-align: left;">0.0202*</td>
<td style="text-align: left;">00:44</td>
</tr>
</tbody>
</table>
<p>I’ll prepare a helper function which does all the submission csv prep stuff:</p>
<div id="cell-41" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:07:33.633823Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:07:33.632898Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:07:33.640722Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:07:33.639703Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:07:33.633789Z&quot;}}" data-trusted="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prep_submission(fn, tta_res):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pull out predictions from tta_res list</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    tta_prs <span class="op">=</span> first(<span class="bu">zip</span>(<span class="op">*</span>tta_res))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert tta_res from list to stacked tensor</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    t_tta <span class="op">=</span> torch.stack(tta_prs)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take mean of each item's predictions</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    avg_pr <span class="op">=</span> t_tta.mean(<span class="dv">0</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get the index (class) of the maximum prediction for each item</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> avg_pr.argmax(dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create DataLoaders to get its vocab</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert indexes to vocab strings</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">enumerate</span>(dls.vocab))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add vocab strings to sample submission file and export to CSV</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    ss <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'sample_submission.csv'</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> pd.Series(idxs.numpy(), name<span class="op">=</span><span class="st">'idxs'</span>).<span class="bu">map</span>(mapping)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    ss.label <span class="op">=</span> results</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    ss.to_csv(fn, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll also copy from the above the <code>train</code> function defined by Jeremy that I’ll use for these models—instead of handling the tta predictions inside the training function, I’m returning the <code>Learner</code> and the <code>DataLoaders</code> so that I can calculate the validation set error rate and prep the test <code>DataLoader</code> with the appropriate <code>Resize</code> based on the model.</p>
<div id="cell-43" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T15:23:23.196513Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T15:23:23.195868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T15:23:23.204988Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T15:23:23.199778Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T15:23:23.196479Z&quot;}}" data-trusted="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T15:23:24.453841Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T15:23:24.453455Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T15:23:24.460218Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T15:23:24.459183Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T15:23:24.453810Z&quot;}}" data-trusted="true" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(arch, item, batch, accum<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    kwargs <span class="op">=</span> {<span class="st">'bs'</span>: <span class="dv">16</span>} <span class="cf">if</span> accum <span class="cf">else</span> {}</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>item, batch_tfms<span class="op">=</span>batch, <span class="op">**</span>kwargs)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    cbs <span class="op">=</span> GradientAccumulation(<span class="dv">2</span>) <span class="cf">if</span> accum <span class="cf">else</span> []</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    learn <span class="op">=</span> vision_learner(dls, arch, metrics<span class="op">=</span>error_rate, cbs<span class="op">=</span>cbs).to_fp16()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    learn.fine_tune(<span class="dv">12</span>, <span class="fl">0.01</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> learn, dls</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tta_res.append(learn.tta(dl=tst_dl))</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return error_rate(*learn.tta(dl=dls.valid))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I’ll train the three large models:</p>
<div id="cell-46" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T15:23:30.494365Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T15:23:30.493529Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T15:23:30.499035Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T15:23:30.497954Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T15:23:30.494323Z&quot;}}" data-trusted="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'swinv2_large_window12_192_22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T15:24:24.694272Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T15:24:24.693326Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:28:46.274207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:28:46.272935Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T15:24:24.694229Z&quot;}}" data-trusted="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/torch/functional.py:504: UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /usr/local/src/pytorch/aten/src/ATen/native/TensorShape.cpp:3483.)

  return _VF.meshgrid(tensors, **kwargs)  # type: ignore[attr-defined]

Downloading: "https://github.com/SwinTransformer/storage/releases/download/v2.0.0/swinv2_large_patch4_window12_192_22k.pth" to /root/.cache/torch/hub/checkpoints/swinv2_large_patch4_window12_192_22k.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.212364</td>
<td>0.643707</td>
<td>0.188852</td>
<td>03:40</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.476209</td>
<td>0.274359</td>
<td>0.094666</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.494529</td>
<td>0.300078</td>
<td>0.098030</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.447107</td>
<td>0.328064</td>
<td>0.099952</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.429720</td>
<td>0.298238</td>
<td>0.089861</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.284891</td>
<td>0.312586</td>
<td>0.082172</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.248839</td>
<td>0.156329</td>
<td>0.039885</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.132434</td>
<td>0.122389</td>
<td>0.039404</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.114585</td>
<td>0.123687</td>
<td>0.031235</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.078405</td>
<td>0.103234</td>
<td>0.027871</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.061866</td>
<td>0.087151</td>
<td>0.022105</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.056032</td>
<td>0.080488</td>
<td>0.017780</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.031765</td>
<td>0.082360</td>
<td>0.018741</td>
<td>05:01</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here’s the code to prepare the test <code>DataLoader</code> for this swin model that uses 192x192 pixels:</p>
<div id="cell-49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:29:49.954235Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:29:49.953075Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:29:54.467000Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:29:54.465944Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:29:49.954192Z&quot;}}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">192</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:30:25.873960Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:30:25.872984Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:30:27.568225Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:30:27.567073Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:30:25.873927Z&quot;}}" data-trusted="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tst_dl.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:30:33.689324Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:30:33.688921Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:33:01.295529Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:33:01.294297Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:30:33.689292Z&quot;}}" data-trusted="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tta_res.append(learn.tta(dl<span class="op">=</span>tst_dl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div id="cell-52" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:33:07.709085Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:33:07.708652Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:33:07.716843Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:33:07.715599Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:33:07.709040Z&quot;}}" data-trusted="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>3469</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:33:15.116917Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:33:15.116166Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:34:46.731975Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:34:46.730904Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:33:15.116882Z&quot;}}" data-trusted="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>TensorBase(0.0159)</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:35:31.845303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:35:31.844397Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T16:35:31.850190Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T16:35:31.849079Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:35:31.845263Z&quot;}}" data-trusted="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'convnext_large_in22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-56" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T16:35:33.920468Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T16:35:33.919701Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:36:26.910245Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:36:26.909086Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T16:35:33.920430Z&quot;}}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize((<span class="dv">640</span>,<span class="dv">480</span>)), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span>(<span class="dv">288</span>,<span class="dv">224</span>), min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_large_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_large_22k_224.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.213938</td>
<td>0.805596</td>
<td>0.224892</td>
<td>03:14</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.467912</td>
<td>0.239441</td>
<td>0.077367</td>
<td>04:48</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.419594</td>
<td>0.247392</td>
<td>0.067756</td>
<td>04:47</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.377958</td>
<td>0.205914</td>
<td>0.062470</td>
<td>04:45</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.312134</td>
<td>0.294184</td>
<td>0.071600</td>
<td>04:46</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.233862</td>
<td>0.241724</td>
<td>0.058626</td>
<td>04:46</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.149694</td>
<td>0.118743</td>
<td>0.028832</td>
<td>04:45</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.141486</td>
<td>0.137468</td>
<td>0.030274</td>
<td>04:45</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.086328</td>
<td>0.117887</td>
<td>0.027391</td>
<td>04:45</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.069587</td>
<td>0.101186</td>
<td>0.024027</td>
<td>04:45</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.047381</td>
<td>0.083770</td>
<td>0.017780</td>
<td>04:44</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.023768</td>
<td>0.087173</td>
<td>0.018260</td>
<td>04:44</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.023235</td>
<td>0.092406</td>
<td>0.020663</td>
<td>04:45</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-57" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:39:05.049767Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:39:05.049313Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:39:10.751158Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:39:10.750124Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:39:05.049732Z&quot;}}" data-trusted="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>tst_dl.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-58" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:39:36.205916Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:39:36.205530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:41:36.264554Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:41:36.263453Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:39:36.205884Z&quot;}}" data-trusted="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tta_res.append(learn.tta(dl<span class="op">=</span>tst_dl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div id="cell-59" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:42:27.381505Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:42:27.381117Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:42:27.389456Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:42:27.388477Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:42:27.381474Z&quot;}}" data-trusted="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>(2, 3469, 3469)</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:42:52.403258Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:42:52.402403Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:44:08.425983Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:44:08.424870Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:42:52.403212Z&quot;}}" data-trusted="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>TensorBase(0.0706)</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:44:50.781838Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:44:50.781410Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T17:44:50.787196Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T17:44:50.785933Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:44:50.781804Z&quot;}}" data-trusted="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'vit_large_patch16_224'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T17:45:03.641933Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T17:45:03.641453Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T19:12:00.862266Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T19:12:00.861327Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T17:45:03.641895Z&quot;}}" data-trusted="true" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.303628</td>
<td>0.769040</td>
<td>0.225853</td>
<td>04:53</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.472007</td>
<td>0.282628</td>
<td>0.092263</td>
<td>06:47</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.493476</td>
<td>0.508031</td>
<td>0.155694</td>
<td>06:48</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.510523</td>
<td>0.543362</td>
<td>0.172994</td>
<td>06:46</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.449807</td>
<td>0.509493</td>
<td>0.131667</td>
<td>06:46</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.323358</td>
<td>0.229533</td>
<td>0.068236</td>
<td>06:46</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.239007</td>
<td>0.150215</td>
<td>0.044210</td>
<td>06:46</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.223845</td>
<td>0.160197</td>
<td>0.047093</td>
<td>06:45</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.085320</td>
<td>0.112214</td>
<td>0.029313</td>
<td>06:45</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.078987</td>
<td>0.108103</td>
<td>0.029313</td>
<td>06:46</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.043259</td>
<td>0.092681</td>
<td>0.024507</td>
<td>06:45</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.037170</td>
<td>0.075773</td>
<td>0.020183</td>
<td>06:45</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.028403</td>
<td>0.074941</td>
<td>0.021144</td>
<td>06:44</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-64" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T19:15:44.449659Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T19:15:44.449227Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T19:15:48.915207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T19:15:48.914095Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T19:15:44.449623Z&quot;}}" data-trusted="true" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tst_dl.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-65" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T19:15:54.639358Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T19:15:54.638858Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T19:19:23.625311Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T19:19:23.624086Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T19:15:54.639318Z&quot;}}" data-trusted="true" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tta_res.append(learn.tta(dl<span class="op">=</span>tst_dl))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div id="cell-66" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T19:21:31.040858Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T19:21:31.040405Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T19:21:31.048732Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T19:21:31.047810Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T19:21:31.040821Z&quot;}}" data-trusted="true" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(3, 3469, 3469, 3469)</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T19:21:34.214392Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T19:21:34.213988Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T19:23:41.012321Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T19:23:41.011155Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T19:21:34.214360Z&quot;}}" data-trusted="true" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="12" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>TensorBase(0.0135)</code></pre>
</div>
</div>
<div id="cell-68" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T20:10:44.556902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T20:10:44.556491Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T20:10:48.721190Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T20:10:48.720355Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T20:10:44.556870Z&quot;}}" data-trusted="true" data-execution_count="42">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_ensemble.csv'</span>, tta_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-69" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T20:10:57.530085Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T20:10:57.529689Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T20:10:58.521657Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T20:10:58.520645Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T20:10:57.530052Z&quot;}}" data-trusted="true" data-execution_count="43">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_ensemble.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<section id="improving-the-large-model-ensemble" class="level3">
<h3 class="anchored" data-anchor-id="improving-the-large-model-ensemble">Improving the Large Model Ensemble</h3>
<p>Here is a summary of my submissions so far in this competition, with the fifth submission the one I just did with a large model ensemble:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 18%">
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Submission</th>
<th style="text-align: left;">Description</th>
<th style="text-align: center;">Private Score</th>
<th style="text-align: center;">Public Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">initial submission file after creating a quick small model following Jeremy Howard’s walkthrough video.</td>
<td style="text-align: center;">0.13709</td>
<td style="text-align: center;">0.12418</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">initial submission using convnext small 2 epochs fine-tuned sorted file list</td>
<td style="text-align: center;">0.94124</td>
<td style="text-align: center;">0.92541</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">squish convnext small 12 epoch ft tta</td>
<td style="text-align: center;">0.98156</td>
<td style="text-align: center;">0.98308</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">ensemble small 12 epoch ft tta</td>
<td style="text-align: center;">0.98617</td>
<td style="text-align: center;">0.98423</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 12 epoch ft tta</td>
<td style="text-align: center;">0.97811</td>
<td style="text-align: center;">0.98039</td>
</tr>
</tbody>
</table>
<p>The first four submissions were going great—each successive one improved the private and public score. I was expecting my ensemble with larger models to improve the accuracy of the small model ensemble. Instead, the larger ensemble’s private error rate (1-0.97811) is 58% more than the smaller ensemble (1-0.98617), and the public error rate of the larger ensemble (1-0.98039) is 24% larger than the smaller ensemble (1-0.98423). Why?</p>
</section>
</section>
<section id="improving-the-large-model-ensemble-1" class="level2">
<h2 class="anchored" data-anchor-id="improving-the-large-model-ensemble-1">Improving the Large Model Ensemble</h2>
<p>In order to try and improve the large model ensemble, I want to share my main observation from the large model training runs: In each of the training runs, the error rate increased for the first 4-5 epochs before decreasing, and was higher after the final epoch than any of the final error rates of the smaller models. I think this means that I should train the models for longer. Granted, the error rates between the larger models and between the larger and smaller models are not comparable (they use different validation sets), so I can’t conclude anything about training performance from that comparison. However, I would generally expect the error rates of the larger models to be lower, even on different validation sets (perhaps that’s not a fair expectation).</p>
<p>A secondary observation that I made is that the manner in which I calculated the TTA error rate after each training run…</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>…is not correct. I should pass <code>dls.valid</code> using the <code>dls</code> used during the training to <code>learn.tta</code> instead of using a new <code>DataLoaders</code> object which has a different training/validation split, and therefore likely is including images from the training when calculating the error rate. I also should use the same item and batch transforms.</p>
<p>I’ll redefine my <code>train</code> function to include the TTA prediction and error rate calculations, and increase the number of epochs to 24 (this will likely be too large, but I’ll adjust after one training run):</p>
<div id="cell-75" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T17:35:55.982357Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T17:35:55.981996Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T17:35:58.841356Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T17:35:58.840573Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T17:35:55.982329Z&quot;}}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run this once and re-use for all trainings</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-76" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T17:35:59.858694Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T17:35:59.858283Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T17:35:59.865805Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T17:35:59.864931Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T17:35:59.858627Z&quot;}}" data-trusted="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train(arch, item, batch, accum<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    kwargs <span class="op">=</span> {<span class="st">'bs'</span>: <span class="dv">16</span>} <span class="cf">if</span> accum <span class="cf">else</span> {}</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    dls <span class="op">=</span> ImageDataLoaders.from_folder(trn_path, valid_pct<span class="op">=</span><span class="fl">0.2</span>, item_tfms<span class="op">=</span>item, batch_tfms<span class="op">=</span>batch, <span class="op">**</span>kwargs)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    cbs <span class="op">=</span> GradientAccumulation(<span class="dv">2</span>) <span class="cf">if</span> accum <span class="cf">else</span> []</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    learn <span class="op">=</span> vision_learner(dls, arch, metrics<span class="op">=</span>error_rate, cbs<span class="op">=</span>cbs).to_fp16()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    learn.fine_tune(<span class="dv">24</span>, <span class="fl">0.01</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># view losses</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    learn.recorder.plot_loss()</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TTA predictions using test dataset</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    tta_res.append(learn.tta(dl<span class="op">=</span>tst_dl))</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return error rate using validation dataset</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(error_rate(<span class="op">*</span>learn.tta(dl<span class="op">=</span>dls.valid)))</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> learn, dls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="determine-ideal-number-of-epochs" class="level3">
<h3 class="anchored" data-anchor-id="determine-ideal-number-of-epochs">Determine Ideal Number of Epochs</h3>
<p>I’ll train the swinv2 model to see how many epochs I should use for training—I’ll be keeping an eye on the validation loss. If it starts to increase, I know I’ve trained for too long.</p>
<p><strong>I’ll train it a few times to see how stable the training is.</strong></p>
<div id="cell-79" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-10T22:23:29.457930Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-10T22:23:29.457535Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-10T22:23:29.462645Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-10T22:23:29.461568Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-10T22:23:29.457897Z&quot;}}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-80" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-10T22:23:29.754950Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-10T22:23:29.754255Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-10T22:23:29.759022Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-10T22:23:29.758026Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-10T22:23:29.754914Z&quot;}}" data-trusted="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'swinv2_large_window12_192_22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-81" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-09T21:42:49.401064Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-09T21:42:49.400562Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-09T23:52:15.637253Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-09T23:52:15.636164Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-09T21:42:49.401007Z&quot;}}" data-trusted="true" data-execution_count="54">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.242866</td>
<td>0.766052</td>
<td>0.219606</td>
<td>03:40</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.439101</td>
<td>0.294660</td>
<td>0.087938</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.351378</td>
<td>0.222908</td>
<td>0.068236</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.362053</td>
<td>0.194189</td>
<td>0.060548</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.352330</td>
<td>0.217729</td>
<td>0.064873</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.317429</td>
<td>0.332206</td>
<td>0.088419</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.268157</td>
<td>0.211638</td>
<td>0.057184</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.281623</td>
<td>0.222969</td>
<td>0.059587</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.302056</td>
<td>0.192562</td>
<td>0.053820</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.240952</td>
<td>0.229510</td>
<td>0.058626</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.121465</td>
<td>0.183262</td>
<td>0.040365</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.172122</td>
<td>0.207367</td>
<td>0.056704</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.116110</td>
<td>0.218943</td>
<td>0.051418</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.110617</td>
<td>0.127053</td>
<td>0.030274</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.095698</td>
<td>0.143608</td>
<td>0.035560</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.082635</td>
<td>0.119791</td>
<td>0.027391</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.086161</td>
<td>0.109686</td>
<td>0.024507</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.060592</td>
<td>0.115672</td>
<td>0.026430</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.045066</td>
<td>0.116955</td>
<td>0.023546</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.027253</td>
<td>0.106379</td>
<td>0.022105</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.027075</td>
<td>0.116326</td>
<td>0.022585</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.027959</td>
<td>0.106153</td>
<td>0.020183</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.018591</td>
<td>0.106057</td>
<td>0.019222</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.016949</td>
<td>0.107893</td>
<td>0.017780</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.015706</td>
<td>0.106630</td>
<td>0.018260</td>
<td>05:01</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>TensorBase(0.0187)</code></pre>
</div>
</div>
<p>I’m getting decent results after 24 epochs. Let’s see if that holds when I train it again:</p>
<div id="cell-83" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-10T00:01:21.245582Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-10T00:01:21.244670Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-10T02:10:46.854270Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-10T02:10:46.853104Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-10T00:01:21.245438Z&quot;}}" data-trusted="true" data-execution_count="58">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.092984</td>
<td>0.851812</td>
<td>0.221048</td>
<td>03:40</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.544550</td>
<td>0.254801</td>
<td>0.083614</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.348117</td>
<td>0.210600</td>
<td>0.066795</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.360428</td>
<td>0.211086</td>
<td>0.065834</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.346224</td>
<td>0.313809</td>
<td>0.094666</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.368918</td>
<td>0.243433</td>
<td>0.067756</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.377717</td>
<td>0.414140</td>
<td>0.119654</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.310699</td>
<td>0.225722</td>
<td>0.069678</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.245260</td>
<td>0.207003</td>
<td>0.061028</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.183680</td>
<td>0.181822</td>
<td>0.049976</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.138067</td>
<td>0.211188</td>
<td>0.052859</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.192407</td>
<td>0.231691</td>
<td>0.063912</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.135225</td>
<td>0.172450</td>
<td>0.041326</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.150147</td>
<td>0.115569</td>
<td>0.033638</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.090655</td>
<td>0.107455</td>
<td>0.029313</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.076048</td>
<td>0.087698</td>
<td>0.023546</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.063137</td>
<td>0.082899</td>
<td>0.024027</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.055129</td>
<td>0.085577</td>
<td>0.017299</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.039957</td>
<td>0.078003</td>
<td>0.018741</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.027110</td>
<td>0.094057</td>
<td>0.018741</td>
<td>05:02</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.036028</td>
<td>0.086254</td>
<td>0.015858</td>
<td>05:02</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.016480</td>
<td>0.083638</td>
<td>0.014416</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.024642</td>
<td>0.079923</td>
<td>0.013455</td>
<td>05:01</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.017131</td>
<td>0.081694</td>
<td>0.015377</td>
<td>05:01</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.013220</td>
<td>0.081680</td>
<td>0.015858</td>
<td>05:01</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorBase(0.0154)</code></pre>
</div>
</div>
<p>I get a similar final error rate as the first training. However, it’s not so clear from the tables how the validation and training losses change over the course of the training. To do so, I’ve added <code>learn.recorder.plot_loss()</code> to the <code>train</code> function.</p>
<p>I’ll train it a couple more times to see the loss plots (<em>ignore the <code>NameError</code> for now, I’m not concerned with TTA error rate at this point, I’m only concerned with whether or not the training is stable</em>):</p>
<div id="cell-85" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-10T18:18:06.442846Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-10T18:18:06.442418Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-10T20:24:49.180920Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-10T20:24:49.179491Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-10T18:18:06.442817Z&quot;}}" data-trusted="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/torch/functional.py:504: UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /usr/local/src/pytorch/aten/src/ATen/native/TensorShape.cpp:3483.)

  return _VF.meshgrid(tensors, **kwargs)  # type: ignore[attr-defined]

Downloading: "https://github.com/SwinTransformer/storage/releases/download/v2.0.0/swinv2_large_patch4_window12_192_22k.pth" to /root/.cache/torch/hub/checkpoints/swinv2_large_patch4_window12_192_22k.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.294445</td>
<td>0.719873</td>
<td>0.204229</td>
<td>03:42</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.485149</td>
<td>0.264520</td>
<td>0.084575</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.383336</td>
<td>0.238155</td>
<td>0.072081</td>
<td>05:07</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.322685</td>
<td>0.196292</td>
<td>0.052379</td>
<td>05:06</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.391429</td>
<td>0.196975</td>
<td>0.056223</td>
<td>05:06</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.310772</td>
<td>0.311188</td>
<td>0.084575</td>
<td>05:07</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.370088</td>
<td>0.309966</td>
<td>0.087458</td>
<td>05:07</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.306135</td>
<td>0.160217</td>
<td>0.045651</td>
<td>05:06</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.227858</td>
<td>0.303918</td>
<td>0.077367</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.237295</td>
<td>0.202838</td>
<td>0.050937</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.173179</td>
<td>0.163243</td>
<td>0.046132</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.154630</td>
<td>0.141608</td>
<td>0.037482</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.123365</td>
<td>0.116312</td>
<td>0.032677</td>
<td>05:06</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.117789</td>
<td>0.117131</td>
<td>0.031716</td>
<td>05:05</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.100615</td>
<td>0.150154</td>
<td>0.031716</td>
<td>05:05</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.069063</td>
<td>0.106202</td>
<td>0.024507</td>
<td>05:04</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.062251</td>
<td>0.098203</td>
<td>0.022105</td>
<td>05:06</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.067058</td>
<td>0.103470</td>
<td>0.022585</td>
<td>05:06</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.041386</td>
<td>0.093786</td>
<td>0.020183</td>
<td>05:05</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.033301</td>
<td>0.099226</td>
<td>0.017780</td>
<td>05:05</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.030562</td>
<td>0.086443</td>
<td>0.016338</td>
<td>05:05</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.045077</td>
<td>0.090462</td>
<td>0.016819</td>
<td>05:05</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.015390</td>
<td>0.087115</td>
<td>0.017780</td>
<td>05:05</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.013893</td>
<td>0.084977</td>
<td>0.016819</td>
<td>05:05</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.021804</td>
<td>0.084517</td>
<td>0.016819</td>
<td>05:06</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[11], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> learn, dls <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">train</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">arch</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">item</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">Resize</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">480</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">method</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">squish</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">batch</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">aug_transforms</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">size</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">192</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">min_scale</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">0.75</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">accum</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">)</span>

Cell <span class="ansi-green-fg">In[10], line 12</span>, in <span class="ansi-cyan-fg">train</span><span class="ansi-blue-fg">(arch, item, batch, accum)</span>
<span class="ansi-green-fg ansi-bold">      9</span> learn<span style="color:rgb(98,98,98)">.</span>recorder<span style="color:rgb(98,98,98)">.</span>plot_loss()
<span class="ansi-green-fg ansi-bold">     11</span> <span style="font-style:italic;color:rgb(95,135,135)"># TTA predictions using test dataset</span>
<span class="ansi-green-fg">---&gt; 12</span> tst_dl <span style="color:rgb(98,98,98)">=</span> dls<span style="color:rgb(98,98,98)">.</span>test_dl(<span class="ansi-yellow-bg">tst_files</span>)
<span class="ansi-green-fg ansi-bold">     13</span> tta_res<span style="color:rgb(98,98,98)">.</span>append(learn<span style="color:rgb(98,98,98)">.</span>tta(dl<span style="color:rgb(98,98,98)">=</span>tst_dl))
<span class="ansi-green-fg ansi-bold">     15</span> <span style="font-style:italic;color:rgb(95,135,135)"># Return error rate using validation dataset</span>

<span class="ansi-red-fg">NameError</span>: name 'tst_files' is not defined</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-38-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-86" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-87" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-10T22:24:15.210235Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-10T22:24:15.209839Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T00:37:13.422727Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T00:37:13.421534Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-10T22:24:15.210207Z&quot;}}" data-trusted="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>, method<span class="op">=</span><span class="st">'squish'</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">192</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/torch/functional.py:504: UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /usr/local/src/pytorch/aten/src/ATen/native/TensorShape.cpp:3483.)

  return _VF.meshgrid(tensors, **kwargs)  # type: ignore[attr-defined]

Downloading: "https://github.com/SwinTransformer/storage/releases/download/v2.0.0/swinv2_large_patch4_window12_192_22k.pth" to /root/.cache/torch/hub/checkpoints/swinv2_large_patch4_window12_192_22k.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.327175</td>
<td>0.800045</td>
<td>0.214320</td>
<td>03:41</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.428933</td>
<td>0.264715</td>
<td>0.085536</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.373618</td>
<td>0.269784</td>
<td>0.081211</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.322864</td>
<td>0.236708</td>
<td>0.076406</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.318025</td>
<td>0.255129</td>
<td>0.073522</td>
<td>05:11</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.362358</td>
<td>0.276745</td>
<td>0.073042</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.252548</td>
<td>0.238884</td>
<td>0.056223</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.269222</td>
<td>0.258998</td>
<td>0.067275</td>
<td>05:11</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.232486</td>
<td>0.361521</td>
<td>0.095627</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.194597</td>
<td>0.210730</td>
<td>0.060067</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.195712</td>
<td>0.128107</td>
<td>0.036040</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.158002</td>
<td>0.159793</td>
<td>0.040846</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.100048</td>
<td>0.135760</td>
<td>0.037001</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.081591</td>
<td>0.175432</td>
<td>0.042768</td>
<td>05:11</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.101374</td>
<td>0.191513</td>
<td>0.041326</td>
<td>05:11</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.065971</td>
<td>0.126861</td>
<td>0.026430</td>
<td>05:11</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.059315</td>
<td>0.120217</td>
<td>0.028352</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.038761</td>
<td>0.118691</td>
<td>0.026430</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.031474</td>
<td>0.106201</td>
<td>0.021144</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.029422</td>
<td>0.132580</td>
<td>0.023546</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.024789</td>
<td>0.102459</td>
<td>0.021624</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.031319</td>
<td>0.110205</td>
<td>0.021144</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.021636</td>
<td>0.108477</td>
<td>0.018741</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.013328</td>
<td>0.111174</td>
<td>0.019222</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.019866</td>
<td>0.108757</td>
<td>0.020183</td>
<td>05:09</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorBase(0.0183)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-40-output-15.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-88" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T00:41:34.173416Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T00:41:34.172686Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T00:41:34.179582Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T00:41:34.178656Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T00:41:34.173386Z&quot;}}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(1, 3469)</code></pre>
</div>
</div>
<p>I ran four training runs of 24 epochs each for this large swinv2 model, including two training runs where I plotted the validation and training loss. I noticed the same patterns in each one:</p>
<ul>
<li>The training and validation losses are generally decreasing but tend to rise and fall a bit across the training.</li>
<li>24 epochs doesn’t seem to be overfitting the model. The validation loss certainly fluctuates a bit at the end of the training (increasing and decreasing in consecutive epochs) but it is relatively flat at the end. Perhaps I’m making a mistake here, and such a flattening is a sign of the start of overfitting, but I’m going to stick to 24 epochs for now.</li>
<li>The final error rate during training is still unremarkable at around 0.02. None of the training runs resulted in anything close to the lowest error rate I had with smaller models (0.0163). Again, different validation sets will result in different error rates, but because of this lack of error rate improvement, I’m not expecting to improve my competition score significantly.</li>
</ul>
<p>Next, I’ll train the other two large models for 24 epochs each:</p>
<div id="cell-91" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T00:53:14.630314Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T00:53:14.629928Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T00:53:14.634575Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T00:53:14.633658Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T00:53:14.630286Z&quot;}}" data-trusted="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'convnext_large_in22k'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-92" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T00:53:22.861044Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T00:53:22.860679Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T03:05:50.430959Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T03:05:50.429699Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T00:53:22.861018Z&quot;}}" data-trusted="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize((<span class="dv">640</span>,<span class="dv">480</span>)), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span>(<span class="dv">288</span>,<span class="dv">224</span>), min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_large_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_large_22k_224.pth</code></pre>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.117779</td>
<td>0.660938</td>
<td>0.174916</td>
<td>03:27</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.437924</td>
<td>0.200062</td>
<td>0.068717</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.315851</td>
<td>0.158929</td>
<td>0.048054</td>
<td>05:10</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.294190</td>
<td>0.167008</td>
<td>0.049976</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.240635</td>
<td>0.133045</td>
<td>0.040846</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.296416</td>
<td>0.199445</td>
<td>0.057184</td>
<td>05:10</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.223830</td>
<td>0.155541</td>
<td>0.044690</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.231965</td>
<td>0.144504</td>
<td>0.034118</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.176270</td>
<td>0.160164</td>
<td>0.041807</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.173444</td>
<td>0.175411</td>
<td>0.039885</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.154608</td>
<td>0.150472</td>
<td>0.040846</td>
<td>05:09</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.128028</td>
<td>0.119761</td>
<td>0.031235</td>
<td>05:09</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.081071</td>
<td>0.093472</td>
<td>0.020183</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.107737</td>
<td>0.099295</td>
<td>0.021144</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.096281</td>
<td>0.111142</td>
<td>0.024507</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.054678</td>
<td>0.078692</td>
<td>0.019222</td>
<td>05:08</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.039529</td>
<td>0.092145</td>
<td>0.024507</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.049152</td>
<td>0.084749</td>
<td>0.020183</td>
<td>05:07</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.029900</td>
<td>0.075587</td>
<td>0.014897</td>
<td>05:08</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.025885</td>
<td>0.088903</td>
<td>0.020663</td>
<td>05:07</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.016233</td>
<td>0.076446</td>
<td>0.017299</td>
<td>05:07</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.012938</td>
<td>0.069057</td>
<td>0.015377</td>
<td>05:07</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.017901</td>
<td>0.072703</td>
<td>0.013455</td>
<td>05:06</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.015330</td>
<td>0.076080</td>
<td>0.014416</td>
<td>05:06</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.027190</td>
<td>0.074604</td>
<td>0.014416</td>
<td>05:06</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorBase(0.0144)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-15.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-93" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T05:04:44.309853Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T05:04:44.309306Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T05:04:44.317298Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T05:04:44.316325Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T05:04:44.309817Z&quot;}}" data-trusted="true" data-execution_count="38">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>(2, 3469, 3469)</code></pre>
</div>
</div>
<p>Similar to the large swinv2 training run, the training loss starts at a much higher value and ends up at a lower value than the validation loss. Both losses fluctuate, decreasing for the first few epochs, then increasing in epoch 4, then generally decreasing the rest of the way with small bumps.</p>
<p>It’s hard not to compare error rates across models, even though I know I shouldn’t because they are on different validation and test sets. That being said:</p>
<p>After the final (24th) epoch, the large convnext model achieved about 30% smaller final training error rate than the large swinv2 models. The TTA error rate for convnext model (0.0144) is 20% lower than the swinv2 models (0.0183).</p>
<p>Let’s see how the large vit model performs, but I am leaning towards excluding the swinv2 model from the ensemble since it seems to be the worst performing one on both validation and test set error rates. I am now also questioning whether the excellent performance of the small swinv2 model just simply doesn’t translate to the larger model. I also have to question here—am I doing something wrong in how I’m training these large models? Shouldn’t they be performing much better than their smaller counterparts? convnext certainly seems to be doing so, but swinv2 doesn’t.</p>
<div id="cell-95" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T17:37:23.049775Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T17:37:23.049387Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T17:37:23.054563Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T17:37:23.053405Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T17:37:23.049744Z&quot;}}" data-trusted="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>arch <span class="op">=</span> <span class="st">'vit_large_patch16_224'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I was running into the usual CUDA Out-Of-Memory errors, even after restarting the kernel, so I found the following code online to clear out most of the GPU cache.</p>
<div id="cell-97" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T03:44:09.317781Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T03:44:09.317392Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T03:44:09.506271Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T03:44:09.505106Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T03:44:09.317749Z&quot;}}" data-trusted="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gc<span class="op">;</span> gc.collect()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>torch.cuda.empty_cache()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-98" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T17:37:32.439189Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T17:37:32.438219Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T20:38:39.558541Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T20:38:39.557316Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T17:37:32.439148Z&quot;}}" data-trusted="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>learn, dls <span class="op">=</span> train(arch, item<span class="op">=</span>Resize(<span class="dv">480</span>), batch<span class="op">=</span>aug_transforms(size<span class="op">=</span><span class="dv">224</span>, min_scale<span class="op">=</span><span class="fl">0.75</span>), accum<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.293154</td>
<td>0.675305</td>
<td>0.199423</td>
<td>05:01</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">epoch</th>
<th data-quarto-table-cell-role="th">train_loss</th>
<th data-quarto-table-cell-role="th">valid_loss</th>
<th data-quarto-table-cell-role="th">error_rate</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0.559790</td>
<td>0.329836</td>
<td>0.110524</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.347774</td>
<td>0.223555</td>
<td>0.070159</td>
<td>07:01</td>
</tr>
<tr class="odd">
<td>2</td>
<td>0.375485</td>
<td>0.274702</td>
<td>0.074003</td>
<td>07:01</td>
</tr>
<tr class="even">
<td>3</td>
<td>0.386415</td>
<td>0.247032</td>
<td>0.070159</td>
<td>07:01</td>
</tr>
<tr class="odd">
<td>4</td>
<td>0.401717</td>
<td>0.207438</td>
<td>0.068236</td>
<td>07:01</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.367362</td>
<td>0.319452</td>
<td>0.100432</td>
<td>07:01</td>
</tr>
<tr class="odd">
<td>6</td>
<td>0.300632</td>
<td>0.215864</td>
<td>0.066314</td>
<td>07:01</td>
</tr>
<tr class="even">
<td>7</td>
<td>0.232857</td>
<td>0.152640</td>
<td>0.044690</td>
<td>07:01</td>
</tr>
<tr class="odd">
<td>8</td>
<td>0.268405</td>
<td>0.222575</td>
<td>0.062470</td>
<td>07:01</td>
</tr>
<tr class="even">
<td>9</td>
<td>0.139751</td>
<td>0.270562</td>
<td>0.072561</td>
<td>07:01</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.191241</td>
<td>0.155850</td>
<td>0.039885</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>11</td>
<td>0.116998</td>
<td>0.124926</td>
<td>0.031235</td>
<td>07:00</td>
</tr>
<tr class="odd">
<td>12</td>
<td>0.130736</td>
<td>0.161409</td>
<td>0.043248</td>
<td>07:01</td>
</tr>
<tr class="even">
<td>13</td>
<td>0.082500</td>
<td>0.174184</td>
<td>0.036521</td>
<td>07:00</td>
</tr>
<tr class="odd">
<td>14</td>
<td>0.061503</td>
<td>0.108156</td>
<td>0.026430</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>15</td>
<td>0.069686</td>
<td>0.138058</td>
<td>0.034599</td>
<td>07:00</td>
</tr>
<tr class="odd">
<td>16</td>
<td>0.059782</td>
<td>0.116582</td>
<td>0.032196</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>17</td>
<td>0.054639</td>
<td>0.102705</td>
<td>0.024507</td>
<td>07:00</td>
</tr>
<tr class="odd">
<td>18</td>
<td>0.033125</td>
<td>0.098741</td>
<td>0.025949</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>19</td>
<td>0.039223</td>
<td>0.099548</td>
<td>0.020183</td>
<td>06:59</td>
</tr>
<tr class="odd">
<td>20</td>
<td>0.021738</td>
<td>0.101047</td>
<td>0.020183</td>
<td>07:00</td>
</tr>
<tr class="even">
<td>21</td>
<td>0.027946</td>
<td>0.100101</td>
<td>0.021624</td>
<td>07:00</td>
</tr>
<tr class="odd">
<td>22</td>
<td>0.016446</td>
<td>0.095121</td>
<td>0.022585</td>
<td>06:59</td>
</tr>
<tr class="even">
<td>23</td>
<td>0.021418</td>
<td>0.093120</td>
<td>0.022105</td>
<td>07:00</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="24" style="width:300px; height:20px; vertical-align: middle;"></progress>
      
    </div>
    
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorBase(0.0197)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-48-output-14.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-99" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T20:43:09.275174Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T20:43:09.274759Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T20:43:09.283005Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T20:43:09.282022Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T20:43:09.275143Z&quot;}}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(3, 3469, 3469, 3469)</code></pre>
</div>
</div>
<p>Only the larger convnext model seems to be clearly out-performing its smaller counterpart. The larger swinv2 and vit models seems to be performing at around the same error rate as their smaller versions. I’ll make my next submission an ensemble of these three models and see how it performs:</p>
<div id="cell-101" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:11:29.474224Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:11:29.473437Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:11:33.047238Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:11:33.046461Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:11:29.474191Z&quot;}}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_ensemble2.csv'</span>, tta_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-102" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:11:38.957762Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:11:38.957019Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:11:39.912360Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:11:39.911162Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:11:38.957724Z&quot;}}" data-trusted="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_ensemble2.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<p>The submission (the sixth submission in the table below) for this ensemble received a lower private score and a higher public score when compared to the best submission (Submission 4: ensemble of small models trained for 12 epochs with final predictions calculated using TTA), and higher private and public score when compared to the same ensemble trained on only 12 epochs.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 18%">
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Submission</th>
<th style="text-align: left;">Description</th>
<th style="text-align: center;">Private Score</th>
<th style="text-align: center;">Public Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">initial submission file after creating a quick small model following Jeremy Howard’s walkthrough video.</td>
<td style="text-align: center;">0.13709</td>
<td style="text-align: center;">0.12418</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">initial submission using convnext small 2 epochs fine-tuned sorted file list</td>
<td style="text-align: center;">0.94124</td>
<td style="text-align: center;">0.92541</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">squish convnext small 12 epoch ft tta</td>
<td style="text-align: center;">0.98156</td>
<td style="text-align: center;">0.98308</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">ensemble small 12 epoch ft tta</td>
<td style="text-align: center;">0.98617</td>
<td style="text-align: center;">0.98423</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 12 epoch ft tta</td>
<td style="text-align: center;">0.97811</td>
<td style="text-align: center;">0.98039</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98502</td>
<td style="text-align: center;">0.98539</td>
</tr>
</tbody>
</table>
<p>During training, the model with the lowest error rate was convnext_large_in22k. I’ll weigh this model’s predictions more (by duplicating them twice more) so the ratio between this model’s predictions and the other models is 3:1, and see if that performs better.</p>
<div id="cell-105" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:36:46.141680Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:36:46.141305Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:36:46.145927Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:36:46.145050Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:36:46.141634Z&quot;}}" data-trusted="true" data-execution_count="34">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">+=</span> <span class="dv">2</span> <span class="op">*</span> [tta_res[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-106" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:36:46.841852Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:36:46.841241Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:36:46.848796Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:36:46.847804Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:36:46.841825Z&quot;}}" data-trusted="true" data-execution_count="35">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">3</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">4</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>(5, 3469, 3469, 3469, 3469, 3469)</code></pre>
</div>
</div>
<div id="cell-107" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:37:01.570211Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:37:01.569299Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:37:05.191388Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:37:05.190585Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:37:01.570176Z&quot;}}" data-trusted="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_ensemble3.csv'</span>, tta_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-108" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:37:08.825467Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:37:08.824574Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:37:09.776255Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:37:09.775107Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:37:08.825436Z&quot;}}" data-trusted="true" data-execution_count="37">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_ensemble3.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<p>This submission (#7) actually decreased both the public and private scores:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 18%">
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Submission</th>
<th style="text-align: left;">Description</th>
<th style="text-align: center;">Private Score</th>
<th style="text-align: center;">Public Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">initial submission file after creating a quick small model following Jeremy Howard’s walkthrough video.</td>
<td style="text-align: center;">0.13709</td>
<td style="text-align: center;">0.12418</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">initial submission using convnext small 2 epochs fine-tuned sorted file list</td>
<td style="text-align: center;">0.94124</td>
<td style="text-align: center;">0.92541</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">squish convnext small 12 epoch ft tta</td>
<td style="text-align: center;">0.98156</td>
<td style="text-align: center;">0.98308</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">ensemble small 12 epoch ft tta</td>
<td style="text-align: center;">0.98617</td>
<td style="text-align: center;">0.98423</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 12 epoch ft tta</td>
<td style="text-align: center;">0.97811</td>
<td style="text-align: center;">0.98039</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98502</td>
<td style="text-align: center;">0.98539</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: left;">swinv2 (3x convnext) vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98387</td>
<td style="text-align: center;">0.98423</td>
</tr>
</tbody>
</table>
<p>I’ll try 5 more submissions next:</p>
<ul>
<li>3:1 ratio between swinv2 and the other models</li>
<li>3:1 ratio between vit and the other models</li>
<li>large swinv2 only</li>
<li>large convnext only</li>
<li>large vit only</li>
</ul>
<div id="cell-111" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:45:15.454306Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:45:15.453812Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:45:15.466731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:45:15.465473Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:45:15.454270Z&quot;}}" data-trusted="true" data-execution_count="39">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># triple swinv2</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> load_pickle(<span class="st">'/kaggle/working/tta_res2.pkl'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">+=</span> <span class="dv">2</span> <span class="op">*</span> [tta_res[<span class="dv">0</span>]]</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">3</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">4</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>(5, 3469, 3469, 3469, 3469, 3469)</code></pre>
</div>
</div>
<div id="cell-112" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:45:45.195947Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:45:45.195109Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:45:47.762902Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:45:47.761889Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:45:45.195916Z&quot;}}" data-trusted="true" data-execution_count="40">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_ensemble4.csv'</span>, tta_res)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_ensemble4.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<div id="cell-113" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:48:59.470741Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:48:59.469669Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:48:59.481719Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:48:59.480851Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:48:59.470699Z&quot;}}" data-trusted="true" data-execution_count="41">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># triple vit</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> load_pickle(<span class="st">'/kaggle/working/tta_res2.pkl'</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">+=</span> <span class="dv">2</span> <span class="op">*</span> [tta_res[<span class="dv">2</span>]]</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">1</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">2</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">3</span>][<span class="dv">0</span>]), <span class="bu">len</span>(tta_res[<span class="dv">4</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>(5, 3469, 3469, 3469, 3469, 3469)</code></pre>
</div>
</div>
<div id="cell-114" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:49:08.910485Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:49:08.909715Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:49:11.558992Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:49:11.557961Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:49:08.910449Z&quot;}}" data-trusted="true" data-execution_count="42">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_ensemble5.csv'</span>, tta_res)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_ensemble5.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<div id="cell-115" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:51:50.969911Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:51:50.969384Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:51:50.978458Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:51:50.977551Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:51:50.969874Z&quot;}}" data-trusted="true" data-execution_count="45">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># large swinv2 only</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> load_pickle(<span class="st">'/kaggle/working/tta_res2.pkl'</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> [tta_res[<span class="dv">0</span>]]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>(1, 3469)</code></pre>
</div>
</div>
<div id="cell-116" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:51:53.529342Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:51:53.528573Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:51:56.216213Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:51:56.215185Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:51:53.529310Z&quot;}}" data-trusted="true" data-execution_count="46">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_swinv2.csv'</span>, tta_res)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_swinv2.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<div id="cell-117" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:52:56.874530Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:52:56.873617Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:52:56.883970Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:52:56.882998Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:52:56.874494Z&quot;}}" data-trusted="true" data-execution_count="47">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># large convnext only</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> load_pickle(<span class="st">'/kaggle/working/tta_res2.pkl'</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> [tta_res[<span class="dv">1</span>]]</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(1, 3469)</code></pre>
</div>
</div>
<div id="cell-118" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:53:10.781654Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:53:10.780759Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:53:13.295300Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:53:13.294117Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:53:10.781619Z&quot;}}" data-trusted="true" data-execution_count="48">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_convnext.csv'</span>, tta_res)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_convnext.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<div id="cell-119" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:53:56.255451Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:53:56.254507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:53:56.265347Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:53:56.264435Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:53:56.255413Z&quot;}}" data-trusted="true" data-execution_count="49">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># large vit only</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> load_pickle(<span class="st">'/kaggle/working/tta_res2.pkl'</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>tta_res <span class="op">=</span> [tta_res[<span class="dv">2</span>]]</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tta_res), <span class="bu">len</span>(tta_res[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>(1, 3469)</code></pre>
</div>
</div>
<div id="cell-120" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2024-01-11T21:54:11.478009Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-11T21:54:11.477646Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-11T21:54:14.032497Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-11T21:54:14.031483Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-11T21:54:11.477984Z&quot;}}" data-trusted="true" data-execution_count="50">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>prep_submission(<span class="st">'subm_large_vit.csv'</span>, tta_res)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head subm_large_vit.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label

200001.jpg,hispa

200002.jpg,normal

200003.jpg,blast

200004.jpg,blast

200005.jpg,blast

200006.jpg,brown_spot

200007.jpg,dead_heart

200008.jpg,brown_spot

200009.jpg,hispa</code></pre>
</div>
</div>
<p>Here is the final summary of the public and private scores for each submission:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 18%">
<col style="width: 27%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Submission</th>
<th style="text-align: left;">Description</th>
<th style="text-align: center;">Private Score</th>
<th style="text-align: center;">Public Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;">initial submission file after creating a quick small model following Jeremy Howard’s walkthrough video.</td>
<td style="text-align: center;">0.13709</td>
<td style="text-align: center;">0.12418</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;">initial submission using convnext small 2 epochs fine-tuned sorted file list</td>
<td style="text-align: center;">0.94124</td>
<td style="text-align: center;">0.92541</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;">squish convnext small 12 epoch ft tta</td>
<td style="text-align: center;">0.98156</td>
<td style="text-align: center;">0.98308</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;">ensemble small 12 epoch ft tta</td>
<td style="text-align: center;">0.98617*</td>
<td style="text-align: center;">0.98423</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 12 epoch ft tta</td>
<td style="text-align: center;">0.97811</td>
<td style="text-align: center;">0.98039</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: left;">swinv2 convnext vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98502</td>
<td style="text-align: center;">0.98539**</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: left;">swinv2 (3x convnext) vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98387</td>
<td style="text-align: center;">0.98423</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: left;">(3x swinv2) convnext vit large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98156</td>
<td style="text-align: center;">0.985</td>
</tr>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: left;">swinv2 convnext (3x vit) large ensemble 24 epoch ft tta</td>
<td style="text-align: center;">0.98617*</td>
<td style="text-align: center;">0.98462</td>
</tr>
<tr class="even">
<td style="text-align: center;">10</td>
<td style="text-align: left;">swinv2 large 24 epoch ft tta</td>
<td style="text-align: center;">0.98271</td>
<td style="text-align: center;">0.98269</td>
</tr>
<tr class="odd">
<td style="text-align: center;">11</td>
<td style="text-align: left;">convnext large 24 epoch ft tta</td>
<td style="text-align: center;">0.98502</td>
<td style="text-align: center;">0.98269</td>
</tr>
<tr class="even">
<td style="text-align: center;">12</td>
<td style="text-align: left;">vit large 24 epoch ft tta</td>
<td style="text-align: center;">0.97811</td>
<td style="text-align: center;">0.98231</td>
</tr>
</tbody>
</table>
<p>* largest private score</p>
<p>** largest public score</p>
<p>The two ensembles with the largest private score (0.98617) which I would therefore consider my best submissions:</p>
<ul>
<li>Three small models (swinv2, convnext, vit) trained for 12 epochs with predictions calculated using TTA.</li>
<li>Three large models (swinv2, convnext, vit) trained for 24 epochs with predictions calculated using TTA and with a weighted average using 3 times the vit model’s predictions.</li>
</ul>
<p>I would have expected the larger models trained on more epochs to have a higher private and public score than their smaller versions trained on half the number of epochs.</p>
<p>In my <a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-5/">next blog post</a> I walk through the discussion and code from Live Coding 12. I continue improving my large ensemble in <a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-7/">Part 7</a> of this blog post series.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/vishalbakshi\.github\.io\/blog");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>