<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2023-11-02">
<meta name="description" content="In this notebook I use 20 math reasoning dataset questions to prompt three 7B-parameter LLMs using 3 different prompting styles.">

<title>Prompting LLMs Using Different Prompting Styles – Vishal Bakshi’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9c1ae87ad5063dce4f793ccd314a7566.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#models-tested" id="toc-models-tested" class="nav-link" data-scroll-target="#models-tested">Models Tested</a></li>
  <li><a href="#prompting-styles" id="toc-prompting-styles" class="nav-link" data-scroll-target="#prompting-styles">Prompting Styles</a></li>
  </ul></li>
  <li><a href="#loading-and-trying-out-the-models" id="toc-loading-and-trying-out-the-models" class="nav-link" data-scroll-target="#loading-and-trying-out-the-models">Loading and Trying Out the Models</a>
  <ul class="collapse">
  <li><a href="#mistral-7b-instruct-v0.1" id="toc-mistral-7b-instruct-v0.1" class="nav-link" data-scroll-target="#mistral-7b-instruct-v0.1">Mistral-7B-Instruct-v0.1</a></li>
  <li><a href="#zephyr-7b-alpha" id="toc-zephyr-7b-alpha" class="nav-link" data-scroll-target="#zephyr-7b-alpha">zephyr-7b-alpha</a></li>
  <li><a href="#llama-2-7b-chat-hf" id="toc-llama-2-7b-chat-hf" class="nav-link" data-scroll-target="#llama-2-7b-chat-hf">Llama-2-7b-chat-hf</a></li>
  </ul></li>
  <li><a href="#testing-all-prompts" id="toc-testing-all-prompts" class="nav-link" data-scroll-target="#testing-all-prompts">Testing All Prompts</a>
  <ul class="collapse">
  <li><a href="#mistral-7b-instruct-v0.1-1" id="toc-mistral-7b-instruct-v0.1-1" class="nav-link" data-scroll-target="#mistral-7b-instruct-v0.1-1">Mistral-7B-Instruct-v0.1</a></li>
  <li><a href="#zephyr-7b-alpha-1" id="toc-zephyr-7b-alpha-1" class="nav-link" data-scroll-target="#zephyr-7b-alpha-1">zephyr-7b-alpha</a></li>
  <li><a href="#llama-2-7b-chat-hf-1" id="toc-llama-2-7b-chat-hf-1" class="nav-link" data-scroll-target="#llama-2-7b-chat-hf-1">Llama-2-7b-chat-hf</a></li>
  </ul></li>
  <li><a href="#grading-the-responses" id="toc-grading-the-responses" class="nav-link" data-scroll-target="#grading-the-responses">Grading the Responses</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prompting LLMs Using Different Prompting Styles</h1>
  <div class="quarto-categories">
    <div class="quarto-category">deep learning</div>
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    In this notebook I use 20 math reasoning dataset questions to prompt three 7B-parameter LLMs using 3 different prompting styles.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 2, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this notebook, I test the performance of different LLMs on a small set of samples from math reasoning datasets using zero-shot, zero-shot-Chain-of-Thought and Plan-and-Solve+ (PS+) prompting techniques. The purpose of this exercise is for me to get some practice prompting LLMs.</p>
<p>In <a href="http://vishalbakshi.com/blog/posts/2023-10-20-PS-Prompting/">a previous blog post</a>, I prompted questions from math reasoning datasets to different model chat interfaces (HuggingChat, Zephyr Chat and ChatGPT). However, when presenting these results to a fastai study group, one of the more experienced members noted that these model interfaces have built-in system prompts that will interfere with the prompts provided by the user. So, in order to get a sense of how these models perform without a system prompt, I decided to prompt these models directly using HuggingFace in this exercise.</p>
<section id="models-tested" class="level3">
<h3 class="anchored" data-anchor-id="models-tested">Models Tested</h3>
<p>I’ll test three models in this exercise:</p>
<ul>
<li><a href="https://huggingface.co/mistralai/Mistral-7B-Instruct-v0.1">Mistral-7B-Instruct-v0.1</a></li>
<li><a href="https://huggingface.co/HuggingFaceH4/zephyr-7b-alpha">zephyr-7b-alpha</a></li>
<li><a href="https://huggingface.co/meta-llama/Llama-2-7b-chat-hf">Llama-2-7b-chat-hf</a></li>
</ul>
</section>
<section id="prompting-styles" class="level3">
<h3 class="anchored" data-anchor-id="prompting-styles">Prompting Styles</h3>
<p>I’ll show an example of the three different prompting styles that I’ll use for this evaluation.</p>
<section id="zero-shot" class="level4">
<h4 class="anchored" data-anchor-id="zero-shot">Zero-shot</h4>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: The answer is</p>
</blockquote>
</section>
<section id="zero-shot-chain-of-thought" class="level4">
<h4 class="anchored" data-anchor-id="zero-shot-chain-of-thought">Zero-shot-Chain-of-Thought</h4>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: Let’s think step by step.</p>
</blockquote>
</section>
<section id="ps" class="level4">
<h4 class="anchored" data-anchor-id="ps">PS+</h4>
<blockquote class="blockquote">
<p>Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</p>
<p>A: Let’s first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let’s carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</p>
</blockquote>
</section>
</section>
</section>
<section id="loading-and-trying-out-the-models" class="level2">
<h2 class="anchored" data-anchor-id="loading-and-trying-out-the-models">Loading and Trying Out the Models</h2>
<p>I’ll start by loading each model and testing out a prompt for each manually:</p>
<p>::: {#cell-5 .cell _cell_guid=‘b1076dfc-b9ad-4769-8c92-a6c4dae69d19’ _uuid=‘8f2839f25d086af736a60e9eeb907d3b93b6e0e5’ quarto-private-1=‘{“key”:“execution”,“value”:{“iopub.execute_input”:“2023-10-31T01:58:45.248095Z”,“iopub.status.busy”:“2023-10-31T01:58:45.247784Z”,“iopub.status.idle”:“2023-10-31T01:59:51.608104Z”,“shell.execute_reply”:“2023-10-31T01:59:51.607351Z”,“shell.execute_reply.started”:“2023-10-31T01:58:45.248068Z”}}’ scrolled=‘true’ trusted=‘true’}</p>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install git<span class="op">+</span>https:<span class="op">//</span>github.com<span class="op">/</span>huggingface<span class="op">/</span>transformers.git huggingface_hub</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> huggingface_hub <span class="im">import</span> notebook_login</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd, torch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<div id="cell-6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:00:37.011164Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:00:37.010338Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:00:37.034535Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:00:37.033556Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:00:37.011129Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>notebook_login()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mistral-7b-instruct-v0.1" class="level3">
<h3 class="anchored" data-anchor-id="mistral-7b-instruct-v0.1">Mistral-7B-Instruct-v0.1</h3>
<div id="cell-8" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T00:45:54.662187Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T00:45:54.661813Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T00:47:58.585462Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T00:47:58.584617Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T00:45:54.662156Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"mistralai/Mistral-7B-Instruct-v0.1"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T00:48:01.125465Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T00:48:01.125115Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T00:48:22.848744Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T00:48:22.847769Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T00:48:01.125434Z&quot;}}" data-outputid="d3f6d4f9-820e-4bb5-d93d-d7d8161384f4" data-trusted="true">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>},</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(messages, tokenize<span class="op">=</span><span class="va">False</span>, add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> pipe(prompt, max_new_tokens<span class="op">=</span><span class="dv">256</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span><span class="fl">0.7</span>, top_k<span class="op">=</span><span class="dv">50</span>, top_p<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting `pad_token_id` to `eos_token_id`:2 for open-end generation.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;s&gt;[INST] 
Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?

A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.
 [/INST] Plan:

1. Extract the relevant variables and their corresponding numerals.
2. Devise a plan to solve the problem.
3. Carry out the plan and calculate intermediate results.
4. Solve the problem step by step.
5. Show the answer.

Solution:

1. Variables and their corresponding numerals:
- Total bill (T)
- Number of people (N)
- Payment per person (P)

2. Plan:
We need to determine the total bill (T) based on the number of people (N) and the payment per person (P). We can use the following equation:

T = P * N

3. Carrying out the plan and calculating intermediate results:
We are given the payment per person (P) as 45 dollars. We need to find the total bill (T) by multiplying the payment per person by the number of people. We are also given the number of people (N) as Sally, Sam, and Alyssa.

T = 45 * N

4. Solving the problem step by step:
We can substitute the given values into the equation</code></pre>
</div>
</div>
</section>
<section id="zephyr-7b-alpha" class="level3">
<h3 class="anchored" data-anchor-id="zephyr-7b-alpha">zephyr-7b-alpha</h3>
<div id="cell-11" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:30:37.206645Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:30:37.206247Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:33:12.461735Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:33:12.460554Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:30:37.206607Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"HuggingFaceH4/zephyr-7b-alpha"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:33:33.861590Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:33:33.860852Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:33:52.378077Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:33:52.376373Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:33:33.861542Z&quot;}}" data-outputid="1d2c6e87-786a-4b0c-e284-6dacd50bb06b" data-trusted="true">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>},</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(messages, tokenize<span class="op">=</span><span class="va">False</span>, add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> pipe(prompt, max_new_tokens<span class="op">=</span><span class="dv">256</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span><span class="fl">0.7</span>, top_k<span class="op">=</span><span class="dv">50</span>, top_p<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/transformers/generation/utils.py:1473: UserWarning: You have modified the pretrained model configuration to control generation. This is a deprecated strategy to control generation and will be removed soon, in a future version. Please use and modify the model generation configuration (see https://huggingface.co/docs/transformers/generation_strategies#default-text-generation-configuration )
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;|user|&gt;

Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?

A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.
&lt;/s&gt;
&lt;|assistant|&gt;
Let's assume the total bill is x.

Each person paid 45 dollars, so each person's share of the bill is 45.

If the total bill is x, then the sum of each person's share is also x, as each person's share is one-third of the total bill.

Therefore, we have:

x = 45 + 45 + 45 (the sum of each person's share)

x = 135 (the total bill)

So the total bill was $135.

In summary, we identified the variables (total bill and each person's share), calculated intermediate results (total of each person's share), and solved the problem by setting up an equation and calculating the total bill.</code></pre>
</div>
</div>
</section>
<section id="llama-2-7b-chat-hf" class="level3">
<h3 class="anchored" data-anchor-id="llama-2-7b-chat-hf">Llama-2-7b-chat-hf</h3>
<div id="cell-14" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:00:57.538186Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:00:57.537507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:04:51.010113Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:04:51.009341Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:00:57.538153Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"meta-llama/Llama-2-7b-chat-hf"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:05:07.201844Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:05:07.201492Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:05:26.665231Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:05:26.664031Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:05:07.201819Z&quot;}}" data-outputid="311669a4-c91c-4a44-a913-26aebaa62b8d" data-trusted="true">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> [</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>},</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(messages, tokenize<span class="op">=</span><span class="va">False</span>, add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> pipe(prompt, max_new_tokens<span class="op">=</span><span class="dv">256</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span><span class="fl">0.7</span>, top_k<span class="op">=</span><span class="dv">50</span>, top_p<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;s&gt;[INST] Q: After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid 45 dollars, what was the total of the bill?

A: Let's first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let's carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer. [/INST]  Great, let's dive into the problem!

After eating at the restaurant, Sally, Sam, and Alyssa decided to divide the bill evenly. If each person paid $45, what was the total of the bill?

To solve this problem, we need to identify the variables involved and determine their values. Let's do this by breaking down the information given in the problem:

Variables:

* Sally
* Sam
* Alyssa
* Total bill

Values:

* Sally paid $45
* Sam paid $45
* Alyssa paid $45
* Total bill = $45 + $45 + $45 = $135

Now, let's put this information together to find the total of the bill:

Total bill = $135

So, the total of the bill was $135.

Let me know if you have any questions or if you'd like me to explain the steps in more detail!</code></pre>
</div>
</div>
</section>
</section>
<section id="testing-all-prompts" class="level2">
<h2 class="anchored" data-anchor-id="testing-all-prompts">Testing All Prompts</h2>
<p>I have entered 20 questions (from the Appendix of the paper <a href="https://arxiv.org/pdf/2305.04091.pdf">Plan-and-Solve Prompting: Improving Zero-Shot Chain-of-Thought Reasoning by Large Language Models</a> (Lei Wang, et al)) into a CSV file:</p>
<div id="cell-18" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:05:56.425832Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:05:56.425099Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:05:56.483103Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:05:56.482192Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:05:56.425799Z&quot;}}" data-outputid="a9d5dac8-77a6-442d-f14a-1a3a4f506fde" data-trusted="true">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"/kaggle/input/questions5/questions.csv"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To prepare the questions for the prompts, I’ll prepend each question with <code>"Q:"</code> and append each question with <code>"\n\nA: &lt;instruction&gt;"</code> where <code>&lt;instruction&gt;</code> is the given instruction based on the type of prompt I’m constructing. For example, for Zero-shot prompting:</p>
<div id="cell-20" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:05:59.425434Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:05:59.424618Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:05:59.432070Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:05:59.431034Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:05:59.425397Z&quot;}}" data-outputid="ddaa5b23-1a02-448c-f3c4-e54c0c9a211e" data-trusted="true">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">"Q: "</span> <span class="op">+</span> df.question[<span class="dv">1</span>] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">A: The answer is"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>'Q: If 27 bottles of soda cost A cents, how much will B bottles cost in dollars? Answer Choices: (A) AB/2700 (B) 27/AB (C) AB/270 (D) 2700/AB (E) 100AB/27\n\nA: The answer is'</code></pre>
</div>
</div>
<p>I’ll use the same parameters for these models as the official chat interfaces published by the model authors.</p>
<p>I’ll also create a copy of the <code>DataFrame</code> with questions in order to populate responses for each model.</p>
<div id="cell-23" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:02.661508Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:02.660642Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:02.681298Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:02.680499Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:02.661475Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [<span class="st">'Mistral-7B-Instruct-v0.1'</span>, <span class="st">'zephyr-7b-alpha'</span>, <span class="st">'Llama-2-7b-chat-hf'</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>prompting_styles <span class="op">=</span> [<span class="st">'Zero-shot'</span>, <span class="st">'Zero-shot-CoT'</span>, <span class="st">'PS+'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> model_names:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    model_dfs <span class="op">=</span> []</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> style <span class="kw">in</span> prompting_styles:</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create a DataFrame for each prompting style</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        temp_df <span class="op">=</span> df.copy()</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        temp_df[<span class="st">'model'</span>] <span class="op">=</span> name</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        temp_df[<span class="st">'prompting_style'</span>] <span class="op">=</span> style</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        temp_df[<span class="st">'response'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        model_dfs.append(temp_df)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame for each model and store in a list</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> pd.concat(model_dfs)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    dfs.append(model_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I now have three <code>DataFrames</code>, one for each of my models, and each with 20 rows of questions for each prompting style.</p>
<div id="cell-25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:06.037488Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:06.036739Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:06.048920Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:06.048015Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:06.037455Z&quot;}}" data-outputid="4f52390d-e740-4955-f55c-8651a688e79d" data-trusted="true">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-26" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:08.946434Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:08.945580Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:08.957734Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:08.956855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:08.946403Z&quot;}}" data-outputid="b51cace5-5af2-478f-921a-b9a98b9b4d13" data-trusted="true">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-27" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:10.567450Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:10.567072Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:10.580253Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:10.579286Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:10.567421Z&quot;}}" data-outputid="476305a9-ca74-4343-b158-a68388d1134d" data-trusted="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>None</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There should be three instances of each question, one for each prompting style:</p>
<div id="cell-29" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:12.641697Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:12.641331Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:12.666889Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:12.666012Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:12.641669Z&quot;}}" data-outputid="8cddf533-731c-4827-a73a-99fd8e658005" data-trusted="true">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].groupby(dfs[<span class="dv">0</span>].question).count()[<span class="st">'dataset'</span>].unique(),<span class="op">\</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].groupby(dfs[<span class="dv">1</span>].question).count()[<span class="st">'dataset'</span>].unique(),<span class="op">\</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].groupby(dfs[<span class="dv">2</span>].question).count()[<span class="st">'dataset'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(array([3]), array([3]), array([3]))</code></pre>
</div>
</div>
<p>Each model’s <code>DataFrame</code> should have 20 rows for each of the three prompting styles:</p>
<div id="cell-31" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:14.506187Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:14.505571Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:14.518804Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:14.517894Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:14.506156Z&quot;}}" data-outputid="22028467-84ac-494c-a4e2-1a14f24086a0" data-trusted="true">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].groupby(dfs[<span class="dv">0</span>].prompting_style).count()[<span class="st">'dataset'</span>].unique(),<span class="op">\</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].groupby(dfs[<span class="dv">1</span>].prompting_style).count()[<span class="st">'dataset'</span>].unique(),<span class="op">\</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].groupby(dfs[<span class="dv">2</span>].prompting_style).count()[<span class="st">'dataset'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(array([20]), array([20]), array([20]))</code></pre>
</div>
</div>
<p>And finally, I’ll check that each <code>DataFrame</code> should have <code>Zero-shot</code>, <code>Zero-shot-CoT</code> and <code>PS+</code> as the prompting styles:</p>
<div id="cell-33" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:16.205169Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:16.204556Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:16.213905Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:16.213021Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:16.205138Z&quot;}}" data-outputid="58f8ed82-4198-4f17-df0b-9ef9ce84e843" data-trusted="true">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].prompting_style.unique(),<span class="op">\</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].prompting_style.unique(),<span class="op">\</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].prompting_style.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(array(['Zero-shot', 'Zero-shot-CoT', 'PS+'], dtype=object),
 array(['Zero-shot', 'Zero-shot-CoT', 'PS+'], dtype=object),
 array(['Zero-shot', 'Zero-shot-CoT', 'PS+'], dtype=object))</code></pre>
</div>
</div>
<p>Finally, I’ll create a dictionary to lookup the instruction for a given prompting style, to append to the question in the prompt:</p>
<div id="cell-35" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:21.834812Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:21.833942Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:21.839477Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:21.838260Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:21.834779Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>instructions <span class="op">=</span> {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-shot'</span>: <span class="st">'The answer is'</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Zero-shot-CoT'</span>: <span class="st">"Let's think step by step."</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PS+'</span>: <span class="st">"Let’s first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let’s carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer."</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:06:23.037840Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:06:23.037063Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:06:23.043521Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:06:23.042632Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:06:23.037809Z&quot;}}" data-outputid="4950266b-4430-48f3-fb39-631832dce376" data-trusted="true">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>instructions[<span class="st">'PS+'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>'Let’s first understand the problem, extract relevant variables and their corresponding numerals, and devise a plan. Then, let’s carry out the plan, calculate intermediate results (pay attention to calculation and common sense), solve the problem step by step, and show the answer.'</code></pre>
</div>
</div>
<p>With my <code>DataFrame</code>s with questions and prompting styles ready, I can prompt the models one at a time. The Kaggle GPUs were running out of memory if I tried to load more than one of these models, so I have to create a new session for each model run. I export the model responses into a CSV before stopping the session so I can combine all models’ responses into one <code>DataFrame</code> at the end to analyze the results.</p>
<section id="mistral-7b-instruct-v0.1-1" class="level3">
<h3 class="anchored" data-anchor-id="mistral-7b-instruct-v0.1-1">Mistral-7B-Instruct-v0.1</h3>
<div id="cell-39" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-26T02:41:55.943407Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-26T02:41:55.942708Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-26T02:45:03.065676Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-26T02:45:03.064889Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-26T02:41:55.943372Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"mistralai/Mistral-7B-Instruct-v0.1"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T00:51:25.118361Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T00:51:25.117968Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:01:48.495156Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:01:48.494187Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T00:51:25.118327Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dfs[<span class="dv">0</span>])):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Q: "</span> <span class="op">+</span> dfs[<span class="dv">0</span>].question.iloc[i] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">A: "</span> <span class="op">+</span> instructions[dfs[<span class="dv">0</span>].prompting_style.iloc[i]] }</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> pipe(</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        prompt,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span> <span class="dv">2048</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        top_p<span class="op">=</span> <span class="fl">0.95</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        repetition_penalty<span class="op">=</span> <span class="fl">1.2</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        top_k<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        return_full_text<span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    dfs[<span class="dv">0</span>].response.iloc[i] <span class="op">=</span> outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:14:34.473193Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:14:34.472820Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:14:34.485419Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:14:34.484264Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:14:34.473161Z&quot;}}" data-outputid="2a893f1b-93b0-41df-d1e7-7efd0b797249" data-trusted="true">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>To solve this problem, we need to use the for...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>To convert the number of bottles from one uni...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>To find out how many total meters James runs ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>Let's break down this problem step by step:\n...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>33 extra apples.\n\nHere's the reasoning behi...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-42" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:14:40.676951Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:14:40.676194Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:14:40.684502Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:14:40.683732Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:14:40.676917Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">0</span>].to_csv(<span class="st">'mistral_responses.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="zephyr-7b-alpha-1" class="level3">
<h3 class="anchored" data-anchor-id="zephyr-7b-alpha-1">zephyr-7b-alpha</h3>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-26T03:52:01.499151Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-26T03:52:01.498167Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-26T03:53:38.275582Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-26T03:53:38.273670Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-26T03:52:01.499108Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"HuggingFaceH4/zephyr-7b-alpha"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:35:15.706124Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:35:15.705310Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:56:52.713160Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:56:52.712048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:35:15.706087Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dfs[<span class="dv">1</span>])):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Q: "</span> <span class="op">+</span> dfs[<span class="dv">1</span>].question.iloc[i] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">A: "</span> <span class="op">+</span> instructions[dfs[<span class="dv">1</span>].prompting_style.iloc[i]] }</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> pipe(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        prompt,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span> <span class="fl">0.7</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span> <span class="dv">1024</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        top_p<span class="op">=</span> <span class="fl">0.95</span>,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        repetition_penalty<span class="op">=</span> <span class="fl">1.2</span>,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        top_k<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>        return_full_text<span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    dfs[<span class="dv">1</span>].response.iloc[i] <span class="op">=</span> outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-46" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:57:08.182012Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:57:08.181142Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:57:08.194052Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:57:08.193050Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:57:08.181952Z&quot;}}" data-outputid="465f803b-b29c-4043-9445-edf369bd895d" data-trusted="true">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>The total earnings for the first seven days ar...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>(A) AB/2700 \n\nExplanation: Let's say the pri...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>James runs 3 sprints of 60 meters each, three ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>Let's calculate this using math:\n\nFirstly, l...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>Let's calculate the total number of apples (re...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-47" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T01:57:12.711726Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T01:57:12.710814Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T01:57:12.736529Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T01:57:12.735606Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T01:57:12.711691Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">1</span>].to_csv(<span class="st">'zephyr_responses.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="llama-2-7b-chat-hf-1" class="level3">
<h3 class="anchored" data-anchor-id="llama-2-7b-chat-hf-1">Llama-2-7b-chat-hf</h3>
<div id="cell-49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-26T03:57:31.429215Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-26T03:57:31.428839Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-26T03:59:16.362191Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-26T03:59:16.361350Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-26T03:57:31.429183Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span><span class="st">"meta-llama/Llama-2-7b-chat-hf"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.bfloat16,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:07:09.615218Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:07:09.614436Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:21:47.599571Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:21:47.598443Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:07:09.615187Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(dfs[<span class="dv">2</span>])):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: <span class="st">"Q: "</span> <span class="op">+</span> dfs[<span class="dv">2</span>].question.iloc[i] <span class="op">+</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">A: "</span> <span class="op">+</span> instructions[dfs[<span class="dv">2</span>].prompting_style.iloc[i]] }</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    pipe.use_default_system_prompt <span class="op">=</span> <span class="va">False</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> pipe.tokenizer.apply_chat_template(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> pipe(</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        prompt,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        do_sample<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        temperature<span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span> <span class="dv">1024</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        top_p<span class="op">=</span> <span class="fl">0.95</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        repetition_penalty<span class="op">=</span> <span class="fl">1.2</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        top_k<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        return_full_text<span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    dfs[<span class="dv">2</span>].response.iloc[i] <span class="op">=</span> outputs[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:22:05.689688Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:22:05.689300Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:22:05.701673Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:22:05.700579Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:22:05.689658Z&quot;}}" data-outputid="0a567d36-014d-4fe9-d2ca-faab582b78c6" data-trusted="true">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AQuA</td>
<td>The average wages of a worker during a fortnig...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>To find the wage of the worker on the 8th da...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AQuA</td>
<td>If 27 bottles of soda cost A cents, how much w...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>To find the cost of B bottles in dollars, we...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>GSM8K</td>
<td>James decides to run 3 sprints 3 times a week....</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>To find out how many total meters James runs...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>GSM8K</td>
<td>In a dance class of 20 students, 20% enrolled ...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>To find out what percentage of the entire gr...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MultiArith</td>
<td>The school cafeteria ordered 42 red apples and...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>Great question! To find out how many extra a...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-52" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:22:08.986975Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:22:08.986082Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:22:08.999454Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:22:08.998661Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:22:08.986918Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dfs[<span class="dv">2</span>].to_csv(<span class="st">'llama2_responses.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="grading-the-responses" class="level2">
<h2 class="anchored" data-anchor-id="grading-the-responses">Grading the Responses</h2>
<p>I really liked the way Johnathan Whitaker (on the Data Science Castnet YouTube channel) used gradio as a tool to check responses from an LLM, so I’m using the approach from <a href="https://colab.research.google.com/drive/1pXk9cbahwmtb0ultmnjGSmABjogYzDKt?usp=sharing#scrollTo=d99wEgr0rc-7">his notebook</a> below.</p>
<p>For each row of data, the gradio app displays the question, response and two buttons (“Correct” and “Incorrect”). If the answer is correct, I’ll press “Correct” and the <code>is_correct</code> column value will be set to <code>1</code>. If it’s not, I’ll press “Incorrect” and <code>is_correct</code> will stay <code>0</code>.</p>
<div id="cell-55" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T02:56:26.138818Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T02:56:26.137866Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T02:56:46.400728Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T02:56:46.399668Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T02:56:26.138779Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install gradio (quick fix for install error on colab)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> locale</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>locale.getpreferredencoding <span class="op">=</span> <span class="kw">lambda</span>: <span class="st">"UTF-8"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>q gradio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll load the three CSVs (each with responses for 3 prompting styles across 20 questions from each model) into a single <code>DataFrame</code>, and sort it by the <code>question</code> column so it’s easier for me to grade the responses.</p>
<div id="cell-57" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T03:04:15.535619Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T03:04:15.534982Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T03:04:15.545883Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T03:04:15.544994Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T03:04:15.535587Z&quot;}}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gradio <span class="im">as</span> gr, pandas <span class="im">as</span> pd</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [<span class="st">'llama2_responses.csv'</span>, <span class="st">'mistral_responses.csv'</span>, <span class="st">'zephyr_responses.csv'</span>]</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> pd.read_csv(<span class="bu">file</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> df.drop(<span class="st">'Unnamed: 0'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  df[<span class="st">'is_correct'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  dfs.append(df)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sort by question so it's easier to grade</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(by<span class="op">=</span>[<span class="st">'question'</span>])</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T03:04:16.237348Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T03:04:16.236733Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T03:04:16.249585Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T03:04:16.248609Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T03:04:16.237313Z&quot;}}" data-outputid="20cf3fca-6b18-44a2-ab7a-7b230533734e" data-trusted="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div id="df-70e490b3-af52-4560-a200-3aa3232c10c5" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">question</th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">prompting_style</th>
<th data-quarto-table-cell-role="th">response</th>
<th data-quarto-table-cell-role="th">is_correct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Coin Flip</td>
<td>'A coin is heads up. Lorena does not flip the ...</td>
<td>zephyr-7b-alpha</td>
<td>PS+</td>
<td>Problem understanding:\n- The question asks wh...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Coin Flip</td>
<td>'A coin is heads up. Lorena does not flip the ...</td>
<td>zephyr-7b-alpha</td>
<td>Zero-shot</td>
<td>Yes, according to the given scenario, since no...</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Coin Flip</td>
<td>'A coin is heads up. Lorena does not flip the ...</td>
<td>Llama-2-7b-chat-hf</td>
<td>Zero-shot</td>
<td>No, the coin is no longer heads up. Since no...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Coin Flip</td>
<td>'A coin is heads up. Lorena does not flip the ...</td>
<td>Mistral-7B-Instruct-v0.1</td>
<td>Zero-shot</td>
<td>Yes, the coin is still heads up.\n\nHere's th...</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Coin Flip</td>
<td>'A coin is heads up. Lorena does not flip the ...</td>
<td>Llama-2-7b-chat-hf</td>
<td>PS+</td>
<td>Great! Let's tackle this problem together. H...</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-70e490b3-af52-4560-a200-3aa3232c10c5')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-70e490b3-af52-4560-a200-3aa3232c10c5 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-70e490b3-af52-4560-a200-3aa3232c10c5');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-33f5eb18-10fd-457c-ad63-b69fe5296789">
  <button class="colab-df-quickchart" onclick="quickchart('df-33f5eb18-10fd-457c-ad63-b69fe5296789')" title="Suggest charts." style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-33f5eb18-10fd-457c-ad63-b69fe5296789 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>
</div>
</div>
<p>The gradio app consists of a <code>Textbox</code> which will display the text of the question and response. I’ll modify the existing <code>get_text</code> function, which takes an index and returns a concatenated string.</p>
<p>The <code>label</code> function is called when the user clicks either of the buttons. If the button clicked has a value of <code>"Correct"</code> then the <code>choice</code> parameter will be <code>"correct"</code> and the <code>is_correct</code> column will be set to <code>1</code>. The <code>label</code> function returns the next index and string to display.</p>
<div id="cell-60" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T03:04:05.030898Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T03:04:05.030480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T03:04:05.037054Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T03:04:05.036012Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T03:04:05.030869Z&quot;}}" data-trusted="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_text(idx):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Combine the question and answer into a single string """</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> df</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">'Q: '</span> <span class="op">+</span> df.iloc[idx][<span class="st">'question'</span>] <span class="op">+</span> <span class="st">'</span><span class="ch">\n\n</span><span class="st">A: '</span> <span class="op">+</span> df.iloc[idx][<span class="st">'response'</span>]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> label(idx, choice<span class="op">=</span><span class="st">'correct'</span>):</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Set `is_correct` column to `1` if response is correct """</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> choice <span class="op">==</span> <span class="st">'correct'</span>:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        df.loc[idx, <span class="st">'is_correct'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> idx<span class="op">+</span><span class="dv">1</span>, get_text(idx<span class="op">+</span><span class="dv">1</span>) <span class="co"># Move on to next one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to avoid the gradio app from timing out, I have called <code>queue</code> on the <code>demo</code> object before I <code>launch</code> it.</p>
<div id="cell-62" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2023-10-31T03:04:55.089579Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-10-31T03:04:55.089210Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-10-31T03:05:07.988781Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-10-31T03:05:07.987874Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-10-31T03:04:55.089552Z&quot;}}" data-trusted="true">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> gr.Blocks() <span class="im">as</span> demo:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    starting_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> gr.Column():</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> gr.Slider(value<span class="op">=</span>starting_idx, label<span class="op">=</span><span class="st">"idx"</span>) <span class="co"># Progress bar, borrowed the idea from https://www.kaggle.com/code/nbroad/create-science-wikipedia-dataset</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> gr.Textbox(value<span class="op">=</span>get_text(<span class="dv">0</span>), label<span class="op">=</span><span class="st">"text"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> gr.Row():</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        correct_btn <span class="op">=</span> gr.Button(value<span class="op">=</span><span class="st">"Correct"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        incorrect_btn <span class="op">=</span> gr.Button(value<span class="op">=</span><span class="st">"Incorrect"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    correct_btn.click(fn<span class="op">=</span>partial(label, choice<span class="op">=</span><span class="st">'correct'</span>), inputs<span class="op">=</span>[idx], outputs<span class="op">=</span>[idx, text])</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    incorrect_btn.click(fn<span class="op">=</span>partial(label, choice<span class="op">=</span><span class="st">'incorrect'</span>), inputs<span class="op">=</span>[idx], outputs<span class="op">=</span>[idx, text])</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">#demo.launch(debug=True, show_error=True)</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>demo.queue().launch(share<span class="op">=</span><span class="va">True</span>, show_error<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is an example of what the gradio app looks like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gradio_app.png" class="img-fluid figure-img"></p>
<figcaption>A screenshot of my gradio app used to grade LLM responses</figcaption>
</figure>
</div>
<div id="cell-65" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'graded_responses.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>With all of the model responses graded, I can now calculate the percentage of correct responses from each model for each dataset and prompting style.</p>
<div id="cell-68" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="38a5cc7d-698a-49cb-dafd-33d6b7cb8fc1" data-execution_count="28">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">'model'</span>, <span class="st">'prompting_style'</span>])[<span class="st">'is_correct'</span>].mean() <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>model                     prompting_style
Llama-2-7b-chat-hf        PS+                25.0
                          Zero-shot          45.0
                          Zero-shot-CoT      30.0
Mistral-7B-Instruct-v0.1  PS+                60.0
                          Zero-shot          60.0
                          Zero-shot-CoT      45.0
zephyr-7b-alpha           PS+                30.0
                          Zero-shot          45.0
                          Zero-shot-CoT      45.0
Name: is_correct, dtype: float64</code></pre>
</div>
</div>
<p>Overall, the best performing model and prompting style (60% correct) was the Mistral-7B-Instruct-v0.1 model using the PS+ and Zero-shot prompting styles. Mistral was the only model where PS+ outperformed Zero-shot and Zero-shot-CoT.</p>
<div id="cell-70" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="2e941153-7dce-4162-9b43-3478a5afdc7f" data-execution_count="29">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">'model'</span>])[<span class="st">'is_correct'</span>].mean() <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>model
Llama-2-7b-chat-hf          33.333333
Mistral-7B-Instruct-v0.1    55.000000
zephyr-7b-alpha             40.000000
Name: is_correct, dtype: float64</code></pre>
</div>
</div>
<p>Overall the best performing model across all prompting styles was Mistral (55%) following by Zephyr (40%) and Llama-2 coming in last at 33.33%.</p>
<div id="cell-72" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="50de3b09-7526-40da-cede-382af76e41c4" data-execution_count="30">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.groupby([<span class="st">'dataset'</span>])[<span class="st">'is_correct'</span>].mean() <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>dataset
AQuA             5.555556
AddSub          77.777778
CSQA            27.777778
Coin Flip       77.777778
GSM8K           50.000000
Last Letters     0.000000
MultiArith      38.888889
SVAMP           77.777778
SingleEq        72.222222
StrategyQA       0.000000
Name: is_correct, dtype: float64</code></pre>
</div>
</div>
<p>Across all models and prompting styles, the highest performing datasets (78% correct) were AddSub, Coin Flip and SVAMP. The lowest performing datasets (0% correct) were Last Letters and StrategyQA.</p>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>I want to reiterate that the purpose of this exercise for me to get some practice prompting LLMs. I also got some experience setting up a gradio app to help me evaluate the responses of the models.</p>
<p>Given the small sample size for each model (20 questions and responses for each prompting style) I don’t think these results can be used to conclude anything about the performance of these prompting styles and models. Yes, Mistral and Zephyr out-performed Llama-2 on these 20 questions across these 3 particular prompting styles, but testing the models on another thousand questions might yield different results.</p>
<p>I hope you enjoyed this blog post!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/vishalbakshi\.github\.io\/blog");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>