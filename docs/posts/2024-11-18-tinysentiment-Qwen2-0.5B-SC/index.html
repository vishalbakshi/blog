<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-11-18">
<meta name="description" content="In this blog post I use Qwen2-0.5B-Instruct to classify sentiment in the financial_phrasebank dataset with 79.5% accuracy.">

<title>Vishal Bakshi’s Blog - Sentiment Classification with Qwen2-0.5B-Instruct</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#prompt-a" id="toc-prompt-a" class="nav-link" data-scroll-target="#prompt-a">Prompt A</a></li>
  <li><a href="#prompt-b" id="toc-prompt-b" class="nav-link" data-scroll-target="#prompt-b">Prompt B</a></li>
  <li><a href="#prompt-c" id="toc-prompt-c" class="nav-link" data-scroll-target="#prompt-c">Prompt C</a></li>
  <li><a href="#prompt-d" id="toc-prompt-d" class="nav-link" data-scroll-target="#prompt-d">Prompt D</a></li>
  <li><a href="#prompt-e" id="toc-prompt-e" class="nav-link" data-scroll-target="#prompt-e">Prompt E</a></li>
  <li><a href="#prompt-f" id="toc-prompt-f" class="nav-link" data-scroll-target="#prompt-f">Prompt F</a></li>
  <li><a href="#prompt-g" id="toc-prompt-g" class="nav-link" data-scroll-target="#prompt-g">Prompt G</a></li>
  <li><a href="#prompt-h" id="toc-prompt-h" class="nav-link" data-scroll-target="#prompt-h">Prompt H</a></li>
  <li><a href="#prompt-i" id="toc-prompt-i" class="nav-link" data-scroll-target="#prompt-i">Prompt I</a></li>
  <li><a href="#prompt-j" id="toc-prompt-j" class="nav-link" data-scroll-target="#prompt-j">Prompt J</a></li>
  <li><a href="#prompt-k" id="toc-prompt-k" class="nav-link" data-scroll-target="#prompt-k">Prompt K</a></li>
  <li><a href="#prompt-l" id="toc-prompt-l" class="nav-link" data-scroll-target="#prompt-l">Prompt L</a></li>
  <li><a href="#prompt-m" id="toc-prompt-m" class="nav-link" data-scroll-target="#prompt-m">Prompt M</a></li>
  <li><a href="#prompt-n" id="toc-prompt-n" class="nav-link" data-scroll-target="#prompt-n">Prompt N</a></li>
  <li><a href="#prompt-o" id="toc-prompt-o" class="nav-link" data-scroll-target="#prompt-o">Prompt O</a></li>
  <li><a href="#prompt-p" id="toc-prompt-p" class="nav-link" data-scroll-target="#prompt-p">Prompt P</a></li>
  <li><a href="#prompt-q" id="toc-prompt-q" class="nav-link" data-scroll-target="#prompt-q">Prompt Q</a></li>
  <li><a href="#prompt-r" id="toc-prompt-r" class="nav-link" data-scroll-target="#prompt-r">Prompt R</a></li>
  <li><a href="#prompt-s" id="toc-prompt-s" class="nav-link" data-scroll-target="#prompt-s">Prompt S</a></li>
  <li><a href="#prompt-t" id="toc-prompt-t" class="nav-link" data-scroll-target="#prompt-t">Prompt T</a></li>
  <li><a href="#prompt-u" id="toc-prompt-u" class="nav-link" data-scroll-target="#prompt-u">Prompt U</a></li>
  <li><a href="#prompt-v" id="toc-prompt-v" class="nav-link" data-scroll-target="#prompt-v">Prompt V</a></li>
  <li><a href="#prompt-w" id="toc-prompt-w" class="nav-link" data-scroll-target="#prompt-w">Prompt W</a></li>
  <li><a href="#prompt-x" id="toc-prompt-x" class="nav-link" data-scroll-target="#prompt-x">Prompt X</a></li>
  <li><a href="#prompt-y" id="toc-prompt-y" class="nav-link" data-scroll-target="#prompt-y">Prompt Y</a></li>
  <li><a href="#prompt-z" id="toc-prompt-z" class="nav-link" data-scroll-target="#prompt-z">Prompt Z</a></li>
  <li><a href="#prompt-aa" id="toc-prompt-aa" class="nav-link" data-scroll-target="#prompt-aa">Prompt AA</a></li>
  <li><a href="#prompt-ab" id="toc-prompt-ab" class="nav-link" data-scroll-target="#prompt-ab">Prompt AB</a></li>
  <li><a href="#prompt-ac" id="toc-prompt-ac" class="nav-link" data-scroll-target="#prompt-ac">Prompt AC</a></li>
  <li><a href="#prompt-ad" id="toc-prompt-ad" class="nav-link" data-scroll-target="#prompt-ad">Prompt AD</a></li>
  <li><a href="#prompt-ae" id="toc-prompt-ae" class="nav-link" data-scroll-target="#prompt-ae">Prompt AE</a></li>
  <li><a href="#prompt-af" id="toc-prompt-af" class="nav-link" data-scroll-target="#prompt-af">Prompt AF</a></li>
  <li><a href="#prompt-ag" id="toc-prompt-ag" class="nav-link" data-scroll-target="#prompt-ag">Prompt AG</a></li>
  <li><a href="#prompt-ah" id="toc-prompt-ah" class="nav-link" data-scroll-target="#prompt-ah">Prompt AH</a></li>
  <li><a href="#prompt-ai" id="toc-prompt-ai" class="nav-link" data-scroll-target="#prompt-ai">Prompt AI</a></li>
  <li><a href="#prompt-aj" id="toc-prompt-aj" class="nav-link" data-scroll-target="#prompt-aj">Prompt AJ</a></li>
  <li><a href="#prompt-ak" id="toc-prompt-ak" class="nav-link" data-scroll-target="#prompt-ak">Prompt AK</a></li>
  <li><a href="#prompt-al" id="toc-prompt-al" class="nav-link" data-scroll-target="#prompt-al">Prompt AL</a></li>
  <li><a href="#prompt-am" id="toc-prompt-am" class="nav-link" data-scroll-target="#prompt-am">Prompt AM</a></li>
  <li><a href="#prompt-an" id="toc-prompt-an" class="nav-link" data-scroll-target="#prompt-an">Prompt AN</a></li>
  <li><a href="#prompt-ao" id="toc-prompt-ao" class="nav-link" data-scroll-target="#prompt-ao">Prompt AO</a></li>
  <li><a href="#prompt-ap" id="toc-prompt-ap" class="nav-link" data-scroll-target="#prompt-ap">Prompt AP</a></li>
  <li><a href="#prompt-aq" id="toc-prompt-aq" class="nav-link" data-scroll-target="#prompt-aq">Prompt AQ</a></li>
  <li><a href="#prompt-ar" id="toc-prompt-ar" class="nav-link" data-scroll-target="#prompt-ar">Prompt AR</a></li>
  <li><a href="#prompt-as" id="toc-prompt-as" class="nav-link" data-scroll-target="#prompt-as">Prompt AS</a></li>
  <li><a href="#prompt-at" id="toc-prompt-at" class="nav-link" data-scroll-target="#prompt-at">Prompt AT</a></li>
  <li><a href="#prompt-au" id="toc-prompt-au" class="nav-link" data-scroll-target="#prompt-au">Prompt AU</a></li>
  <li><a href="#prompt-av" id="toc-prompt-av" class="nav-link" data-scroll-target="#prompt-av">Prompt AV</a></li>
  <li><a href="#prompt-aw" id="toc-prompt-aw" class="nav-link" data-scroll-target="#prompt-aw">Prompt AW</a></li>
  <li><a href="#prompt-ax" id="toc-prompt-ax" class="nav-link" data-scroll-target="#prompt-ax">Prompt AX</a></li>
  <li><a href="#running-inference-10-times-using-the-best-prompt" id="toc-running-inference-10-times-using-the-best-prompt" class="nav-link" data-scroll-target="#running-inference-10-times-using-the-best-prompt">Running Inference 10 Times Using the Best Prompt</a></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sentiment Classification with Qwen2-0.5B-Instruct</h1>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">TinySentiment</div>
  </div>
  </div>

<div>
  <div class="description">
    In this blog post I use Qwen2-0.5B-Instruct to classify sentiment in the <code>financial_phrasebank</code> dataset with 79.5% accuracy.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:16:28.469994Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:16:28.469349Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:18:25.503200Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:18:25.502427Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:16:28.469918Z&quot;}">
<details>
<summary>Show <code>pip install</code>s</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install transformers <span class="op">-</span>Uqq</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install accelerate <span class="op">-</span>qq</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install torch<span class="op">==</span><span class="fl">2.2.2</span> <span class="op">-</span>qq</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasets<span class="op">~=</span><span class="fl">2.16.1</span> <span class="op">-</span>qq</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install scikit<span class="op">-</span>learn<span class="op">==</span><span class="fl">1.2</span> <span class="op">-</span>qq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:15.898137Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:15.897579Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:16.634963Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:16.634205Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:15.898114Z&quot;}" data-execution_count="5">
<details>
<summary>Show imports</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset, Dataset</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd, numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, ConfusionMatrixDisplay</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> CategoricalDtype</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoModelForCausalLM, AutoTokenizer</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">"cuda"</span> <span class="co"># the device to load the model onto</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> AutoModelForCausalLM.from_pretrained(</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Qwen/Qwen2-0.5B-Instruct"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span><span class="st">"auto"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(<span class="st">"Qwen/Qwen2-0.5B-Instruct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:46.679431Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:46.679029Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.352741Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.351913Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:46.679413Z&quot;}">
<details>
<summary>Show dataset loading functions</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> load_dataset(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"financial_phrasebank"</span>, <span class="st">"sentences_allagree"</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    split<span class="op">=</span><span class="st">"train"</span>  <span class="co"># note that the dataset does not have a default test split</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new column with the numeric label verbalised as label_text (e.g. "positive" instead of "0")</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>label_map <span class="op">=</span> {i: label_text <span class="cf">for</span> i, label_text <span class="kw">in</span> <span class="bu">enumerate</span>(dataset.features[<span class="st">"label"</span>].names)}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_label_text(example):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    example[<span class="st">"label_text"</span>] <span class="op">=</span> label_map[example[<span class="st">"label"</span>]]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> example</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_label_text)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.356381Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.356209Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.361805Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.360968Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.356363Z&quot;}" data-execution_count="8">
<details>
<summary>Show <code>generate_response</code> function</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_response(prompt):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> [</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: <span class="st">"You are a helpful assistant."</span>},</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt}</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        model_inputs.input_ids,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> [</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.365096Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.364922Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.371487Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.370703Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.365079Z&quot;}" data-execution_count="9">
<details>
<summary>Show <code>add_prompt</code> and <code>generate_responses</code> functions</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_prompt(item, prompt):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        item[<span class="st">'prompt'</span>] <span class="op">=</span> prompt.<span class="bu">format</span>(text<span class="op">=</span>item[<span class="st">'sentence'</span>])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> item</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_responses(dataset, prompt):</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> [</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#df['responses'] = df['responses'].apply(lambda x: x if x in ['negative', 'positive', 'neutral'] else "other")</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.374652Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.374497Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.378945Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.378534Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.374638Z&quot;}" data-execution_count="10">
<details>
<summary>Show <code>make_cm</code> function</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cm(df):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create confusion matrix for true vs predicted sentiment classes"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>df[<span class="st">'label_text'</span>], y_pred<span class="op">=</span>df[<span class="st">'responses'</span>], labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    disp <span class="op">=</span> ConfusionMatrixDisplay(cm, display_labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I chose 8x8 so it fits on one screen but still is large</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    disp.plot(ax<span class="op">=</span>ax,text_kw<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">16</span>}, cmap<span class="op">=</span><span class="st">'Blues'</span>, colorbar<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change label font size without changing label text</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make tick labels larger</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.381494Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.381332Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.385060Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.384497Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.381479Z&quot;}" data-execution_count="11">
<details>
<summary>Show <code>ds_subset</code> function</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ds_subset(dataset, exclude_idxs, columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(dataset)))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> idxs <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> exclude_idxs]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    ddf <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    new_ds <span class="op">=</span> Dataset.from_pandas(ddf.iloc[idxs, columns])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.387400Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.387210Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.393552Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.393013Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.387380Z&quot;}" data-execution_count="12">
<details>
<summary>Show <code>few_shot_responses</code>function</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> few_shot_responses(dataset, prompt, examples):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.395840Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.395695Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.399478Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.398810Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.395827Z&quot;}" data-execution_count="13">
<details>
<summary>Show <code>get_acc</code> function</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_acc(df):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:19:48.403462Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:19:48.403147Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:19:48.407433Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:19:48.406773Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:19:48.403445Z&quot;}" data-execution_count="14">
<details>
<summary>Show <code>get_ds</code> function</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ds(n):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    prompt_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    examples <span class="op">=</span> []</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(prompt_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples[:<span class="dv">10</span>]])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt_ds, examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this notebook I’ll use <a href="https://huggingface.co/Qwen/Qwen2-0.5B-Instruct">Qwen2-0.5B-Instruct</a> to classify sentiment in the <a href="https://huggingface.co/datasets/financial_phrasebank"><code>financial_phrasebank</code> dataset</a>. In previous notebooks I have performed <a href="https://vishalbakshi.github.io/blog/posts/2024-09-23-tinysentiment-Qwen2-1.5B-sentiment-classification/">sentiment classification with Qwen2-1.5B-Instruct</a>, <a href="https://vishalbakshi.github.io/blog/posts/2024-08-31-tinysentiment-phi-2-sentiment-classification/">phi-2</a>, <a href="https://vishalbakshi.github.io/blog/posts/2024-09-12-tinysentiment-phi-3-sentiment-classification/">phi-3</a>, <a href="https://vishalbakshi.github.io/blog/posts/2024-09-12-tinysentiment-phi-3-5-sentiment-classification/">phi-3.5</a>, and <a href="https://vishalbakshi.github.io/blog/posts/2024-08-29-tinysentiment-claude-experiments/">the Claude series</a>.</p>
<p>This notebook is part of <a href="https://vishalbakshi.github.io/blog/#category=TinySentiment">a series of blog posts</a> for a project I’m working called TinySentiment where I’m experimenting with tiny models to improve their ability to classify sentiment in the <code>financial_phrasebank dataset</code>. I was inspired to do so after reading <a href="https://huggingface.co/blog/synthetic-data-save-costs">this blog post</a> and <a href="https://github.com/MoritzLaurer/synthetic-data-blog/blob/main/notebooks/synthetic_data_creation.ipynb">this corresponding notebook</a> by Moritz Laurer as part of a fastai study group last year.</p>
<p>Here are the results from my experiments so far (**the best-performing prompt from this notebook):</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Prompting Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">claude-3-5-sonnet-20240620</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">94.78%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">94% (1302/1391)</td>
<td style="text-align: center;">95% (544/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">claude-3-opus-20240229</td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">94.13%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">96% (1333/1391)</td>
<td style="text-align: center;">88% (501/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">phi-3.5</td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">93.94%</td>
<td style="text-align: center;">96% (286/299)</td>
<td style="text-align: center;">98% (1355/1379)</td>
<td style="text-align: center;">83% (467/566)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-3</td>
<td style="text-align: center;">30-Shot w/System Prompt</td>
<td style="text-align: center;">92.79%</td>
<td style="text-align: center;">98% (290/297)</td>
<td style="text-align: center;">94% (1284/1373)</td>
<td style="text-align: center;">88% (499/564)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">claude-3-haiku-20240307</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">92.39%</td>
<td style="text-align: center;">90% (272/303)</td>
<td style="text-align: center;">91% (1267/1391)</td>
<td style="text-align: center;">96% (550/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-2</td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91.94%</td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Qwen2-1.5B</td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">86.10%</td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">96% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;">**Qwen2-0.5B</td>
<td style="text-align: center;">17-Shot</td>
<td style="text-align: center;">79.48%</td>
<td style="text-align: center;">69% (206/300)</td>
<td style="text-align: center;">86% (1180/1380)</td>
<td style="text-align: center;">71% (400/567)</td>
</tr>
</tbody>
</table>
<p>Here are the results from this notebook:</p>
<table class="table">
<thead>
<tr class="header">
<th>Prompt</th>
<th>Strategy</th>
<th>Accuracy</th>
<th>Negative</th>
<th>Neutral</th>
<th>Positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#prompt-a">A</a></td>
<td>0-Shot</td>
<td>62.41%</td>
<td>91% (276/303)</td>
<td>53% (735/1391)</td>
<td>71% (402/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-b">B</a></td>
<td>0-Shot</td>
<td>47.84%</td>
<td>90% (274/303)</td>
<td>57% (789/1391)</td>
<td>4% (20/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-c">C</a></td>
<td>0-Shot</td>
<td>40.46%</td>
<td>91% (276/303)</td>
<td>43% (594/1391)</td>
<td>8% (46/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-d">D</a></td>
<td>0-Shot</td>
<td>68.29%</td>
<td>79% (240/303)</td>
<td>61% (851/1391)</td>
<td>80% (455/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-e">E</a></td>
<td>0-Shot</td>
<td>51.19%</td>
<td>97% (293/303)</td>
<td>28% (396/1391)</td>
<td>82% (470/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-f">F</a></td>
<td>0-Shot</td>
<td>48.19%</td>
<td>94% (286/303)</td>
<td>21% (287/1391)</td>
<td>91% (518/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-g">G</a></td>
<td>0-Shot</td>
<td>61.09%</td>
<td>93% (282/303)</td>
<td>46% (646/1391)</td>
<td>80% (455/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-h">H</a></td>
<td>0-Shot</td>
<td>65.42%</td>
<td>85% (257/303)</td>
<td>57% (798/1391)</td>
<td>75% (426/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-i">I</a></td>
<td>0-Shot</td>
<td>66.12%</td>
<td>81% (245/303)</td>
<td>58% (800/1391)</td>
<td>79% (452/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-j">J</a></td>
<td>3-Shot</td>
<td>70.94%</td>
<td>43% (131/302)</td>
<td>75% (1042/1390)</td>
<td>76% (431/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-k">K</a></td>
<td>3-Shot</td>
<td>74.88%</td>
<td>67% (201/302)</td>
<td>75% (1043/1390)</td>
<td>79% (449/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-l">L</a></td>
<td>3-Shot</td>
<td>68.11%</td>
<td>49% (149/302)</td>
<td>65% (900/1390)</td>
<td>86% (491/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-m">M</a></td>
<td>3-Shot</td>
<td>56.97%</td>
<td>49% (149/302)</td>
<td>45% (625/1390)</td>
<td>90% (514/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-n">N</a></td>
<td>3-Shot</td>
<td>73.95%</td>
<td>62% (188/302)</td>
<td>75% (1038/1390)</td>
<td>78% (446/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-o">O</a></td>
<td>3-Shot</td>
<td>59.97%</td>
<td>65% (196/302)</td>
<td>46% (635/1390)</td>
<td>92% (525/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-p">P</a></td>
<td>6-Shot</td>
<td>63.91%</td>
<td>95% (289/303)</td>
<td>49% (678/1389)</td>
<td>84% (476/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-q">Q</a></td>
<td>6-Shot</td>
<td>65.72%</td>
<td>69% (207/302)</td>
<td>55% (765/1389)</td>
<td>90% (512/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-r">R</a></td>
<td>6-Shot</td>
<td>64.84%</td>
<td>94% (285/303)</td>
<td>49% (686/1387)</td>
<td>87% (493/568)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-s">S</a></td>
<td>6-Shot</td>
<td>62.98%</td>
<td>96% (292/303)</td>
<td>47% (656/1387)</td>
<td>83% (474/568)</td>
</tr>
<tr class="even">
<td><a href="#prompt-t">T</a></td>
<td>6-Shot</td>
<td>68.87%</td>
<td>51% (155/302)</td>
<td>70% (966/1387)</td>
<td>76% (434/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-u">U</a></td>
<td>12-Shot</td>
<td>65.50%</td>
<td>53% (159/302)</td>
<td>59% (820/1386)</td>
<td>88% (496/564)</td>
</tr>
<tr class="even">
<td><a href="#prompt-v">V</a></td>
<td>12-Shot</td>
<td>73.22%</td>
<td>70% (209/300)</td>
<td>80% (1103/1386)</td>
<td>60% (337/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-w">W</a></td>
<td>12-Shot</td>
<td>70.43%</td>
<td>82% (246/301)</td>
<td>66% (912/1384)</td>
<td>75% (428/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-x">X</a></td>
<td>12-Shot</td>
<td>76.60%</td>
<td>91% (270/298)</td>
<td>72% (1000/1386)</td>
<td>80% (455/568)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-y">Y</a></td>
<td>12-Shot</td>
<td>72.56%</td>
<td>80% (243/303)</td>
<td>77% (1069/1381)</td>
<td>57% (322/568)</td>
</tr>
<tr class="even">
<td><a href="#prompt-z">Z</a></td>
<td>18-Shot</td>
<td>71.33%</td>
<td>50% (150/301)</td>
<td>75% (1036/1382)</td>
<td>74% (416/563)</td>
</tr>
<tr class="odd">
<td><strong><a href="#prompt-aa">AA</a></strong></td>
<td><strong>17-Shot</strong></td>
<td><strong>79.48%</strong></td>
<td>69% (206/300)</td>
<td>86% (1180/1380)</td>
<td>71% (400/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ab">AB</a></td>
<td>18-Shot</td>
<td>74.22%</td>
<td>77% (229/299)</td>
<td>76% (1054/1381)</td>
<td>68% (384/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ac">AC</a></td>
<td>18-Shot</td>
<td>68.57%</td>
<td>49% (148/302)</td>
<td>73% (1013/1380)</td>
<td>67% (379/564)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ad">AD</a></td>
<td>18-Shot</td>
<td>74.98%</td>
<td>89% (271/303)</td>
<td>76% (1052/1379)</td>
<td>64% (361/564)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ae">AE</a></td>
<td>24-Shot</td>
<td>74.91%</td>
<td>61% (181/299)</td>
<td>92% (1267/1375)</td>
<td>41% (230/566)</td>
</tr>
<tr class="even">
<td><a href="#prompt-af">AF</a></td>
<td>24-Shot</td>
<td>73.08%</td>
<td>37% (112/302)</td>
<td>91% (1246/1375)</td>
<td>50% (279/563)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ag">AG</a></td>
<td>24-Shot</td>
<td>75.00%</td>
<td>58% (173/300)</td>
<td>92% (1265/1375)</td>
<td>43% (242/565)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ah">AH</a></td>
<td>24-Shot</td>
<td>77.46%</td>
<td>78% (233/299)</td>
<td>84% (1153/1375)</td>
<td>62% (349/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ai">AI</a></td>
<td>23-Shot</td>
<td>75.37%</td>
<td>48% (143/301)</td>
<td>92% (1266/1375)</td>
<td>50% (280/565)</td>
</tr>
<tr class="even">
<td><a href="#prompt-aj">AJ</a></td>
<td>30-Shot</td>
<td>77.39%</td>
<td>58% (172/298)</td>
<td>94% (1284/1370)</td>
<td>48% (273/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ak">AK</a></td>
<td>30-Shot</td>
<td>67.78%</td>
<td>63% (187/299)</td>
<td>61% (844/1375)</td>
<td>86% (483/560)</td>
</tr>
<tr class="even">
<td><a href="#prompt-al">AL</a></td>
<td>30-Shot</td>
<td>76.54%</td>
<td>58% (173/299)</td>
<td>86% (1185/1372)</td>
<td>63% (352/563)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-am">AM</a></td>
<td>30-Shot</td>
<td>74.84%</td>
<td>82% (242/296)</td>
<td>72% (984/1376)</td>
<td>79% (446/562)</td>
</tr>
<tr class="even">
<td><a href="#prompt-an">AN</a></td>
<td>30-Shot</td>
<td>73.81%</td>
<td>51% (154/300)</td>
<td>77% (1052/1372)</td>
<td>79% (443/562)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ao">AO</a></td>
<td>45-Shot</td>
<td>74.18%</td>
<td>54% (159/297)</td>
<td>76% (1034/1366)</td>
<td>81% (453/556)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ap">AP</a></td>
<td>45-Shot</td>
<td>78.73%</td>
<td>63% (186/296)</td>
<td>87% (1192/1365)</td>
<td>66% (369/558)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-aq">AQ</a></td>
<td>45-Shot</td>
<td>72.01%</td>
<td>17% (51/301)</td>
<td>89% (1210/1359)</td>
<td>60% (337/559)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ar">AR</a></td>
<td>45-Shot</td>
<td>73.86%</td>
<td>53% (157/297)</td>
<td>80% (1094/1364)</td>
<td>70% (388/558)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-as">AS</a></td>
<td>45-Shot</td>
<td>74.94%</td>
<td>42% (125/297)</td>
<td>89% (1219/1363)</td>
<td>57% (319/559)</td>
</tr>
<tr class="even">
<td><a href="#prompt-at">AT</a></td>
<td>60-Shot</td>
<td>72.19%</td>
<td>47% (138/292)</td>
<td>78% (1055/1356)</td>
<td>72% (398/556)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-au">AU</a></td>
<td>60-Shot</td>
<td>76.86%</td>
<td>43% (127/296)</td>
<td>91% (1237/1356)</td>
<td>60% (330/552)</td>
</tr>
<tr class="even">
<td><a href="#prompt-av">AV</a></td>
<td>60-Shot</td>
<td>75.45%</td>
<td>26% (79/299)</td>
<td>89% (1206/1352)</td>
<td>68% (378/553)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-aw">AW</a></td>
<td>60-Shot</td>
<td>74.46%</td>
<td>29% (88/299)</td>
<td>86% (1157/1349)</td>
<td>71% (396/556)</td>
</tr>
<tr class="even">
<td><strong><a href="#prompt-ax">AX</a></strong></td>
<td><strong>60-Shot</strong></td>
<td><strong>79.63%</strong></td>
<td>62% (179/290)</td>
<td>94% (1275/1352)</td>
<td>54% (301/562)</td>
</tr>
</tbody>
</table>
</section>
<section id="prompt-a" class="level2">
<h2 class="anchored" data-anchor-id="prompt-a">Prompt A</h2>
<p>I’ll start out with a simple instruction.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:06:57.416392Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:06:57.416240Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:06:57.419066Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:06:57.418576Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:06:57.416379Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>promptA <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(promptA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: {text}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:06:57.419951Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:06:57.419805Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:06:57.423086Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:06:57.422602Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:06:57.419938Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>formatted_prompt <span class="op">=</span> promptA.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:06:28.885140Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:06:28.884477Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:06:29.963491Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:06:29.963030Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:06:28.885121Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>generate_response(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>'Negative.'</code></pre>
</div>
</div>
<p>Good—at least it’s responding with a sensible answer, although it’s not formatted how I’d like to be, so I expect to need more data cleaning than Qwen2-1.5B-Instruct’s responses.</p>
<p>At ~35ms per prompt it will take about 80 seconds to run inference on the full 2264 item dataset.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:07:52.246526Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:07:52.245923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:07:54.728288Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:07:54.727624Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:07:52.246506Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">10</span> generate_response(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>35.4 ms ± 472 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:06:57.423920Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:06:57.423771Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:08:21.273658Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:08:21.273041Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:06:57.423907Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5c7d5f99af714ca5bc16ef82cd36598c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<p>0.5B yields messier responses. Note the period at the end of some of the strings. For now I’ll manually check each set of responses and clean them accordingly.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:09:42.449650Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:09:42.449408Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:09:42.453694Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:09:42.453268Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:09:42.449632Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array(['neutral.', 'positive', 'neutral', 'negative', 'positive.',
       'negative.', 'negot', 'negative profit', 'net interest', 'teleste',
       'neglig'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:09:44.550987Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:09:44.550744Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:09:44.555325Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:09:44.554824Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:09:44.550970Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:09:45.888176Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:09:45.887936Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:09:45.891803Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:09:45.891351Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:09:45.888158Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>0.5B doesn’t do terribly on this simple prompt (62.4% accuracy) but it’s almost 20% less accurate than 1.5B (~82% accuracy).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:09:48.659229Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:09:48.658952Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:09:48.664254Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:09:48.663806Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:09:48.659210Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.6241166077738516</code></pre>
</div>
</div>
<p>0.5B does a great job at classifying <code>negative</code> sentiment, does quite well at <code>positive</code> sentences, and has very few <code>other</code> responses overall.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:09:55.592179Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:09:55.591912Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:09:55.710721Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:09:55.710240Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:09:55.592158Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-21-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:10:46.788934Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:10:46.788562Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:10:46.824757Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:10:46.823462Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:10:46.788911Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_A.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-b" class="level2">
<h2 class="anchored" data-anchor-id="prompt-b">Prompt B</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:19:52.401923Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:19:52.401380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:19:52.404779Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:19:52.404267Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:19:52.401903Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>promptB <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:19:58.268457Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:19:58.267907Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:21:21.446669Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:21:21.446147Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:19:58.268457Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2400d2564ed7448bb9a62f7c661b3850","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral</code></pre>
</div>
</div>
<p>With this prompt (where the instruction is repeated after the dataset text) 0.5B responds much more cleanly.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:22:42.185977Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:22:42.185222Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:22:42.190027Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:22:42.189485Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:22:42.185957Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array(['negative', 'neutral', 'positive'], dtype=object)</code></pre>
</div>
</div>
<p>However, it performs almost 20% worse!</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:23:24.094096Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:23:24.093590Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:23:24.098934Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:23:24.098407Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:23:24.094077Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0.47835689045936397</code></pre>
</div>
</div>
<p>While it’s quite good still with <code>negative</code> sentiment, it performs significantly worse on <code>positive</code> sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:23:52.963662Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:23:52.962935Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:23:53.042260Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:23:53.041708Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:23:52.963642Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-27-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T02:24:46.629787Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T02:24:46.629542Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T02:24:46.652705Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T02:24:46.652177Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T02:24:46.629772Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_B.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-c" class="level2">
<h2 class="anchored" data-anchor-id="prompt-c">Prompt C</h2>
<p>I’ll use the same Prompt C as the 1.5B model: a reword of Prompt A (which performed well for 0.5B).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:11:42.451637Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:11:42.451364Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:11:42.454661Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:11:42.454054Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:11:42.451618Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>promptC <span class="op">=</span> <span class="st">"""Respond with a single word: negative, positive, or neutral</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:11:50.438572Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:11:50.438227Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:13:13.073197Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:13:13.072496Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:11:50.438549Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1850d4d1251f4c6f96c147dc47c65bf0","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Respond with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:15:21.567381Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:15:21.567036Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:15:21.572013Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:15:21.571626Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:15:21.567357Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array(['negative.', 'negative', 'neutral', 'neutral.', 'positive',
       'positive.', 'negative loss'], dtype=object)</code></pre>
</div>
</div>
<p>The change in prompt language significantly deteriorates 0.5B’s accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:15:59.334134Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:15:59.333858Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:15:59.341454Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:15:59.340898Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:15:59.334115Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0.4045936395759717</code></pre>
</div>
</div>
<p>0.5B still does really well on <code>negative</code> sentiment, but does horribly on <code>positive</code> and underwhelming for <code>neutral</code> sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:16:09.428930Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:16:09.428567Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:16:09.541818Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:16:09.540818Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:16:09.428906Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-33-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:21:20.952890Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:21:20.952259Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:21:20.969868Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:21:20.969377Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:21:20.952887Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_C.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-d" class="level2">
<h2 class="anchored" data-anchor-id="prompt-d">Prompt D</h2>
<p>I’ll change the order of sentiment listed in Prompt A by putting <code>positive</code> first:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:27:37.315441Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:27:37.314994Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:27:37.317890Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:27:37.317465Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:27:37.315417Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>promptD <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: positive, negative, or neutral</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:27:54.359838Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:27:54.359529Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:29:18.187786Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:29:18.187151Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:27:54.359817Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"56f606b29d494edfa07c6c699f58ed31","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:40:51.283108Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:40:51.282770Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:40:51.289653Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:40:51.288635Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:40:51.283085Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array(['neutral.', 'positive', 'positive.', 'neutral', 'net income',
       'the text', 'negative', 'negative.', 'negative net', 'negot',
       'subscription'], dtype=object)</code></pre>
</div>
</div>
<p>Changing the order of sentiment (putting <code>positive</code> first) increases the overall accuracy by ~6%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:41:17.193956Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:41:17.193527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:41:17.201748Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:41:17.201048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:41:17.193933Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.6828621908127208</code></pre>
</div>
</div>
<p>0.5B’s performance on <code>negative</code> sentiment dips a bit (36 fewer correct) but that is more than compensated by the increase in correctly classified <code>positive</code> (+53) and <code>neutral</code> (+166) sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:41:50.466425Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:41:50.466145Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:41:50.550640Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:41:50.550069Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:41:50.466403Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-39-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:43:48.221661Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:43:48.220978Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:43:48.240803Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:43:48.240315Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:43:48.221633Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_D.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-e" class="level2">
<h2 class="anchored" data-anchor-id="prompt-e">Prompt E</h2>
<p>I’ll try another combination:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:57:10.476268Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:57:10.475999Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:57:10.479112Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:57:10.478662Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:57:10.476244Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>promptE <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: negative, neutral, or positive</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T15:57:11.899422Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T15:57:11.898626Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T15:58:34.403468Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T15:58:34.402934Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T15:57:11.899395Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a18fc62aaeaa4f1dbb934e3ced3673dc","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: negative, neutral, or positive
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:10:02.399949Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:10:02.399307Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:10:02.408731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:10:02.407068Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:10:02.399915Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>array(['negative.', 'positive', 'negative', 'positive.', 'neutral.',
       'neutral', 'negative profit', 'negot', 'teleste'], dtype=object)</code></pre>
</div>
</div>
<p>This ordering of sentiment worsens the accuracy by 10 points.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:10:14.729900Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:10:14.729337Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:10:14.738751Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:10:14.738157Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:10:14.729876Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.5119257950530035</code></pre>
</div>
</div>
<p>0.5B is nearly perfect for <code>negative</code> sentiment, and quite good with <code>positive</code> sentences, but abysmal for <code>neutral</code>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:13:42.609575Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:13:42.609047Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:13:42.699838Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:13:42.699210Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:13:42.609551Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-45-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:16:55.010380Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:16:55.009793Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:16:55.027764Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:16:55.027177Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:16:55.010357Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_E.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-f" class="level2">
<h2 class="anchored" data-anchor-id="prompt-f">Prompt F</h2>
<p>Trying the next permutation of sentiments:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:18:27.966340Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:18:27.965774Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:18:27.969015Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:18:27.968560Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:18:27.966319Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>promptF <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: positive, neutral, or negative</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:18:38.888221Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:18:38.887609Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:20:00.199752Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:20:00.199224Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:18:38.888192Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9289395352be4e30a137504a14a920b1","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, neutral, or negative
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:20:03.801905Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:20:03.801662Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:20:03.806739Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:20:03.806163Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:20:03.801889Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>array(['neutral.', 'positive', 'positive.', 'negative', 'negative.',
       'neutral', 'positive net', 'negativ', 'negot', 'subscription'],
      dtype=object)</code></pre>
</div>
</div>
<p>This ordering of sentiments further worsens the overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:20:05.977351Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:20:05.976777Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:20:05.985406Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:20:05.984899Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:20:05.977331Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.4818904593639576</code></pre>
</div>
</div>
<p><code>positive</code> sentences are classified correctly at the highest rate so far, and <code>negative</code> sentiment accuracy is very good, but the model does terribly on <code>neutral</code> sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:32:37.359476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:32:37.359228Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:32:37.441342Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:32:37.440585Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:32:37.359458Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-51-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:32:40.186530Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:32:40.186271Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:32:40.204090Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:32:40.203521Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:32:40.186510Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_F.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-g" class="level2">
<h2 class="anchored" data-anchor-id="prompt-g">Prompt G</h2>
<p>The next ordering of sentiments:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:44:27.274119Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:44:27.273834Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:44:27.277400Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:44:27.276812Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:44:27.274099Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>promptG <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: neutral, negative, or positive</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:44:39.176959Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:44:39.176388Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:46:05.987881Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:46:05.987283Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:44:39.176935Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ed291cc5383142fbaa9e89602fe9cb93","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: neutral, negative, or positive
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:47:35.254527Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:47:35.254223Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:47:35.260071Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:47:35.259184Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:47:35.254505Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>array(['neutral.', 'positive', 'positive.', 'neutral', 'negative',
       'negative.', 'positive profit', 'negot'], dtype=object)</code></pre>
</div>
</div>
<p>The accuracy of 61% is worse than the best-performing Prompt D (68%).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:47:44.853309Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:47:44.853065Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:47:44.860139Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:47:44.859592Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:47:44.853291Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>0.6108657243816255</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:48:42.650613Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:48:42.650331Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:48:42.736844Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:48:42.736238Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:48:42.650593Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-57-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:49:18.201295Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:49:18.201015Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:49:18.219357Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:49:18.218733Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:49:18.201276Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_G.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-h" class="level2">
<h2 class="anchored" data-anchor-id="prompt-h">Prompt H</h2>
<p>The last ordering of sentiment:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:50:02.620945Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:50:02.620686Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:50:02.624335Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:50:02.623735Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:50:02.620926Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>promptH <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: neutral, positive, or negative</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:50:13.987873Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:50:13.987344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:51:36.797131Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:51:36.796546Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:50:13.987848Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a74227e8b18940dbbe9b163108a1dbd1","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: neutral, positive, or negative
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:51:48.590402Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:51:48.589784Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:51:48.595347Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:51:48.594512Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:51:48.590374Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>array(['positive', 'neutral.', 'positive.', 'neutral', 'negative',
       'negative.', 'positive profit', 'negot'], dtype=object)</code></pre>
</div>
</div>
<p>This yields a 65% accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:51:50.330667Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:51:50.330087Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:51:50.338298Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:51:50.337747Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:51:50.330642Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>0.6541519434628975</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:52:04.746828Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:52:04.746140Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:52:04.834796Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:52:04.834229Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:52:04.746805Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-63-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-15T16:52:19.718116Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-15T16:52:19.717293Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-15T16:52:19.735506Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-15T16:52:19.734996Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-15T16:52:19.718056Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_H.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-i" class="level2">
<h2 class="anchored" data-anchor-id="prompt-i">Prompt I</h2>
<p>I’ll make a small change to my best-performing prompt by adding a period at the end of the instruction.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:08:04.010399Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:08:04.009720Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:08:04.013065Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:08:04.012470Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:08:04.010377Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>promptI <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: positive, negative, or neutral.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:08:06.298948Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:08:06.298427Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:09:30.860558Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:09:30.859947Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:08:06.298919Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f7b45463350241638856bab9db483ea5","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral.
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:09:30.862173Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:09:30.861908Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:09:30.867177Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:09:30.866590Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:09:30.862147Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['neutral.', 'positive', 'positive.', 'neutral', 'net income',
       'negative', 'negative.', 'negative profit', 'nord', 'negot',
       'the text', 'negation', 'neglig', 'subscription'], dtype=object)</code></pre>
</div>
</div>
<p>Adding a period to the end of the instruction worsens the accuracy a bit.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:09:30.868315Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:09:30.868080Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:09:30.875277Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:09:30.874630Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:09:30.868315Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">str</span>.replace(<span class="st">'.'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.6612190812720848</code></pre>
</div>
</div>
<p>Adding a period worsens the performance on <code>neutral</code> by 51 sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:10:54.250514Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:10:54.250220Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:10:54.366578Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:10:54.365989Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:10:54.250495Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-69-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:12:28.511166Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:12:28.510931Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:12:28.531074Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:12:28.530572Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:12:28.511149Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_I.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-j" class="level2">
<h2 class="anchored" data-anchor-id="prompt-j">Prompt J</h2>
<p>I’ll now shift my attention to few-shot prompts, starting with 3-Shot.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T17:56:36.227336Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T17:56:36.227079Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T17:56:36.232314Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T17:56:36.231086Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T17:56:36.227313Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T17:56:40.143384Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T17:56:40.142984Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T17:56:40.190847Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T17:56:40.190145Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T17:56:40.143353Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>promptJ_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>promptJ_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2261
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:04:48.021046Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:04:48.020879Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:04:48.023404Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:04:48.022991Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:04:48.021034Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>promptJ <span class="op">=</span> <span class="st">"""Label the following TEXT with a single word: positive, negative, or neutral</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since ordering seems to matter, I’ll start with a <code>neutral</code> example, <code>positive</code> example and <code>negative</code> example.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:35:39.911727Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:35:39.911071Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:35:39.917007Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:35:39.916420Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:35:39.911703Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>[('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral'),
 ("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive'),
 ('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:37:46.111876Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:37:46.110986Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:39:09.396371Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:39:09.395798Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:37:46.111853Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"606d1d4849b9409287d6f50ddfaae41f","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:42:25.182570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:42:25.182329Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:42:25.187267Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:42:25.186715Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:42:25.182553Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>3-Shot prompting resulted in the best accuracy so far! ~71%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:42:58.519436Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:42:58.518626Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:42:58.526054Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:42:58.525310Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:42:58.519417Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.709420610349403</code></pre>
</div>
</div>
<p>Compared to my best 0-Shot Prompt D (68%) this prompt results in the model significantly underperforming on <code>negative</code> sentences, (131 &lt; 240), but more than making up for it on <code>neutral</code> sentences (1042 &gt; 851).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:43:24.577313Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:43:24.577079Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:43:24.668210Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:43:24.667424Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:43:24.577296Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-78-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:44:51.201093Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:44:51.200511Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:44:51.219628Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:44:51.218946Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:44:51.201067Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_J.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-k" class="level2">
<h2 class="anchored" data-anchor-id="prompt-k">Prompt K</h2>
<p>I’ll re-order the examples and use the same Prompt J.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:55:14.095479Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:55:14.095018Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:55:14.098424Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:55:14.097751Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:55:14.095460Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">292</span>, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:55:15.660698Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:55:15.660098Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:55:15.666226Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:55:15.665556Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:55:15.660673Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>[('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral'),
 ('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative'),
 ("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T15:55:27.086016Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T15:55:27.085551Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T15:56:55.766250Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T15:56:55.765608Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T15:55:27.085998Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6a5334d1277c433e9f1b22b417a02168","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:00:00.781085Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:00:00.780829Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:00:00.788849Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:00:00.788246Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:00:00.781066Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Changing the order of examples to <code>neutral</code>, <code>negative</code>, <code>positive</code> increases the overall accuracy to almost 75%!</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:00:09.582843Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:00:09.582549Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:00:09.590055Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:00:09.589330Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:00:09.582823Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.7487837240159222</code></pre>
</div>
</div>
<p>The model improves on all three sentiments compared to Prompt J.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:00:52.046846Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:00:52.046570Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:00:52.130637Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:00:52.129935Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:00:52.046828Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-85-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/cell-85-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:01:31.422192Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:01:31.421912Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:01:31.442329Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:01:31.441771Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:01:31.422173Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_K.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-l" class="level2">
<h2 class="anchored" data-anchor-id="prompt-l">Prompt L</h2>
<p>I’ll re-order the examples and use the same Prompt J.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:53:09.091102Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:53:09.090421Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:53:09.096950Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:53:09.096179Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:53:09.091091Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">292</span>]</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>[("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive'),
 ('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral'),
 ('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:53:12.405932Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:53:12.405679Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:54:36.095190Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:54:36.094453Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:53:12.405914Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"01f57c52645d46cf814aa725a96f7747","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:55:43.750775Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:55:43.750186Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:55:43.755677Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:55:43.755190Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:55:43.750747Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This ordering of examples drops the accuracy to 68%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:55:46.251303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:55:46.250749Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:55:46.258519Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:55:46.258031Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:55:46.251276Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0.6811145510835913</code></pre>
</div>
</div>
<p>Compared to the best-performing Prompt K, this prompt yields a better accuracy for <code>positive</code> sentences (491 &gt; 449).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T16:56:07.120059Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T16:56:07.119530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T16:56:07.207893Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T16:56:07.207391Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T16:56:07.120035Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-91-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/cell-91-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:05:45.878112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:05:45.877189Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:05:45.897256Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:05:45.896724Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:05:45.878077Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_L.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-m" class="level2">
<h2 class="anchored" data-anchor-id="prompt-m">Prompt M</h2>
<p>I’ll re-order the examples and use the same Prompt J.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:06:51.120531Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:06:51.120029Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:06:51.125610Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:06:51.124972Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:06:51.120513Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">292</span>, <span class="dv">0</span>]</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>[("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive'),
 ('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative'),
 ('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:06:53.547086Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:06:53.546549Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:08:17.036467Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:08:17.035964Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:06:53.547062Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4302906e714349518fd574ec4dfae09d","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:10:49.074858Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:10:49.074300Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:10:49.080201Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:10:49.079465Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:10:49.074829Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This ordering of examples worsens the accuracy, dropping it down to 57%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:10:52.645476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:10:52.645171Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:10:52.654850Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:10:52.654233Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:10:52.645457Z&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>0.5696594427244582</code></pre>
</div>
</div>
<p>This prompt yields better results for <code>positive</code> sentiment (514 &gt; 449) than the best overall performing Prompt J.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:11:18.521032Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:11:18.520386Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:11:18.603547Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:11:18.603050Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:11:18.521003Z&quot;}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-97-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/cell-97-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-16T17:12:09.626877Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-16T17:12:09.626335Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-16T17:12:09.647834Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-16T17:12:09.647298Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-16T17:12:09.626854Z&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_M.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-n" class="level2">
<h2 class="anchored" data-anchor-id="prompt-n">Prompt N</h2>
<p>Trying the next ordering of sentiments:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T17:58:07.580523Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T17:58:07.579935Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T17:58:07.586872Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T17:58:07.585920Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T17:58:07.580500Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">292</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>[('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative'),
 ('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral'),
 ("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:02:03.166870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:02:03.166144Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:03:36.992645Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:02:03.166828Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6973944f4a2d45c3b97fadcaa02fa27e","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:04:01.271855Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:04:01.270888Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:04:01.279344Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:04:01.278502Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:04:01.271815Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This ordering results in the second-highest overall accuracy at 74%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:04:14.277567Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:04:14.276719Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:04:14.285341Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:04:14.284486Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:04:14.277543Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0.7394957983193278</code></pre>
</div>
</div>
<p>This prompt performs slightly worse for all three sentiments than the so far best-overall performing Prompt K.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:04:55.798501Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:04:55.798190Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:04:55.968689Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:04:55.967973Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:04:55.798482Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-103-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/cell-103-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:12:51.868774Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:12:51.867994Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:12:51.893470Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:12:51.892649Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:12:51.868738Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_N.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-o" class="level2">
<h2 class="anchored" data-anchor-id="prompt-o">Prompt O</h2>
<p>Here’s the final 3-sentiment ordering:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:13:32.130448Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:13:32.129456Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:13:32.137291Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:13:32.136442Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:13:32.130411Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">292</span>, <span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>[('Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
  'negative'),
 ("For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
  'positive'),
 ('According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
  'neutral')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:13:34.944128Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:13:34.943306Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:15:08.938495Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:15:08.937842Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:13:34.944102Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8ac7113793924d79b01f81366fc539fe","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:15:20.865480Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:15:20.865180Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:15:20.870528Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:15:20.869869Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:15:20.865480Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This ordering of sentiment does not beat my so far best-performing accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:15:31.139347Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:15:31.138569Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:15:31.147849Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:15:31.146964Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:15:31.139324Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.599734630694383</code></pre>
</div>
</div>
<p>This prompt yields a much better performance on <code>positive</code> sentiment than my best performing Prompt K (525 &gt; 449).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:16:03.893883Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:16:03.893078Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:16:03.983496Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:16:03.982776Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:16:03.893858Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-109-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/cell-109-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:17:12.074844Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:17:12.074555Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:17:12.094606Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:17:12.093593Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:17:12.074824Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_O.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-p" class="level2">
<h2 class="anchored" data-anchor-id="prompt-p">Prompt P</h2>
<p>Next, I’ll increase the number of examples to 6. Note that I won’t be trying all permutations but a few random ones.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:22:45.506763Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:22:45.506309Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:22:45.525999Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:22:45.524985Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:22:45.506732Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>promptP_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>promptP_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2258
})</code></pre>
</div>
</div>
<p>The random examples I have picked don’t include a <code>negative</code> sentence. I’m curious to see how the model performs on this.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:24:39.883851Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:24:39.883147Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:24:39.890833Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:24:39.890089Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:24:39.883825Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>[el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>['positive', 'neutral', 'positive', 'neutral', 'positive', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:24:57.870957Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:24:57.870066Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:26:31.250443Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:26:31.249890Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:24:57.870923Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptP_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"183fab0bb79a4002a45e4128f4e9b018","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:27:31.129703Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:27:31.129012Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:27:31.134404Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:27:31.133817Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:27:31.129678Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt results in a worse performance in overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:27:36.542414Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:27:36.542094Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:27:36.549272Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:27:36.548595Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:27:36.542392Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.6390611160318866</code></pre>
</div>
</div>
<p>Even though no <code>negative</code> examples were given, this prompt yields considerably more correct <code>negative</code> sentences (289) than the best-performing Prompt K (201).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:27:59.202779Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:27:59.202423Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:27:59.294910Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:27:59.294212Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:27:59.202767Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-116-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/cell-116-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:29:35.155708Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:29:35.155156Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:29:35.174855Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:29:35.174110Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:29:35.155686Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_P.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-q" class="level2">
<h2 class="anchored" data-anchor-id="prompt-q">Prompt Q</h2>
<p>I’ll try another random set of 6 examples, this time making sure there’s at least one of each sentiment.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:30:44.091284Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:30:44.090544Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:30:44.107078Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:30:44.106408Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:30:44.091247Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>promptQ_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>promptQ_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2258
 }),
 ['positive', 'positive', 'positive', 'neutral', 'negative', 'neutral'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:31:15.054828Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:31:15.054035Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:32:49.495380Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:32:49.494839Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:31:15.054803Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptQ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2b79208198b44f0db1c1a2939d3b12aa","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:34:57.682289Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:34:57.681391Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:34:57.689128Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:34:57.688168Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:34:57.682289Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>array(['neutral', 'positive', 'negative', 'live'], dtype=object)</code></pre>
</div>
</div>
<p>This set of 6 examples does not improve upon the best-overall accuracy of 75%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:35:03.426521Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:35:03.425759Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:35:03.432401Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:35:03.431896Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:35:03.426499Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0.6572187776793623</code></pre>
</div>
</div>
<p>Something we haven’t seen in awhile, an <code>other</code> response.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:35:25.827435Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:35:25.826893Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:35:25.910215Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:35:25.909664Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:35:25.827414Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-122-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="index_files/figure-html/cell-122-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:35:48.026906Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:35:48.026189Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:35:48.047101Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:35:48.046564Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:35:48.026877Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_Q.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-r" class="level2">
<h2 class="anchored" data-anchor-id="prompt-r">Prompt R</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:36:39.272463Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:36:39.271784Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:36:39.287884Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:36:39.287385Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:36:39.272439Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>promptR_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>promptR_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2258
 }),
 ['neutral', 'neutral', 'positive', 'positive', 'neutral', 'neutral'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:37:26.507209Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:37:26.506807Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:39:01.601663Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:39:01.600997Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:37:26.507184Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptR_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bb5acb86c42b4da9b40cb5ac0f82eb78","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:41:08.319693Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:41:08.319128Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:41:08.325689Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:41:08.324935Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:41:08.319672Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>No improvements on accuracy with this prompt.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:41:14.089085Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:41:14.088319Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:41:14.095020Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:41:14.094465Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:41:14.089059Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>0.6483613817537643</code></pre>
</div>
</div>
<p>Compared to the best-performing Prompt K, this prompt yields considerably more correct <code>negative</code> (285 &gt; 201) and <code>positive</code> (493 &gt; 449) sentences but underperforms on <code>neutral</code> sentences (686 &lt; 1043).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:41:33.506474Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:41:33.506122Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:41:33.595267Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:41:33.594577Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:41:33.506441Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-128-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/cell-128-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-17T18:42:48.974479Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-17T18:42:48.973801Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-17T18:42:48.994080Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-17T18:42:48.993159Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-17T18:42:48.974454Z&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_R.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-s" class="level2">
<h2 class="anchored" data-anchor-id="prompt-s">Prompt S</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:30:02.213626Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:30:02.213480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:30:02.241444Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:30:02.240909Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:30:02.213613Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>promptS_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>promptS_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2258
 }),
 ['neutral', 'neutral', 'positive', 'neutral', 'positive', 'neutral'])</code></pre>
</div>
</div>
<p>This set of examples has no <code>negative</code> sentences and a majority of <code>neutral</code> sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:31:16.314738Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:31:16.314444Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:32:45.706853Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:32:45.706328Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:31:16.314703Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptS_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"875914eead224148b8ba4912d15c8193","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:34:20.439835Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:34:20.439100Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:34:20.445031Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:34:20.444594Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:34:20.439809Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array(['negative', 'positive', 'neutral'], dtype=object)</code></pre>
</div>
</div>
<p>This set of examples does not improve on the best-overall accuracy of 75% (Prompt K).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:35:14.049197Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:35:14.048458Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:35:14.054289Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:35:14.053903Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:35:14.049173Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.6297608503100088</code></pre>
</div>
</div>
<p>It does, however, have a considerably larger number of correctly labeled <code>negative</code> sentences (292 &gt; 201).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:35:36.495935Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:35:36.494967Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:35:36.645012Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:35:36.644433Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:35:36.495909Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-134-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="index_files/figure-html/cell-134-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:36:24.089195Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:36:24.088355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:36:24.117161Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:36:24.116540Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:36:24.089136Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_S.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll try one more 6-shot prompt before I increase the number of examples.</p>
</section>
<section id="prompt-t" class="level2">
<h2 class="anchored" data-anchor-id="prompt-t">Prompt T</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:55:34.309276Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:55:34.308778Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:55:34.323574Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:55:34.323142Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:55:34.309253Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">6</span>)]</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>promptT_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>promptT_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2258
 }),
 ['neutral', 'neutral', 'positive', 'neutral', 'negative', 'neutral'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:55:59.942812Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:55:59.942122Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:57:28.430965Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:57:28.430449Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:55:59.942789Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptT_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"141b6967bf0b4e5fa4b2c7974c023240","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:58:38.230184Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:58:38.229435Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:58:38.233870Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:58:38.233517Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:58:38.230184Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Similar to the other 6-Shot examples, this set of examples does not improve on the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:58:45.243422Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:58:45.242933Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:58:45.249270Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:58:45.248866Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:58:45.243401Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0.6886625332152347</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:59:13.946858Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:59:13.946325Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:59:14.027807Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:59:14.027364Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:59:13.946845Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-140-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="index_files/figure-html/cell-140-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T13:59:32.786118Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T13:59:32.785380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T13:59:32.806137Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T13:59:32.805471Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T13:59:32.786088Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_T.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-u" class="level2">
<h2 class="anchored" data-anchor-id="prompt-u">Prompt U</h2>
<p>I’ll now increase the number of examples in the prompt to 12, and try out 5 random sets of 12 examples.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:00:28.621634Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:00:28.620848Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:00:28.635296Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:00:28.634901Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:00:28.621601Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>promptU_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>promptU_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2252
 }),
 ['positive',
  'negative',
  'positive',
  'neutral',
  'positive',
  'positive',
  'neutral',
  'positive',
  'neutral',
  'neutral',
  'positive',
  'neutral'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:01:38.389458Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:01:38.388825Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:03:23.033402Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:03:23.032762Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:01:38.389435Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptU_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e5a98d72cfc14621ad9798b3f5123995","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:06:51.541051Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:06:51.540185Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:06:51.545332Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:06:51.544741Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:06:51.541004Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Increasing the number of examples to 12, at least the 12 I chose here, doesn’t improve on the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:06:53.560404Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:06:53.559764Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:06:53.565967Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:06:53.565398Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:06:53.560384Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0.6549733570159858</code></pre>
</div>
</div>
<p>The number of correct <code>positive</code> sentences is considerably higher than Prompt K (496 &gt; 449).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:07:27.529572Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:07:27.528960Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:07:27.615080Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:07:27.614550Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:07:27.529553Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-146-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="index_files/figure-html/cell-146-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:08:05.244580Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:08:05.243880Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:08:05.267617Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:08:05.267057Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:08:05.244559Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_U.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-v" class="level2">
<h2 class="anchored" data-anchor-id="prompt-v">Prompt V</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:08:41.538713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:08:41.538231Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:08:41.555768Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:08:41.555300Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:08:41.538611Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>promptV_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>promptV_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2252
 }),
 ['neutral',
  'positive',
  'positive',
  'neutral',
  'neutral',
  'negative',
  'negative',
  'neutral',
  'positive',
  'neutral',
  'positive',
  'negative'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:09:32.506121Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:09:32.505853Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:11:13.447020Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:11:13.446226Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:09:32.506103Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptV_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5f651aff3c8c441292594026344e8679","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:16:12.063113Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:16:12.062440Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:16:12.067632Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:16:12.067082Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:16:12.063088Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt performs well, and competes with but doesn’t improve upon the best overall accuracy of 75%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:16:16.461759Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:16:16.461499Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:16:16.467509Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:16:16.466967Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:16:16.461741Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>0.7322380106571936</code></pre>
</div>
</div>
<p>This prompt performs considerably better on <code>neutral</code> sentences than Prompt K (1103 &gt; 1043).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:17:55.890782Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:17:55.890082Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:17:55.976293Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:17:55.975697Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:17:55.890759Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-152-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="index_files/figure-html/cell-152-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:19:21.061429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:19:21.060771Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:19:21.081270Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:19:21.080651Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:19:21.061407Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_V.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-w" class="level2">
<h2 class="anchored" data-anchor-id="prompt-w">Prompt W</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:19:45.810925Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:19:45.810659Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:19:45.827633Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:19:45.827027Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:19:45.810906Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>)]</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>promptW_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>examples <span class="op">=</span> []</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>    examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>promptW_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2252
 }),
 ['neutral',
  'negative',
  'neutral',
  'positive',
  'neutral',
  'neutral',
  'positive',
  'neutral',
  'neutral',
  'negative',
  'positive',
  'neutral'])</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:20:39.997678Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:20:39.996777Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:22:18.186953Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:22:18.186272Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:20:39.997642Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptW_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2fadb92efc1e4563bc3453b858f70373","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:28:46.745409Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:28:46.744894Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:28:46.750316Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:28:46.749521Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:28:46.745388Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The accuracy worsens with this set of 12 examples.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:28:59.755112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:28:59.754567Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:28:59.760524Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:28:59.759989Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:28:59.755092Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>0.7042628774422736</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:29:15.903542Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:29:15.903018Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:29:15.990840Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:29:15.990293Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:29:15.903523Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-158-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="index_files/figure-html/cell-158-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-18T14:29:30.630260Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-18T14:29:30.629977Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-18T14:29:30.651992Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-18T14:29:30.651278Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-18T14:29:30.630241Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_W.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-x" class="level2">
<h2 class="anchored" data-anchor-id="prompt-x">Prompt X</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:34:05.787845Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:34:05.787245Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:34:05.791899Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:34:05.791285Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:34:05.787816Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ds(n):</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>    exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>    prompt_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>    examples <span class="op">=</span> []</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>        examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(prompt_ds, [el[<span class="dv">1</span>] <span class="cf">for</span> el <span class="kw">in</span> examples])</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt_ds, examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:34:07.213255Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:34:07.212988Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:34:07.243011Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:34:07.242173Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:34:07.213236Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>promptX_ds, examples <span class="op">=</span> get_ds(<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2252
}) ['positive', 'neutral', 'negative', 'neutral', 'positive', 'negative', 'neutral', 'negative', 'negative', 'neutral', 'neutral', 'negative']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:35:04.463653Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:35:04.462984Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:36:51.883836Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:36:51.883265Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:35:04.463577Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptX_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ffff562f2f0a468798337b4b011c064b","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:36:51.885391Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:36:51.885031Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:36:51.893822Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:36:51.893300Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:36:51.885371Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Aha! This prompt improves upon the best overall accuracy, reaching about 77%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:36:51.894774Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:36:51.894597Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:36:51.900833Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:36:51.900265Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:36:51.894759Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0.7659857904085258</code></pre>
</div>
</div>
<p>Compared to Prompt K (75%) this prompt performs worse on <code>neutral</code> sentences (1000 &lt; 1043) but more than makes up for it on <code>negative</code> (270 &gt; 201) and <code>positive</code> (455 &gt; 449) sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:36:51.902337Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:36:51.901979Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:36:52.019059Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:36:52.018219Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:36:51.902320Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-165-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="index_files/figure-html/cell-165-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:36:52.020433Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:36:52.019881Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:36:52.039493Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:36:52.039040Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:36:52.020413Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_X.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-y" class="level2">
<h2 class="anchored" data-anchor-id="prompt-y">Prompt Y</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:52:58.064059Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:52:58.063333Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:52:58.077867Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:52:58.077316Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:52:58.064034Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>promptY_ds, examples <span class="op">=</span> get_ds(<span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2252
}) ['neutral', 'neutral', 'neutral', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'neutral', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:53:40.014078Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:53:40.013266Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:55:19.769152Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:55:19.768418Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:53:40.014049Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptY_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7508b1005ef745398a214941f9314d67","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:55:19.772363Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:55:19.772166Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:55:19.777752Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:55:19.776977Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:55:19.772339Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array(['negative', 'positive', 'neutral'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve on the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:55:19.781903Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:55:19.781666Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:55:19.788921Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:55:19.788213Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:55:19.781880Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.7255772646536413</code></pre>
</div>
</div>
<p>This prompt performs well on <code>negative</code> and <code>neutral</code> sentences but its worse performance on <code>positive</code> sentences brings down the overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:55:19.792298Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:55:19.792068Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:55:19.877641Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:55:19.876956Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:55:19.792277Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-171-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="index_files/figure-html/cell-171-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T12:55:19.881782Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T12:55:19.881592Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T12:55:19.901251Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T12:55:19.900761Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T12:55:19.881763Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_Y.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll try 5 prompts with 18 examples.</p>
</section>
<section id="prompt-z" class="level2">
<h2 class="anchored" data-anchor-id="prompt-z">Prompt Z</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:04:14.959665Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:04:14.959345Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:04:14.977149Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:04:14.976517Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:04:14.959640Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>promptZ_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2246
}) ['neutral', 'neutral', 'neutral', 'positive', 'neutral', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'positive', 'positive', 'neutral', 'positive', 'negative', 'negative', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:04:52.757586Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:04:52.756975Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:07:00.822631Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:07:00.821877Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:04:52.757562Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptZ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f4d3fde5dc124a87b54dc92ad68555e1","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:07:00.825784Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:07:00.825632Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:07:00.830913Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:07:00.830190Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:07:00.825770Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:07:00.833757Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:07:00.833569Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:07:00.840036Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:07:00.839316Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:07:00.833738Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0.7132680320569902</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:07:00.842376Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:07:00.842238Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:07:00.928534Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:07:00.927958Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:07:00.842363Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-177-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="index_files/figure-html/cell-177-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:07:00.932023Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:07:00.931549Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:07:00.949250Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:07:00.948855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:07:00.932004Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_Z.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-aa" class="level2">
<h2 class="anchored" data-anchor-id="prompt-aa">Prompt AA</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:10:00.027553Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:10:00.026691Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:10:00.043156Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:10:00.041761Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:10:00.027520Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>promptAA_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2247
}) ['neutral', 'negative', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'negative', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:10:18.080573Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:10:18.079668Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:12:26.095893Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:12:26.095119Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:10:18.080541Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAA_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9eee93c8dafb42fab936d0e4163ab7c9","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:13:20.214039Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:13:20.213511Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:13:20.218763Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:13:20.218133Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:13:20.214019Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This set of 18 examples increases the best overall accuraacy to almost 80%!</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:13:44.139042Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:13:44.138134Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:13:44.144734Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:13:44.144065Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:13:44.139011Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0.7948375611927013</code></pre>
</div>
</div>
<p>Compared to Prompt X, this prompt performs worse on <code>negative</code> (206 &lt; 270) and <code>positive</code> (400 &lt; 455) but more than makes up for it on <code>neutral</code> sentences (1180 &gt; 1000).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:14:55.630928Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:14:55.630280Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:14:55.712690Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:14:55.712227Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:14:55.630904Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-183-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="index_files/figure-html/cell-183-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:17:38.622646Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:17:38.621923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:17:38.640908Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:17:38.640426Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:17:38.622618Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AA.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ab" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ab">Prompt AB</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:18:39.310382Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:18:39.309951Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:18:39.324078Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:18:39.323492Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:18:39.310361Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>promptAB_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2246
}) ['neutral', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'negative', 'neutral', 'negative', 'neutral', 'negative', 'neutral', 'positive', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:18:55.502725Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:18:55.502144Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:20:59.052763Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:20:59.051867Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:18:55.502702Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAB_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4971be2d1b2b4bb781db14c1184fbe1d","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:20:59.056101Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:20:59.055877Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:20:59.060932Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:20:59.060110Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:20:59.056101Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:20:59.064202Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:20:59.063708Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:20:59.069116Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:20:59.068587Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:20:59.064190Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>0.7422083704363313</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:20:59.070877Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:20:59.070782Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:20:59.155477Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:20:59.154892Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:20:59.070864Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-189-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="index_files/figure-html/cell-189-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-19T13:20:59.160025Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-19T13:20:59.159859Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-19T13:20:59.179450Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-19T13:20:59.178919Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-19T13:20:59.160005Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AB.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ac" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ac">Prompt AC</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:11:36.105141Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:11:36.104525Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:11:36.127962Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:11:36.127482Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:11:36.105121Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>promptAC_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2246
}) ['neutral', 'neutral', 'positive', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'neutral', 'positive', 'positive', 'positive', 'neutral', 'positive', 'neutral', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:12:13.238961Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:12:13.238364Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:14:20.573255Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:14:20.572804Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:12:13.238937Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAC_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eef1dc7c1eba4872b16dbad716045260","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:14:20.574833Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:14:20.574189Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:14:20.582637Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:14:20.582294Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:14:20.574812Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:14:27.886786Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:14:27.886255Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:14:27.892243Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:14:27.891855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:14:27.886766Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.6856634016028496</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:16:01.039671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:16:01.038874Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:16:01.157578Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:16:01.157042Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:16:01.039647Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-195-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="index_files/figure-html/cell-195-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:16:12.545411Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:16:12.545167Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:16:12.566224Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:16:12.565714Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:16:12.545395Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AC.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ad" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ad">Prompt AD</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:17:01.824377Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:17:01.823863Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:17:01.837729Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:17:01.837160Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:17:01.824354Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>promptAD_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2246
}) ['neutral', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'neutral', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:17:31.376114Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:17:31.375623Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:19:32.081242Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:19:32.080760Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:17:31.376094Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAD_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"25f501e61aa44a089dff31dc0297bb6c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:19:51.564249Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:19:51.563537Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:19:51.569318Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:19:51.568689Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:19:51.564221Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:19:57.467901Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:19:57.467630Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:19:57.473771Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:19:57.473193Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:19:57.467883Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0.7497773820124666</code></pre>
</div>
</div>
<p>This prompt yields considerably more correct <code>negative</code> sentences (271 &gt; 206) than the best-performing Prompt AA.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:20:13.407239Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:20:13.406655Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:20:13.486939Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:20:13.486458Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:20:13.407218Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-201-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="index_files/figure-html/cell-201-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T13:21:15.836880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T13:21:15.836244Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T13:21:15.853934Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T13:21:15.853482Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T13:21:15.836858Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AD.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll try 5 prompts with 24 examples each.</p>
</section>
<section id="prompt-ae" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ae">Prompt AE</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:06:34.990200Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:06:34.989685Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:06:35.004289Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:06:35.003730Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:06:34.990178Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>promptAE_ds, examples <span class="op">=</span> get_ds(<span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2240
}) ['neutral', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'negative']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:07:01.009283Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:07:01.008551Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:09:29.947789Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:09:29.947126Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:07:01.009268Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAE_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b55f037fa913455d8f84840fc1a300bc","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:09:29.949424Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:09:29.948965Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:09:29.953744Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:09:29.953114Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:09:29.949405Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Increasing the number of examples to 24 (at least for these 24 examples) does not improve upon the overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:10:44.164112Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:10:44.163348Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:10:44.170178Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:10:44.169377Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:10:44.164089Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>0.7491071428571429</code></pre>
</div>
</div>
<p>Compared to the best performing Prompt AA, this prompt yields considerably more correct <code>neutral</code> sentences (1267 &gt; 1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:11:10.167126Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:11:10.166543Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:11:10.252463Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:11:10.251831Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:11:10.167105Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-207-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="index_files/figure-html/cell-207-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:11:48.264076Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:11:48.263561Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:11:48.281581Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:11:48.281073Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:11:48.264055Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AE.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-af" class="level2">
<h2 class="anchored" data-anchor-id="prompt-af">Prompt AF</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:12:27.100068Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:12:27.099320Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:12:27.113613Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:12:27.113006Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:12:27.100047Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>promptAF_ds, examples <span class="op">=</span> get_ds(<span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2240
}) ['positive', 'neutral', 'positive', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:12:51.846335Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:12:51.845791Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:15:15.133578Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:15:15.133044Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:12:51.846312Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAF_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"47c697ea14a7462d8fb0096424b59e55","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:15:22.017216Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:15:22.016516Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:15:22.021413Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:15:22.020806Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:15:22.017196Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt doesn’t improve upon the best overall accuracy, and performs better than Prompt AA on <code>neutral</code> sentences.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:15:25.450234Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:15:25.449355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:15:25.457089Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:15:25.456414Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:15:25.450198Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.7308035714285714</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:15:29.809353Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:15:29.809059Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:15:29.891756Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:15:29.891270Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:15:29.809333Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-213-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="index_files/figure-html/cell-213-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:16:06.954846Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:16:06.954476Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:16:06.973681Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:16:06.973130Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:16:06.954818Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AF.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ag" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ag">Prompt AG</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:16:24.639488Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:16:24.638961Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:16:24.654808Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:16:24.654039Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:16:24.639467Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>promptAG_ds, examples <span class="op">=</span> get_ds(<span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2240
}) ['neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'positive', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:16:47.211752Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:16:47.211493Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:19:09.464632Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:19:09.463995Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:16:47.211731Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAG_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c18ad9c4ac9e4dd6a42ba51aeab75a83","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:19:09.467806Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:19:09.467666Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:19:09.472974Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:19:09.472433Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:19:09.467792Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The same trend continues for this set of 24 examples.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:20:00.038425Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:20:00.038168Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:20:00.044319Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:20:00.043761Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:20:00.038407Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>0.75</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:20:08.005110Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:20:08.004271Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:20:08.091111Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:20:08.090399Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:20:08.005086Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-219-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="index_files/figure-html/cell-219-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-20T14:20:33.937771Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-20T14:20:33.937013Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-20T14:20:33.955295Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-20T14:20:33.954706Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-20T14:20:33.937749Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AG.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two more 24-Shot prompts to go.</p>
</section>
<section id="prompt-ah" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ah">Prompt AH</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:04:48.024066Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:04:48.023934Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:04:48.050141Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:04:48.049676Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:04:48.024055Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>promptAH_ds, examples <span class="op">=</span> get_ds(<span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2240
}) ['positive', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'negative', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:05:45.187470Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:05:45.186846Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:08:14.556903Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:08:14.556057Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:05:45.187445Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAH_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7f7fe740de8a47c291bcbdbb0193d2aa","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:08:14.558910Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:08:14.558490Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:08:14.569192Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:08:14.568319Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:08:14.558889Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon the best overall accuracy (though it comes close).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:08:14.570159Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:08:14.569979Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:08:14.578541Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:08:14.575950Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:08:14.570139Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0.7745535714285714</code></pre>
</div>
</div>
<p>This prompt yields more correct <code>negative</code> sentences than Prompt AA (233 &gt; 206).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:08:14.579757Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:08:14.579586Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:08:14.727926Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:08:14.727196Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:08:14.579743Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-225-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="index_files/figure-html/cell-225-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:09:22.708743Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:09:22.708213Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:09:22.742293Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:09:22.741676Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:09:22.708723Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AH.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ai" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ai">Prompt AI</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:09:43.126015Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:09:43.125529Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:09:43.141079Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:09:43.140531Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:09:43.125994Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>promptAI_ds, examples <span class="op">=</span> get_ds(<span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2241
}) ['neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:10:12.415205Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:10:12.414529Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:12:36.825534Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:12:36.824801Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:10:12.415185Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAI_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"228125d0dfd248e79d375a95c3766411","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:12:36.827176Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:12:36.826743Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:12:36.831317Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:12:36.830718Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:12:36.827158Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:12:36.832467Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:12:36.832083Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:12:36.837421Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:12:36.836954Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:12:36.832453Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0.7536813922356091</code></pre>
</div>
</div>
<p>This prompt yields considerably more correct <code>neutral</code> sentences than the best performing Prompt AA (1266 &gt; 1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:12:36.838479Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:12:36.838332Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:12:36.921047Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:12:36.920195Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:12:36.838467Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-231-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="index_files/figure-html/cell-231-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:14:00.234285Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:14:00.233667Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:14:00.257756Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:14:00.257214Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:14:00.234263Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AI.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll try 5 different 30-Shot prompts.</p>
</section>
<section id="prompt-aj" class="level2">
<h2 class="anchored" data-anchor-id="prompt-aj">Prompt AJ</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:14:58.308775Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:14:58.308394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:14:58.324902Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:14:58.324385Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:14:58.308746Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>promptAJ_ds, examples <span class="op">=</span> get_ds(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
}) ['neutral', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'neutral', 'negative', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:15:33.793768Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:15:33.792810Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:18:26.300816Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:18:26.300275Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:15:33.793736Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAJ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"388a9a32dcd244488c6d29376f7e02e1","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:18:26.302079Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:18:26.301894Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:18:26.313439Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:18:26.312950Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:18:26.302064Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt doesn’t improve the best overall accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:18:26.314278Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:18:26.314106Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:18:26.326790Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:18:26.326222Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:18:26.314258Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.7739480752014324</code></pre>
</div>
</div>
<p>As seems to be the trend, this prompt results in more correct <code>neutral</code> responses (1284) than Prompt AA (1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:18:26.328350Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:18:26.327918Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:18:26.428491Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:18:26.425775Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:18:26.328333Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-237-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="index_files/figure-html/cell-237-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:19:36.528018Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:19:36.527409Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:19:36.549860Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:19:36.549306Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:19:36.527996Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AJ.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ak" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ak">Prompt AK</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:20:20.954124Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:20:20.953339Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:20:20.968321Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:20:20.967835Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:20:20.954099Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>promptAK_ds, examples <span class="op">=</span> get_ds(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
}) ['neutral', 'neutral', 'neutral', 'negative', 'negative', 'positive', 'neutral', 'neutral', 'positive', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:20:43.738610Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:20:43.737832Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:23:39.346675Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:23:39.346094Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:20:43.738587Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAK_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"752ad28690584f4388f4874bed05f404","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:24:30.273053Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:24:30.272431Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:24:30.278835Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:24:30.278072Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:24:30.273010Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb389"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The model performs considerably worse with these 30 examples.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:24:35.408336Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:24:35.407467Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:24:35.414228Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:24:35.413554Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:24:35.408310Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0.6777081468218442</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:24:58.777713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:24:58.777114Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:24:58.860097Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:24:58.859621Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:24:58.777692Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-243-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="index_files/figure-html/cell-243-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-21T13:25:17.588606Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-21T13:25:17.588328Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-21T13:25:17.608148Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-21T13:25:17.607538Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-21T13:25:17.588591Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AK.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-al" class="level2">
<h2 class="anchored" data-anchor-id="prompt-al">Prompt AL</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:44:03.234919Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:44:03.234661Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:44:03.249997Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:44:03.249509Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:44:03.234901Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>promptAL_ds, examples <span class="op">=</span> get_ds(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
}) ['positive', 'neutral', 'positive', 'positive', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:44:07.149376Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:44:07.149110Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:46:52.918686Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:46:52.918132Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:44:07.149358Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAL_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"47d1acf2e84b46cda653d6ad786a3c11","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:46:52.921542Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:46:52.921362Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:46:52.926032Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:46:52.925554Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:46:52.921524Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The trend continues: the overall accuracy doesn’t improve but the model’s performance on <code>neutral</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:46:52.928711Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:46:52.928567Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:46:52.934045Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:46:52.933549Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:46:52.928697Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.76544315129812</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:46:52.936119Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:46:52.935908Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:46:53.020152Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:46:53.019625Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:46:52.936101Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-249-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="index_files/figure-html/cell-249-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:46:53.022868Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:46:53.022717Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:46:53.042615Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:46:53.042137Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:46:53.022852Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AL.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two more 30-Shot prompts to go.</p>
</section>
<section id="prompt-am" class="level2">
<h2 class="anchored" data-anchor-id="prompt-am">Prompt AM</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:48:02.571312Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:48:02.570969Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:48:02.588766Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:48:02.588223Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:48:02.571287Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>promptAM_ds, examples <span class="op">=</span> get_ds(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
}) ['negative', 'neutral', 'positive', 'negative', 'neutral', 'neutral', 'positive', 'negative', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:48:05.587942Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:48:05.587162Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:50:56.616413Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:50:56.615827Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:48:05.587921Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAM_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0ce200d71898459580ee93e9041dd68a","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:50:56.618963Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:50:56.618658Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:50:56.622701Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:50:56.622370Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:50:56.618946Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The overall accuracy doesn’t improve but the model’s performance on <code>negative</code> and <code>positive</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:50:56.625106Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:50:56.624784Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:50:56.629640Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:50:56.629305Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:50:56.625090Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>0.7484333034914951</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:50:56.631734Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:50:56.631376Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:50:56.711129Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:50:56.710722Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:50:56.631718Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb413"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-255-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="index_files/figure-html/cell-255-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:54:29.225555Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:54:29.224897Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:54:29.304296Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:54:29.303631Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:54:29.225526Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AM.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-an" class="level2">
<h2 class="anchored" data-anchor-id="prompt-an">Prompt AN</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:56:32.752141Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:56:32.751348Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:56:32.766574Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:56:32.765928Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:56:32.752117Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>promptAN_ds, examples <span class="op">=</span> get_ds(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2234
}) ['positive', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:56:48.089634Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:56:48.088913Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:59:44.860049Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:59:44.859324Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:56:48.089611Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAN_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"798beda697a54ce18f225ae0ba7e2375","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:59:44.863119Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:59:44.862967Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:59:44.868108Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:59:44.867323Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:59:44.863104Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The overall accuracy doesn’t improve but the model’s performance on <code>positive</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:59:44.870915Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:59:44.870764Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:59:44.876373Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:59:44.875818Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:59:44.870895Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.7381378692927484</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T14:59:44.878437Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T14:59:44.878290Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T14:59:44.966813Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T14:59:44.966381Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T14:59:44.878424Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-261-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="index_files/figure-html/cell-261-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:06:23.636494Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:06:23.635730Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:06:23.654901Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:06:23.654453Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:06:23.636468Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb424"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AN.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll increase the number of examples to 45.</p>
</section>
<section id="prompt-ao" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ao">Prompt AO</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:10:29.131009Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:10:29.130591Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:10:29.146418Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:10:29.146009Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:10:29.130987Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>promptAO_ds, examples <span class="op">=</span> get_ds(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2219
}) ['neutral', 'neutral', 'positive', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:10:47.464170Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:10:47.463358Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:14:32.928491Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:14:32.928034Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:10:47.464145Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAO_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cec3262f3d434b96a9d723031d1b520c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:20:13.460268Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:20:13.459781Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:20:13.464427Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:20:13.463966Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:20:13.460246Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The overall accuracy doesn’t improve but the model’s performance on <code>positive</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:20:19.637107Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:20:19.636507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:20:19.643040Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:20:19.642342Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:20:19.637085Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>0.7417755745831456</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:20:30.733104Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:20:30.732593Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:20:30.814586Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:20:30.814022Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:20:30.733085Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-267-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="index_files/figure-html/cell-267-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:23:03.728708Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:23:03.727797Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:23:03.752066Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:23:03.751438Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:23:03.728676Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AO.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ap" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ap">Prompt AP</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:23:30.705033Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:23:30.704766Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:23:30.722006Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:23:30.721399Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:23:30.705014Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a>promptAP_ds, examples <span class="op">=</span> get_ds(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2219
}) ['neutral', 'positive', 'negative', 'neutral', 'positive', 'neutral', 'positive', 'positive', 'neutral', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:23:45.039933Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:23:45.039424Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:27:44.733850Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:27:44.733258Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:23:45.039914Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAP_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f5de94812e424e0e8f0d7fc342077431","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:27:44.736642Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:27:44.736500Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:27:44.740547Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:27:44.740171Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:27:44.736628Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The overall accuracy doesn’t improve but the model’s performance on <code>neutral</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:27:44.742814Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:27:44.742678Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:27:44.748093Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:27:44.747612Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:27:44.742800Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>0.7872915727805317</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:27:44.750078Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:27:44.749944Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:27:44.832577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:27:44.831788Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:27:44.750065Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-273-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="index_files/figure-html/cell-273-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:29:45.605092Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:29:45.604749Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:29:45.625955Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:29:45.625388Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:29:45.605065Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AP.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-aq" class="level2">
<h2 class="anchored" data-anchor-id="prompt-aq">Prompt AQ</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:30:17.896877Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:30:17.896340Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:30:17.912057Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:30:17.911549Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:30:17.896857Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>promptAQ_ds, examples <span class="op">=</span> get_ds(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2219
}) ['neutral', 'neutral', 'negative', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:30:36.925551Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:30:36.924795Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:34:20.670491Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:34:20.669841Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:30:36.925529Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAQ_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ecfe97cde26f4fb78d9d05000ee42c75","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:34:20.673221Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:34:20.673061Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:34:20.677376Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:34:20.676909Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:34:20.673221Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>The overall accuracy doesn’t improve but the model’s performance on <code>neutral</code> sentences does.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:34:20.679817Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:34:20.679694Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:34:20.684781Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:34:20.684289Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:34:20.679805Z&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>0.7201442091031997</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:34:20.686695Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:34:20.686550Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:34:20.767211Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:34:20.766771Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:34:20.686681Z&quot;}" data-execution_count="60">
<div class="sourceCode cell-code" id="cb453"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-279-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="index_files/figure-html/cell-279-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-22T15:43:32.655535Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-22T15:43:32.654958Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-22T15:43:32.673359Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-22T15:43:32.672722Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-22T15:43:32.655513Z&quot;}" data-execution_count="61">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AQ.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ar" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ar">Prompt AR</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T16:56:39.257012Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T16:56:39.256490Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T16:56:39.273011Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T16:56:39.272393Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T16:56:39.256991Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>promptAR_ds, examples <span class="op">=</span> get_ds(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2219
}) ['neutral', 'negative', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T16:56:44.444439Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T16:56:44.443754Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T17:00:37.805708Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T17:00:37.804769Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T16:56:44.444409Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAR_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f9583e14f7ec41f1b4bf77273e41cd69","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T17:00:37.807490Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T17:00:37.807133Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T17:00:37.816551Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T17:00:37.815884Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T17:00:37.807470Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt performs worse than the best overall Prompt AA.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T17:00:37.817666Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T17:00:37.817496Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T17:00:37.823581Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T17:00:37.823044Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T17:00:37.817651Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0.7386210004506535</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T17:00:37.824794Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T17:00:37.824588Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T17:00:37.945184Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T17:00:37.944615Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T17:00:37.824776Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-285-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="index_files/figure-html/cell-285-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T17:01:32.220917Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T17:01:32.220256Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T17:01:32.259102Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T17:01:32.258494Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T17:01:32.220891Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AR.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-as" class="level2">
<h2 class="anchored" data-anchor-id="prompt-as">Prompt AS</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:14:49.541363Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:14:49.540820Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:14:49.585211Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:14:49.584745Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:14:49.541340Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a>promptAS_ds, examples <span class="op">=</span> get_ds(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2219
}) ['neutral', 'negative', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:15:06.640204Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:15:06.639932Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:18:59.912588Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:18:59.911836Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:15:06.640183Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAS_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"82770a240e5d4098ae3ac2480be17e24","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.
Starting from v4.46, the `logits` model output will have the same type as the model (except at train time, where it will always be FP32)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:24:17.995156Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:24:17.994844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:24:18.007158Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:24:18.006425Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:24:17.995147Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>array(['positive', 'neutral', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Compared to Prompt AA, this prompt yields a worse overall accuracy but improves on <code>neutral</code> sentences (1291 &gt; 1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:24:22.940661Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:24:22.940381Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:24:22.946895Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:24:22.946352Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:24:22.940642Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>0.7494366831906264</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:24:26.444460Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:24:26.443760Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:24:26.642284Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:24:26.641395Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:24:26.444432Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-291-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="index_files/figure-html/cell-291-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:25:07.495770Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:25:07.495464Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:25:07.524451Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:25:07.523689Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:25:07.495750Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AS.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I’ll move on to the final number of examples: 60.</p>
</section>
<section id="prompt-at" class="level2">
<h2 class="anchored" data-anchor-id="prompt-at">Prompt AT</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:25:58.954202Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:25:58.953826Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:25:58.974165Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:25:58.973415Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:25:58.954180Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>promptAT_ds, examples <span class="op">=</span> get_ds(<span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
}) ['positive', 'neutral', 'neutral', 'negative', 'negative', 'neutral', 'neutral', 'neutral', 'negative', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:26:15.186418Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:26:15.185600Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:31:02.017286Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:31:02.016812Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:26:15.186383Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAT_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d8237fa0d9834380b2a6431c28ec8acd","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:31:02.020144Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:31:02.019706Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:31:02.023681Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:31:02.023310Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:31:02.020125Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Upping the number of examples to 60 does not improve results.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:31:02.026276Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:31:02.025844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:31:02.030749Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:31:02.030388Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:31:02.026258Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb483"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.7218693284936479</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:31:02.033012Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:31:02.032591Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:31:02.116057Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:31:02.115626Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:31:02.032995Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb485"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-297-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="index_files/figure-html/cell-297-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:32:08.073543Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:32:08.072695Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:32:08.094514Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:32:08.094080Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:32:08.073513Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb486-1"><a href="#cb486-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AT.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-au" class="level2">
<h2 class="anchored" data-anchor-id="prompt-au">Prompt AU</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:32:40.591396Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:32:40.590317Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:32:40.609182Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:32:40.608772Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:32:40.591364Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb487"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a>promptAU_ds, examples <span class="op">=</span> get_ds(<span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
}) ['neutral', 'positive', 'neutral', 'positive', 'negative', 'positive', 'positive', 'negative', 'positive', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:33:12.337099Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:33:12.336373Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:38:08.955608Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:38:08.954859Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:33:12.337074Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAU_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e0fc36010b744635995c2e97cc11e04c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:38:08.958564Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:38:08.958394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:38:08.962971Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:38:08.962483Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:38:08.958557Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Compared to Prompt AA, this prompt yields a worse overall accuracy but improves on <code>neutral</code> sentences (1237 &gt; 1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:38:08.965851Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:38:08.965750Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:38:08.971395Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:38:08.970892Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:38:08.965845Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0.7686025408348457</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:38:08.973429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:38:08.973268Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:38:09.057795Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:38:09.057194Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:38:08.973378Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-303-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="index_files/figure-html/cell-303-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:41:33.155895Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:41:33.155120Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:41:33.175706Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:41:33.174993Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:41:33.155895Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AU.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-av" class="level2">
<h2 class="anchored" data-anchor-id="prompt-av">Prompt AV</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:42:03.776289Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:42:03.775695Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:42:03.796742Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:42:03.796107Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:42:03.776261Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>promptAV_ds, examples <span class="op">=</span> get_ds(<span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
}) ['positive', 'neutral', 'neutral', 'neutral', 'positive', 'positive', 'neutral', 'positive', 'negative', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:42:18.680778Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:42:18.680411Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:47:26.825007Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:47:26.824353Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:42:18.680749Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAV_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6023c7bb4f574d22a1ff430de9860e53","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:47:26.827734Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:47:26.827580Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:47:26.832589Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:47:26.832103Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:47:26.827719Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Compared to Prompt AA, this prompt yields a worse overall accuracy but improves on <code>neutral</code> sentences (1206 &gt; 1180).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:47:26.835430Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:47:26.835276Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:47:26.840976Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:47:26.840418Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:47:26.835412Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.7545372050816697</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:47:26.843270Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:47:26.843127Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:47:26.932167Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:47:26.931725Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:47:26.843256Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-309-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="index_files/figure-html/cell-309-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-23T22:57:19.777810Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-23T22:57:19.777386Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-23T22:57:19.800638Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-23T22:57:19.800091Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-23T22:57:19.777778Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AV.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-aw" class="level2">
<h2 class="anchored" data-anchor-id="prompt-aw">Prompt AW</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:13:46.901252Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:13:46.899978Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:13:46.938335Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:13:46.937696Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:13:46.901210Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>promptAW_ds, examples <span class="op">=</span> get_ds(<span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
}) ['neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'negative', 'neutral', 'neutral', 'neutral']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:14:02.402419Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:14:02.401711Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:19:18.840331Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:19:18.839550Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:14:02.402390Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAW_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d8ff0d468c5c4a0580de6ef51f041e92","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:19:18.843142Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:19:18.841987Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:19:18.850895Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:19:18.850220Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:19:18.843105Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>This prompt does not improve upon Prompt AA results.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:19:18.852817Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:19:18.851860Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:19:18.859471Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:19:18.858980Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:19:18.852786Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0.7445553539019963</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:19:18.861731Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:19:18.860891Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:19:18.991387Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:19:18.990545Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:19:18.861699Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-315-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="index_files/figure-html/cell-315-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:19:45.108199Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:19:45.107485Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:19:45.133530Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:19:45.132925Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:19:45.108173Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb517"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AW.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-ax" class="level2">
<h2 class="anchored" data-anchor-id="prompt-ax">Prompt AX</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:20:04.507414Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:20:04.506716Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:20:04.527938Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:20:04.527340Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:20:04.507385Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a>promptAX_ds, examples <span class="op">=</span> get_ds(<span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2204
}) ['neutral', 'neutral', 'negative', 'negative', 'neutral', 'negative', 'positive', 'neutral', 'positive', 'negative']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:20:10.091462Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:20:10.090750Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:25:27.191285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:25:27.190228Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:20:10.091436Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb520"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> few_shot_responses(promptAX_ds, promptJ, examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"4d221d9d4d0c4600a68af9640def59c3","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Label the following TEXT with a single word: positive, negative, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:25:27.198454Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:25:27.198174Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:25:27.204421Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:25:27.203540Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:25:27.198390Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb522"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'responses'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<p>Aha! We finally improve on the overall accuracy of Prompt AA. This prompt yields a slightly higher accuracy that still rounds off to 80%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:25:27.209328Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:25:27.208741Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:25:27.217153Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:25:27.216291Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:25:27.209302Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a>get_acc(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.7962794918330308</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T14:25:17.853772Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T14:25:17.853150Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T14:25:18.029861Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T14:25:18.029273Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T14:25:17.853750Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb526"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-321-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="index_files/figure-html/cell-321-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-10-24T23:28:23.698804Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-10-24T23:28:23.697946Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-10-24T23:28:23.720236Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-10-24T23:28:23.719380Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-10-24T23:28:23.698764Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb527"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/Qwen2-0.5B-Instruct_AX.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-inference-10-times-using-the-best-prompt" class="level2">
<h2 class="anchored" data-anchor-id="running-inference-10-times-using-the-best-prompt">Running Inference 10 Times Using the Best Prompt</h2>
<p>While 60-shot Prompt AX had a slightly higher accuracy (79.63%) I am going to pick the 16-Shot Prompt AA as my best prompt (79.48%) since it has less than a third of the examples, which translates to about a third of the tokens, thus leading to quicker response generation.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:24:58.367864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:24:58.367297Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:24:58.373172Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:24:58.372462Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:24:58.367838Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb528"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_gen(examples):</span>
<span id="cb528-2"><a href="#cb528-2" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb528-3"><a href="#cb528-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb528-4"><a href="#cb528-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb528-5"><a href="#cb528-5" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: promptJ.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb528-6"><a href="#cb528-6" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb528-7"><a href="#cb528-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb528-8"><a href="#cb528-8" aria-hidden="true" tabindex="-1"></a>    messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: promptJ.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])}]</span>
<span id="cb528-9"><a href="#cb528-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb528-10"><a href="#cb528-10" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb528-11"><a href="#cb528-11" aria-hidden="true" tabindex="-1"></a>        messages,</span>
<span id="cb528-12"><a href="#cb528-12" aria-hidden="true" tabindex="-1"></a>        tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb528-13"><a href="#cb528-13" aria-hidden="true" tabindex="-1"></a>        add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb528-14"><a href="#cb528-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb528-15"><a href="#cb528-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb528-16"><a href="#cb528-16" aria-hidden="true" tabindex="-1"></a>    model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb528-17"><a href="#cb528-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-18"><a href="#cb528-18" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb528-19"><a href="#cb528-19" aria-hidden="true" tabindex="-1"></a>        model_inputs.input_ids,</span>
<span id="cb528-20"><a href="#cb528-20" aria-hidden="true" tabindex="-1"></a>        max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb528-21"><a href="#cb528-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb528-22"><a href="#cb528-22" aria-hidden="true" tabindex="-1"></a>    generated_ids <span class="op">=</span> [</span>
<span id="cb528-23"><a href="#cb528-23" aria-hidden="true" tabindex="-1"></a>        output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb528-24"><a href="#cb528-24" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb528-25"><a href="#cb528-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-26"><a href="#cb528-26" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb528-27"><a href="#cb528-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:26:57.789368Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:26:57.788817Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:26:57.817121Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:26:57.816520Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:26:57.789348Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>promptAA_ds, examples <span class="op">=</span> get_ds(<span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2246
}) ['negative', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'neutral', 'neutral', 'positive', 'positive']</code></pre>
</div>
</div>
<p>1 response generation takes 72ms. Running full dataset inference 10 times will take about 30 minutes.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T13:27:11.898558Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T13:27:11.897846Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T13:27:16.975223Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T13:27:16.974612Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T13:27:11.898534Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb531"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">10</span> test_gen(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The attention mask is not set and cannot be inferred from input because pad token is same as eos token. As a consequence, you may observe unexpected behavior. Please pass your input's `attention_mask` to obtain reliable results.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>72 ms ± 42.9 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T14:25:07.586952Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T14:25:07.586414Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T14:25:07.592898Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T14:25:07.592294Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T14:25:07.586932Z&quot;}" data-execution_count="35">
<details>
<summary>Show updated <code>few_shot_responses</code> function</summary>
<div class="sourceCode cell-code" id="cb534"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb534-1"><a href="#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> few_shot_responses(dataset, prompt, examples):</span>
<span id="cb534-2"><a href="#cb534-2" aria-hidden="true" tabindex="-1"></a>    responses <span class="op">=</span> []</span>
<span id="cb534-3"><a href="#cb534-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb534-4"><a href="#cb534-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb534-5"><a href="#cb534-5" aria-hidden="true" tabindex="-1"></a>    few_shot_examples <span class="op">=</span> []</span>
<span id="cb534-6"><a href="#cb534-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb534-7"><a href="#cb534-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> example <span class="kw">in</span> examples:</span>
<span id="cb534-8"><a href="#cb534-8" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt.<span class="bu">format</span>(text<span class="op">=</span>example[<span class="dv">0</span>])})</span>
<span id="cb534-9"><a href="#cb534-9" aria-hidden="true" tabindex="-1"></a>        few_shot_examples.append({<span class="st">"role"</span>: <span class="st">"assistant"</span>, <span class="st">"content"</span>: example[<span class="dv">1</span>]})</span>
<span id="cb534-10"><a href="#cb534-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb534-11"><a href="#cb534-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> dataset:</span>
<span id="cb534-12"><a href="#cb534-12" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> few_shot_examples <span class="op">+</span> [{<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: row[<span class="st">'prompt'</span>]}]</span>
<span id="cb534-13"><a href="#cb534-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb534-14"><a href="#cb534-14" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> tokenizer.apply_chat_template(</span>
<span id="cb534-15"><a href="#cb534-15" aria-hidden="true" tabindex="-1"></a>            messages,</span>
<span id="cb534-16"><a href="#cb534-16" aria-hidden="true" tabindex="-1"></a>            tokenize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb534-17"><a href="#cb534-17" aria-hidden="true" tabindex="-1"></a>            add_generation_prompt<span class="op">=</span><span class="va">True</span></span>
<span id="cb534-18"><a href="#cb534-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb534-19"><a href="#cb534-19" aria-hidden="true" tabindex="-1"></a>        model_inputs <span class="op">=</span> tokenizer([text], return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb534-20"><a href="#cb534-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-21"><a href="#cb534-21" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> model.generate(</span>
<span id="cb534-22"><a href="#cb534-22" aria-hidden="true" tabindex="-1"></a>            model_inputs.input_ids,</span>
<span id="cb534-23"><a href="#cb534-23" aria-hidden="true" tabindex="-1"></a>            max_new_tokens<span class="op">=</span><span class="dv">2</span></span>
<span id="cb534-24"><a href="#cb534-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb534-25"><a href="#cb534-25" aria-hidden="true" tabindex="-1"></a>        generated_ids <span class="op">=</span> [</span>
<span id="cb534-26"><a href="#cb534-26" aria-hidden="true" tabindex="-1"></a>            output_ids[<span class="bu">len</span>(input_ids):] <span class="cf">for</span> input_ids, output_ids <span class="kw">in</span> <span class="bu">zip</span>(model_inputs.input_ids, generated_ids)</span>
<span id="cb534-27"><a href="#cb534-27" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb534-28"><a href="#cb534-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-29"><a href="#cb534-29" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> tokenizer.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>].strip().lower()</span>
<span id="cb534-30"><a href="#cb534-30" aria-hidden="true" tabindex="-1"></a>        responses.append(response)</span>
<span id="cb534-31"><a href="#cb534-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb534-32"><a href="#cb534-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb534-33"><a href="#cb534-33" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb534-34"><a href="#cb534-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> pd.Series(responses)</span>
<span id="cb534-35"><a href="#cb534-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'responses'</span>] <span class="op">=</span> df[<span class="st">'responses'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb534-36"><a href="#cb534-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'responses'</span>]</span>
<span id="cb534-37"><a href="#cb534-37" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb534-38"><a href="#cb534-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb534-39"><a href="#cb534-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T14:30:35.214749Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T14:30:35.214075Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T14:30:35.218795Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T14:30:35.217941Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T14:30:35.214728Z&quot;}" data-execution_count="38">
<details>
<summary>Show updated <code>get_ds</code> function</summary>
<div class="sourceCode cell-code" id="cb535"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ds(n):</span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a>    exclude_idxs <span class="op">=</span> [random.randint(<span class="dv">0</span>, <span class="dv">2263</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb535-3"><a href="#cb535-3" aria-hidden="true" tabindex="-1"></a>    prompt_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>exclude_idxs)</span>
<span id="cb535-4"><a href="#cb535-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-5"><a href="#cb535-5" aria-hidden="true" tabindex="-1"></a>    examples <span class="op">=</span> []</span>
<span id="cb535-6"><a href="#cb535-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> exclude_idxs:</span>
<span id="cb535-7"><a href="#cb535-7" aria-hidden="true" tabindex="-1"></a>        examples.append((dataset[idx][<span class="st">'sentence'</span>], dataset[idx][<span class="st">'label_text'</span>]))</span>
<span id="cb535-8"><a href="#cb535-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb535-9"><a href="#cb535-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt_ds, examples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I didn’t store the exact 18 examples that I used the first time for Prompt AA, so I had to try different 18-Shot examples until I achieved an accuracy close to 79.48%. It took me about 20 tries, but I finally found a set of examples that broke the 79% threshold.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T14:54:34.566913Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T14:54:34.566209Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T14:56:40.474028Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T14:56:40.473384Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T14:54:34.566886Z&quot;}">
<div class="sourceCode cell-code" id="cb536"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb536-1"><a href="#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb536-2"><a href="#cb536-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb536-3"><a href="#cb536-3" aria-hidden="true" tabindex="-1"></a>    ds, examples <span class="op">=</span> get_ds(n)</span>
<span id="cb536-4"><a href="#cb536-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(ds) <span class="op">!=</span> <span class="dv">2264</span> <span class="op">-</span> n: <span class="cf">pass</span></span>
<span id="cb536-5"><a href="#cb536-5" aria-hidden="true" tabindex="-1"></a>    df, acc <span class="op">=</span> few_shot_responses(ds, promptJ, examples)</span>
<span id="cb536-6"><a href="#cb536-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">round</span>(acc, <span class="dv">2</span>) <span class="op">&gt;=</span> <span class="fl">0.79</span>: <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T15:00:29.979940Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T15:00:29.979419Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T15:00:29.983830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T15:00:29.983227Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T15:00:29.979918Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb537"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.815227070347284</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T15:02:22.448916Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T15:02:22.448661Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T15:02:22.453161Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T15:02:22.452663Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T15:02:22.448900Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb539"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb539-1"><a href="#cb539-1" aria-hidden="true" tabindex="-1"></a>ds, <span class="bu">len</span>(examples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>(Dataset({
     features: ['sentence', 'label', 'label_text', '__index_level_0__'],
     num_rows: 2246
 }),
 18)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T15:02:31.195144Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T15:02:31.194651Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T15:23:40.781808Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T15:23:40.781140Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T15:02:31.195123Z&quot;}">
<div class="sourceCode cell-code" id="cb541"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb541-1"><a href="#cb541-1" aria-hidden="true" tabindex="-1"></a>accs <span class="op">=</span> []</span>
<span id="cb541-2"><a href="#cb541-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb541-3"><a href="#cb541-3" aria-hidden="true" tabindex="-1"></a>    df, acc <span class="op">=</span> few_shot_responses(ds, promptJ, examples)</span>
<span id="cb541-4"><a href="#cb541-4" aria-hidden="true" tabindex="-1"></a>    accs.append(acc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this prompt, the overall accuracy ranges from 80.8% to 82.4%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-11-18T15:23:40.784481Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-11-18T15:23:40.784344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-11-18T15:23:40.792597Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-11-18T15:23:40.792074Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-11-18T15:23:40.784466Z&quot;}" data-execution_count="46">
<div class="sourceCode cell-code" id="cb542"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>pd.Series(accs).describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>count    10.000000
mean      0.816830
std       0.005397
min       0.807658
25%       0.814003
50%       0.817453
75%       0.819791
max       0.824577
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Takeaways from my Qwen2-0.5B experiments:</p>
<ul>
<li><strong>Example order matters</strong>: Testing 6 prompts with the same 3 examples in different orders yielded accuracies from 57% to 75%.<br>
</li>
<li><strong>Example selection matters</strong>: Recreating the performance of one of my best prompts (79.48% accuracy) took ~20 attempts, proving not all sets of examples perform equally.<br>
</li>
<li><strong>Result variance exists</strong>: Running a prompt 10 times produced accuracies ranging from 80.8% to 82.4%.</li>
</ul>
<p>Here are the results of Qwen2-0.5B in the context of the other models that I have experimented with:</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">Prompting Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">claude-3-5-sonnet-20240620</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">94.78%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">94% (1302/1391)</td>
<td style="text-align: center;">95% (544/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">claude-3-opus-20240229</td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">94.13%</td>
<td style="text-align: center;">98% (297/303)</td>
<td style="text-align: center;">96% (1333/1391)</td>
<td style="text-align: center;">88% (501/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">phi-3.5</td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">93.94%</td>
<td style="text-align: center;">96% (286/299)</td>
<td style="text-align: center;">98% (1355/1379)</td>
<td style="text-align: center;">83% (467/566)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-3</td>
<td style="text-align: center;">30-Shot w/System Prompt</td>
<td style="text-align: center;">92.79%</td>
<td style="text-align: center;">98% (290/297)</td>
<td style="text-align: center;">94% (1284/1373)</td>
<td style="text-align: center;">88% (499/564)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">claude-3-haiku-20240307</td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">92.39%</td>
<td style="text-align: center;">90% (272/303)</td>
<td style="text-align: center;">91% (1267/1391)</td>
<td style="text-align: center;">96% (550/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;">phi-2</td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91.94%</td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Qwen2-1.5B</td>
<td style="text-align: center;">27-Shot</td>
<td style="text-align: center;">86.10%</td>
<td style="text-align: center;">90% (264/294)</td>
<td style="text-align: center;">96% (1320/1382)</td>
<td style="text-align: center;">61% (342/561)</td>
</tr>
<tr class="even">
<td style="text-align: center;">**Qwen2-0.5B</td>
<td style="text-align: center;">17-Shot</td>
<td style="text-align: center;">79.48%</td>
<td style="text-align: center;">69% (206/300)</td>
<td style="text-align: center;">86% (1180/1380)</td>
<td style="text-align: center;">71% (400/567)</td>
</tr>
</tbody>
</table>
<p>Here are the results from this notebook:</p>
<table class="table">
<thead>
<tr class="header">
<th>Prompt</th>
<th>Strategy</th>
<th>Accuracy</th>
<th>Negative</th>
<th>Neutral</th>
<th>Positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#prompt-a">A</a></td>
<td>0-Shot</td>
<td>62.41%</td>
<td>91% (276/303)</td>
<td>53% (735/1391)</td>
<td>71% (402/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-b">B</a></td>
<td>0-Shot</td>
<td>47.84%</td>
<td>90% (274/303)</td>
<td>57% (789/1391)</td>
<td>4% (20/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-c">C</a></td>
<td>0-Shot</td>
<td>40.46%</td>
<td>91% (276/303)</td>
<td>43% (594/1391)</td>
<td>8% (46/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-d">D</a></td>
<td>0-Shot</td>
<td>68.29%</td>
<td>79% (240/303)</td>
<td>61% (851/1391)</td>
<td>80% (455/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-e">E</a></td>
<td>0-Shot</td>
<td>51.19%</td>
<td>97% (293/303)</td>
<td>28% (396/1391)</td>
<td>82% (470/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-f">F</a></td>
<td>0-Shot</td>
<td>48.19%</td>
<td>94% (286/303)</td>
<td>21% (287/1391)</td>
<td>91% (518/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-g">G</a></td>
<td>0-Shot</td>
<td>61.09%</td>
<td>93% (282/303)</td>
<td>46% (646/1391)</td>
<td>80% (455/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-h">H</a></td>
<td>0-Shot</td>
<td>65.42%</td>
<td>85% (257/303)</td>
<td>57% (798/1391)</td>
<td>75% (426/570)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-i">I</a></td>
<td>0-Shot</td>
<td>66.12%</td>
<td>81% (245/303)</td>
<td>58% (800/1391)</td>
<td>79% (452/570)</td>
</tr>
<tr class="even">
<td><a href="#prompt-j">J</a></td>
<td>3-Shot</td>
<td>70.94%</td>
<td>43% (131/302)</td>
<td>75% (1042/1390)</td>
<td>76% (431/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-k">K</a></td>
<td>3-Shot</td>
<td>74.88%</td>
<td>67% (201/302)</td>
<td>75% (1043/1390)</td>
<td>79% (449/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-l">L</a></td>
<td>3-Shot</td>
<td>68.11%</td>
<td>49% (149/302)</td>
<td>65% (900/1390)</td>
<td>86% (491/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-m">M</a></td>
<td>3-Shot</td>
<td>56.97%</td>
<td>49% (149/302)</td>
<td>45% (625/1390)</td>
<td>90% (514/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-n">N</a></td>
<td>3-Shot</td>
<td>73.95%</td>
<td>62% (188/302)</td>
<td>75% (1038/1390)</td>
<td>78% (446/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-o">O</a></td>
<td>3-Shot</td>
<td>59.97%</td>
<td>65% (196/302)</td>
<td>46% (635/1390)</td>
<td>92% (525/569)</td>
</tr>
<tr class="even">
<td><a href="#prompt-p">P</a></td>
<td>6-Shot</td>
<td>63.91%</td>
<td>95% (289/303)</td>
<td>49% (678/1389)</td>
<td>84% (476/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-q">Q</a></td>
<td>6-Shot</td>
<td>65.72%</td>
<td>69% (207/302)</td>
<td>55% (765/1389)</td>
<td>90% (512/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-r">R</a></td>
<td>6-Shot</td>
<td>64.84%</td>
<td>94% (285/303)</td>
<td>49% (686/1387)</td>
<td>87% (493/568)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-s">S</a></td>
<td>6-Shot</td>
<td>62.98%</td>
<td>96% (292/303)</td>
<td>47% (656/1387)</td>
<td>83% (474/568)</td>
</tr>
<tr class="even">
<td><a href="#prompt-t">T</a></td>
<td>6-Shot</td>
<td>68.87%</td>
<td>51% (155/302)</td>
<td>70% (966/1387)</td>
<td>76% (434/569)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-u">U</a></td>
<td>12-Shot</td>
<td>65.50%</td>
<td>53% (159/302)</td>
<td>59% (820/1386)</td>
<td>88% (496/564)</td>
</tr>
<tr class="even">
<td><a href="#prompt-v">V</a></td>
<td>12-Shot</td>
<td>73.22%</td>
<td>70% (209/300)</td>
<td>80% (1103/1386)</td>
<td>60% (337/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-w">W</a></td>
<td>12-Shot</td>
<td>70.43%</td>
<td>82% (246/301)</td>
<td>66% (912/1384)</td>
<td>75% (428/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-x">X</a></td>
<td>12-Shot</td>
<td>76.60%</td>
<td>91% (270/298)</td>
<td>72% (1000/1386)</td>
<td>80% (455/568)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-y">Y</a></td>
<td>12-Shot</td>
<td>72.56%</td>
<td>80% (243/303)</td>
<td>77% (1069/1381)</td>
<td>57% (322/568)</td>
</tr>
<tr class="even">
<td><a href="#prompt-z">Z</a></td>
<td>18-Shot</td>
<td>71.33%</td>
<td>50% (150/301)</td>
<td>75% (1036/1382)</td>
<td>74% (416/563)</td>
</tr>
<tr class="odd">
<td><strong><a href="#prompt-aa">AA</a></strong></td>
<td><strong>17-Shot</strong></td>
<td><strong>79.48%</strong></td>
<td>69% (206/300)</td>
<td>86% (1180/1380)</td>
<td>71% (400/567)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ab">AB</a></td>
<td>18-Shot</td>
<td>74.22%</td>
<td>77% (229/299)</td>
<td>76% (1054/1381)</td>
<td>68% (384/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ac">AC</a></td>
<td>18-Shot</td>
<td>68.57%</td>
<td>49% (148/302)</td>
<td>73% (1013/1380)</td>
<td>67% (379/564)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ad">AD</a></td>
<td>18-Shot</td>
<td>74.98%</td>
<td>89% (271/303)</td>
<td>76% (1052/1379)</td>
<td>64% (361/564)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ae">AE</a></td>
<td>24-Shot</td>
<td>74.91%</td>
<td>61% (181/299)</td>
<td>92% (1267/1375)</td>
<td>41% (230/566)</td>
</tr>
<tr class="even">
<td><a href="#prompt-af">AF</a></td>
<td>24-Shot</td>
<td>73.08%</td>
<td>37% (112/302)</td>
<td>91% (1246/1375)</td>
<td>50% (279/563)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ag">AG</a></td>
<td>24-Shot</td>
<td>75.00%</td>
<td>58% (173/300)</td>
<td>92% (1265/1375)</td>
<td>43% (242/565)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ah">AH</a></td>
<td>24-Shot</td>
<td>77.46%</td>
<td>78% (233/299)</td>
<td>84% (1153/1375)</td>
<td>62% (349/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ai">AI</a></td>
<td>23-Shot</td>
<td>75.37%</td>
<td>48% (143/301)</td>
<td>92% (1266/1375)</td>
<td>50% (280/565)</td>
</tr>
<tr class="even">
<td><a href="#prompt-aj">AJ</a></td>
<td>30-Shot</td>
<td>77.39%</td>
<td>58% (172/298)</td>
<td>94% (1284/1370)</td>
<td>48% (273/566)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ak">AK</a></td>
<td>30-Shot</td>
<td>67.78%</td>
<td>63% (187/299)</td>
<td>61% (844/1375)</td>
<td>86% (483/560)</td>
</tr>
<tr class="even">
<td><a href="#prompt-al">AL</a></td>
<td>30-Shot</td>
<td>76.54%</td>
<td>58% (173/299)</td>
<td>86% (1185/1372)</td>
<td>63% (352/563)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-am">AM</a></td>
<td>30-Shot</td>
<td>74.84%</td>
<td>82% (242/296)</td>
<td>72% (984/1376)</td>
<td>79% (446/562)</td>
</tr>
<tr class="even">
<td><a href="#prompt-an">AN</a></td>
<td>30-Shot</td>
<td>73.81%</td>
<td>51% (154/300)</td>
<td>77% (1052/1372)</td>
<td>79% (443/562)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-ao">AO</a></td>
<td>45-Shot</td>
<td>74.18%</td>
<td>54% (159/297)</td>
<td>76% (1034/1366)</td>
<td>81% (453/556)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ap">AP</a></td>
<td>45-Shot</td>
<td>78.73%</td>
<td>63% (186/296)</td>
<td>87% (1192/1365)</td>
<td>66% (369/558)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-aq">AQ</a></td>
<td>45-Shot</td>
<td>72.01%</td>
<td>17% (51/301)</td>
<td>89% (1210/1359)</td>
<td>60% (337/559)</td>
</tr>
<tr class="even">
<td><a href="#prompt-ar">AR</a></td>
<td>45-Shot</td>
<td>73.86%</td>
<td>53% (157/297)</td>
<td>80% (1094/1364)</td>
<td>70% (388/558)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-as">AS</a></td>
<td>45-Shot</td>
<td>74.94%</td>
<td>42% (125/297)</td>
<td>89% (1219/1363)</td>
<td>57% (319/559)</td>
</tr>
<tr class="even">
<td><a href="#prompt-at">AT</a></td>
<td>60-Shot</td>
<td>72.19%</td>
<td>47% (138/292)</td>
<td>78% (1055/1356)</td>
<td>72% (398/556)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-au">AU</a></td>
<td>60-Shot</td>
<td>76.86%</td>
<td>43% (127/296)</td>
<td>91% (1237/1356)</td>
<td>60% (330/552)</td>
</tr>
<tr class="even">
<td><a href="#prompt-av">AV</a></td>
<td>60-Shot</td>
<td>75.45%</td>
<td>26% (79/299)</td>
<td>89% (1206/1352)</td>
<td>68% (378/553)</td>
</tr>
<tr class="odd">
<td><a href="#prompt-aw">AW</a></td>
<td>60-Shot</td>
<td>74.46%</td>
<td>29% (88/299)</td>
<td>86% (1157/1349)</td>
<td>71% (396/556)</td>
</tr>
<tr class="even">
<td><strong><a href="#prompt-ax">AX</a></strong></td>
<td><strong>60-Shot</strong></td>
<td><strong>79.63%</strong></td>
<td>62% (179/290)</td>
<td>94% (1275/1352)</td>
<td>54% (301/562)</td>
</tr>
</tbody>
</table>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","closeEffect":"zoom","descPosition":"bottom","selector":".lightbox","loop":true});</script>



</body></html>