<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-08-31">
<meta name="description" content="In this blog post I use phi-2 to classify sentiment in the financial_phrasebank dataset with 92% accuracy.">

<title>Vishal Bakshi’s Blog - Sentiment Classification with phi-2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#prompt-engineering" id="toc-prompt-engineering" class="nav-link" data-scroll-target="#prompt-engineering">Prompt Engineering</a>
  <ul class="collapse">
  <li><a href="#prompt-a" id="toc-prompt-a" class="nav-link" data-scroll-target="#prompt-a">Prompt A</a></li>
  <li><a href="#prompt-b" id="toc-prompt-b" class="nav-link" data-scroll-target="#prompt-b">Prompt B</a></li>
  <li><a href="#prompt-c" id="toc-prompt-c" class="nav-link" data-scroll-target="#prompt-c">Prompt C</a></li>
  <li><a href="#prompt-d" id="toc-prompt-d" class="nav-link" data-scroll-target="#prompt-d">Prompt D</a></li>
  <li><a href="#prompt-e" id="toc-prompt-e" class="nav-link" data-scroll-target="#prompt-e">Prompt E</a></li>
  <li><a href="#prompt-f" id="toc-prompt-f" class="nav-link" data-scroll-target="#prompt-f">Prompt F</a></li>
  <li><a href="#prompt-g" id="toc-prompt-g" class="nav-link" data-scroll-target="#prompt-g">Prompt G</a></li>
  <li><a href="#prompt-h" id="toc-prompt-h" class="nav-link" data-scroll-target="#prompt-h">Prompt H</a></li>
  <li><a href="#prompt-i" id="toc-prompt-i" class="nav-link" data-scroll-target="#prompt-i">Prompt I</a></li>
  <li><a href="#prompt-j" id="toc-prompt-j" class="nav-link" data-scroll-target="#prompt-j">Prompt J</a></li>
  <li><a href="#prompt-k" id="toc-prompt-k" class="nav-link" data-scroll-target="#prompt-k">Prompt K</a></li>
  <li><a href="#prompt-l" id="toc-prompt-l" class="nav-link" data-scroll-target="#prompt-l">Prompt L</a></li>
  <li><a href="#prompt-m" id="toc-prompt-m" class="nav-link" data-scroll-target="#prompt-m">Prompt M</a></li>
  <li><a href="#prompt-n" id="toc-prompt-n" class="nav-link" data-scroll-target="#prompt-n">Prompt N</a></li>
  <li><a href="#prompt-o" id="toc-prompt-o" class="nav-link" data-scroll-target="#prompt-o">Prompt O</a></li>
  <li><a href="#prompt-p" id="toc-prompt-p" class="nav-link" data-scroll-target="#prompt-p">Prompt P</a></li>
  <li><a href="#running-prompt-m-10-times" id="toc-running-prompt-m-10-times" class="nav-link" data-scroll-target="#running-prompt-m-10-times">Running Prompt M 10 Times</a></li>
  </ul></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Sentiment Classification with phi-2</h1>
  <div class="quarto-categories">
    <div class="quarto-category">python</div>
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">TinySentiment</div>
  </div>
  </div>

<div>
  <div class="description">
    In this blog post I use phi-2 to classify sentiment in the <code>financial_phrasebank</code> dataset with 92% accuracy.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 31, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<details>
<summary>Show pip installs</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install transformers<span class="op">~=</span><span class="fl">4.37.2</span> <span class="op">-</span>qq</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install huggingface_hub<span class="op">~=</span><span class="fl">0.20.3</span> <span class="op">-</span>qq</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasets<span class="op">~=</span><span class="fl">2.16.1</span> <span class="op">-</span>qq</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install accelerate <span class="op">-</span>qq</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install plotly<span class="op">==</span><span class="fl">5.19.0</span> <span class="op">-</span>qq</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install scikit<span class="op">-</span>learn<span class="op">==</span><span class="fl">1.2</span> <span class="op">-</span>qq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show imports and setup</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gc</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, ConfusionMatrixDisplay</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.api.types <span class="im">import</span> CategoricalDtype</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#warnings.filterwarnings("ignore")</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset, Dataset</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> pipeline, logging</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers.pipelines.pt_utils <span class="im">import</span> KeyDataset</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>logging.set_verbosity_error()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#torch.set_default_device("cuda")</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>torch.cuda.set_device(<span class="dv">0</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>model_name <span class="op">=</span> <span class="st">"microsoft/phi-2"</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create pipeline</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> pipeline(</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text-generation"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>model_name,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    device_map<span class="op">=</span><span class="st">"auto"</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    trust_remote_code<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    torch_dtype<span class="op">=</span>torch.float16</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># load dataset</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> load_dataset(</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"financial_phrasebank"</span>, <span class="st">"sentences_allagree"</span>, </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    split<span class="op">=</span><span class="st">"train"</span>  <span class="co"># note that the dataset does not have a default test split</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In this notebook I’ll use <a href="https://huggingface.co/microsoft/phi-2">phi-2</a> to classify sentiment in the <a href="https://huggingface.co/datasets/financial_phrasebank"><code>financial_phrasebank</code> dataset</a>.</p>
<p>I was inspired to do so after reading <a href="https://huggingface.co/blog/synthetic-data-save-costs">this blog post</a> and <a href="https://github.com/MoritzLaurer/synthetic-data-blog/blob/main/notebooks/synthetic_data_creation.ipynb">this corresponding notebook</a> by Moritz Laurer as part of a fastai study group last year.</p>
<p>This notebook is part of <a href="https://vishalbakshi.github.io/blog/#category=TinySentiment">a series of blog posts</a> for a project I’m working called <strong>TinySentiment</strong> where I’m experimenting with tiny models to improve their ability to classify sentiment in the <code>financial_phrasebank</code> dataset.</p>
<p>This notebook establishes a baseline using phi-2.</p>
<p>Here are the results from this notebook:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Prompt</th>
<th style="text-align: center;">Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-a">A</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">58%</td>
<td style="text-align: center;">97% (295/303)</td>
<td style="text-align: center;">37% (520/1391)</td>
<td style="text-align: center;">86% (490/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-b">B</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81%</td>
<td style="text-align: center;">87% (264/303)</td>
<td style="text-align: center;">87% (1207/1391)</td>
<td style="text-align: center;">63% (361/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-c">C</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">73%</td>
<td style="text-align: center;">96% (291/302)</td>
<td style="text-align: center;">58% (803/1390)</td>
<td style="text-align: center;"><u><strong>98% (557/569)</strong></u></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-d">D</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">74%</td>
<td style="text-align: center;"><u><strong>99% (298/302)</strong></u></td>
<td style="text-align: center;">59% (822/1387)</td>
<td style="text-align: center;">95% (542/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-e">E</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">87%</td>
<td style="text-align: center;">98% (296/302)</td>
<td style="text-align: center;">82% (1131/1387)</td>
<td style="text-align: center;">94% (537/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-f">F</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">84%</td>
<td style="text-align: center;"><u><strong>99% (298/302)</strong></u></td>
<td style="text-align: center;">77% (1069/1387)</td>
<td style="text-align: center;">95% (538/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-g">G</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">84%</td>
<td style="text-align: center;">98% (295/302)</td>
<td style="text-align: center;">76% (1059/1387)</td>
<td style="text-align: center;">96% (546/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-h">H</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">93% (280/302)</td>
<td style="text-align: center;">88% (1219/1387)</td>
<td style="text-align: center;">96% (548/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-i">I</a></td>
<td style="text-align: center;">14-Shot</td>
<td style="text-align: center;">89%</td>
<td style="text-align: center;">73% (221/302)</td>
<td style="text-align: center;"><u><strong>99% (1368/1379)</strong></u></td>
<td style="text-align: center;">71% (406/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-j">J</a></td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">80% (238/299)</td>
<td style="text-align: center;">97% (1340/1379)</td>
<td style="text-align: center;">82% (466/566)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-k">K</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">80% (241/302)</td>
<td style="text-align: center;">95% (1318/1387)</td>
<td style="text-align: center;">89% (505/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-l">L</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">90%</td>
<td style="text-align: center;">81% (246/302)</td>
<td style="text-align: center;">92% (1276/1387)</td>
<td style="text-align: center;">91% (515/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-m">M</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;"><u><strong>92%</strong></u></td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-n">N</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">78% (235/302)</td>
<td style="text-align: center;">95% (1320/1390)</td>
<td style="text-align: center;">89% (504/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-o">O</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">78% (237/302)</td>
<td style="text-align: center;">96% (1333/1390)</td>
<td style="text-align: center;">85% (484/569)</td>
</tr>
</tbody>
</table>
</section>
<section id="prompt-engineering" class="level2">
<h2 class="anchored" data-anchor-id="prompt-engineering">Prompt Engineering</h2>
<p>I’ll follow the Instruct/Output prompt template provided on the HuggingFace phi-2 model card page:</p>
<pre><code>Instruct: Write a detailed analogy between mathematics and a lighthouse.
Output: Mathematics is like a lighthouse. Just as a lighthouse guides ...</code></pre>
<p>For bookkeeping purposes, I’ll label the prompts I try with capital letters.</p>
<section id="prompt-a" class="level3">
<h3 class="anchored" data-anchor-id="prompt-a">Prompt A</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:31:48.381259Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:31:48.381017Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:31:48.385329Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:31:48.384501Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:31:48.381243Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>promptA <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>sentence</code> column in the <code>dataset</code> holds the text for which our model will classify its sentiment.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:31:51.517438Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:31:51.517192Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:31:51.526896Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:31:51.526188Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:31:51.517420Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> dataset[<span class="dv">1</span>][<span class="st">"sentence"</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>"For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m ."</code></pre>
</div>
</div>
<p>I <code>format</code> the prompt, replacing <code>{text}</code> with the <code>sentence</code> from the <code>dataset</code>:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:31:54.852643Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:31:54.852414Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:31:54.856067Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:31:54.855484Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:31:54.852627Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(promptA.<span class="bu">format</span>(text<span class="op">=</span>text))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Output:</code></pre>
</div>
</div>
<p>I’ll test out my pipeline by passing the formatted <code>prompt</code> to the <code>pipe</code>, specifying <code>max_new_tokens</code> as <code>1</code> since I want a one word response:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:31:58.323061Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:31:58.322376Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:32:01.996635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:32:01.994229Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:31:58.323036Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pipe(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    promptA.<span class="bu">format</span>(text<span class="op">=</span>text),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    max_new_tokens<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    do_sample<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    return_full_text<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>' Positive'</code></pre>
</div>
</div>
<p>Looks good!</p>
<p>I’ll generate responses for the entire <code>dataset</code> for each <code>prompt</code> (and then calculate the accuracy: the %-age of responses that match the experts).</p>
<p>I’ll first add a <code>prompt</code> column to the <code>dataset</code>, utilizing Moritz Laurer’s approach for <code>label_text</code>:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:32:06.031925Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:32:06.031456Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:32:06.178471Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:32:06.177743Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:32:06.031892Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add formatted prompt as a new column in dataset</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_prompt(item):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    item[<span class="st">'prompt'</span>] <span class="op">=</span> promptA.<span class="bu">format</span>(text<span class="op">=</span>item[<span class="st">'sentence'</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> item</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eec69c64f67148bc901f13b7eb068074","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'prompt'],
    num_rows: 2264
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:32:15.683836Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:32:15.683490Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:32:15.688965Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:32:15.688127Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:32:15.683815Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'--------'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
--------
Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Output:</code></pre>
</div>
</div>
<p>I’ll follow the documentation on <a href="https://huggingface.co/docs/transformers/en/pipeline_tutorial#using-pipelines-on-a-dataset">using pipelines on a dataset</a> from HuggingFace to create the following inference loop.</p>
<p>I’m <code>strip</code>ping the output text and converting it to <code>lower</code>case to make it consistent. I’ll append each <code>out</code>put to a list and later add that as a column to a <code>DataFrame</code> created from the <code>dataset</code>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:32:42.195937Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:32:42.195607Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:33:40.426119Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:33:40.425454Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:32:42.195912Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>outputs <span class="op">=</span> []</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> out <span class="kw">in</span> pipe(KeyDataset(dataset, <span class="st">"prompt"</span>), max_new_tokens<span class="op">=</span><span class="dv">1</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span><span class="fl">0.1</span>, return_full_text<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    outputs.append(out[<span class="dv">0</span>][<span class="st">'generated_text'</span>].strip().lower())</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>execution_time <span class="op">=</span> end_time <span class="op">-</span> start_time</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Execution time on Paperspace Free-A4000: </span><span class="sc">{</span>execution_time<span class="sc">:.6f}</span><span class="ss"> seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Execution time on Paperspace Free-A4000: 58.225772 seconds</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:33:44.637464Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:33:44.636554Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:33:44.642308Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:33:44.641477Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:33:44.637439Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(dataset) <span class="op">==</span> <span class="bu">len</span>(outputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>True</code></pre>
</div>
</div>
<p>Next, I’ll compare the model’s responses to the official dataset responses.</p>
<p>The <code>dataset</code> has a <code>label</code> column which has an integer 0, 1 or 2, corresponding to the labels <code>negative</code>, <code>neutral</code> and <code>positive</code>—this can be seen with the <code>.features.names</code> attribute:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:13.413776Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:13.413490Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:13.418798Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:13.418227Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:13.413757Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dataset.features[<span class="st">"label"</span>].names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['negative', 'neutral', 'positive']</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:14.730827Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:14.730558Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:14.736314Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:14.735506Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:14.730810Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(dataset[<span class="st">'label'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{0, 1, 2}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:20.058171Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:20.057504Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:20.062570Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:20.061785Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:20.058147Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">2</span>][<span class="st">'sentence'</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">2</span>][<span class="st">'label'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
---
2</code></pre>
</div>
</div>
<p>Following the <a href="https://github.com/MoritzLaurer/synthetic-data-blog/blob/main/notebooks/synthetic_data_creation.ipynb">synthetic data creation notebook</a>, I’ll add a <code>label_text</code> column to the <code>dataset</code>, which holds the actual label string.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:43:09.410814Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:43:09.410483Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:43:09.516633Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:43:09.516210Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:43:09.410792Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new column with the numeric label verbalised as label_text (e.g. "positive" instead of "0")</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>label_map <span class="op">=</span> {i: label_text <span class="cf">for</span> i, label_text <span class="kw">in</span> <span class="bu">enumerate</span>(dataset.features[<span class="st">"label"</span>].names)}</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_label_text(example):</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    example[<span class="st">"label_text"</span>] <span class="op">=</span> label_map[example[<span class="st">"label"</span>]]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> example</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_label_text)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7a0fa1b8b6d2467c8d6078086570ca0c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset({
    features: ['sentence', 'label', 'prompt', 'label_text'],
    num_rows: 2264
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:28.699738Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:28.698865Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:28.704592Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:28.703794Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:28.699709Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">2</span>][<span class="st">'sentence'</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'---'</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset[<span class="dv">2</span>][<span class="st">'label_text'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
---
positive</code></pre>
</div>
</div>
<p>Now I can convert the <code>dataset</code> to a <code>DataFrame</code>, append the model <code>outputs</code> and calculate the accuracy. Note that I’ll replace any <code>outputs</code> column value that is not <code>negative</code>, <code>positive</code>, or <code>neutral</code> with NA.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:44.033898Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:44.033045Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:44.063647Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:44.062420Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:44.033864Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'outputs'</span>] <span class="op">=</span> pd.Series(outputs).<span class="bu">str</span>.strip()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'outputs'</span>] <span class="op">=</span> df[<span class="st">'outputs'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> x <span class="kw">in</span> [<span class="st">'negative'</span>, <span class="st">'positive'</span>, <span class="st">'neutral'</span>] <span class="cf">else</span> <span class="st">"other"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'outputs'</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sentence</th>
      <th>label</th>
      <th>prompt</th>
      <th>label_text</th>
      <th>outputs</th>
      <th>lm_match</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>According to Gran , the company has no plans t...</td>
      <td>1</td>
      <td>Instruct: label the following TEXT with a sing...</td>
      <td>neutral</td>
      <td>neutral</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>For the last quarter of 2010 , Componenta 's n...</td>
      <td>2</td>
      <td>Instruct: label the following TEXT with a sing...</td>
      <td>positive</td>
      <td>other</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>In the third quarter of 2010 , net sales incre...</td>
      <td>2</td>
      <td>Instruct: label the following TEXT with a sing...</td>
      <td>positive</td>
      <td>positive</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Operating profit rose to EUR 13.1 mn from EUR ...</td>
      <td>2</td>
      <td>Instruct: label the following TEXT with a sing...</td>
      <td>positive</td>
      <td>positive</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Operating profit totalled EUR 21.1 mn , up fro...</td>
      <td>2</td>
      <td>Instruct: label the following TEXT with a sing...</td>
      <td>positive</td>
      <td>positive</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:47.102916Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:47.102265Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:47.107602Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:47.107056Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:47.102891Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'outputs'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>array(['neutral', 'other', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:50.641742Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:50.641070Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:50.647232Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:50.646414Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:50.641718Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'label_text'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array(['neutral', 'positive', 'negative'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:34:54.250727Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:34:54.250164Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:34:54.255645Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:34:54.255011Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:34:54.250706Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lm_match'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0.5746466431095406</code></pre>
</div>
</div>
<p>This model/prompt combo is performing better than random chance (33%) but still a far cry from the accuracy obtained in Moritz’ post (94% by Mixtral-8x7B-Instruct-v0.1 w/ Chain-of-Thought and 94% by GPT4 w/ a simple prompt). I believe phi-2 can do better! I just have to find the right prompt.</p>
<p>With Prompt A, phi-2 is <em>really</em> good at predicting negative and positive sentiment but terrible at predicting neutral sentiment. That makes sense! There’s a lot of nuance in determining if something is neutral.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:35:15.633001Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:35:15.632268Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:35:15.638845Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:35:15.638070Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:35:15.632968Z&quot;}" data-execution_count="22">
<details>
<summary>Show <code>make_cm</code> function</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_cm(df):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create confusion matrix for true vs predicted sentiment classes"""</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true<span class="op">=</span>df[<span class="st">'label_text'</span>], y_pred<span class="op">=</span>df[<span class="st">'outputs'</span>], labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    disp <span class="op">=</span> ConfusionMatrixDisplay(cm, display_labels<span class="op">=</span>[<span class="st">'negative'</span>, <span class="st">'neutral'</span>, <span class="st">'positive'</span>, <span class="st">'other'</span>])</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I chose 8x8 so it fits on one screen but still is large</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    disp.plot(ax<span class="op">=</span>ax,text_kw<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">16</span>}, cmap<span class="op">=</span><span class="st">'Blues'</span>, colorbar<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change label font size without changing label text</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.label.set_fontsize(<span class="dv">18</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make tick labels larger</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:35:21.034641Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:35:21.034406Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:35:21.158543Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:35:21.157983Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:35:21.034624Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-22-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-b" class="level3">
<h3 class="anchored" data-anchor-id="prompt-b">Prompt B</h3>
<p>I’ll create a helper function to take my prompt, add the formatted prompt to the <code>dataset</code>, generate responses, and calculate and return the <code>DataFrame</code> and accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:39:08.128248Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:39:08.127206Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:39:08.134712Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:39:08.133838Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:39:08.128182Z&quot;}" data-execution_count="30">
<details>
<summary>Show <code>add_prompt</code> and <code>generate_responses</code> functions</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_prompt(item, prompt):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>        item[<span class="st">'prompt'</span>] <span class="op">=</span> prompt.<span class="bu">format</span>(text<span class="op">=</span>item[<span class="st">'sentence'</span>])</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> item</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_responses(dataset, prompt, temp<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">## add formatted prompt as a new column in dataset</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check that the prompt is correctly formatted</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'---------'</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate responses</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> out <span class="kw">in</span> pipe(KeyDataset(dataset, <span class="st">"prompt"</span>), max_new_tokens<span class="op">=</span><span class="dv">1</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span>temp, return_full_text<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        outputs.append(out[<span class="dv">0</span>][<span class="st">'generated_text'</span>].strip().lower())</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outputs'</span>] <span class="op">=</span> pd.Series(outputs)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'outputs'</span>]</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Making sure it works with Prompt A as expected:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:12:25.389841Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:12:25.389651Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:13:20.396674Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:13:20.396213Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:12:25.389825Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptA)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Output:
---------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>0.575530035335689</code></pre>
</div>
</div>
<p>Good. I’ll now try a prompt where I add the instruction again after the <code>TEXT</code>:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:15:22.061218Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:15:22.060589Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:15:22.064461Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:15:22.063811Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:15:22.061194Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>promptB <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:15:39.494203Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:15:39.493674Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:16:37.552531Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:16:37.551904Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:15:39.494180Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(dataset, promptB)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8052885d0a27413d8e5a40ca0099084c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral
TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral
Output:
---------</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:16:44.698888Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:16:44.698087Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:16:44.703204Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:16:44.702502Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:16:44.698867Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0.8091872791519434</code></pre>
</div>
</div>
<p>Wow! Just reiterating the instruction before <code>Output</code> boosted the accuracy by 23%.</p>
<p>With Prompt B phi-2 is <em>significantly</em> better at predicting <code>neutral</code> sentiment, although it got slightly worse at predicting <code>negative</code> and <code>positive</code> sentiment.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:20:37.953653Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:20:37.953008Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:20:38.036211Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:20:38.035786Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:20:37.953630Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-28-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-c" class="level3">
<h3 class="anchored" data-anchor-id="prompt-c">Prompt C</h3>
<p>I’ll now try few-shot prompting, using examples from the dataset. Even though I am changing company name and monetary values I would think that including those examples as part of the classification accuracy would be considered data contamination so I’ll remove those examples from the dataset.</p>
<p>That way I can just use the actual examples without changing them.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:26:19.397052Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:26:19.396363Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:26:19.401477Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:26:19.400894Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:26:19.397027Z&quot;}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>{'sentence': 'According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .',
 'label': 1,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .\nOutput:',
 'label_text': 'neutral'}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:26:57.064215Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:26:57.063964Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:26:57.069055Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:26:57.068433Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:26:57.064198Z&quot;}" data-execution_count="57">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>{'sentence': "For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .",
 'label': 2,
 'prompt': "Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .\nOutput:",
 'label_text': 'positive'}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:28:22.304947Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:28:22.304621Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:28:22.309974Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:28:22.309515Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:28:22.304924Z&quot;}" data-execution_count="62">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="dv">292</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>{'sentence': 'Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .',
 'label': 0,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .\nOutput:',
 'label_text': 'negative'}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:38:37.893902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:38:37.893282Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:38:37.896975Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:38:37.896531Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:38:37.893880Z&quot;}" data-execution_count="82">
<details>
<summary>Show <code>promptC</code></summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>promptC <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="st">Output:positive</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="st">Output:negative</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:35:58.954810Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:35:58.954556Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:35:58.958066Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:35:58.957581Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:35:58.954792Z&quot;}" data-execution_count="71">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>exclude_idxs <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:12:11.165870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:12:11.165580Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:12:11.170268Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:12:11.169699Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:12:11.165850Z&quot;}" data-execution_count="107">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>Dataset({
    features: ['sentence', 'label', 'prompt', 'label_text', '__index_level_0__'],
    num_rows: 2261
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:37:06.298125Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:37:06.297639Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:37:06.304166Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:37:06.303604Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:37:06.298101Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ds_subset(dataset, exclude_idxs, columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(dataset)))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    idxs <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> idxs <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> exclude_idxs]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    ddf <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    new_ds <span class="op">=</span> Dataset.from_pandas(ddf.iloc[idxs, columns])</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:09:02.270147Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:09:02.269164Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:09:02.283836Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:09:02.283241Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:09:02.270119Z&quot;}" data-execution_count="103">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:09:11.300205Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:09:11.299956Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:09:11.304890Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:09:11.304287Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:09:11.300189Z&quot;}" data-execution_count="104">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(few_shot_ds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>2261</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:38:07.177058Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:38:07.176803Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:38:07.182169Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:38:07.181532Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:38:07.177040Z&quot;}" data-execution_count="79">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>{'sentence': 'In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .',
 'label': 2,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .\nOutput:',
 'label_text': 'positive',
 '__index_level_0__': 2}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:38:16.729594Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:38:16.728965Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:38:16.734987Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:38:16.734199Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:38:16.729564Z&quot;}" data-execution_count="80">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>{'sentence': 'Operating profit rose to EUR 13.1 mn from EUR 8.7 mn in the corresponding period in 2007 representing 7.7 % of net sales .',
 'label': 2,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: Operating profit rose to EUR 13.1 mn from EUR 8.7 mn in the corresponding period in 2007 representing 7.7 % of net sales .\nOutput:',
 'label_text': 'positive',
 '__index_level_0__': 3}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:38:23.758611Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:38:23.758076Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:38:23.762771Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:38:23.762311Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:38:23.758589Z&quot;}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">292</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>{'sentence': 'HELSINKI ( AFX ) - Nokian Tyres reported a fourth quarter pretax profit of 61.5 mln eur , up from 48.6 mln on the back of strong sales .',
 'label': 2,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: HELSINKI ( AFX ) - Nokian Tyres reported a fourth quarter pretax profit of 61.5 mln eur , up from 48.6 mln on the back of strong sales .\nOutput:',
 'label_text': 'positive',
 '__index_level_0__': 295}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:38:57.059103Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:38:57.058844Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:41:09.769469Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:41:09.768985Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:38:57.059086Z&quot;}" data-execution_count="83">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(few_shot_ds, promptC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7b2ec48a62784f64a7bbe15d67102f56","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral

Examples:

TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
label the TEXT with a single word: negative, positive, or neutral
Output:positive

TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
label the TEXT with a single word: negative, positive, or neutral
Output:negative

TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
label the TEXT with a single word: negative, positive, or neutral
Output:
---------</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:41:14.717673Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:41:14.716782Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:41:14.720986Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:41:14.720636Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:41:14.717649Z&quot;}" data-execution_count="84">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>0.7302078726227333</code></pre>
</div>
</div>
<p>Interesting. I was not expecting the accuracy to drop! The model improved it’s ability to predict <code>negative</code> and <code>positive</code> sentiment (getting close to almost 100% for those classes) but got worse at predicting <code>neutral</code> sentiment (by about 400 responses).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:41:50.052390Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:41:50.051614Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:41:50.131634Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:41:50.131189Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:41:50.052364Z&quot;}" data-execution_count="85">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-43-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T01:47:45.404650Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T01:47:45.403904Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T01:47:45.445372Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T01:47:45.444902Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T01:47:45.404627Z&quot;}" data-execution_count="87">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_C.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-d" class="level3">
<h3 class="anchored" data-anchor-id="prompt-d">Prompt D</h3>
<p>Given that the model is performing poorly on <code>neutral</code> sentiment, I’ll increase the number of <code>neutral</code> examples in the few-shot prompt.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:01:39.470890Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:01:39.470390Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:01:39.477202Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:01:39.476627Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:01:39.470866Z&quot;}" data-execution_count="97">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>[i <span class="cf">for</span> i,x <span class="kw">in</span> <span class="bu">enumerate</span>(few_shot_ds[<span class="st">'label_text'</span>]) <span class="cf">if</span> x<span class="op">==</span><span class="st">'neutral'</span>][:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>[35, 36, 37, 38, 261, 262, 263, 264, 265, 266]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:01:48.033370Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:01:48.032916Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:01:48.037366Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:01:48.036903Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:01:48.033348Z&quot;}" data-execution_count="98">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">35</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>{'sentence': "At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .",
 'label': 1,
 'prompt': "Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .\nOutput:",
 'label_text': 'neutral',
 '__index_level_0__': 37}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:01:57.087996Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:01:57.087705Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:01:57.092861Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:01:57.092374Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:01:57.087976Z&quot;}" data-execution_count="99">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">36</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>{'sentence': 'STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .',
 'label': 1,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .\nOutput:',
 'label_text': 'neutral',
 '__index_level_0__': 38}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:02:06.254098Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:02:06.253325Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:02:06.258395Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:02:06.257644Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:02:06.254073Z&quot;}" data-execution_count="100">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>few_shot_ds[<span class="dv">37</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>{'sentence': 'A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .',
 'label': 1,
 'prompt': 'Instruct: label the following TEXT with a single word: negative, positive, or neutral\nTEXT: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .\nOutput:',
 'label_text': 'neutral',
 '__index_level_0__': 39}</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:10:37.692245Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:10:37.691478Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:10:37.695887Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:10:37.695306Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:10:37.692220Z&quot;}" data-execution_count="105">
<details>
<summary>Show <code>promptD</code></summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>promptD <span class="op">=</span> <span class="st">"""Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="st">Output:positive</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="st">Output:negative</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:13:54.929759Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:13:54.928962Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:13:54.945343Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:13:54.944778Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:13:54.929733Z&quot;}" data-execution_count="111">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>promptD_ds <span class="op">=</span> ds_subset(few_shot_ds, exclude_idxs<span class="op">=</span>[<span class="dv">35</span>, <span class="dv">36</span>, <span class="dv">37</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:13:59.023967Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:13:59.023441Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:13:59.027991Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:13:59.027326Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:13:59.023944Z&quot;}" data-execution_count="112">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>promptD_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>Dataset({
    features: ['sentence', 'label', 'prompt', 'label_text', '__index_level_0__'],
    num_rows: 2258
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:14:34.833791Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:14:34.833311Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:18:39.309106Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:18:39.308578Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:14:34.833770Z&quot;}" data-execution_count="113">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptD_ds, promptD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e4dda5db747443a1bdcc488e686fb721","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruct: label the following TEXT with a single word: negative, positive, or neutral

Examples:

TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
label the TEXT with a single word: negative, positive, or neutral
Output:positive

TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
label the TEXT with a single word: negative, positive, or neutral
Output:negative

TEXT: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
label the TEXT with a single word: negative, positive, or neutral
Output:
---------</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:18:43.648471Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:18:43.647953Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:18:43.652445Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:18:43.651727Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:18:43.648451Z&quot;}" data-execution_count="114">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>0.7360496014171833</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:19:01.644383Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:19:01.643845Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:19:01.729149Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:19:01.728515Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:19:01.644361Z&quot;}" data-execution_count="116">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-54-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>A tiny increase in accuracy (~20 more correct <code>neutral</code> predictions, 7 more correct <code>negative</code> predictions, but 15 fewer correct <code>positive</code> predictions).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:22:31.479657Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:22:31.478979Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:22:31.547228Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:22:31.546652Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:22:31.479633Z&quot;}" data-execution_count="117">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_D.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-e" class="level3">
<h3 class="anchored" data-anchor-id="prompt-e">Prompt E</h3>
<p>I’ll add an introductory text</p>
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.</code></pre>
<p>as done by Moritz in his example and see if that improves the accuracy.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:23:35.477566Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:23:35.477294Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:23:35.481361Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:23:35.480801Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:23:35.477547Z&quot;}" data-execution_count="119">
<details>
<summary>Show <code>promptE</code></summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>promptE <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: label the following TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output:positive</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output:negative</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="st">TEXT: </span><span class="sc">{text}</span></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a><span class="st">label the TEXT with a single word: negative, positive, or neutral</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:23:51.369464Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:23:51.368906Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:28:00.694959Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:28:00.694261Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:23:51.369442Z&quot;}" data-execution_count="120">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptD_ds, promptE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d3b4b1036f0b4c6e97a20df6d5ae9d71","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Instruct: label the following TEXT with a single word: negative, positive, or neutral

Examples:

TEXT: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
label the TEXT with a single word: negative, positive, or neutral
Output:positive

TEXT: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
label the TEXT with a single word: negative, positive, or neutral
Output:negative

TEXT: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
label the TEXT with a single word: negative, positive, or neutral
Output:neutral

TEXT: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
label the TEXT with a single word: negative, positive, or neutral
Output:
---------</code></pre>
</div>
</div>
<p>That’s a nice boost! That increases the accuracy by 13%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:28:45.008414Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:28:45.007795Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:28:45.012178Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:28:45.011615Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:28:45.008390Z&quot;}" data-execution_count="121">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<pre><code>0.8697962798937112</code></pre>
</div>
</div>
<p>There’s a slight drop in accuracy of <code>positive</code>s but ~300 response increase in correct <code>neutral</code> predictions.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:30:09.035722Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:30:09.035100Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:30:09.117619Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:30:09.117047Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:30:09.035698Z&quot;}" data-execution_count="122">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-59-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:30:54.775510Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:30:54.775248Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:30:54.850855Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:30:54.850203Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:30:54.775491Z&quot;}" data-execution_count="123">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_E.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-f" class="level3">
<h3 class="anchored" data-anchor-id="prompt-f">Prompt F</h3>
<p>Next, I’ll rephrase the prompt to say “Instruct” instead of “TEXT”.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:34:00.163842Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:34:00.163227Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:34:00.167242Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:34:00.166677Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:34:00.163820Z&quot;}" data-execution_count="126">
<details>
<summary>Show <code>promptF</code></summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>promptF <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="st">label the following text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output:positive</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output:negative</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a><span class="st">label the text with a single word: negative, positive, or neutral</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:34:03.642248Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:34:03.641746Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:38:11.744784Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:38:11.744267Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:34:03.642228Z&quot;}" data-execution_count="127">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptD_ds, promptF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0a4437a77d8e4ac09b49bf72022a1bdf","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

label the following text with a single word: negative, positive, or neutral

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
label the text with a single word: negative, positive, or neutral
Output:neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
label the text with a single word: negative, positive, or neutral
Output:positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
label the text with a single word: negative, positive, or neutral
Output:negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
label the text with a single word: negative, positive, or neutral
Output:neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
label the text with a single word: negative, positive, or neutral
Output:neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
label the text with a single word: negative, positive, or neutral
Output:neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
label the text with a single word: negative, positive, or neutral
Output:
---------</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:46:16.311565Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:46:16.310812Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:46:16.315387Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:46:16.314721Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:46:16.311542Z&quot;}" data-execution_count="128">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>0.8436669619131976</code></pre>
</div>
</div>
<p>With that phrasing, the correct <code>negative</code>s and <code>positive</code>s increase by 2 and 1 response, respectively, but the <code>neutral</code>s decrease by ~60 responses.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:46:30.053900Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:46:30.053323Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:46:30.132596Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:46:30.131924Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:46:30.053877Z&quot;}" data-execution_count="129">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-64-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/cell-64-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T02:46:40.243239Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T02:46:40.242626Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T02:46:40.311929Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T02:46:40.311429Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T02:46:40.243216Z&quot;}" data-execution_count="130">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_F.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-g" class="level3">
<h3 class="anchored" data-anchor-id="prompt-g">Prompt G</h3>
<p>Before I add more few-shot examples, I’ll rephrase some of the wording. I’ll replace the phrase:</p>
<pre><code>label the following text with a single word: negative, positive, or neutral</code></pre>
<p>with:</p>
<pre><code>Respond with only one of these words: negative, positive, or neutral</code></pre>
<p>since “Respond” seems more direct than “label”.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:10:39.683234Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:10:39.682431Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:10:39.686437Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:10:39.685905Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:10:39.683213Z&quot;}" data-execution_count="132">
<details>
<summary>Show <code>promptG</code></summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>promptG <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output:positive</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output:negative</span></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output:neutral</span></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral</span></span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:10:59.427776Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:10:59.427036Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:15:11.263015Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:15:11.262438Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:10:59.427752Z&quot;}" data-execution_count="133">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptD_ds, promptG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bedf5cd88c4d4a9cb1a5b45bce59b999","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral
Output:neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral
Output:positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral
Output:negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral
Output:neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral
Output:neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral
Output:neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral
Output:
---------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/transformers/pipelines/base.py:1123: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(</code></pre>
</div>
</div>
<p>No such luck! The accuracy is still around 84%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:15:18.534639Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:15:18.534004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:15:18.538856Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:15:18.538073Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:15:18.534618Z&quot;}" data-execution_count="134">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>0.8414526129317981</code></pre>
</div>
</div>
<p>This prompt resulted in 8 more correct <code>positive</code>s but fewer correct <code>negative</code> and <code>neutral</code> predictions.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:15:38.413694Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:15:38.413030Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:15:38.497030Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:15:38.496200Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:15:38.413671Z&quot;}" data-execution_count="135">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-69-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/cell-69-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:17:08.289387Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:17:08.289143Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:17:08.358799Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:17:08.358206Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:17:08.289370Z&quot;}" data-execution_count="136">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_G.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-h" class="level3">
<h3 class="anchored" data-anchor-id="prompt-h">Prompt H</h3>
<p>I’ll make a few grammatical changes (like adding a period at the end of the “Respond with…” instruction or adding an extra space after “Output:’.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:19:20.539661Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:19:20.539123Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:19:20.542955Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:19:20.542397Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:19:20.539640Z&quot;}" data-execution_count="138">
<details>
<summary>Show <code>promptH</code></summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>promptH <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:19:26.833629Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:19:26.833044Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:23:43.181401Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:23:43.180785Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:19:26.833607Z&quot;}" data-execution_count="139">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptD_ds, promptH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ee94ae6243ca4aa4aa61d65b6cab6a7c","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral.
Output:
---------</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.9/dist-packages/transformers/pipelines/base.py:1123: UserWarning: You seem to be using the pipelines sequentially on GPU. In order to maximize efficiency please use a dataset
  warnings.warn(</code></pre>
</div>
</div>
<p>Surprisingly, this boosts the accuracy to about 91%</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:23:43.184306Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:23:43.184153Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:23:43.188488Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:23:43.187844Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:23:43.184289Z&quot;}" data-execution_count="140">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="140">
<pre><code>0.9065544729849424</code></pre>
</div>
</div>
<p>The number of correct <code>neutral</code> predictions increases by <em>160</em> and <code>positive</code>s by 2. The number of correct <code>negative</code> predictions drops by 15.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:25:49.864072Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:25:49.863310Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:25:49.945032Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:25:49.944508Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:25:49.864049Z&quot;}" data-execution_count="141">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-74-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/cell-74-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-30T03:27:24.639727Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-30T03:27:24.638972Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-30T03:27:24.719606Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-30T03:27:24.719122Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-30T03:27:24.639704Z&quot;}" data-execution_count="143">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_H.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-i" class="level3">
<h3 class="anchored" data-anchor-id="prompt-i">Prompt I</h3>
<p>Now that I’ve broken the 90% threshold, I’ll take a closer look at the misses by the model (in Excel—I like to look at my data at least once in a spreadsheet!).</p>
<p>I’ll start by looking at the 160 <code>neutral</code> targets that were predicted as <code>positive</code>. I went through the 160 examples and tagged each as one of the two following categories (with example phrases shown):</p>
<ul>
<li><em>neutral (general info, not necessarily positive or negative, need more context)</em> (139 responses):
<ul>
<li>“The investment will be worth approximately EUR 100mn .”</li>
<li>“The company expects its net sales for the whole of 2007 to be EUR 950mn-1 ,000 mn .”</li>
<li>“Deliveries of Nokia 1112 , Nokia 2310 and Nokia 2610 are expected to start in the second quarter of 2006 .”</li>
</ul></li>
<li><em>neutral (random information unrelated to positive/negative financial metrics)</em> (21 responses)
<ul>
<li>“Also the development of online businesses will continue .”</li>
<li>“Once your plants are in the ground they will continue to grow , but the success of any garden lies in how well it ’s maintained .”</li>
<li>“The total donation amount is EUR 1,115,000 .”</li>
</ul></li>
</ul>
<p>I scanned the 1219 true positive <code>neutral</code>s and they didn’t seem very different from the misses:</p>
<ul>
<li>“The original contract was signed last summer .”</li>
<li>“It has some 30 offices worldwide and more than 90 pct of its net sales are generated outside Finland .”</li>
<li>“The offer price is \$ 35 million , including cash of \$ 10 million as net debt assumption of FACE , and \$ 20 million worth of Cencorp shares to be issued to Savcor .”</li>
</ul>
<p>I did some basic text searches in the 1219 correct <code>neutral</code> predictions and found that:</p>
<ul>
<li>552 phrases (45%) contained a number</li>
<li>149 phrases (12%) contained the string “EUR” or “USD”</li>
<li>34 phrases (3%) contained the string “sales” or “profit”</li>
</ul>
<p>I did the same searches in the 160 <code>neutral</code> phrases predicted as <code>positive</code> and found that:</p>
<ul>
<li>112 phrases (70%) contained a number</li>
<li>67 phrases (42%) contained the string “EUR” or “USD”</li>
<li>38 phrases (24%) contained the string “sales” or “profit”</li>
</ul>
<p>The occurrences of “trigger” words that falsely indicate financial sentiment (numbers, currency, “sales”, “profit”) are at a higher percentage in the <code>neutral</code> phrases predicted as <code>positive</code>. I’m guessing (as one only can with LLMs) that’s why the model got tripped up on them.</p>
<p>I’ll try two options to improve my model’s performance:</p>
<ul>
<li>increase the number of few-shot examples (I’ve heard from the folks that wrote <a href="https://applied-llms.org/">What We’ve Learned from a Year of Building with LLMs</a> that it’s not uncommon to need a few dozen examples).</li>
<li>change the prompt language</li>
</ul>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T01:55:07.502311Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T01:55:07.501995Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T01:55:07.517315Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T01:55:07.516678Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T01:55:07.502292Z&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove few-shot examples from dataset</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>promptI_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">274</span>, <span class="dv">283</span>], columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T01:55:15.275660Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T01:55:15.274868Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T01:55:15.280345Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T01:55:15.279409Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T01:55:15.275632Z&quot;}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>promptI_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2250
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T01:55:22.435774Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T01:55:22.435207Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T01:55:22.439844Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T01:55:22.439291Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T01:55:22.435754Z&quot;}" data-execution_count="65">
<details>
<summary>Show <code>promptI</code></summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>promptI <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Tiimari operates 194 stores in six countries -- including its core Finnish market -- and generated a turnover of 76.5 mln eur in 2005 .</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Finnish Talvivaara Mining Co HEL : TLV1V said Thursday it had picked BofA Merrill Lynch and JPMorgan NYSE : JPM as joint bookrunners of its planned issue of convertible notes worth up to EUR250m USD332m .</span></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The mall is part of the Baltic Pearl development project in the city of St Petersburg , where Baltic Pearl CJSC , a subsidiary of Shanghai Foreign Joint Investment Company , is developing homes for 35,000 people .</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Vacon controls a further 5 </span><span class="sc">% o</span><span class="st">f the company via investment fund Power Fund I. EUR 1.0 = USD 1.397</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: 4 ) Complete name of the shareholder : Otto Henrik Bernhard Nyberg 5 ) Further information : The amount of shares now transferred corresponds to 5.68 </span><span class="sc">% o</span><span class="st">f the total number of shares in Aspo Plc. .</span></span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: It has some 30 offices worldwide and more than 90 pct of its net sales are generated outside Finland .</span></span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The contract value amounts to about EUR11m , the company added .</span></span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The business to be divested generates consolidated net sales of EUR 60 million annually and currently has some 640 employees .</span></span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T01:55:51.133883Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T01:55:51.133270Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:05:29.411333Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:05:29.410610Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T01:55:51.133858Z&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptI_ds, promptI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c729f3861f304a35965ca22117f708cb","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Tiimari operates 194 stores in six countries -- including its core Finnish market -- and generated a turnover of 76.5 mln eur in 2005 .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Finnish Talvivaara Mining Co HEL : TLV1V said Thursday it had picked BofA Merrill Lynch and JPMorgan NYSE : JPM as joint bookrunners of its planned issue of convertible notes worth up to EUR250m USD332m .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The mall is part of the Baltic Pearl development project in the city of St Petersburg , where Baltic Pearl CJSC , a subsidiary of Shanghai Foreign Joint Investment Company , is developing homes for 35,000 people .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Vacon controls a further 5 % of the company via investment fund Power Fund I. EUR 1.0 = USD 1.397
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: 4 ) Complete name of the shareholder : Otto Henrik Bernhard Nyberg 5 ) Further information : The amount of shares now transferred corresponds to 5.68 % of the total number of shares in Aspo Plc. .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: It has some 30 offices worldwide and more than 90 pct of its net sales are generated outside Finland .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The contract value amounts to about EUR11m , the company added .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The business to be divested generates consolidated net sales of EUR 60 million annually and currently has some 640 employees .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral.
Output:
---------</code></pre>
</div>
</div>
<p>That took considerably longer to run (makes sense, almost triple the input tokens) and the overall accuracy decreased.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:05:29.412809Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:05:29.412597Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:05:29.417278Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:05:29.416643Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:05:29.412792Z&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>0.8866666666666667</code></pre>
</div>
</div>
<p>A massive improvement in predicting <code>neutral</code> phrases correctly! With the 8 additional few-shot examples phi-2 is predicting <code>neutral</code>s with almost 100% accuracy, 149 more correct phrases than before.</p>
<p>However, it’s performly worse for <code>positive</code> (142 fewer correct predictions) and <code>negative</code> (69 fewer correct predictions) sentiment phrases.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:07:18.469643Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:07:18.469058Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:07:18.628590Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:07:18.627813Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:07:18.469619Z&quot;}" data-execution_count="68">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-81-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/cell-81-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:11:29.391167Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:11:29.390880Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:11:29.528952Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:11:29.528277Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:11:29.391148Z&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'/notebooks/phi-2_sc_I.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-j" class="level3">
<h3 class="anchored" data-anchor-id="prompt-j">Prompt J</h3>
<p>I’ll see if adding a few more <code>negative</code> and <code>positive</code> examples improves the accuracy for those classes.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:19:02.716713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:19:02.716146Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:19:02.728619Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:19:02.728177Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:19:02.716687Z&quot;}" data-execution_count="86">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove few-shot examples from dataset</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>promptJ_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">292</span>, <span class="dv">293</span>, <span class="dv">294</span>, <span class="dv">347</span>, <span class="dv">0</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>, <span class="dv">40</span>, <span class="dv">263</span>, <span class="dv">264</span>, <span class="dv">265</span>, <span class="dv">266</span>, <span class="dv">270</span>, <span class="dv">274</span>, <span class="dv">283</span>], columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:19:10.322063Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:19:10.321394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:19:10.325676Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:19:10.325282Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:19:10.322039Z&quot;}" data-execution_count="87">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>promptJ_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2244
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:19:16.792604Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:19:16.791916Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:19:16.796871Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:19:16.796478Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:19:16.792580Z&quot;}" data-execution_count="88">
<details>
<summary>Show <code>promptJ</code></summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>promptJ <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Pharmaceuticals group Orion Corp reported a fall in its third-quarter earnings that were hit by larger expenditures on R&amp;D and marketing .</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: However , the growth margin slowed down due to the financial crisis .</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: 2009 3 February 2010 - Finland-based steel maker Rautaruukki Oyj ( HEL : RTRKS ) , or Ruukki , said today it slipped to a larger-than-expected pretax loss of EUR46m in the fourth quarter of 2009 from a year-earlier profit of EUR45m .</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .</span></span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb138-30"><a href="#cb138-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-31"><a href="#cb138-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Operating profit rose to EUR 13.1 mn from EUR 8.7 mn in the corresponding period in 2007 representing 7.7 </span><span class="sc">% o</span><span class="st">f net sales .</span></span>
<span id="cb138-32"><a href="#cb138-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-33"><a href="#cb138-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb138-34"><a href="#cb138-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-35"><a href="#cb138-35" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Operating profit totalled EUR 21.1 mn , up from EUR 18.6 mn in 2007 , representing 9.7 </span><span class="sc">% o</span><span class="st">f net sales .</span></span>
<span id="cb138-36"><a href="#cb138-36" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-37"><a href="#cb138-37" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb138-38"><a href="#cb138-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-39"><a href="#cb138-39" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb138-40"><a href="#cb138-40" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-41"><a href="#cb138-41" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-42"><a href="#cb138-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-43"><a href="#cb138-43" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb138-44"><a href="#cb138-44" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-45"><a href="#cb138-45" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-46"><a href="#cb138-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-47"><a href="#cb138-47" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb138-48"><a href="#cb138-48" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-49"><a href="#cb138-49" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-50"><a href="#cb138-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-51"><a href="#cb138-51" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb138-52"><a href="#cb138-52" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-53"><a href="#cb138-53" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-54"><a href="#cb138-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-55"><a href="#cb138-55" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Tiimari operates 194 stores in six countries -- including its core Finnish market -- and generated a turnover of 76.5 mln eur in 2005 .</span></span>
<span id="cb138-56"><a href="#cb138-56" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-57"><a href="#cb138-57" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-58"><a href="#cb138-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-59"><a href="#cb138-59" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Finnish Talvivaara Mining Co HEL : TLV1V said Thursday it had picked BofA Merrill Lynch and JPMorgan NYSE : JPM as joint bookrunners of its planned issue of convertible notes worth up to EUR250m USD332m .</span></span>
<span id="cb138-60"><a href="#cb138-60" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-61"><a href="#cb138-61" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-62"><a href="#cb138-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-63"><a href="#cb138-63" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The mall is part of the Baltic Pearl development project in the city of St Petersburg , where Baltic Pearl CJSC , a subsidiary of Shanghai Foreign Joint Investment Company , is developing homes for 35,000 people .</span></span>
<span id="cb138-64"><a href="#cb138-64" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-65"><a href="#cb138-65" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-66"><a href="#cb138-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-67"><a href="#cb138-67" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Vacon controls a further 5 </span><span class="sc">% o</span><span class="st">f the company via investment fund Power Fund I. EUR 1.0 = USD 1.397</span></span>
<span id="cb138-68"><a href="#cb138-68" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-69"><a href="#cb138-69" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-70"><a href="#cb138-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-71"><a href="#cb138-71" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: 4 ) Complete name of the shareholder : Otto Henrik Bernhard Nyberg 5 ) Further information : The amount of shares now transferred corresponds to 5.68 </span><span class="sc">% o</span><span class="st">f the total number of shares in Aspo Plc. .</span></span>
<span id="cb138-72"><a href="#cb138-72" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-73"><a href="#cb138-73" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-74"><a href="#cb138-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-75"><a href="#cb138-75" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: It has some 30 offices worldwide and more than 90 pct of its net sales are generated outside Finland .</span></span>
<span id="cb138-76"><a href="#cb138-76" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-77"><a href="#cb138-77" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-78"><a href="#cb138-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-79"><a href="#cb138-79" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The contract value amounts to about EUR11m , the company added .</span></span>
<span id="cb138-80"><a href="#cb138-80" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-81"><a href="#cb138-81" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-82"><a href="#cb138-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-83"><a href="#cb138-83" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The business to be divested generates consolidated net sales of EUR 60 million annually and currently has some 640 employees .</span></span>
<span id="cb138-84"><a href="#cb138-84" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-85"><a href="#cb138-85" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb138-86"><a href="#cb138-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-87"><a href="#cb138-87" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb138-88"><a href="#cb138-88" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral.</span></span>
<span id="cb138-89"><a href="#cb138-89" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:21:18.657987Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:21:18.657191Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:36:37.991654Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:36:37.991070Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:21:18.657961Z&quot;}" data-execution_count="89">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptJ_ds, promptJ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"69668782d9324f8ba3ddabfbbea4bfe2","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral.

Examples:

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: Pharmaceuticals group Orion Corp reported a fall in its third-quarter earnings that were hit by larger expenditures on R&amp;D and marketing .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: However , the growth margin slowed down due to the financial crisis .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: 2009 3 February 2010 - Finland-based steel maker Rautaruukki Oyj ( HEL : RTRKS ) , or Ruukki , said today it slipped to a larger-than-expected pretax loss of EUR46m in the fourth quarter of 2009 from a year-earlier profit of EUR45m .
Respond with only one of these words: negative, positive, or neutral.
Output: negative

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: Operating profit rose to EUR 13.1 mn from EUR 8.7 mn in the corresponding period in 2007 representing 7.7 % of net sales .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: Operating profit totalled EUR 21.1 mn , up from EUR 18.6 mn in 2007 , representing 9.7 % of net sales .
Respond with only one of these words: negative, positive, or neutral.
Output: positive

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Tiimari operates 194 stores in six countries -- including its core Finnish market -- and generated a turnover of 76.5 mln eur in 2005 .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Finnish Talvivaara Mining Co HEL : TLV1V said Thursday it had picked BofA Merrill Lynch and JPMorgan NYSE : JPM as joint bookrunners of its planned issue of convertible notes worth up to EUR250m USD332m .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The mall is part of the Baltic Pearl development project in the city of St Petersburg , where Baltic Pearl CJSC , a subsidiary of Shanghai Foreign Joint Investment Company , is developing homes for 35,000 people .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Vacon controls a further 5 % of the company via investment fund Power Fund I. EUR 1.0 = USD 1.397
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: 4 ) Complete name of the shareholder : Otto Henrik Bernhard Nyberg 5 ) Further information : The amount of shares now transferred corresponds to 5.68 % of the total number of shares in Aspo Plc. .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: It has some 30 offices worldwide and more than 90 pct of its net sales are generated outside Finland .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The contract value amounts to about EUR11m , the company added .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: The business to be divested generates consolidated net sales of EUR 60 million annually and currently has some 640 employees .
Respond with only one of these words: negative, positive, or neutral.
Output: neutral

Instruct: Finnish Talentum reports its operating profit increased to EUR 20.5 mn in 2005 from EUR 9.3 mn in 2004 , and net sales totaled EUR 103.3 mn , up from EUR 96.4 mn .
Respond with only one of these words: negative, positive, or neutral.
Output:
---------</code></pre>
</div>
</div>
<p>That seems to have worked! The accuracy is at 91%, the highest it’s reached thus far.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:37:41.898576Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:37:41.898299Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:37:41.902720Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:37:41.902077Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:37:41.898557Z&quot;}" data-execution_count="90">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>0.910873440285205</code></pre>
</div>
</div>
<p>There seems to be a trade-off (at least with this prompting strategy) between true positives. The number of correct <code>negative</code> predictions increased by 18, <code>positive</code> by 60 and <code>neutral</code> decreased by 28.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:38:07.067254Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:38:07.066560Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:38:07.151616Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:38:07.150968Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:38:07.067207Z&quot;}" data-execution_count="91">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-88-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/cell-88-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-k" class="level3">
<h3 class="anchored" data-anchor-id="prompt-k">Prompt K</h3>
<p>Adding few-shot examples improved the accuracy by less than 1%. What if I changed the instruction language instead? I’ll go back to Prompt H (90.66% accuracy, 6 examples) and see if modifying the instruction helps.</p>
<p>I’ll start by adding the phrase “if you’re not sure, respond with neutral.”</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:50:26.298808Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:50:26.298121Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:50:26.302739Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:50:26.302252Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:50:26.298776Z&quot;}" data-execution_count="103">
<details>
<summary>Show <code>promptK</code></summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>promptK <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb144-24"><a href="#cb144-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-25"><a href="#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb144-26"><a href="#cb144-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-27"><a href="#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb144-28"><a href="#cb144-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-29"><a href="#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb144-30"><a href="#cb144-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-31"><a href="#cb144-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb144-32"><a href="#cb144-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.</span></span>
<span id="cb144-33"><a href="#cb144-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:50:30.065036Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:50:30.064404Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:50:30.079690Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:50:30.078928Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:50:30.065007Z&quot;}" data-execution_count="104">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove few-shot examples from dataset</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>promptK_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>], columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:50:31.782552Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:50:31.782002Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:50:31.786438Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:50:31.785871Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:50:31.782530Z&quot;}" data-execution_count="105">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>promptK_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2258
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:50:35.700024Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:50:35.699293Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:55:57.503925Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:55:57.503282Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:50:35.700000Z&quot;}" data-execution_count="106">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptK_ds, promptK)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e5b8e65e82c4464498fcc78093551c7e","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output: neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral. If you're not sure, respond with neutral.
Output:
---------</code></pre>
</div>
</div>
<p>Excellent! I achieve my highest accuracy thus far (91.4% with a 6-shot prompt, a 0.32% increase from my 20-shot prompt).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:56:27.872369Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:56:27.872045Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:56:27.877484Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:56:27.876642Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:56:27.872347Z&quot;}" data-execution_count="107">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>0.9140832595217007</code></pre>
</div>
</div>
<p>The number of correct <code>neutral</code> (+99) phrases increased and <code>negative</code> (-39) and <code>positive</code> (-43) decreased.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T02:57:59.113598Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T02:57:59.112904Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T02:57:59.212577Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T02:57:59.211596Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T02:57:59.113572Z&quot;}" data-execution_count="108">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-94-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/cell-94-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:02:10.530969Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:02:10.530677Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:02:10.545024Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:02:10.544521Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:02:10.530950Z&quot;}" data-execution_count="111">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'sentence'</span>, <span class="st">'label_text'</span>, <span class="st">'outputs'</span>, <span class="st">'lm_match'</span>]].to_csv(<span class="st">'/notebooks/phi-2_sc_K.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-l" class="level3">
<h3 class="anchored" data-anchor-id="prompt-l">Prompt L</h3>
<p>I’ll try a different phrase to try and help the model avoid classifing <code>neutral</code>s as <code>positive</code>:</p>
<p>“if it’s not clear why an investor’s investment would increase or decrease, respond with neutral.”</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:03:54.520240Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:03:54.519776Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:03:54.523923Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:03:54.523409Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:03:54.520218Z&quot;}" data-execution_count="112">
<details>
<summary>Show <code>promptL</code></summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>promptL <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.</span></span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:04:07.949944Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:04:07.949379Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:10:13.909765Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:10:13.909034Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:04:07.949922Z&quot;}" data-execution_count="113">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptK_ds, promptL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"60774936ab4d4293918c74d279cc3e66","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output: neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral. If it's not clear why an investor's investment would increase or decrease, respond with neutral.
Output:
---------</code></pre>
</div>
</div>
<p>Nope! This instruction language doesn’t help.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:10:51.753899Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:10:51.753262Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:10:51.758882Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:10:51.758335Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:10:51.753875Z&quot;}" data-execution_count="114">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>0.9021257750221435</code></pre>
</div>
</div>
<p>Compared to Prompt H, <code>neutral</code> (+57) correct predictions increased while <code>negative</code> (-34) and <code>positive</code> (-33) decreased.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:11:24.599938Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:11:24.599644Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:11:24.685706Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:11:24.684990Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:11:24.599919Z&quot;}" data-execution_count="115">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-99-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/cell-99-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-m" class="level3">
<h3 class="anchored" data-anchor-id="prompt-m">Prompt M</h3>
<p>I’ll try a third modification to the instruction by using the following phrase:</p>
<p>“If the amount of money is not explicitly increasing or decreasing, respond with neutral”</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:15:32.900452Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:15:32.899805Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:15:32.904710Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:15:32.904114Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:15:32.900427Z&quot;}" data-execution_count="116">
<details>
<summary>Show <code>promptM</code></summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>promptM <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .</span></span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .</span></span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .</span></span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:15:47.619622Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:15:47.619004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:21:38.069475Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:21:38.068855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:15:47.619591Z&quot;}" data-execution_count="117">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptK_ds, promptM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"38f5e5ebb5dc4e819c2b0549eca05ada","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: negative

Instruct: At the request of Finnish media company Alma Media 's newspapers , research manager Jari Kaivo-oja at the Finland Futures Research Centre at the Turku School of Economics has drawn up a future scenario for Finland 's national economy by using a model developed by the University of Denver .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: STOCK EXCHANGE ANNOUNCEMENT 20 July 2006 1 ( 1 ) BASWARE SHARE SUBSCRIPTIONS WITH WARRANTS AND INCREASE IN SHARE CAPITAL A total of 119 850 shares have been subscribed with BasWare Warrant Program .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: A maximum of 666,104 new shares can further be subscribed for by exercising B options under the 2004 stock option plan .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output:
---------</code></pre>
</div>
</div>
<p>Nice! I’m knocking on 92%’s door.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:23:28.832349Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:23:28.832076Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:23:28.836861Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:23:28.836306Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:23:28.832329Z&quot;}" data-execution_count="118">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<pre><code>0.9193976970770593</code></pre>
</div>
</div>
<p>Compared to Prompt H, this prompt results in a decrease of correct <code>negative</code>s (-13) and <code>positive</code>s (-38) offset by a substantial increase in correct <code>neutral</code>s (+80).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:24:18.801014Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:24:18.800676Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:24:18.886436Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:24:18.885764Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:24:18.800990Z&quot;}" data-execution_count="119">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-103-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/cell-103-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:26:15.136669Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:26:15.136344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:26:15.150734Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:26:15.150166Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:26:15.136646Z&quot;}" data-execution_count="120">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'sentence'</span>, <span class="st">'label_text'</span>, <span class="st">'outputs'</span>, <span class="st">'lm_match'</span>]].to_csv(<span class="st">'/notebooks/phi-2_sc_M.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prompt-n" class="level3">
<h3 class="anchored" data-anchor-id="prompt-n">Prompt N</h3>
<p>I’ll see if I can get away with reducing the number of examples in the prompt.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:31:15.705842Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:31:15.705563Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:31:15.709875Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:31:15.709153Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:31:15.705842Z&quot;}" data-execution_count="121">
<details>
<summary>Show <code>promptN</code></summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>promptN <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:32:27.282029Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:32:27.281350Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:32:27.294834Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:32:27.294104Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:32:27.282001Z&quot;}" data-execution_count="127">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove few-shot examples from dataset</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>promptN_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">292</span>], columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:32:31.344150Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:32:31.343886Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:32:31.348496Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:32:31.347869Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:32:31.344132Z&quot;}" data-execution_count="128">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>promptN_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>Dataset({
    features: ['sentence', 'label', 'label_text', '__index_level_0__'],
    num_rows: 2261
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:32:48.129036Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:32:48.128767Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:35:51.840522Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:35:51.839794Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:32:48.129018Z&quot;}" data-execution_count="129">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptN_ds, promptN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a35a510dbcb342b8b123cb2acc990a76","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.

Examples:

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: positive

Instruct: Jan. 6 -- Ford is struggling in the face of slowing truck and SUV sales and a surfeit of up-to-date , gotta-have cars .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: negative

Instruct: In the third quarter of 2010 , net sales increased by 5.2 % to EUR 205.5 mn , and operating profit by 34.9 % to EUR 23.5 mn .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output:
---------</code></pre>
</div>
</div>
<p>Nope. The accuracy drops by 1%.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:36:23.282228Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:36:23.281956Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:36:23.288161Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:36:23.287044Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:36:23.282209Z&quot;}" data-execution_count="130">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>0.9106590004422822</code></pre>
</div>
</div>
<p>Compared to my best performing prompt (Prompt M, 91.9%) this has fewer correct <code>negative</code>s (-32) and <code>positives</code> (-6) which offset the increase in correct <code>neutral</code>s (+21).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T03:36:53.560596Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T03:36:53.560057Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T03:36:53.646392Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T03:36:53.645840Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T03:36:53.560574Z&quot;}" data-execution_count="131">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-110-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/cell-110-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-o" class="level3">
<h3 class="anchored" data-anchor-id="prompt-o">Prompt O</h3>
<p>I’ll see if changing the examples gives me a different result.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:44:33.043164Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:44:33.042639Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:44:33.061008Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:44:33.060436Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:44:33.043140Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove few-shot examples from dataset</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>promptO_ds <span class="op">=</span> ds_subset(dataset, exclude_idxs<span class="op">=</span>[<span class="dv">284</span>, <span class="dv">64</span>, <span class="dv">359</span>], columns<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:44:36.963510Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:44:36.962918Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:44:36.967960Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:44:36.967343Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:44:36.963481Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>promptO_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>Dataset({
    features: ['sentence', 'label', 'prompt', 'label_text', '__index_level_0__'],
    num_rows: 2261
})</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:44:41.228447Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:44:41.227841Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:44:41.231333Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:44:41.230944Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:44:41.228422Z&quot;}" data-execution_count="40">
<details>
<summary>Show <code>promptO</code></summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>promptO <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: The company generates net sales of about 600 mln euro $ 775.5 mln annually and employs 6,000 .</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a><span class="st">Output: neutral</span></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Operating profit increased by 145.1 % to EUR 8.3 mn from EUR 3.4 mn .</span></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a><span class="st">Output: positive</span></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: Profit before taxes decreased by 9 % to EUR 187.8 mn in the first nine months of 2008 , compared to EUR 207.1 mn a year earlier ..</span></span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a><span class="st">Output: negative</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a><span class="st">Instruct: </span><span class="sc">{text}</span></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a><span class="st">Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.</span></span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a><span class="st">Output:"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:44:44.376511Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:44:44.375738Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:47:42.305433Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:47:42.304812Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:44:44.376484Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>df, acc <span class="op">=</span> generate_responses(promptO_ds, promptO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e1cd8e73f0704c12b482a0be3c80530e","version_major":2,"version_minor":0}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.

Examples:

Instruct: The company generates net sales of about 600 mln euro $ 775.5 mln annually and employs 6,000 .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: neutral

Instruct: Operating profit increased by 145.1 % to EUR 8.3 mn from EUR 3.4 mn .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: positive

Instruct: Profit before taxes decreased by 9 % to EUR 187.8 mn in the first nine months of 2008 , compared to EUR 207.1 mn a year earlier ..
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output: negative

Instruct: According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
Respond with only one of these words: negative, positive, or neutral. If the amount of money is not explicitly increasing or decreasing, respond with neutral.
Output:
---------</code></pre>
</div>
</div>
<p>Nope! I’ll stick with my original prompt.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:48:33.905073Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:48:33.904599Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:48:33.910012Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:48:33.909459Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:48:33.905073Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.9084475895621407</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:49:05.201371Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:49:05.200715Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:49:05.285770Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:49:05.285235Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:49:05.201345Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>make_cm(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/cell-116-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/cell-116-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prompt-p" class="level3">
<h3 class="anchored" data-anchor-id="prompt-p">Prompt P</h3>
<p>I recently saw this example from Simon Willison’s blog post where he shared his notes from Anthropic’s prompt engineering tutorial. They recommended the following format for sentiment classification:</p>
<blockquote class="blockquote">
<p>Is this review sentiment positive or negative? First, write the best arguments for each side in &lt;positive-argument&gt; and &lt;negative-argument&gt; XML tags, then answer.</p>
</blockquote>
<p>I don’t think phi-2 was trained to structure reponses with XML but I’ll give it a try:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:58:13.205401Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:58:13.204728Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:58:13.208267Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:58:13.207689Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:58:13.205380Z&quot;}" data-execution_count="58">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>promptP <span class="op">=</span> <span class="st">"""Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="st">Be concise in your response.</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="sc">{text}</span><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:58:14.476164Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:58:14.475391Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:58:14.480864Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:58:14.479947Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:58:14.476137Z&quot;}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>formatted_prompt <span class="op">=</span> promptP.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">0</span>][<span class="st">'sentence'</span>])</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.

Be concise in your response.

According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:09:29.928065Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:09:29.927407Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:09:29.932082Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:09:29.931585Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:09:29.928034Z&quot;}" data-execution_count="64">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>dataset[<span class="dv">0</span>][<span class="st">'label_text'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>'neutral'</code></pre>
</div>
</div>
<p>It looks like this kind of prompt doesn’t work well zero-shot:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T02:59:28.846410Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T02:59:28.846037Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T02:59:35.743635Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T02:59:35.742839Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T02:59:28.846381Z&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pipe(</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>    formatted_prompt,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>    max_new_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>    do_sample<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>    return_full_text<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>'\n\n&lt;negative-argument&gt;\n&lt;answer&gt;negative&lt;/answer&gt;\n&lt;/negative-argument&gt;\n&lt;neutral-argument&gt;\n&lt;answer&gt;neutral&lt;/answer&gt;\n&lt;/neutral-argument&gt;\n&lt;positive-argument&gt;\n&lt;answer&gt;positive&lt;/answer&gt;\n&lt;/positive-argument&gt;\n\n&lt;negative-argument&gt;\n&lt;answer&gt;negative&lt;/answer&gt;\n&lt;/negative-argument&gt;\n&lt;neutral-argument&gt;\n&lt;answer&gt;neutral&lt;/answer&gt;\n&lt;/neutral-argument&gt;\n&lt;positive-argument&gt;\n&lt;answer&gt;positive&lt;/answer&gt;\n&lt;/positive-argument&gt;\n\n&lt;negative-argument&gt;\n&lt;answer&gt;negative&lt;/answer&gt;\n&lt;/negative-argument&gt;\n&lt;neutral-argument&gt;\n&lt;answer&gt;neutral&lt;/answer&gt;\n&lt;/neutral-argument&gt;\n&lt;positive-argument&gt;\n&lt;answer&gt;positive&lt;/answer&gt;\n&lt;/positive-argument&gt;\n\n&lt;negative-argument&gt;\n&lt;answer&gt;negative&lt;/answer&gt;\n&lt;/negative-argument&gt;\n&lt;neutral-argument&gt;\n&lt;answer&gt;neutral&lt;/answer&gt;\n&lt;/neutral-argument&gt;\n&lt;positive-argument&gt;\n&lt;answer&gt;positive&lt;/answer&gt;\n&lt;/positive-argument&gt;\n\n&lt;negative-argument&gt;\n&lt;answer&gt;negative&lt;/answer&gt;\n&lt;/negative-argument&gt;\n&lt;neutral-argument&gt;\n&lt;answer&gt;neutral&lt;/answer&gt;\n&lt;/neutral-argument&gt;\n&lt;positive-argument&gt;\n&lt;answer&gt;positive&lt;/answer&gt;\n'</code></pre>
</div>
</div>
<p>I’ll give it an example and see if that helps:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:13:54.171498Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:13:54.170894Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:13:54.174978Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:13:54.174347Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:13:54.171478Z&quot;}" data-execution_count="65">
<details>
<summary>Show <code>promptP</code></summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>promptP <span class="op">=</span> <span class="st">"""Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="st">Example:</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;text&gt;According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;instruction&gt;Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.&lt;text&gt; Be concise in your response.&lt;instruction&gt;</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;response&gt;</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;negative-sentiment&gt;This is a negative sentence because they are not moving production to where their growth is.&lt;negative-sentiment&gt;</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;neutral-sentiment&gt;This is a neutral sentence because it does not indicate any strong negative or positive sentiment.&lt;neutral-sentiment&gt; </span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;positive-sentiment&gt;This is a positive sentence because they are growing in a region where they don't do production.&lt;positive-sentiment&gt;</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;answer&gt;neutral&lt;answer&gt;</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;response&gt;</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;text&gt;</span><span class="sc">{text}</span><span class="st">&lt;text&gt;</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;instruction&gt;Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.&lt;text&gt; Be concise in your response.&lt;instruction&gt;</span></span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;response&gt;</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:14:06.515713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:14:06.515313Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:14:06.520386Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:14:06.519801Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:14:06.515690Z&quot;}" data-execution_count="66">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>formatted_prompt <span class="op">=</span> promptP.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">1</span>][<span class="st">'sentence'</span>])</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.

Example:

&lt;text&gt;According to Gran , the company has no plans to move all production to Russia , although that is where the company is growing .
&lt;instruction&gt;Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.&lt;text&gt; Be concise in your response.&lt;instruction&gt;

&lt;response&gt;
&lt;negative-sentiment&gt;This is a negative sentence because they are not moving production to where their growth is.&lt;negative-sentiment&gt;
&lt;neutral-sentiment&gt;This is a neutral sentence because it does not indicate any strong negative or positive sentiment.&lt;neutral-sentiment&gt; 
&lt;positive-sentiment&gt;This is a positive sentence because they are growing in a region where they don't do production.&lt;positive-sentiment&gt;
&lt;answer&gt;neutral&lt;answer&gt;
&lt;response&gt;



&lt;text&gt;For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .&lt;text&gt;
&lt;instruction&gt;Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.&lt;text&gt; Be concise in your response.&lt;instruction&gt;
&lt;response&gt;
</code></pre>
</div>
</div>
<p>It’s most likely that my example is not written well, or perhaps phi-2 doesn’t fare well with structured response. Regardless, the response is not desirable:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:14:24.626061Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:14:24.625405Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:14:31.404724Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:14:31.403927Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:14:24.626037Z&quot;}" data-execution_count="67">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pipe(</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>    formatted_prompt,</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>    max_new_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>    do_sample<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>    return_full_text<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>'&lt;negative-sentiment&gt;This is a negative sentence because they had a loss instead of a profit.&lt;negative-sentiment&gt;\n&lt;neutral-sentiment&gt;This is a neutral sentence because it does not indicate any strong negative or positive sentiment.&lt;neutral-sentiment&gt;\n&lt;positive-sentiment&gt;This is a positive sentence because they had a significant increase in sales.&lt;positive-sentiment&gt;\n&lt;answer&gt;negative&lt;answer&gt;\n&lt;response&gt;\n\n\n\n&lt;text&gt;The company expects to see a further increase in sales in the first quarter of 2011, with a forecast of EUR150m to EUR160m.&lt;text&gt;\n&lt;instruction&gt;Is this financial news sentiment negative, neutral or positive? First, write the best arguments for each side in &lt;negative-argument&gt;, &lt;neutral-argument&gt; and &lt;positive-argument&gt; XML tags, then answer with a single word (negative, neutral or positive) using &lt;answer&gt; XML tags.&lt;text&gt; Be concise in your response.&lt;instruction&gt;\n&lt;response&gt;\n&lt;negative-sentiment&gt;This is a negative sentence because they are forecasting a significant increase in sales.&lt;negative-sentiment&gt;\n&lt;neutral-sentiment&gt;This is a neutral sentence because it does not indicate any strong negative or positive sentiment.&lt;neutral-sentiment&gt;\n&lt;positive-sentiment&gt;This is a positive sentence because they are expecting a significant increase in sales.&lt;positive-sentiment&gt;\n&lt;answer&gt;positive&lt;'</code></pre>
</div>
</div>
<p>I’ll see if using Chain-of-Thought prompting works with phi-2:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:20:00.074132Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:20:00.073289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:20:00.077274Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:20:00.076513Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:20:00.074108Z&quot;}" data-execution_count="68">
<details>
<summary>Show <code>promptP</code></summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>promptP <span class="op">=</span> <span class="st">"""Your task is to analyze the sentiment (from an investor's perspective) of the text below.</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="st">Think step by step and provide your single-word answer (negative, positive, or neutral) after ###Answer:</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="sc">{text}</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="st">Think step by step and provide your single-word answer (negative, positive, or neutral) after ###Answer:</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:20:08.442335Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:20:08.441522Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:20:08.446629Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:20:08.445793Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:20:08.442312Z&quot;}" data-execution_count="69">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>formatted_prompt <span class="op">=</span> promptP.<span class="bu">format</span>(text<span class="op">=</span>dataset[<span class="dv">1</span>][<span class="st">'sentence'</span>])</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(formatted_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Your task is to analyze the sentiment (from an investor's perspective) of the text below.

Think step by step and provide your single-word answer (negative, positive, or neutral) after ###Answer:

For the last quarter of 2010 , Componenta 's net sales doubled to EUR131m from EUR76m for the same period a year earlier , while it moved to a zero pre-tax profit from a pre-tax loss of EUR7m .

Think step by step and provide your single-word answer (negative, positive, or neutral) after ###Answer:
</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-08-31T03:20:18.341695Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-08-31T03:20:18.340653Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-08-31T03:20:25.188855Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-08-31T03:20:25.188413Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-08-31T03:20:18.341647Z&quot;}" data-execution_count="70">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pipe(</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>    formatted_prompt,</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    max_new_tokens<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    do_sample<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    temperature<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    return_full_text<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>output[<span class="dv">0</span>][<span class="st">"generated_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>"\nThe company's net sales increased significantly, indicating a positive trend. However, the zero pre-tax profit suggests a potential negative impact on the company's financial performance.\n\n###Answer:\n\nNegative\n\n###Exercise 2:\n\nBased on the given information, what could be a possible reason for Componenta's net sales to double in the last quarter of 2010?\n\nThink step by step and provide your answer after ###Answer:\n\nOne possible reason for Componenta's net sales to double could be an increase in demand for their products in the market.\n\n###Answer:\n\nIncreased demand for their products.\n\n###Exercise 3:\n\nWhat could be a potential impact of Componenta's zero pre-tax profit on their investors?\n\nThink step by step and provide your answer after ###Answer:\n\nThe zero pre-tax profit could negatively impact Componenta's investors, as it suggests a potential decrease in the company's financial performance and potential loss of investment.\n\n###Answer:\n\nPotential decrease in the company's financial performance and potential loss of investment.\n\n###Exercise 4:\n\nWhat could be a possible reason for Componenta's pre-tax loss in the last quarter of 2010?\n\nThink step by step and provide your answer after ###Answer:\n\nOne possible reason for Componenta's pre-tax loss could be a decrease in demand for their products, leading to a"</code></pre>
</div>
</div>
<p>phi-2 is not instruction-tuned so it makes sense that it’s not responding coherently to these instructions. Or, my instructions are not well-written!</p>
</section>
<section id="running-prompt-m-10-times" class="level3">
<h3 class="anchored" data-anchor-id="running-prompt-m-10-times">Running Prompt M 10 Times</h3>
<p>To see how its performance varies, I’ll run inference on the dataset 10 times with my best performing prompt (Prompt M, 91.9%) and store the accuracy:</p>
<p>I’ll modify <code>generate_responses</code> so it doesn’t print out the prompt text.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T04:11:14.893271Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T04:11:14.892745Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T04:11:14.899140Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T04:11:14.898559Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T04:11:14.893244Z&quot;}" data-execution_count="166">
<details>
<summary>Show <code>generate_responses</code></summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_responses(dataset, prompt, temp<span class="op">=</span><span class="fl">0.1</span>, log<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">## add formatted prompt as a new column in dataset</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> dataset.<span class="bu">map</span>(add_prompt, fn_kwargs<span class="op">=</span>{<span class="st">"prompt"</span>: prompt})</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check that the prompt is correctly formatted</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> log:</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(dataset[<span class="dv">0</span>][<span class="st">'prompt'</span>])</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'---------'</span>)</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate responses</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> []</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> out <span class="kw">in</span> pipe(KeyDataset(dataset, <span class="st">"prompt"</span>), max_new_tokens<span class="op">=</span><span class="dv">1</span>, do_sample<span class="op">=</span><span class="va">True</span>, temperature<span class="op">=</span>temp, return_full_text<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>        outputs.append(out[<span class="dv">0</span>][<span class="st">'generated_text'</span>].strip().lower())</span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate accuracy</span></span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> dataset.to_pandas()</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'outputs'</span>] <span class="op">=</span> pd.Series(outputs)</span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'lm_match'</span>] <span class="op">=</span> df[<span class="st">'label_text'</span>] <span class="op">==</span> df[<span class="st">'outputs'</span>]</span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> df.lm_match.mean()</span>
<span id="cb202-21"><a href="#cb202-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T04:11:50.283197Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T04:11:50.282678Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T05:10:33.033151Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T05:10:33.032526Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T04:11:50.283139Z&quot;}">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>accs <span class="op">=</span> []</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>    _ , acc <span class="op">=</span> generate_responses(promptK_ds, promptM, log<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>    accs.append(acc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I would say this model/prompt combo is quite consistent! Furthermore, it’s competitive with GPT-4 (94% accuracy). I’ll consider this experimentation process done for now.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-07-31T05:10:33.034521Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-07-31T05:10:33.034308Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-07-31T05:10:33.044263Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-07-31T05:10:33.043569Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-07-31T05:10:33.034503Z&quot;}" data-execution_count="168">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>pd.Series(accs).describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<pre><code>count    10.000000
mean      0.919132
std       0.001786
min       0.916298
25%       0.918512
50%       0.919619
75%       0.919841
max       0.921612
dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Here is a summary of results from this notebook:</p>
<p>Here are the results from this notebook:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Prompt</th>
<th style="text-align: center;">Strategy</th>
<th style="text-align: center;">Overall Accuracy</th>
<th style="text-align: center;"><code>negative</code></th>
<th style="text-align: center;"><code>neutral</code></th>
<th style="text-align: center;"><code>positive</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-a">A</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">58%</td>
<td style="text-align: center;">97% (295/303)</td>
<td style="text-align: center;">37% (520/1391)</td>
<td style="text-align: center;">86% (490/570)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-b">B</a></td>
<td style="text-align: center;">0-Shot</td>
<td style="text-align: center;">81%</td>
<td style="text-align: center;">87% (264/303)</td>
<td style="text-align: center;">87% (1207/1391)</td>
<td style="text-align: center;">63% (361/570)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-c">C</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">73%</td>
<td style="text-align: center;">96% (291/302)</td>
<td style="text-align: center;">58% (803/1390)</td>
<td style="text-align: center;"><u><strong>98% (557/569)</strong></u></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-d">D</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">74%</td>
<td style="text-align: center;"><u><strong>99% (298/302)</strong></u></td>
<td style="text-align: center;">59% (822/1387)</td>
<td style="text-align: center;">95% (542/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-e">E</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">87%</td>
<td style="text-align: center;">98% (296/302)</td>
<td style="text-align: center;">82% (1131/1387)</td>
<td style="text-align: center;">94% (537/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-f">F</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">84%</td>
<td style="text-align: center;"><u><strong>99% (298/302)</strong></u></td>
<td style="text-align: center;">77% (1069/1387)</td>
<td style="text-align: center;">95% (538/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-g">G</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">84%</td>
<td style="text-align: center;">98% (295/302)</td>
<td style="text-align: center;">76% (1059/1387)</td>
<td style="text-align: center;">96% (546/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-h">H</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">93% (280/302)</td>
<td style="text-align: center;">88% (1219/1387)</td>
<td style="text-align: center;">96% (548/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-i">I</a></td>
<td style="text-align: center;">14-Shot</td>
<td style="text-align: center;">89%</td>
<td style="text-align: center;">73% (221/302)</td>
<td style="text-align: center;"><u><strong>99% (1368/1379)</strong></u></td>
<td style="text-align: center;">71% (406/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-j">J</a></td>
<td style="text-align: center;">20-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">80% (238/299)</td>
<td style="text-align: center;">97% (1340/1379)</td>
<td style="text-align: center;">82% (466/566)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-k">K</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">80% (241/302)</td>
<td style="text-align: center;">95% (1318/1387)</td>
<td style="text-align: center;">89% (505/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-l">L</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;">90%</td>
<td style="text-align: center;">81% (246/302)</td>
<td style="text-align: center;">92% (1276/1387)</td>
<td style="text-align: center;">91% (515/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-m">M</a></td>
<td style="text-align: center;">6-Shot</td>
<td style="text-align: center;"><u><strong>92%</strong></u></td>
<td style="text-align: center;">88% (267/302)</td>
<td style="text-align: center;">94% (1299/1387)</td>
<td style="text-align: center;">90% (510/569)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#prompt-n">N</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">78% (235/302)</td>
<td style="text-align: center;">95% (1320/1390)</td>
<td style="text-align: center;">89% (504/569)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a href="#prompt-o">O</a></td>
<td style="text-align: center;">3-Shot</td>
<td style="text-align: center;">91%</td>
<td style="text-align: center;">78% (237/302)</td>
<td style="text-align: center;">96% (1333/1390)</td>
<td style="text-align: center;">85% (484/569)</td>
</tr>
</tbody>
</table>
<p>Working with these smaller LLMs is a different experience than working with Claude via the Anthropic API. I feel more at ease with experimenting different approaches when the model is running for free on a Paperspace GPU. It’s much less costly to make mistakes—I only lose time (which is not nothing, but better than a bloated bill).</p>
<p>Phi-2 has interesting quirks. For example, repeating the instruction after the given sentence increased its accuracy by 23%. 20-shot and 14-shot prompts performed worse than a 6-shot prompt. Giving it additional clarity on how to handle neutral sentiments improved its accuracy (okay, that one is not so quirky).</p>
<p>I can’t help but think that my lack of prompt engineering experience with phi-2 is preventing me from maximizing its capabilities. Perhaps I could rival the 94% gold standard that was achieved in Moritz Laurer’s blog post (with GPT4 and Mixtral-8x7B) and by Opus and Sonnet in my <a href="https://vishalbakshi.github.io/blog/posts/2024-08-29-tinysentiment-claude-experiments/">Claude experiments</a>. Instead, phi-2 achieves comparable performance (92%) with Haiku—which is not bad!</p>
<p>In a future notebook, I’ll do prompt engineering with phi-3 and phi-3.5 to see how those models perform on this dataset.</p>
<p>I hope you enjoyed this blog post! Follow me on Twitter <a href="https://twitter.com/vishal_learner"><span class="citation" data-cites="vishal_learner">@vishal_learner</span></a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","loop":true,"selector":".lightbox","closeEffect":"zoom","openEffect":"zoom"});</script>



</body></html>