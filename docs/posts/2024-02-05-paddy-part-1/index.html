<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Vishal Bakshi">
<meta name="dcterms.date" content="2024-02-05">
<meta name="description" content="In this notebook I work through Jeremy Howard’s Live Coding 8 video in which he starts working on the Paddy Doctor Disease Classification Kaggle Competition.">

<title>Vishal Bakshi’s Blog - Paddy Doctor Kaggle Competition - Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vishal Bakshi’s Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#get-file-sizes-the-slow-way" id="toc-get-file-sizes-the-slow-way" class="nav-link" data-scroll-target="#get-file-sizes-the-slow-way">Get file sizes the slow way</a></li>
  <li><a href="#create-a-dataloaders-object" id="toc-create-a-dataloaders-object" class="nav-link" data-scroll-target="#create-a-dataloaders-object">Create a <code>DataLoaders</code> object</a></li>
  <li><a href="#selecting-a-different-image-model-from-timm" id="toc-selecting-a-different-image-model-from-timm" class="nav-link" data-scroll-target="#selecting-a-different-image-model-from-timm">Selecting a different image model from timm</a></li>
  <li><a href="#start-fine-tuning-model" id="toc-start-fine-tuning-model" class="nav-link" data-scroll-target="#start-fine-tuning-model">Start fine tuning model</a></li>
  <li><a href="#discussion-of-fit_one_cycle" id="toc-discussion-of-fit_one_cycle" class="nav-link" data-scroll-target="#discussion-of-fit_one_cycle">Discussion of <code>fit_one_cycle</code></a></li>
  <li><a href="#applying-fine-tuned-model-to-test-set" id="toc-applying-fine-tuned-model-to-test-set" class="nav-link" data-scroll-target="#applying-fine-tuned-model-to-test-set">Applying fine tuned model to test set</a></li>
  <li><a href="#applying-fine-tuned-model-to-test-set-1" id="toc-applying-fine-tuned-model-to-test-set-1" class="nav-link" data-scroll-target="#applying-fine-tuned-model-to-test-set-1">Applying fine tuned model to test set</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Paddy Doctor Kaggle Competition - Part 1</h1>
  <div class="quarto-categories">
    <div class="quarto-category">deep learning</div>
    <div class="quarto-category">fastai</div>
    <div class="quarto-category">kaggle competition</div>
    <div class="quarto-category">paddy doctor</div>
    <div class="quarto-category">python</div>
  </div>
  </div>

<div>
  <div class="description">
    In this notebook I work through Jeremy Howard’s Live Coding 8 video in which he starts working on the Paddy Doctor Disease Classification Kaggle Competition.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Vishal Bakshi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>In the fastai course Part 1 <a href="https://youtu.be/AdhG64NF76E?feature=shared&amp;t=3117">Lesson 6 video</a> Jeremy Howard walked through the notebooks <a href="https://www.kaggle.com/code/jhoward/first-steps-road-to-the-top-part-1">First Steps: Road to the Top, Part 1</a> and <a href="https://www.kaggle.com/code/jhoward/small-models-road-to-the-top-part-2">Small models: Road to the Top, Part 2</a> where he builds increasingly accurate solutions to the <a href="https://www.kaggle.com/competitions/paddy-disease-classification">Paddy Doctor: Paddy Disease Classification</a> Kaggle Competition. In the video, Jeremy referenced a series of walkthrough videos that he made while working through the four-notebook series for this competition. I’m excited to watch these walkthroughs to better understand how to approach a Kaggle competition from the perspective of a former #1 Kaggle grandmaster.</p>
<p>In this blog post series, I’ll walk through the code Jeremy shared in each of the 6 Live Coding videos focused on this competition, submitting predictions to Kaggle along the way. My last two blog posts in this series reference Jeremy’s <a href="https://www.kaggle.com/code/jhoward/scaling-up-road-to-the-top-part-3">Scaling Up: Road to the Top, Part 3</a> notebook to improve my large model ensemble predictions. Here are the links to each of the blog posts in this series:</p>
<ul>
<li>Part 1: Live Coding 8 (You are here)</li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-2/">Part 2: Live Coding 9</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-3/">Part 3: Live Coding 10</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-4/">Part 4: Live Coding 11</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-5/">Part 5: Live Coding 12</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-6/">Part 6: Live Coding 13</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-7/">Part 7: Improving My Large Ensemble, Part 1</a></li>
<li><a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-8/">Part 8: Improving My Large Ensemble, Part 2</a></li>
</ul>
<p><a href="https://www.youtube.com/watch?v=-Scs4gbwWXg">Link to the Live Coding 8 video</a></p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:57:06.882336Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:57:06.881483Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:57:30.579050Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:57:30.578088Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:57:06.882288Z&quot;}" data-trusted="true" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>qq timm<span class="op">==</span><span class="fl">0.6.13</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>timm.__version__</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'0.6.13'</code></pre>
</div>
</div>
<p>You might have to restart kernel (right-click on a cell &gt; scroll down and click “Restart Kernel”) after installing a specific version of `timm`` to make sure Kaggle uses that version (and not the latest version which in January 2024 was 0.9.10).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:14.958729Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:14.958386Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:42.611882Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:42.610722Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:14.958702Z&quot;}" data-trusted="true" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install fastkaggle if not available</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: <span class="im">import</span> fastkaggle</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ModuleNotFoundError:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">-</span>Uq fastkaggle</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastkaggle <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> <span class="st">'paddy-disease-classification'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> setup_comp(comp, install<span class="op">=</span><span class="st">'fastai'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/scipy/__init__.py:146: UserWarning: A NumPy version &gt;=1.16.5 and &lt;1.23.0 is required for this version of SciPy (detected version 1.24.3
  warnings.warn(f"A NumPy version &gt;={np_minversion} and &lt;{np_maxversion}"</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:42.614149Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:42.613640Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:42.622704Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:42.621886Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:42.614120Z&quot;}" data-trusted="true" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>path.ls()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(#4) [Path('../input/paddy-disease-classification/sample_submission.csv'),Path('../input/paddy-disease-classification/train_images'),Path('../input/paddy-disease-classification/train.csv'),Path('../input/paddy-disease-classification/test_images')]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:42.624189Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:42.623918Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:42.639469Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:42.638618Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:42.624164Z&quot;}" data-trusted="true" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>trn_path <span class="op">=</span> path<span class="op">/</span><span class="st">'train_images'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:42.642585Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:42.642311Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:49.865826Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:49.864744Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:42.642562Z&quot;}" data-trusted="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> get_image_files(trn_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:49.868186Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:49.867759Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:50.015830Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:50.014939Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:49.868149Z&quot;}" data-trusted="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> PILImage.create(files[<span class="dv">0</span>])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>img</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="index_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:50.017735Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:50.017162Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T03:58:50.024436Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T03:58:50.023380Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:50.017702Z&quot;}" data-trusted="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>img.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(480, 640)</code></pre>
</div>
</div>
</section>
<section id="get-file-sizes-the-slow-way" class="level2">
<h2 class="anchored" data-anchor-id="get-file-sizes-the-slow-way">Get file sizes the slow way</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T03:58:50.026084Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T03:58:50.025723Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:00:49.510966Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:00:49.509812Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T03:58:50.026032Z&quot;}" data-trusted="true" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time sizes <span class="op">=</span> [PILImage.create(o).size <span class="cf">for</span> o <span class="kw">in</span> files]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 30.1 s, sys: 1.76 s, total: 31.9 s
Wall time: 1min 59s</code></pre>
</div>
</div>
<p>If most of the time is spent reading the image from the disk, doing it in parallel won’t be much faster. If most of the time is spent decoding the JPEG, then doing it in parallel will be faster. Which of these is true depends on whether we are using an SSD.</p>
<section id="using-parallel-processing-to-speed-things-up" class="level4">
<h4 class="anchored" data-anchor-id="using-parallel-processing-to-speed-things-up">Using parallel processing to speed things up</h4>
<p>To do this in parallel (using the CPU):</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:00:49.513839Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:00:49.513484Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:00:49.519679Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:00:49.518777Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:00:49.513780Z&quot;}" data-trusted="true" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.parallel <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:00:49.521226Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:00:49.520957Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:00:49.532480Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:00:49.531481Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:00:49.521202Z&quot;}" data-trusted="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(o): <span class="cf">return</span> PILImage.create(o).size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you increase the number of workers (<code>n_workers</code>) from 2 to 4, the overall wall time decreases. When you increase from 4 to 8, it actually slightly increases.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:00:49.539761Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:00:49.539424Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:01:33.979900Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:01:33.978839Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:00:49.539730Z&quot;}" data-trusted="true" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time sizes <span class="op">=</span> parallel(f, files, n_workers<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 4.03 s, sys: 917 ms, total: 4.94 s
Wall time: 44.4 s</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:01:33.981741Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:01:33.981355Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:03.792190Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:03.791080Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:01:33.981703Z&quot;}" data-trusted="true" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time sizes <span class="op">=</span> parallel(f, files, n_workers<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 3.78 s, sys: 689 ms, total: 4.47 s
Wall time: 29.8 s</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:03.793911Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:03.793523Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:34.533123Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:34.531870Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:03.793875Z&quot;}" data-trusted="true" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time sizes <span class="op">=</span> parallel(f, files, n_workers<span class="op">=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 3.77 s, sys: 720 ms, total: 4.49 s
Wall time: 30.7 s</code></pre>
</div>
</div>
<p>Note: you can’t use <code>lambda</code> functions with <code>parallel</code>.</p>
</section>
</section>
<section id="create-a-dataloaders-object" class="level2">
<h2 class="anchored" data-anchor-id="create-a-dataloaders-object">Create a <code>DataLoaders</code> object</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:34.535525Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:34.534480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:35.862388Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:35.861278Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:34.535495Z&quot;}" data-trusted="true" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    trn_path,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    valid_pct<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:35.864219Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:35.863887Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:37.931686Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:37.930671Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:35.864192Z&quot;}" data-trusted="true" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dls.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ImageDataLoaders.from_folder(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  trn_path,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  valid_pct<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  item_tfms<span class="op">=</span>Resize(<span class="dv">224</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="selecting-a-different-image-model-from-timm" class="level2">
<h2 class="anchored" data-anchor-id="selecting-a-different-image-model-from-timm">Selecting a different image model from timm</h2>
<p>View which models are available in the <code>timm</code> library:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:37.933515Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:37.933187Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:37.942408Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:37.941344Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:37.933487Z&quot;}" data-trusted="true" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>timm.list_models(<span class="st">'convnext*'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>['convnext_atto',
 'convnext_atto_ols',
 'convnext_base',
 'convnext_base_384_in22ft1k',
 'convnext_base_in22ft1k',
 'convnext_base_in22k',
 'convnext_femto',
 'convnext_femto_ols',
 'convnext_large',
 'convnext_large_384_in22ft1k',
 'convnext_large_in22ft1k',
 'convnext_large_in22k',
 'convnext_nano',
 'convnext_nano_ols',
 'convnext_pico',
 'convnext_pico_ols',
 'convnext_small',
 'convnext_small_384_in22ft1k',
 'convnext_small_in22ft1k',
 'convnext_small_in22k',
 'convnext_tiny',
 'convnext_tiny_384_in22ft1k',
 'convnext_tiny_hnf',
 'convnext_tiny_in22ft1k',
 'convnext_tiny_in22k',
 'convnext_xlarge_384_in22ft1k',
 'convnext_xlarge_in22ft1k',
 'convnext_xlarge_in22k']</code></pre>
</div>
</div>
<p>In <code>'convnext_small_in22k'</code>, <code>in</code> refers to ImageNet, <code>22k</code> refers to the version of ImageNet with 22,000 categories, which is more likely to have seen something like rice paddy images than the 1000 category version of ImageNet.</p>
</section>
<section id="start-fine-tuning-model" class="level2">
<h2 class="anchored" data-anchor-id="start-fine-tuning-model">Start fine tuning model</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:37.944299Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:37.943957Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:02:41.844832Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:02:41.843660Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:37.944269Z&quot;}" data-trusted="true" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, <span class="st">'convnext_small_in22k'</span>, metrics<span class="op">=</span>error_rate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading: "https://dl.fbaipublicfiles.com/convnext/convnext_small_22k_224.pth" to /root/.cache/torch/hub/checkpoints/convnext_small_22k_224.pth</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:02:41.846867Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:02:41.846536Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:12:49.735282Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:12:49.734250Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:02:41.846839Z&quot;}" data-trusted="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>learn.fine_tune(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.170897</td>
      <td>0.561514</td>
      <td>0.187410</td>
      <td>02:11</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.568585</td>
      <td>0.306411</td>
      <td>0.099952</td>
      <td>03:58</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.363094</td>
      <td>0.219503</td>
      <td>0.074964</td>
      <td>03:57</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<p>What does <code>fine_tune</code> do? - Calls <code>Learner.freeze</code> which only allows the optimizer to change the last layer’s weights - Calls <code>Learner.fit_one_cycle</code> which updates the weights in the last layer for <code>freeze_epochs</code> - Calls <code>Learner.unfreeze</code> to allow the optimizer to update all weights - Calls <code>Learner.fit_one_cycle</code> for <code>epochs</code> which updates all of the layers’ weights</p>
<p>If you are using a GPU that was released in the last 4 years or so (since 2019ish) it will train faster if you use half precision point. Most of the time on Colab or Kaggle you are not going to get one of those more up to date GPUs. Having said that, there’s really never any harm using half-precision floating point. Even if you are using an older GPU, it’s still going to save memory. To ask fastai to do that for you, add <code>.to_fp16()</code> at the end of the <code>vision_learner</code> call:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, <span class="st">'convnext_small_in22k'</span>, metrics<span class="op">=</span>error_rate).to_fp16()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:12:49.737068Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:12:49.736761Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:23.536031Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:23.534867Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:12:49.737043Z&quot;}" data-trusted="true" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> vision_learner(dls, <span class="st">'convnext_small_in22k'</span>, metrics<span class="op">=</span>error_rate).to_fp16()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>learn.fine_tune(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.157001</td>
      <td>0.536221</td>
      <td>0.178760</td>
      <td>00:59</td>
    </tr>
  </tbody>
</table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>error_rate</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.580092</td>
      <td>0.332838</td>
      <td>0.113407</td>
      <td>01:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.373035</td>
      <td>0.220751</td>
      <td>0.065834</td>
      <td>01:16</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<p>Using <code>to_fp16</code> resulted in a training that took only about a third of the time as the full-precision training and actually resulted in a slightly better error rate. To be fair, the first time I ran both trainings, the half-precision training resulted in a slightly worse error rate.</p>
</section>
<section id="discussion-of-fit_one_cycle" class="level2">
<h2 class="anchored" data-anchor-id="discussion-of-fit_one_cycle">Discussion of <code>fit_one_cycle</code></h2>
<p><code>fit_one_cycle</code> uses a scheduler which is something that changes the learning rate during training. Remember that the learning rate is the thing we multiply the gradients by before we subtract them from the parameters. When you have a randomly initialized model, or even a pretrained model (we randomly initialize the last layer of weights). At first even a pretrained model that we are fine-tuning can’t do anything. It’s still giving random answers. That means we want to use a really small learning rate because it’s very difficult to get to a point where it’s starting to learn something slightly useful. So with <code>fit_one_cycle</code> when we start training the first few batches use a tiny learning rate, and then as the model gets better and better at doing something useful, you can increase the learning rate because it’s gotten to a point where it knows vaguely what it’s doing. So as it trains the learning rate goes up, and then as you start to get close to the answer, you need to decrease the learning rate because you only need to take really little steps. The schedule used by <code>fit_one_cycle</code> is not interacting with anything (training loss, validation loss, etc) it’s just following the shape of the curve of learning rate vs.&nbsp;batch number.</p>
<p>Sylvain Gugger has a good <a href="https://sgugger.github.io/the-1cycle-policy.html">blog post</a> about the 1cycle policy.</p>
<p>The learning rate finder (<code>Learner.lr_find</code>) does something very similar to the 1cycle scheduler, which is that it gradually increases the learning rate while it train up to 100 batches, which is generally far less than an epoch. It doesn’t increase then decrease the learning rate like <code>fit_one_cycle</code>, it just increases it until the whole training falls apart. Once the learning gets too high, the model jumps past the answer and the loss shoots off exponentially.</p>
<p>It surprisingly difficult to come up with algorithmically what our eyes do when we look at the loss curve to pick the best learning rate. Zach Mueller did a lot of experimenting with learning rate finder on the suggested learning rate defaults (minimum, steep, valley, slide). Note: “minimum” is the actual minimum divided by 10.</p>
<p>Most of the time fastai’s default learning rate works fine. Particularly for a tabular dataset the learning rate can be almost anything. It really does depend on the model. If you try something and it doesn’t seem to be training well, run <code>lr_rind</code> just in case the default learning rate is nowhere near the recommended values.</p>
</section>
<section id="applying-fine-tuned-model-to-test-set" class="level2">
<h2 class="anchored" data-anchor-id="applying-fine-tuned-model-to-test-set">Applying fine tuned model to test set</h2>
<p>Now that we have a model, we’ll have to apply it to our test set in order to submit it to Kaggle.</p>
<p>A test <code>DataLoader</code> is used for inference of a bunch of things at once.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:23.538104Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:23.537757Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:27.313805Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:27.312944Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:23.538078Z&quot;}" data-trusted="true" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tst_files <span class="op">=</span> get_image_files(path<span class="op">/</span><span class="st">'test_images'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:27.315252Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:27.314956Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:27.352749Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:27.351855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:27.315226Z&quot;}" data-trusted="true" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>tst_files.sort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:27.354166Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:27.353889Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:27.366669Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:27.365781Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:27.354142Z&quot;}" data-trusted="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tst_files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>(#3469) [Path('../input/paddy-disease-classification/test_images/200001.jpg'),Path('../input/paddy-disease-classification/test_images/200002.jpg'),Path('../input/paddy-disease-classification/test_images/200003.jpg'),Path('../input/paddy-disease-classification/test_images/200004.jpg'),Path('../input/paddy-disease-classification/test_images/200005.jpg'),Path('../input/paddy-disease-classification/test_images/200006.jpg'),Path('../input/paddy-disease-classification/test_images/200007.jpg'),Path('../input/paddy-disease-classification/test_images/200008.jpg'),Path('../input/paddy-disease-classification/test_images/200009.jpg'),Path('../input/paddy-disease-classification/test_images/200010.jpg')...]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:27.368476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:27.368146Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:27.377886Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:27.376855Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:27.368444Z&quot;}" data-trusted="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tst_dl <span class="op">=</span> dls.test_dl(tst_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:27.379181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:27.378877Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:29.157188Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:29.156135Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:27.379158Z&quot;}" data-trusted="true" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>tst_dl.show_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The key difference of a <code>test_dl</code> is that it doesn’t have labels.</p>
</section>
<section id="applying-fine-tuned-model-to-test-set-1" class="level2">
<h2 class="anchored" data-anchor-id="applying-fine-tuned-model-to-test-set-1">Applying fine tuned model to test set</h2>
<p>Let’s look at the sample submission provided in the Kaggle competition:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:29.158941Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:29.158567Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:29.203864Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:29.202997Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:29.158909Z&quot;}" data-trusted="true" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ss <span class="op">=</span> pd.read_csv(path<span class="op">/</span><span class="st">'sample_submission.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:29.205551Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:29.205279Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:29.240288Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:29.239204Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:29.205526Z&quot;}" data-trusted="true" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_id</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>200001.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200002.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>200003.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>200004.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>200005.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3464</th>
      <td>203465.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3465</th>
      <td>203466.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3466</th>
      <td>203467.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3467</th>
      <td>203468.jpg</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3468</th>
      <td>203469.jpg</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3469 rows × 2 columns</p>
</div>
</div>
</div>
<p>Unfortunately this doesn’t help, but we know from the Kaggle competition page that they want the text of the classification in the <code>label</code> column.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:29.242336Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:29.241947Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.827232Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.826028Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:29.242298Z&quot;}" data-trusted="true" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> learn.get_preds(dl<span class="op">=</span>tst_dl, with_decoded<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.829248Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.828902Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.856857Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.855887Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.829219Z&quot;}" data-trusted="true" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(tensor([[1.6281e-02, 1.7275e-04, 3.7474e-04,  ..., 9.6960e-01, 6.2574e-04,
          8.8058e-05],
         [1.4577e-05, 1.6399e-04, 1.4309e-05,  ..., 4.8571e-05, 9.9965e-01,
          1.9105e-05],
         [5.7042e-04, 2.4972e-03, 1.3404e-04,  ..., 3.4435e-03, 9.8561e-04,
          1.1331e-04],
         ...,
         [2.4891e-03, 9.6513e-05, 3.8919e-05,  ..., 4.2361e-04, 9.9636e-01,
          2.4615e-04],
         [1.1240e-03, 5.4271e-01, 2.8814e-03,  ..., 2.3160e-01, 5.7650e-02,
          7.0772e-02],
         [1.6173e-11, 5.5747e-10, 1.5082e-08,  ..., 3.0132e-10, 6.3914e-10,
          3.0830e-07]]),
 None,
 tensor([7, 8, 3,  ..., 8, 1, 5]))</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.863495Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.863189Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.868307Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.867083Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.863468Z&quot;}" data-trusted="true" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>probs,_,idxs <span class="op">=</span> preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.870229Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.869779Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.881293Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.880434Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.870194Z&quot;}" data-trusted="true" data-execution_count="30">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>idxs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>tensor([7, 8, 3,  ..., 8, 1, 5])</code></pre>
</div>
</div>
<p><code>idxs</code> are indexes into the <code>vocab</code> of the <code>DataLoaders</code>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.883342Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.882521Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.893154Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.892329Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.883314Z&quot;}" data-trusted="true" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dls.vocab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>['bacterial_leaf_blight', 'bacterial_leaf_streak', 'bacterial_panicle_blight', 'blast', 'brown_spot', 'dead_heart', 'downy_mildew', 'hispa', 'normal', 'tungro']</code></pre>
</div>
</div>
<p>Convert <code>idxs</code> into a <code>Series</code> object so we can map it to the <code>vocab</code>:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.894423Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.894141Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.904054Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.903116Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.894398Z&quot;}" data-trusted="true" data-execution_count="32">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>idxs <span class="op">=</span> pd.Series(idxs.numpy(), name<span class="op">=</span><span class="st">"idxs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.905715Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.905381Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.919700Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.918683Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.905684Z&quot;}" data-trusted="true" data-execution_count="33">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>idxs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>0       7
1       8
2       3
3       3
4       3
       ..
3464    5
3465    7
3466    8
3467    1
3468    5
Name: idxs, Length: 3469, dtype: int64</code></pre>
</div>
</div>
<p>We need to create a dictionary from <code>dls.vocab</code> that we can use as a mapping in <code>idxs.map</code></p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.921173Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.920855Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.929715Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.928760Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.921142Z&quot;}" data-trusted="true" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {k: v <span class="cf">for</span> k,v <span class="kw">in</span> <span class="bu">enumerate</span>(dls.vocab)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.932711Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.932427Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.952208Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.951475Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.932688Z&quot;}" data-trusted="true" data-execution_count="35">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> idxs.<span class="bu">map</span>(mapping)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: using a function for <code>Series.map</code> is really slow (259 times slower than using a dictionary).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.953444Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.953186Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:46.972418Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:46.971539Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.953422Z&quot;}" data-trusted="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time idxs.<span class="bu">map</span>(mapping)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 784 µs, sys: 0 ns, total: 784 µs
Wall time: 666 µs</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0                       hispa
1                      normal
2                       blast
3                       blast
4                       blast
                ...          
3464               dead_heart
3465                    hispa
3466                   normal
3467    bacterial_leaf_streak
3468               dead_heart
Name: idxs, Length: 3469, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:46.974271Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:46.973578Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:47.229059Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:47.228129Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:46.974244Z&quot;}" data-trusted="true" data-execution_count="37">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>time idxs.<span class="bu">map</span>(<span class="kw">lambda</span> i: dls.vocab[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 241 ms, sys: 2.5 ms, total: 243 ms
Wall time: 243 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0                       hispa
1                      normal
2                       blast
3                       blast
4                       blast
                ...          
3464               dead_heart
3465                    hispa
3466                   normal
3467    bacterial_leaf_streak
3468               dead_heart
Name: idxs, Length: 3469, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:47.230880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:47.230584Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:47.234958Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:47.234152Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:47.230856Z&quot;}" data-trusted="true" data-execution_count="38">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ss[<span class="st">'label'</span>] <span class="op">=</span> results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:47.236368Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:47.236044Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:47.254311Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:47.253393Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:47.236332Z&quot;}" data-trusted="true" data-execution_count="39">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>image_id</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>200001.jpg</td>
      <td>hispa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200002.jpg</td>
      <td>normal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>200003.jpg</td>
      <td>blast</td>
    </tr>
    <tr>
      <th>3</th>
      <td>200004.jpg</td>
      <td>blast</td>
    </tr>
    <tr>
      <th>4</th>
      <td>200005.jpg</td>
      <td>blast</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3464</th>
      <td>203465.jpg</td>
      <td>dead_heart</td>
    </tr>
    <tr>
      <th>3465</th>
      <td>203466.jpg</td>
      <td>hispa</td>
    </tr>
    <tr>
      <th>3466</th>
      <td>203467.jpg</td>
      <td>normal</td>
    </tr>
    <tr>
      <th>3467</th>
      <td>203468.jpg</td>
      <td>bacterial_leaf_streak</td>
    </tr>
    <tr>
      <th>3468</th>
      <td>203469.jpg</td>
      <td>dead_heart</td>
    </tr>
  </tbody>
</table>
<p>3469 rows × 2 columns</p>
</div>
</div>
</div>
<p>Normally at this point you should visually check your results:</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:47.255994Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:47.255702Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:49.215333Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:49.214445Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:47.255971Z&quot;}" data-trusted="true" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>learn.show_results()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-41-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>In this case, the problem is that I don’t which one of these are right so I don’t know what to look for.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:49.216888Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:49.216547Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:49.235280Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:49.234421Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:49.216857Z&quot;}" data-trusted="true" data-execution_count="41">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ss.to_csv(<span class="st">'submission.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2024-01-29T04:16:49.236602Z&quot;,&quot;iopub.status.busy&quot;:&quot;2024-01-29T04:16:49.236325Z&quot;,&quot;iopub.status.idle&quot;:&quot;2024-01-29T04:16:50.243568Z&quot;,&quot;shell.execute_reply&quot;:&quot;2024-01-29T04:16:50.242396Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2024-01-29T04:16:49.236577Z&quot;}" data-trusted="true" data-execution_count="42">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head submission.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>image_id,label
200001.jpg,hispa
200002.jpg,normal
200003.jpg,blast
200004.jpg,blast
200005.jpg,blast
200006.jpg,brown_spot
200007.jpg,dead_heart
200008.jpg,brown_spot
200009.jpg,hispa</code></pre>
</div>
</div>
<p>In my <a href="https://vishalbakshi.github.io/blog/posts/2024-02-05-paddy-part-2/">next blog post</a> I walk through the discussion and code from Live Coding 9.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>